; :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
;       paRt WALTER file
;
;       Theme: dimmed
;       Version: 1.2
;       Date: 2024-06-30 18:31:56
; :::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::


;~ ~ ~ ~ ~ ~ ~ ~ ~ ~ programmatically created Block ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ 

adjuster_script "part_theme-adjuster.lua"
define_parameter part_version 'paRt Theme v1.56' 0 0 0
define_parameter par_bank_selected 'Selected Bank' 2 2 9
define_parameter par_colors_track_envcp_bg_tint 'Colors - Track - ENVCP Background Select' 50 0 100
define_parameter par_colors_track_envcp_bg_tone 'Colors - Track - ENVCP Background Tone' 50 0 100
define_parameter par_colors_track_envcp_label_bg_Tone 'Colors - Track - ENVCP Label Background Tone' 50 0 100
define_parameter par_colors_track_envcp_label_bg_tint 'Colors - Track - ENVCP Label Background Select' 50 0 100
define_parameter par_colors_track_envcp_label_readout_tone 'Colors - Track - ENVCP Label Readout Tone' 50 0 100
define_parameter par_colors_track_envcp_label_text_tone 'Colors - Track - ENVCP Label Text Tone' 50 0 100
define_parameter par_colors_track_folder_foldertrack_tint 'Colors - Track - Folder Track Tint' 50 0 100
define_parameter par_colors_track_folder_foldertrack_tone 'Colors - Track - Folder Track Tone' 50 0 100
define_parameter par_colors_track_folder_foldertree_tint 'Colors - Track - Folder Tree Tint' 50 0 100
define_parameter par_colors_track_folder_foldertree_tone 'Colors - Track - Folder Tree Tone' 50 0 100
define_parameter par_colors_track_meter_text_alpha_bottom 'Colors - Track - Meter Text Alpha Botom' 100 0 100
define_parameter par_colors_track_meter_text_alpha_lit 'Colors - Track - Meter Text Alpha Lit' 50 0 100
define_parameter par_colors_track_meter_text_alpha_readout 'Colors - Track - Meter Text Alpha Readout' 50 0 100
define_parameter par_colors_track_meter_text_alpha_top 'Colors - Track - Meter Text Alpha Top' 100 0 100
define_parameter par_colors_track_meter_text_alpha_unlit 'Colors - Track - Meter Text Alpha Unlit' 50 0 100
define_parameter par_colors_track_meter_text_shadow_lit 'Colors - Track - Meter Text Shadow Top' 50 0 100
define_parameter par_colors_track_meter_text_shadow_unlit 'Colors - Track - Meter Text Shadow Bottom' 50 0 100
define_parameter par_colors_track_meter_text_tint_readout_clip 'Colors - Track - Meter Text Tint Readout Clip' 50 0 100
define_parameter par_colors_track_meter_text_tone_lit 'Colors - Track - Meter Text Tone Lit' 50 0 100
define_parameter par_colors_track_meter_text_tone_readout 'Colors - Track - Meter Text Tone Readout' 50 0 100
define_parameter par_colors_track_meter_text_tone_readout_clip 'Colors - Track - Meter Text Tone Readout Clip' 50 0 100
define_parameter par_colors_track_meter_text_tone_unlit 'Colors - Track - Meter Text Tone Unlit' 50 0 100
define_parameter par_colors_track_track_bg_select_tint 'Colors - Track - Track Background Selection Tint' 50 0 100
define_parameter par_colors_track_track_bg_select_tone 'Colors - Track - Track Background Selection Tone' 50 0 100
define_parameter par_colors_track_track_bg_tint 'Colors - Track - Track Background Select' 50 0 100
define_parameter par_colors_track_track_bg_tone 'Colors - Track - Track Background Tone' 50 0 100
define_parameter par_colors_track_track_colorbar_intensity 'Colors - Track - Track Colorbar Intensity' 50 0 100
define_parameter par_colors_track_track_index_tone_mcp 'Colors - Track - Track Label Index Tone MCP' 50 0 100
define_parameter par_colors_track_track_index_tone_tcp 'Colors - Track - Track Label Index Tone TCP' 50 0 100
define_parameter par_colors_track_track_label_bg_tint 'Colors - Track - Track Label Background Tint' 50 0 100
define_parameter par_colors_track_track_label_bg_tone 'Colors - Track - Track Label Background Tone' 50 0 100
define_parameter par_colors_track_track_label_select_tint 'Colors - Track - Track Label Selection Tint' 50 0 100
define_parameter par_colors_track_track_label_select_tone 'Colors - Track - Track Label Selection Tone' 50 0 100
define_parameter par_colors_track_track_label_text_tone 'Colors - Track - Track Label Text Tone' 50 0 100
define_parameter par_mcp_gen_element_adj_separator 'MCP - Track - Element Adjustments Separator' 0 0 20
define_parameter par_mcp_gen_element_adj_separator_line 'MCP - Track - Element Adjustments Separator Line' 0 0 1
define_parameter par_mcp_gen_element_adj_spacing_fader_x 'MCP - Track - Element Adjustments Spacing Fader X' 0 0 20
define_parameter par_mcp_gen_element_adj_spacing_fader_y 'MCP - Track - Element Adjustments Spacing Fader Y' 0 0 20 
define_parameter par_mcp_gen_element_adj_spacing_section_x 'MCP - Track - Element Adjustments Spacing Section X' 0 0 20
define_parameter par_mcp_gen_element_adj_spacing_section_y 'MCP - Track - Element Adjustments Spacing Section Y' 0 0 20
define_parameter par_mcp_gen_element_adj_spacing_x 'MCP - Track - Element Adjustments Spacing X' 0 0 20
define_parameter par_mcp_gen_element_adj_spacing_y 'MCP - Track - Element Adjustments Spacing Y' 0 0 20
define_parameter par_mcp_gen_folder_grid 'MCP - General - Folder Grid' 0 0 1
define_parameter par_mcp_gen_folder_icon_folder 'MCP - General - Folder Icon Parent' 0 0 1
define_parameter par_mcp_gen_folder_icon_last 'MCP - General - Folder Icon Last' 0 0 1
define_parameter par_mcp_gen_folder_indent 'MCP - General - Folder Indent' 0 0 50
define_parameter par_mcp_gen_folder_pad_folder_last 'MCP - General - Folder Padding Last' 0 0 100
define_parameter par_mcp_gen_folder_pad_folder_parent 'MCP - General - Folder Padding Parent' 0 0 100
define_parameter par_mcp_gen_highlight_color 'MCP - General - Highlight Color Bar' 0 0 100
define_parameter par_mcp_gen_highlight_selection 'MCP - General - Highlight Selection Bar' 0 0 100
define_parameter par_mcp_gen_settings_multirow 'MCP - General - Settings MultiRow' 0 0 1
define_parameter par_mcp_gen_settings_multirow_compact 'MCP - General - Settings MultiRow Compact' 0 0 1
define_parameter par_mcp_gen_settings_trackicons 'MCP - General - Settings Track Icons' 0 0 1
define_parameter par_mcp_master_element_separator 'MCP - Master - Element Separator' 0 0 100000
define_parameter par_mcp_master_element_vis 'MCP - Master - Element Visibility' 0 0 100000
define_parameter par_mcp_master_element_width 'MCP - Master - Element Width' 0 0 1
define_parameter par_mcp_master_fader_layout 'MCP - Master - Faders Layout' 0 0 10
define_parameter par_mcp_master_fader_pan_height 'MCP - Master - Faders Pan Height' 0 0 100
define_parameter par_mcp_master_fader_pan_height_scale 'MCP - Master - Faders Pan Height Scale' 0 0 1
define_parameter par_mcp_master_fader_pan_mode_dual 'MCP - Master - Faders Pan Mode Dual' 0 0 10
define_parameter par_mcp_master_fader_pan_mode_mono 'MCP - Master - Faders Pan Mode Mono' 0 0 10
define_parameter par_mcp_master_fader_pan_mode_stereo 'MCP - Master - Faders Pan Mode Stereo' 0 0 10
define_parameter par_mcp_master_fader_pan_width 'MCP - Master - Faders Pan Width' 0 0 100
define_parameter par_mcp_master_fader_wid_always 'MCP - Master - Faders Always Show Width' 0 0 1 
define_parameter par_mcp_master_insert_mode 'MCP - Master - Inserts Mode' 0 0 2
define_parameter par_mcp_master_insert_pad 'MCP - Master - Inserts Padding' 0 0 2
define_parameter par_mcp_master_insert_size 'MCP - Master - Inserts Size' 0 0 100
define_parameter par_mcp_master_insert_size_scale 'MCP - Master - Inserts Size Scale' 0 0 1
define_parameter par_mcp_master_meter_channeldiv 'MCP - Master - Meter Channel Division' 0 0 100
define_parameter par_mcp_master_meter_channeldiv_rms 'MCP - Master - Meter Channel Division RMS' 0 0 100
define_parameter par_mcp_master_meter_padding 'MCP - Master - Meter Padding' 0 0 2
define_parameter par_mcp_master_meter_pos 'MCP - Master - Meter Position' 0 0 2
define_parameter par_mcp_master_meter_size 'MCP - Master - Meter Size' 0 0 100
define_parameter par_mcp_master_meter_size_scale 'MCP - Master - Meter Size Scale' 0 0 1
define_parameter par_mcp_master_meter_vol_readout 'MCP - Master - Meter Volume Readout' 0 0 2
define_parameter par_mcp_master_meter_vu_db 'MCP - Master - Meter VU dB' 0 0 1
define_parameter par_mcp_master_meter_vu_readout 'MCP - Master - Meter VU Readout' 0 0 1
define_parameter par_mcp_master_settings_extrapad 'MCP - Master - Settigns Extra Padding' 0 0 100
define_parameter par_mcp_master_settings_label_size 'MCP - Master - Settigns Label Size' 0 0 100
define_parameter par_mcp_track_element_input_size 'MCP - Track - Element Input Size' 0 0 100
define_parameter par_mcp_track_element_separator 'MCP - Track - Element Separator' 0 0 100000
define_parameter par_mcp_track_element_vis 'MCP - Track - Element Visibility' 0 0 100000
define_parameter par_mcp_track_element_width 'MCP - Track - Element Width' 0 0 1
define_parameter par_mcp_track_fader_layout 'MCP - Track - Faders Layout' 0 0 10
define_parameter par_mcp_track_fader_pan_height 'MCP - Track - Faders Pan Height' 0 0 100
define_parameter par_mcp_track_fader_pan_height_scale 'MCP - Track - Faders Pan Height Scale' 0 0 1
define_parameter par_mcp_track_fader_pan_mode_dual 'MCP - Track - Faders Pan Mode Dual' 0 0 10
define_parameter par_mcp_track_fader_pan_mode_mono 'MCP - Track - Faders Pan Mode Mono' 0 0 10
define_parameter par_mcp_track_fader_pan_mode_stereo 'MCP - Track - Faders Pan Mode Stereo' 0 0 10
define_parameter par_mcp_track_fader_pan_width 'MCP - Track - Faders Pan Width' 0 0 100
define_parameter par_mcp_track_fader_wid_always 'MCP - Track - Faders Always Show Width' 0 0 1 
define_parameter par_mcp_track_insert_mode 'MCP - Track - Inserts Mode' 0 0 3
define_parameter par_mcp_track_insert_pad 'MCP - Track - Inserts Padding' 0 0 2
define_parameter par_mcp_track_insert_size 'MCP - Track - Inserts Size' 0 0 100
define_parameter par_mcp_track_insert_size_embed 'MCP - Track - Inserts Size Embed' 0 0 100
define_parameter par_mcp_track_insert_size_scale 'MCP - Track - Inserts Size Scale' 0 0 1
define_parameter par_mcp_track_meter_channeldiv 'MCP - Track - Meter Channel Division' 0 0 100
define_parameter par_mcp_track_meter_expand 'MCP - Track - Meter Expansion' 0 0 100
define_parameter par_mcp_track_meter_expand_mode 'MCP - Track - Meter Expansion Mode' 0 0 1
define_parameter par_mcp_track_meter_expand_threshold 'MCP - Track - Meter Expansion Threshold' 2 2 36
define_parameter par_mcp_track_meter_padding 'MCP - Track - Meter Padding' 0 0 2
define_parameter par_mcp_track_meter_pos 'MCP - Track - Meter Position' 0 0 2
define_parameter par_mcp_track_meter_size 'MCP - Track - Meter Size' 0 0 100
define_parameter par_mcp_track_meter_size_scale 'MCP - Track - Meter Size Scale' 0 0 1
define_parameter par_mcp_track_meter_vol_readout 'MCP - Track - Meter Volume Readout' 0 0 2
define_parameter par_mcp_track_meter_vu_db 'MCP - Track - Meter VU dB' 0 0 1
define_parameter par_mcp_track_meter_vu_readout 'MCP - Track - Meter VU Readout' 0 0 1
define_parameter par_mcp_track_settings_extrapad 'MCP - Track - Settings Extra Padding' 0 0 50
define_parameter par_mcp_track_settings_label_index 'MCP - Track - Settings Label Index Position' 0 0 2
define_parameter par_mcp_track_settings_label_size 'MCP - Track - Settings Label Size' 0 0 100
define_parameter par_mcp_track_settings_label_vertical 'MCP - Track - Settings Label Vertical' 0 0 1
define_parameter par_tcp_envcp_element_separator 'TCP - ENVCP - Element Separator' 0 0 1000000
define_parameter par_tcp_envcp_element_vis 'TCP - ENVCP - Element Visibility' 0 0 1000000
define_parameter par_tcp_envcp_label_readout_placement 'TCP - ENVCP - Label Readout Placement' 0 0 2
define_parameter par_tcp_envcp_label_readout_size 'TCP - ENVCP - Label Readout Separator Size' 0 0 100
define_parameter par_tcp_envcp_label_readout_size_scale 'TCP - ENVCP - Label Readout Separator Size Scale' 0 0 1
define_parameter par_tcp_envcp_label_size 'TCP - ENVCP - Label Size' 0 0 100
define_parameter par_tcp_envcp_settings_indent 'TCP - ENVCP - Settings Indentation' 0 0 100
define_parameter par_tcp_envcp_settings_lane_display 'TCP - ENVCP - Settings Lane Display' 0 0 2
define_parameter par_tcp_envcp_settings_symbol 'TCP - ENVCP - Settings Symbol' 0 0 1
define_parameter par_tcp_envcp_value_lane 'TCP - ENVCP - Value Display Lane' 0 0 1
define_parameter par_tcp_envcp_value_mode 'TCP - ENVCP - Value Display Mode' 0 0 3
define_parameter par_tcp_envcp_value_scale 'TCP - ENVCP - Value Size Scaling' 0 0 1
define_parameter par_tcp_envcp_value_size 'TCP - ENVCP - Value Size' 0 0 100
define_parameter par_tcp_envcp_value_vertical 'TCP - ENVCP - Value Display Vertical' 0 0 1
define_parameter par_tcp_gen_element_adj_separator 'TCP - General - Element Adjustment Separator Size' 0 0 20
define_parameter par_tcp_gen_element_adj_separator_line 'TCP - General - Element Adjustment Separator Line' 0 0 1
define_parameter par_tcp_gen_element_adj_show_fx 'TCP - General - Element Adjustment Show FX' 0 0 1
define_parameter par_tcp_gen_element_adj_show_sends 'TCP - General - Element Adjustment Show Sends' 0 0 1
define_parameter par_tcp_gen_element_adj_spacing_section_x 'TCP - General - Element Adjustment Spacing Section X' 0 0 20
define_parameter par_tcp_gen_element_adj_spacing_section_y 'TCP - General - Element Adjustment Spacing Section Y' 0 0 20
define_parameter par_tcp_gen_element_adj_spacing_x 'TCP - General - Element Adjustment Spacing X' 0 0 20
define_parameter par_tcp_gen_element_adj_spacing_x_fader 'TCP - General - Element Adjustment Spacing X Fader' 0 0 20
define_parameter par_tcp_gen_element_adj_spacing_y_fader 'TCP - General - Element Adjustment Spacing Y Fader' 0 0 20
define_parameter par_tcp_gen_folder_icon_collapse 'TCP - General - Folder Collapse' 0 0 1
define_parameter par_tcp_gen_folder_icon_grid 'TCP - General - Folder Grid' 0 0 1
define_parameter par_tcp_gen_folder_icon_mode 'TCP - General - Folder Mode' 0 0 1
define_parameter par_tcp_gen_folder_indent 'TCP - General - Folder Indentation' 0 0 100
define_parameter par_tcp_gen_highlight_color 'TCP - Highlight - Color Bar' 0 0 100
define_parameter par_tcp_gen_highlight_selection 'TCP - Highlight - Selection Bar' 0 0 100
define_parameter par_tcp_master_element_adj_size_env 'TCP - Master - Element Adjustment Envelope Size' 0 0 1
define_parameter par_tcp_master_element_adj_size_fx 'TCP - Master - Element Adjustment FX Size' 0 0 1
define_parameter par_tcp_master_element_separator 'TCP - Master - Element Separator' 0 0 1000000
define_parameter par_tcp_master_element_vis 'TCP - Master - Element Visibility Flags' 0 0 1000000
define_parameter par_tcp_master_fader_pan_size 'TCP - Master - Faders Pan Size' 0 0 100
define_parameter par_tcp_master_fader_pan_size_scale 'TCP - Master - Faders Pan Size Scaling' 0 0 1
define_parameter par_tcp_master_fader_pan_vis 'TCP - Master - Faders Pan Visibility' 0 0 1
define_parameter par_tcp_master_fader_placement 'TCP - Master - Faders Placement' 0 0 2
define_parameter par_tcp_master_fader_vol_size 'TCP - Master - Faders Volume Size' 0 0 100
define_parameter par_tcp_master_fader_vol_size_scale 'TCP - Master - Faders Volume Size Scaling' 0 0 1
define_parameter par_tcp_master_fader_vol_vis 'TCP - Master - Faders Volume Visibility' 0 0 1
define_parameter par_tcp_master_fader_wid_size 'TCP - Master - Faders Width Size' 0 0 100
define_parameter par_tcp_master_fader_wid_size_scale 'TCP - Master - Faders Width Size Scaling' 0 0 1
define_parameter par_tcp_master_fader_wid_vis 'TCP - Master - Faders Width Visibility' 0 0 1
define_parameter par_tcp_master_insert_mode 'TCP - Master - Inserts Mode' 0 0 2
define_parameter par_tcp_master_insert_size 'TCP - Master - Inserts Size' 0 0 100
define_parameter par_tcp_master_insert_size_scale 'TCP - Master - Inserts Size Scaling' 0 0 1
define_parameter par_tcp_master_meter_channeldiv 'TCP - Master - Meter Channel Division' 0 0 100
define_parameter par_tcp_master_meter_mode 'TCP - Master - Mode' 0 0 1
define_parameter par_tcp_master_meter_size 'TCP - Master - Meter Size' 0 0 100
define_parameter par_tcp_master_meter_size_scale 'TCP - Master - Meter Size Scaling' 0 0 1
define_parameter par_tcp_master_meter_vol_readout 'TCP - Master - Meter Volume Readout' 0 0 1
define_parameter par_tcp_master_meter_vu_db 'TCP - Master - Meter VU dB' 0 0 1
define_parameter par_tcp_master_meter_vu_readout 'TCP - Master - Meter VU Readout' 0 0 1
define_parameter par_tcp_track_element_adj_label_size 'TCP - Track - Element Adjustment Label Size' 0 0 100
define_parameter par_tcp_track_element_adj_size_env 'TCP - Track - Element Adjustment Envelope Size' 0 0 1
define_parameter par_tcp_track_element_adj_size_input 'TCP - Track - Element Adjustment Input Size' 0 0 50
define_parameter par_tcp_track_element_separator 'TCP - Track - Element Separator' 0 0 1000000
define_parameter par_tcp_track_element_vis 'TCP - Track - Element Visibility' 0 0 1000000
define_parameter par_tcp_track_element_vis_mixer 'TCP - Track - Element Visibility Mixer' 0 0 1000000
define_parameter par_tcp_track_fader_pan_size 'TCP - Track - Faders Pan Size' 0 0 100
define_parameter par_tcp_track_fader_pan_size_scale 'TCP - Track - Faders Pan Size Scaling' 0 0 1
define_parameter par_tcp_track_fader_pan_vis 'TCP - Track - Faders Pan Visibility' 0 0 1
define_parameter par_tcp_track_fader_pan_vis_mixer 'TCP - Track - Faders Pan Mixer Visibility' 0 0 1
define_parameter par_tcp_track_fader_placement 'TCP - Track - Faders Placement' 0 0 2
define_parameter par_tcp_track_fader_vol_size 'TCP - Track - Faders Volume Size' 0 0 100
define_parameter par_tcp_track_fader_vol_size_scale 'TCP - Track - Faders Volume Size Scaling' 0 0 1
define_parameter par_tcp_track_fader_vol_vis 'TCP - Track - Faders Volume Visibility' 0 0 1
define_parameter par_tcp_track_fader_vol_vis_mixer 'TCP - Track - Faders Volume Mixer Visibility' 0 0 1
define_parameter par_tcp_track_fader_wid_size 'TCP - Track - Faders Width Size' 0 0 100
define_parameter par_tcp_track_fader_wid_size_scale 'TCP - Track - Faders Width Size Scaling' 0 0 1
define_parameter par_tcp_track_fader_wid_vis 'TCP - Track - Faders Width Visibility' 0 0 1
define_parameter par_tcp_track_fader_wid_vis_mixer 'TCP - Track - Faders Width Mixer Visibility' 0 0 1
define_parameter par_tcp_track_insert_mode 'TCP - Track - Inserts Mode' 0 0 2
define_parameter par_tcp_track_insert_size 'TCP - Track - Inserts Size' 0 0 100
define_parameter par_tcp_track_insert_size_scale 'TCP - Track - Inserts Size Scaling' 0 0 1
define_parameter par_tcp_track_label_index_vis 'TCP - Track - Index Vsibility' 0 0 2
define_parameter par_tcp_track_label_size 'TCP - Track - Size' 0 0 100
define_parameter par_tcp_track_meter_channeldiv 'TCP - Track - Meter Channel Division' 0 0 100
define_parameter par_tcp_track_meter_mode 'TCP - Track - Mode' 0 0 1
define_parameter par_tcp_track_meter_size 'TCP - Track - Meter Size' 0 0 100
define_parameter par_tcp_track_meter_size_scale 'TCP - Track - Meter Size Scaling' 0 0 1
define_parameter par_tcp_track_meter_vol_readout 'TCP - Track - Meter Volume Readout' 0 0 1
define_parameter par_tcp_track_meter_vu_db 'TCP - Track - Meter VU dB' 0 0 1
define_parameter par_tcp_track_meter_vu_readout 'TCP - Track - Meter VU Readout' 0 0 1
define_parameter par_trans_element_adj_bpm_tap 'Transport - Element Adjustments BPM Tap' 0 0 1
define_parameter par_trans_element_adj_selection_size 'Transport - Element Adjustments Selection Size' 0 0 100
define_parameter par_trans_element_adj_selection_size_scale 'Transport - Element Adjustments Selection Size Scale' 0 0 1
define_parameter par_trans_element_adj_separator_size 'Transport - Element Adjustments Separator Size' 0 0 20
define_parameter par_trans_element_adj_spacing_section_x 'Transport - Element Adjustments Spacing Section X' 0 0 20
define_parameter par_trans_element_adj_spacing_time_x 'Transport - Element Adjustments Spacing Time X' 0 0 20
define_parameter par_trans_element_adj_spacing_x 'Transport - Element Adjustments Spacing X' 0 0 20
define_parameter par_trans_element_adj_status_size 'Transport - Element Adjustments Status Size' 0 0 100
define_parameter par_trans_element_adj_status_size_scale 'Transport - Element Adjustments Status Size Scale' 0 0 1
define_parameter par_trans_element_separator 'Transport - Element Separator' 0 0 10000000
define_parameter par_trans_element_vis 'Transport - Element Visibility' 0 0 10000000
define_parameter par_trans_playrate_mode 'Transport - Playrate Display Mode' 0 0 2
define_parameter par_trans_playrate_size 'Transport - Playrate Fader Size' 0 0 100
define_parameter par_trans_settings_extrapad_x 'Transport - Settings Extra Padding X' 0 0 100
define_parameter par_trans_settings_extrapad_y 'Transport - Settings Extra Padding Y' 0 0 100
define_parameter par_trans_settings_theme_macros 'Transport - Settings Theme Macros' 0 0 8
define_parameter paRt_end 'paRt end' 0 0 1

;~ ~ ~ ~ ~ ~ ~ ~ ~ ~ End of programmatically created Block ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ 

; ====================================================================================================================================
;   # TOOLS
; ====================================================================================================================================

    ;   ## Math
    ; -----------------------------------------------------------------

        ;   ### Math : Interpolate
        ; -----------------------------------------------------------------

            macro MAC_Math_Interpolate VAL_A VAL_B   FACTOR  TARGET

                set TARGET##    + VAL_A * FACTOR{0} - VAL_B VAL_A

            endmacro

        ;   ### Math : Clamp
        ; -----------------------------------------------------------------

            macro MAC_Math_Cap VAL_INPUT VAL_MIN VAL_MAX

                set VAL_INPUT##                            \
                    VAL_INPUT##{0}<VAL_MIN{0} VAL_MIN{0}   \
                    VAL_INPUT##{0}>VAL_MAX{0} VAL_MAX{0}

            endmacro

        ;   ### Math : Minimal
        ; -----------------------------------------------------------------

            macro MAC_Math_Min VAL_INPUT VAL_MIN

                set VAL_INPUT## VAL_INPUT##{0}<VAL_MIN{0} VAL_MIN{0}

            endmacro

        ;   ### Math : Maximum
        ; -----------------------------------------------------------------

            macro MAC_Math_Max VAL_INPUT VAL_MAX

                set VAL_INPUT## VAL_INPUT##{0}>VAL_MAX{0} VAL_MAX{0}

            endmacro

    ;   ## Draw
    ; -----------------------------------------------------------------

        ;   ### Draw : Image
        ; -----------------------------------------------------------------

            macro MAC_Draw_Image CONDITION SECTION NAME IMAGE_NAME POS_X POS_Y POS_W POS_H ATT_L ATT_T ATT_R ATT_B
                custom SECTION##.custom.Image_##NAME "" "" "" IMAGE_NAME

                ; [DRAW] Custom Image
                set SECTION##.custom.Image_##NAME                           \
                    ?CONDITION{0}                                           \
                        [POS_X POS_Y POS_W POS_H ATT_L ATT_T ATT_R ATT_B]

                front SECTION##.custom.Image_##NAME
            endmacro

        ;   ### Draw : Box
        ; -----------------------------------------------------------------

            macro MAC_Draw_Box CONDITION SECTION NAME CLR_R CLR_G CLR_B POS_X POS_Y POS_W POS_H ATT_L ATT_T ATT_R ATT_B
                custom SECTION##.custom.Box_##NAME "" "" "" ""

                ; [DRAW] Custom Box
                set SECTION##.custom.Box_##NAME                             \
                    ?CONDITION{0}                                           \
                        [POS_X POS_Y POS_W POS_H ATT_L ATT_T ATT_R ATT_B]

                ; Box Color
                set SECTION##.custom.Box_##NAME##.color [0 0 0 0 CLR_R CLR_G CLR_B 255]

                front SECTION##.custom.Box_##NAME
            endmacro

        ;   ### Draw : Frame
        ; -----------------------------------------------------------------

            macro MAC_Draw_Frame CONDITION SECTION NAME POS_X POS_Y POS_W POS_H ATT_L ATT_T ATT_R ATT_B
                custom SECTION##.custom.Border_##NAME "" "" "" "custom_border"

                ; [DRAW] Custom Border
                set SECTION##.custom.Border_##NAME                          \
                    ?CONDITION{0}                                           \
                        [POS_X POS_Y POS_W POS_H ATT_L ATT_T ATT_R ATT_B]

                front SECTION##.custom.Border_##NAME
            endmacro

        ;   ### Draw : Framed Box
        ; -----------------------------------------------------------------

            ; combination of two macros to create a box with a frame

            macro MAC_Draw_FramedBox CONDITION SECTION NAME CLR_R CLR_G CLR_B POS_X POS_Y POS_W POS_H ATT_L ATT_T ATT_R ATT_B
                MAC_Draw_Box    CONDITION SECTION NAME  CLR_R CLR_G CLR_B       POS_X POS_Y POS_W POS_H     ATT_L ATT_T ATT_R ATT_B
                MAC_Draw_Frame  CONDITION SECTION NAME                          POS_X POS_Y POS_W POS_H     ATT_L ATT_T ATT_R ATT_B
            endmacro


; ====================================================================================================================================
;   # SETUP
; ====================================================================================================================================

    ;   ## Setup
    ; -----------------------------------------------------------------

        macro MAC_Setup         SCALE

            ; dpi dependent constants
            MAC_SetupValues             SCALE

            ; shared track data
            MAC_Setup_Values_Tcp        SCALE
            MAC_Setup_Values_Mcp        SCALE

            ; dynamically calculated colors
            MAC_SetupColors             SCALE

        endmacro

        ;   ### Setup : Values
        ; -----------------------------------------------------------------

            macro MAC_SetupValues      SCALE

                ; base unit
                set VAL_Unit            \
                    SCALE>2         3   \
                    SCALE>1         2   \
                                    1

                ; minimum padding
                set VAL_Pad             \
                    SCALE>=2        6   \
                    SCALE>1         4   \
                                    2

                ; border
                set VAL_Border          \
                    SCALE>=2.5      3   \
                    SCALE>=2        2   \
                                    1

                ; average button
                set VAL_Button                  \
                    SCALE>=2.5      [45 35]     \
                    SCALE>=2.25     [22 18]     \
                    SCALE>=2        [36 28]     \
                    SCALE>=1.75     [32 24]     \
                    SCALE>=1.5      [27 21]     \
                    SCALE>=1.25     [22 18]     \
                                    [18 14]

                ; transport button
                set VAL_Button_Trans            \
                    SCALE>=2.5      [85 45 51]  \
                    SCALE>=2.25     [76 40 51]  \
                    SCALE>=2        [68 36 51]  \
                    SCALE>=1.75     [60 32 51]  \
                    SCALE>=1.5      [51 27 51]  \
                    SCALE>=1.25     [42 22 51]  \
                                    [34 18 51]

                ; folder button / icon
                set VAL_Button_Folder       \
                    SCALE>=2.5      40      \
                    SCALE>=2.25     36      \
                    SCALE>=2        32      \
                    SCALE>=1.75     28      \
                    SCALE>=1.5      24      \
                    SCALE>=1.25     20      \
                                    16

                ; large knob
                set VAL_Knob                \
                    SCALE>=2.5      45      \
                    SCALE>=2.25     40      \
                    SCALE>=2        36      \
                    SCALE>=1.75     32      \
                    SCALE>=1.5      27      \
                    SCALE>=1.25     22      \
                                    18

                ; small knob
                set VAL_Knob_s              \
                    SCALE>=2.5      35      \
                    SCALE>=2.25     32      \
                    SCALE>=2        28      \
                    SCALE>=1.75     24      \
                    SCALE>=1.5      21      \
                    SCALE>=1.25     18      \
                                    14

                ; mcp label
                set VAL_MCP_Label           \
                    SCALE>=2.5      35      \
                    SCALE>=2.25     32      \
                    SCALE>=2        28      \
                    SCALE>=1.75     24      \
                    SCALE>=1.5      21      \
                    SCALE>=1.25     18      \
                                    14

                ; tcp label
                set VAL_TCP_Label           \
                    SCALE>=2.5      35      \
                    SCALE>=2.25     32      \
                    SCALE>=2        28      \
                    SCALE>=1.75     24      \
                    SCALE>=1.5      21      \
                    SCALE>=1.25     18      \
                                    14

                ; tcp minimal height
                set VAL_tcp_h               \
                    SCALE>=2.5      45      \
                    SCALE>=2.25     40      \
                    SCALE>=2        36      \
                    SCALE>=1.75     32      \
                    SCALE>=1.5      27      \
                    SCALE>=1.25     22      \
                                    17

                ; envcp minimal height
                set VAL_Envcp_h             \
                    SCALE>=2.5      38      \
                    SCALE>=2.25     34      \
                    SCALE>=2        30      \
                    SCALE>=1.75     26      \
                    SCALE>=1.5      22      \
                    SCALE>=1.25     19      \
                                    17

                ; separator icon thickness
                set VAL_Separator           \
                    SCALE>=2.5      24      \
                    SCALE>=2.25     20      \
                    SCALE>=2        16      \
                    SCALE>=1.75     14      \
                    SCALE>=1.5      12      \
                    SCALE>=1.25     4       \
                                    2

                ; insert slot height
                set VAL_insert_slot             \
                    SCALE>=2.5      [40 50]     \
                    SCALE>=2.25     [36 50]     \
                    SCALE>=2        [32 50]     \
                    SCALE>=1.75     [28 50]     \
                    SCALE>=1.5      [24 50]     \
                    SCALE>=1.25     [20 50]     \
                                    [16 50]

                ; track index number count
                set VAL_index_letters       \
                    ntracks>=100000     6   \
                    ntracks>=10000      5   \
                    ntracks>=1000       4   \
                    ntracks>=100        3   \
                    ntracks>=10         2   \
                                        1

                ; label margins
                set VAL_Margin_Label                \
                    SCALE>=2.5      [24 24 24 24]   \
                    SCALE>=2.25     [20 20 20 20]   \
                    SCALE>=2        [16 16 16 16]   \
                    SCALE>=1.75     [14 14 14 14]   \
                    SCALE>=1.5      [4 2 4 2]       \
                    SCALE>=1.25     [4 2 4 2]       \
                                    [4 2 4 3]

                ; transport time section label margins
                set VAL_Margin_Label_Trans_Time     \
                    SCALE>=2.5      [24 24 24 24]   \
                    SCALE>=2.25     [20 20 20 20]   \
                    SCALE>=2        [16 16 16 16]   \
                    SCALE>=1.75     [14 14 14 14]   \
                    SCALE>=1.5      [4 2 4 2]       \
                    SCALE>=1.25     [4 2 4 2]       \
                                    [0 0 0 0]

                ; transport status margins
                set VAL_Margin_Label_Trans_Status   \
                    SCALE>=2.5      [24 24 24 24]   \
                    SCALE>=2.25     [20 20 20 20]   \
                    SCALE>=2        [16 16 16 16]   \
                    SCALE>=1.75     [14 14 14 14]   \
                    SCALE>=1.5      [4 2 4 2]       \
                    SCALE>=1.25     [4 2 4 2]       \
                                    [0 0 0 0]

                ; transport selection margins
                set VAL_Margin_Label_Trans_Selection    \
                    SCALE>=2.5      [24 24 24 24]       \
                    SCALE>=2.25     [20 20 20 20]       \
                    SCALE>=2        [16 16 16 16]       \
                    SCALE>=1.75     [14 14 14 14]       \
                    SCALE>=1.5      [4 2 4 2]           \
                    SCALE>=1.25     [4 2 4 2]           \
                                    [8 0 8 0]

                ; record input margins
                set VAL_Margin_RecInput             \
                    SCALE>=2.5      [8 1 2 1]       \
                    SCALE>=2.25     [8 1 2 1]       \
                    SCALE>=2        [8 1 2 1]       \
                    SCALE>=1.75     [8 1 2 1]       \
                    SCALE>=1.5      [8 1 2 1]       \
                    SCALE>=1.25     [8 1 2 1]       \
                                    [8 1 2 1]

                ; fader size
                ; --> scalar 0-1 = mcp fader, scalar 2-3 = tcp fader
                set VAL_Fader                       \
                    SCALE>=2.5      [14 2 10 2]     \
                    SCALE>=2.25     [14 2 10 2]     \
                    SCALE>=2        [14 2 10 2]     \
                    SCALE>=1.75     [14 2 10 2]     \
                    SCALE>=1.5      [14 2 10 2]     \
                    SCALE>=1.25     [14 2 10 2]     \
                                    [14 2 10 2]

                ; envcp indent symbol
                set VAL_Envcp_Symbol                \
                    SCALE>=2.5          [18 14]     \
                    SCALE>=2.25         [18 14]     \
                    SCALE>=2            [18 14]     \
                    SCALE>=1.75         [18 14]     \
                    SCALE>=1.5          [18 14]     \
                    SCALE>=1.25         [18 14]     \
                                        [18 14]

                set VAL_Font_Large      \
                    SCALE>=2.5      7   \
                    SCALE>=2.25     6   \
                    SCALE>=2        5   \
                    SCALE>=1.75     4   \
                    SCALE>=1.5      3   \
                    SCALE>=1.25     2   \
                                    1
                set VAL_Font_Small      \
                    SCALE>=2.5      14  \
                    SCALE>=2.25     13  \
                    SCALE>=2        12  \
                    SCALE>=1.75     11  \
                    SCALE>=1.5      10  \
                    SCALE>=1.25     9   \
                                    8

                ; negations and multiplications
                set VAL_Border_Neg          - 0     VAL_Border
                set VAL_Border_Neg_2        * -2    VAL_Border
                set VAL_Border_2            * 2     VAL_Border
                set VAL_Button_2            * 2     VAL_Button

            endmacro

        ;   ### Setup : Values : TCP
        ; -----------------------------------------------------------------

            macro MAC_Setup_Values_Tcp   SCALE

                ; spacing
                set VAL_tcp_spacing_x           + VAL_Pad{0} * SCALE par_tcp_gen_element_adj_spacing_x
                set VAL_tcp_spacing_x_fader     + VAL_Pad{0} * SCALE par_tcp_gen_element_adj_spacing_x_fader
                set VAL_tcp_spacing_y_fader     + VAL_Pad{0} * SCALE par_tcp_gen_element_adj_spacing_y_fader
                set VAL_tcp_spacing_section_x   + VAL_Pad{0} * SCALE par_tcp_gen_element_adj_spacing_section_x
                set VAL_tcp_spacing_section_y   + VAL_Pad{0} * SCALE par_tcp_gen_element_adj_spacing_section_y
                set VAL_tcp_spacing_separator   + VAL_Pad{0} * SCALE par_tcp_gen_element_adj_separator

                ; height detection
                set VAL_tcp_h_level     \
                    h>=VAL_tcp_h{0}     \
                        1               \
                        0

                ; volume readout size
                set VAL_tcp_vol_readout_w   * SCALE 30

                ; minimal width values
                set VAL_tcp_insert_min_w    * SCALE 20
                set VAL_tcp_meter_min_w     * SCALE 6
                set VAL_tcp_fader_min_w     * SCALE 10
                set VAL_tcp_label_min_w     * SCALE 50


            endmacro

        ;   ### Setup : Values : MCP
        ; -----------------------------------------------------------------

            macro MAC_Setup_Values_Mcp SCALE

                ; spacing
                set VAL_mcp_spacing_x           + VAL_Pad{0} * SCALE par_mcp_gen_element_adj_spacing_x
                set VAL_mcp_spacing_y           + VAL_Pad{0} * SCALE par_mcp_gen_element_adj_spacing_y
                set VAL_mcp_spacing_fader_x     + VAL_Pad{0} * SCALE par_mcp_gen_element_adj_spacing_fader_x
                set VAL_mcp_spacing_fader_y     + VAL_Pad{0} * SCALE par_mcp_gen_element_adj_spacing_fader_y
                set VAL_mcp_spacing_section_x   + VAL_Pad{0} * SCALE par_mcp_gen_element_adj_spacing_section_x
                set VAL_mcp_spacing_section_y   + VAL_Pad{0} * SCALE par_mcp_gen_element_adj_spacing_section_y
                set VAL_mcp_spacing_separator   + VAL_Pad{0} * SCALE par_mcp_gen_element_adj_separator

                ; minimal height values
                set VAL_mcp_inserts_min_h   * SCALE 30
                set VAL_mcp_meter_min_h     * SCALE 10
                set VAL_mcp_fader_min_h     * SCALE 40
                set VAL_mcp_fader_min_h_2   + * 2 VAL_mcp_fader_min_h{0} VAL_mcp_spacing_fader_y{0}

                ; button section width
                set VAL_mcp_w_button_slim   + VAL_Unit{0}       VAL_Button{0}
                set VAL_mcp_w_button_wide   + VAL_Unit{0} + * 2 VAL_Button{0} VAL_mcp_spacing_x{0}

                ; minimal fader height before hiding
                set VAL_mcp_vol_h_min_show  + VAL_Knob{0} VAL_Pad{0}

                ; minimal fader height for forced knob layout
                set VAL_mcp_vol_h_min_knob  + VAL_mcp_vol_h_min_show{0} * SCALE 24

            endmacro

        ;   ### Setup : Colors
        ; -----------------------------------------------------------------

            macro MAC_SetupColors   SCALE

                ;   ::: Theme Specific Colors :::


set THEME_color_tcp_empty_space             [50 50 50]
set THEME_color_mcp_empty_space             [50 50 50]
set THEME_color_track_bg                    [69 69 69]
set THEME_color_track_label_bg              [38 38 38]
set THEME_color_track_label_text            [140 140 140]
set THEME_color_envcp_bg                    THEME_color_track_bg
set THEME_color_envcp_label_bg              THEME_color_track_label_bg
set THEME_color_envcp_label_text            THEME_color_track_label_text
set THEME_color_select_bar                  [26 26 26 0 200 200 200 0]
set THEME_color_icon_bg                     [47 47 47 0 70 70 70 0]
set THEME_color_icon_bg                     [47 47 47 0 70 70 70 0]
set THEME_color_master_icon_bg              [35 35 35 0 70 70 70 0]
set THEME_color_meter_text                  [125 125 125 0]
set THEME_color_meter_shadow                [1 1 1 0]
set THEME_color_meter_readout               [255 255 255]
set THEME_color_meter_readout_clipped       [255 0 0]
set THEME_color_button_text_off             [199 199 199]
set THEME_color_button_text_on              [10 10 10]
set THEME_color_button_bg_off               [50 50 50]
set THEME_color_readout_font                [142 142 142]
set THEME_color_red                         [181 66 66]

                set THEME_color_recinput_bg         \
                    !recarm                         \
                        THEME_color_button_bg_off   \
                        THEME_color_red

                ;   ::: Folder Tree Analysis :::

                set VAL_folder_depth_factor / folderdepth maxfolderdepth

                ;   ::: Tint Factors :::

                ; track bg
                set VAL_color_track_bg_tint_factor                                                              \
                    !track_selected                                                                             \
                        * 0.005 par_colors_track_track_bg_tint                                                  \
                        * 0.005 + par_colors_track_track_bg_tint * 0.5 par_colors_track_track_bg_select_tint

                ; track bg folder modulation
                set VAL_color_track_bg_tint_factor                                                                  \
                    folderstate>0                                                                                   \
                        + VAL_color_track_bg_tint_factor{0} + -1 * 0.02 par_colors_track_folder_foldertrack_tint

                ; track bg folder tree modulation
                set VAL_color_track_bg_tint_factor                                                                                                                      \
                    ?maxfolderdepth                                                                                                                                     \
                        par_colors_track_folder_foldertree_tint==50                                                                                                     \
                            .                                                                                                                                           \
                        par_colors_track_folder_foldertree_tint<50                                                                                                      \
                            * VAL_color_track_bg_tint_factor{0} - 1 * VAL_folder_depth_factor{0}            * 0.02 - 50     par_colors_track_folder_foldertree_tint     \
                            * VAL_color_track_bg_tint_factor{0} - 1 * - 1 VAL_folder_depth_factor{0} + -1   * 0.02          par_colors_track_folder_foldertree_tint

                ; track label bg
                set VAL_color_track_label_bg_tint_factor                                                            \
                    !track_selected                                                                                 \
                        * 0.005      par_colors_track_track_label_bg_tint                                           \
                        * 0.005 +    par_colors_track_track_label_bg_tint par_colors_track_track_label_select_tint

                ; envcp bg
                set VAL_color_envcp_bg_tint_factor                                                          \
                    !env_selected                                                                           \
                        * 0.005      par_colors_track_envcp_bg_tint                                         \
                        * 0.005 +    par_colors_track_envcp_bg_tint par_colors_track_track_bg_select_tint

                ; envcp label bg
                set VAL_color_envcp_label_bg_tint_factor                                                            \
                    !env_selected                                                                                   \
                        * 0.005      par_colors_track_envcp_label_bg_tint                                           \
                        * 0.005 +    par_colors_track_envcp_label_bg_tint par_colors_track_track_label_select_tint

                ;   ::: Tint Factor Limiting :::

                MAC_Math_Cap    VAL_color_track_bg_tint_factor          0 1
                MAC_Math_Cap    VAL_color_track_label_bg_tint_factor    0 1
                MAC_Math_Cap    VAL_color_envcp_bg_tint_factor          0 1
                MAC_Math_Cap    VAL_color_envcp_label_bg_tint_factor    0 1

                ;   ::: Base Colors :::
                set VAL_color_track_bg_base             THEME_color_track_bg
                set VAL_color_track_label_bg_base       THEME_color_track_label_bg
                set VAL_color_envcp_bg_base             THEME_color_envcp_bg
                set VAL_color_envcp_label_bg_base       THEME_color_envcp_label_bg

                ; track bg
                set VAL_color_track_bg_tinted                       \
                    ?trackcolor_valid                               \
                        [trackcolor_r trackcolor_g trackcolor_b]    \
                        VAL_color_track_bg_base

                ; track label bg
                set VAL_color_track_label_bg_tinted                 \
                    ?trackcolor_valid                               \
                        [trackcolor_r trackcolor_g trackcolor_b]    \
                        VAL_color_track_label_bg_base

                ; envcp bg
                set VAL_color_envcp_bg_tinted                       \
                    ?trackcolor_valid                               \
                        [trackcolor_r trackcolor_g trackcolor_b]    \
                        VAL_color_envcp_bg_base

                ; envcp label bg
                set VAL_color_envcp_label_bg_tinted                 \
                    ?trackcolor_valid                               \
                        [trackcolor_r trackcolor_g trackcolor_b]    \
                        VAL_color_envcp_label_bg_base

                ;   ::: Tint Crossfading :::

                MAC_Math_Interpolate     VAL_color_track_bg_base         VAL_color_track_bg_tinted           VAL_color_track_bg_tint_factor          VAL_Color_Track_Bg
                MAC_Math_Interpolate     VAL_color_track_label_bg_base   VAL_color_track_label_bg_tinted     VAL_color_track_label_bg_tint_factor    VAL_Color_Track_Label_Bg
                MAC_Math_Interpolate     VAL_color_envcp_bg_base         VAL_color_envcp_bg_tinted           VAL_color_envcp_bg_tint_factor          VAL_Color_Envcp_Bg
                MAC_Math_Interpolate     VAL_color_envcp_label_bg_base   VAL_color_envcp_label_bg_tinted     VAL_color_envcp_label_bg_tint_factor    VAL_Color_Envcp_label_Bg

                ;   ::: Tone Adjustments :::

                ; track bg
                set VAL_Color_Track_Bg                                                                                                      \
                    !track_selected                                                                                                         \
                        * VAL_Color_Track_Bg + 0.75 * 0.005     par_colors_track_track_bg_tone                                              \
                        * VAL_Color_Track_Bg + 0.75 * 0.005 +   par_colors_track_track_bg_tone * 2 par_colors_track_track_bg_select_tone

                ; track bg folder state modulation
                set VAL_Color_Track_Bg                                                                      \
                    folderstate>0                                                                           \
                        par_colors_track_folder_foldertrack_tone!=50                                        \
                            * VAL_Color_Track_BG + 0.75 * 0.005 par_colors_track_folder_foldertrack_tone

                ; track bg folder tree modulation
                set VAL_Color_Track_Bg                                                                                                                  \
                    ?maxfolderdepth                                                                                                                     \
                        par_colors_track_folder_foldertree_tone==50                                                                                     \
                            .                                                                                                                           \
                        par_colors_track_folder_foldertree_tone<50                                                                                      \
                            * VAL_Color_Track_Bg - 1 * VAL_folder_depth_factor{0}           * 0.01 - 50     par_colors_track_folder_foldertree_tone     \
                            * VAL_Color_Track_Bg - 1 * - 1 VAL_folder_depth_factor{0} + -1  + 0.5 * 0.01    par_colors_track_folder_foldertree_tone

                ; track label bg
                set VAL_Color_Track_Label_Bg                                                                                                            \
                    !track_selected                                                                                                                     \
                        * VAL_Color_Track_Label_Bg + 0.5 * 0.01       par_colors_track_track_label_bg_tone                                              \
                        * VAL_Color_Track_Label_Bg + 0.5 * 0.01 +     par_colors_track_track_label_bg_tone par_colors_track_track_label_select_tone

                ; track label text
                set VAL_Color_Track_Label_Text                                                                                                                          \
                    !track_selected                                                                                                                                     \
                        + [1 1 1 0 0 0 0 0] * THEME_color_track_label_text * 0.02   par_colors_track_track_label_text_tone                                              \
                        + [1 1 1 0 0 0 0 0] * THEME_color_track_label_text * 0.02 + par_colors_track_track_label_text_tone par_colors_track_track_label_select_tone

                ; track tcp index
                set VAL_Color_Track_Index_TCP                                                                                                                                       \
                    !track_selected                                                                                                                                                 \
                        + [1 1 1 0 0 0 0 0] * THEME_color_track_label_text      * 0.02 par_colors_track_track_index_tone_tcp                                                        \
                        par_tcp_track_label_index_vis==1                                                                                                                            \
                            + [1 1 1 0 0 0 0 0] * THEME_color_track_label_text  * 0.02 + par_colors_track_track_index_tone_tcp  * 0.25  par_colors_track_track_label_select_tone    \
                            + [1 1 1 0 0 0 0 0] * THEME_color_track_label_text  * 0.02 + par_colors_track_track_index_tone_tcp          par_colors_track_track_bg_select_tone

                ; track mcp index
                set VAL_Color_Track_Index_MCP                                                                                                                                           \
                    !track_selected                                                                                                                                                     \
                        + [1 1 1 0 0 0 0 0] * THEME_color_track_label_text      * 0.02      par_colors_track_track_index_tone_mcp                                                       \
                        par_mcp_track_settings_label_index==1                                                                                                                           \
                            + [1 1 1 0 0 0 0 0] * THEME_color_track_label_text  * 0.02 +    par_colors_track_track_index_tone_mcp           par_colors_track_track_label_select_tone    \
                            + [1 1 1 0 0 0 0 0] * THEME_color_track_label_text  * 0.02 +    par_colors_track_track_index_tone_mcp * 0.25    par_colors_track_track_bg_select_tone

                ; envcp bg
                set VAL_Color_Envcp_Bg                                                                                                  \
                    !env_selected                                                                                                       \
                        * VAL_Color_Envcp_Bg + 0.75 * 0.005     par_colors_track_envcp_bg_tone                                          \
                        * VAL_Color_Envcp_Bg + 0.75 * 0.005 +   par_colors_track_envcp_bg_tone par_colors_track_track_bg_select_tone

                ; envcp label bg
                set VAL_Color_Envcp_Label_Bg                                                                                                            \
                    !env_selected                                                                                                                       \
                        * VAL_Color_Envcp_Label_Bg + 0.75 * 0.005       par_colors_track_envcp_label_bg_tone                                            \
                        * VAL_Color_Envcp_Label_Bg + 0.75 * 0.005 +     par_colors_track_envcp_label_bg_tone par_colors_track_track_label_select_tone


                ; envcp label text
                set VAL_Color_Envcp_Label_Text                                                                                                                          \
                    !env_selected                                                                                                                                       \
                        + [1 1 1 0 0 0 0 0] * THEME_color_envcp_label_text * 0.02   par_colors_track_envcp_label_text_tone                                              \
                        + [1 1 1 0 0 0 0 0] * THEME_color_envcp_label_text * 0.02 + par_colors_track_envcp_label_text_tone par_colors_track_track_label_select_tone

                ; envcp readout
                set VAL_Color_Envcp_Readout                                                                                                                                 \
                    !env_selected                                                                                                                                           \
                        + [1 1 1 0 0 0 0 0] * THEME_color_envcp_label_text * 0.02   par_colors_track_envcp_label_readout_tone                                               \
                        + [1 1 1 0 0 0 0 0] * THEME_color_envcp_label_text * 0.02 + par_colors_track_envcp_label_readout_tone par_colors_track_track_label_select_tone

                ;   ::: Highlights :::

                ; adjustable intensity
                set VAL_colorbar_tint_plus * 0.003  par_colors_track_track_colorbar_intensity
                set VAL_colorbar_tone_plus * 0.003  par_colors_track_track_colorbar_intensity
                set VAL_colorbar_tone_lift * 0.25   par_colors_track_track_colorbar_intensity

                ; increment base tint factor
                set VAL_colorbar_tint_factor_off    + VAL_colorbar_tint_plus 0.7
                set VAL_colorbar_tint_factor_on     + VAL_colorbar_tint_plus 0.4

                ; tcp colobar tint factor
                set VAL_colobar_tint_factor_tcp         \
                    ?track_selected                     \
                        VAL_colorbar_tint_factor_on     \
                        VAL_colorbar_tint_factor_off

                ; envcp colobar tint factor
                set VAL_colobar_tint_factor_env         \
                    ?env_selected                       \
                        VAL_colorbar_tint_factor_on     \
                        VAL_colorbar_tint_factor_off

                ; calculate colorbar tint
                MAC_Math_Interpolate     VAL_color_track_bg_base   VAL_color_track_bg_tinted     VAL_colobar_tint_factor_tcp    VAL_colorbar_tcp
                MAC_Math_Interpolate     VAL_color_track_bg_base   VAL_color_track_bg_tinted     VAL_colobar_tint_factor_env    VAL_colorbar_env

                ; final colorbar values
                set VAL_colorbar_on     + [VAL_colorbar_tone_lift VAL_colorbar_tone_lift VAL_colorbar_tone_lift] * VAL_colorbar_tcp + VAL_colorbar_tone_plus 0.9
                set VAL_colorbar_off    + [VAL_colorbar_tone_lift VAL_colorbar_tone_lift VAL_colorbar_tone_lift] * VAL_colorbar_tcp + VAL_colorbar_tone_plus 0.5

                ; color bar (track)
                set VAL_color_colorbar      \
                    ?track_selected         \
                        VAL_colorbar_on     \
                        VAL_colorbar_off    \

                ; color bar (envcp)
                set VAL_color_colorbar_envcp    \
                    ?track_selected             \
                        VAL_colorbar_on         \
                        VAL_colorbar_off        \

                ; selection bar
                set VAL_color_selectbar                                                                     \
                    ?track_selected                                                                         \
                        [THEME_color_select_bar{4} THEME_color_select_bar{5} THEME_color_select_bar{6}]     \
                        [THEME_color_select_bar{0} THEME_color_select_bar{1} THEME_color_select_bar{2}]

                ; selection bar (envcp)
                set VAL_color_selectbar_envcp                                                               \
                    ?env_selected                                                                           \
                        [THEME_color_select_bar{4} THEME_color_select_bar{5} THEME_color_select_bar{6}]     \
                        [THEME_color_select_bar{0} THEME_color_select_bar{1} THEME_color_select_bar{2}]

                ;   ::: Icons :::

                ; icon bg
                set VAL_color_envcp_iconbg                                                      \
                    ?env_selected                                                               \
                        [THEME_color_icon_bg{4} THEME_color_icon_bg{5} THEME_color_icon_bg{6}]  \
                        [THEME_color_icon_bg{0} THEME_color_icon_bg{1} THEME_color_icon_bg{2}]

                ; master icon background
                set VAL_color_master_icon                                                                               \
                    ?track_selected                                                                                     \
                        [THEME_color_master_icon_bg{4} THEME_color_master_icon_bg{5} THEME_color_master_icon_bg{6}]     \
                        [THEME_color_master_icon_bg{0} THEME_color_master_icon_bg{1} THEME_color_master_icon_bg{2}]

                ;   ::: Meter :::

                ; tone
                set VAL_Color_Meter_Text_Lit            + [1 1 1 0] * THEME_color_meter_text * 0.02 par_colors_track_meter_text_tone_lit
                set VAL_Color_Meter_Text_Unlit          + [1 1 1 0] * THEME_color_meter_text * 0.02 par_colors_track_meter_text_tone_unlit

                ; readout clip tint
                set VAL_Color_readout_clip_tint_factor * 0.01 par_colors_track_meter_text_tint_readout_clip
                MAC_Math_Interpolate        THEME_color_meter_readout   THEME_color_meter_readout_clipped   VAL_Color_readout_clip_tint_factor  VAL_Color_Meter_Text_Readout_Clip

                ; readout colors
                set VAL_Color_Meter_Text_Readout        * THEME_color_meter_readout             * 0.01 par_colors_track_meter_text_tone_readout
                set VAL_Color_Meter_Text_Readout_Clip   * VAL_Color_Meter_Text_Readout_Clip     * 0.01 par_colors_track_meter_text_tone_readout_clip

                ; alpha
                set VAL_Color_Meter_Alpha_Lit_Top       + 1 * * 0.01    par_colors_track_meter_text_alpha_top       * 2.55 par_colors_track_meter_text_alpha_lit
                set VAL_Color_Meter_Alpha_Unlit_Top     + 1 * * 0.01    par_colors_track_meter_text_alpha_top       * 2.55 par_colors_track_meter_text_alpha_unlit
                set VAL_Color_Meter_Alpha_Lit_Bottom    + 1 * * 0.01    par_colors_track_meter_text_alpha_bottom    * 2.55 par_colors_track_meter_text_alpha_lit
                set VAL_Color_Meter_Alpha_Unlit_Bottom  + 1 * * 0.01    par_colors_track_meter_text_alpha_bottom    * 2.55 par_colors_track_meter_text_alpha_unlit
                set VAL_Color_Meter_Alpha_Readout       + 1 * 2.55      par_colors_track_meter_text_alpha_readout

                ; shadow
                set VAL_Color_Meter_Shadow_Lit_Top      + 1 * * 0.01 par_colors_track_meter_text_alpha_top      * 2.55 par_colors_track_meter_text_shadow_lit
                set VAL_Color_Meter_Shadow_Unlit_Top    + 1 * * 0.01 par_colors_track_meter_text_alpha_top      * 2.55 par_colors_track_meter_text_shadow_unlit
                set VAL_Color_Meter_Shadow_Lit_Bottom   + 1 * * 0.01 par_colors_track_meter_text_alpha_bottom   * 2.55 par_colors_track_meter_text_shadow_lit
                set VAL_Color_Meter_Shadow_Unlit_Bottom + 1 * * 0.01 par_colors_track_meter_text_alpha_bottom   * 2.55 par_colors_track_meter_text_shadow_unlit

                ; meter lookup values
                set VAL_meter_lit_top           [VAL_Color_Meter_Text_Lit{0}        VAL_Color_Meter_Text_Lit{1}     VAL_Color_Meter_Text_Lit{2}     VAL_Color_Meter_Alpha_Lit_Top       0 0 0 VAL_Color_Meter_Shadow_Lit_Top]
                set VAL_meter_lit_bottom        [VAL_Color_Meter_Text_Lit{0}        VAL_Color_Meter_Text_Lit{1}     VAL_Color_Meter_Text_Lit{2}     VAL_Color_Meter_Alpha_Lit_Bottom    0 0 0 VAL_Color_Meter_Shadow_Lit_Bottom]
                set VAL_meter_unlit_top         [VAL_Color_Meter_Text_Unlit{0}      VAL_Color_Meter_Text_Unlit{1}   VAL_Color_Meter_Text_Unlit{2}   VAL_Color_Meter_Alpha_Unlit_Top     0 0 0 VAL_Color_Meter_Shadow_Unlit_Bottom]
                set VAL_meter_unlit_bottom      [VAL_Color_Meter_Text_Unlit{0}      VAL_Color_Meter_Text_Unlit{1}   VAL_Color_Meter_Text_Unlit{2}   VAL_Color_Meter_Alpha_Unlit_Bottom  0 0 0 VAL_Color_Meter_Shadow_Unlit_Bottom]
                set VAL_meter_readout           [VAL_Color_Meter_Text_Readout{0}    VAL_Color_Meter_Text_Readout{1} VAL_Color_Meter_Text_Readout{2} VAL_Color_Meter_Alpha_Readout       VAL_Color_Meter_Text_Readout_Clip{0} VAL_Color_Meter_Text_Readout_Clip{1} VAL_Color_Meter_Text_Readout_Clip{2} VAL_Color_Meter_Alpha_Readout]

            endmacro

; ====================================================================================================================================
;   # TRANSPORT
; ====================================================================================================================================

    ;   ## Draw : Transport : Draw
    ; -----------------------------------------------------------------

        macro MAC_DrawTransport     SCALE

            clear trans.*
            MAC_DrawTransport_Setup             SCALE   "trans" "trans"
            MAC_DrawTransport_Buttons           SCALE   "trans" "trans"
            MAC_DrawTransport_Status            SCALE   "trans" "trans"
            MAC_DrawTransport_Selection         SCALE   "trans" "trans"
            MAC_DrawTransport_Size              SCALE   "trans" "trans"
            MAC_DrawTransport_PlaceElements     SCALE   "trans" "trans"
            MAC_DrawTransport_BankButtons       SCALE   "trans" "trans"
            MAC_DrawTransport_Font              SCALE   "trans" "trans"

        endmacro

    ;   ## Draw : Transport : Setup
    ; -----------------------------------------------------------------

        macro MAC_DrawTransport_Setup SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; custom elements
            custom WALTER_ELEMENT##.custom.bank_0       "" "_RS2c91a971d2bf85ecafd0efaf77363df6f731205d"    ""      "transport_custom_bank_1_off"
            custom WALTER_ELEMENT##.custom.bank_1       "" "_RSc043dcd177669da6a9a4266e99990f0aee866e71"    ""      "transport_custom_bank_2_off"
            custom WALTER_ELEMENT##.custom.bank_2       "" "_RS0bd17eabbc3e1ccd86a6c108d0844c6663be3dbd"    ""      "transport_custom_bank_3_off"
            custom WALTER_ELEMENT##.custom.bank_3       "" "_RSeae090c8cf3daffda4364fed0a9a0c5214d257fd"    ""      "transport_custom_bank_4_off"
            custom WALTER_ELEMENT##.custom.bank_4       "" "_RSfbe6d484414eca2da48a652094177639290ffdd6"    ""      "transport_custom_bank_5_off"
            custom WALTER_ELEMENT##.custom.bank_5       "" "_RS8f42ebdffe94a4d492447d77228fb29814f38b39"    ""      "transport_custom_bank_6_off"
            custom WALTER_ELEMENT##.custom.bank_6       "" "_RSa640c6e5eae8a45b69b8dc2f8a750c19712871e8"    ""      "transport_custom_bank_7_off"
            custom WALTER_ELEMENT##.custom.bank_7       "" "_RSb48f6969ba104c941fd8ec29aaacadcba64618f6"    ""      "transport_custom_bank_8_off"
            custom WALTER_ELEMENT##.custom.bank_0_on    "" ""                                               ""      "transport_custom_bank_1_on"
            custom WALTER_ELEMENT##.custom.bank_1_on    "" ""                                               ""      "transport_custom_bank_2_on"
            custom WALTER_ELEMENT##.custom.bank_2_on    "" ""                                               ""      "transport_custom_bank_3_on"
            custom WALTER_ELEMENT##.custom.bank_3_on    "" ""                                               ""      "transport_custom_bank_4_on"
            custom WALTER_ELEMENT##.custom.bank_4_on    "" ""                                               ""      "transport_custom_bank_5_on"
            custom WALTER_ELEMENT##.custom.bank_5_on    "" ""                                               ""      "transport_custom_bank_6_on"
            custom WALTER_ELEMENT##.custom.bank_6_on    "" ""                                               ""      "transport_custom_bank_7_on"
            custom WALTER_ELEMENT##.custom.bank_7_on    "" ""                                               ""      "transport_custom_bank_8_on"
            custom WALTER_ELEMENT##.custom.bank_logo    "" ""                                               ""      "transport_custom_bank_part"
            custom WALTER_ELEMENT##.custom.bank_bg      "" ""                                               ""      "transport_group_bg"
            custom WALTER_ELEMENT##.custom.time_bg      "" ""                                               ""      "transport_group_bg"

            ; width
            set VAL_trans_w 600

            ; extra padding
            set VAL_trans_extrapad_x * SCALE par_##PARAMETER_SECTION##_settings_extrapad_x
            set VAL_trans_extrapad_y * SCALE par_##PARAMETER_SECTION##_settings_extrapad_y

            ; spacing
            set VAL_trans_spacing_x                 + VAL_Pad{0} * SCALE par_##PARAMETER_SECTION##_element_adj_spacing_x
            set VAL_trans_spacing_time_x            + VAL_Pad{0} * SCALE par_##PARAMETER_SECTION##_element_adj_spacing_time_x
            set VAL_trans_spacing_section_x         + VAL_Pad{0} * SCALE par_##PARAMETER_SECTION##_element_adj_spacing_section_x
            set VAL_trans_spacing_separator         + VAL_Pad{0} * SCALE par_##PARAMETER_SECTION##_element_adj_separator_size

            ; top position
            set VAL_trans_y_top + VAL_pad VAL_trans_extrapad_y{0}

            ; leftmost position
            set VAL_trans_x_leftmost + VAL_Pad VAL_trans_extrapad_x{0}

            ; rightmost position
            set VAL_trans_x_rightmost - VAL_trans_w + VAL_Pad{0} VAL_trans_extrapad_x{0}

            ; element hiding flag
            set VAL_trans_hide_buttons 0

            ; bank buttons section width
            set VAL_trans_w_bank_section                                        \
                ?par_trans_settings_theme_macros                                \
                    + + VAL_Button_Trans{0} VAL_Pad{0}                          \
                    + * 2 VAL_Pad{0} +                                          \
                        * - par_trans_settings_theme_macros 1 VAL_Pad{0}        \
                        * par_trans_settings_theme_macros VAL_Button_Trans{1}   \
                    0

            ; right edge padding
            set VAL_trans_x_rightmost_padding - VAL_trans_w{0} - VAL_trans_x_rightmost{0} VAL_trans_w_bank_section{0}

            ; hiding x position
            set VAL_trans_hide_x - w VAL_trans_x_rightmost_padding{0}


        endmacro

    ;   ## Draw : Transport : Buttons
    ; -----------------------------------------------------------------

        macro MAC_DrawTransport_Buttons SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; y position
            set CUR_y VAL_trans_y_top

            ; x position
            set CUR_x VAL_trans_x_leftmost

            ; preparation
            set VAL_trans_button_count 0
            set VAL_trans_button_group_count 0
            set VAL_trans_button_section_count 0

            set CUR_w VAL_Button_Trans{0}
            set CUR_h VAL_Button_Trans{1}

            ; rewind / forward
            MAC_DrawTransport_Buttons_SingleButton          SCALE 2 "trans" "trans" "rew"
            MAC_DrawTransport_Buttons_SingleButton          SCALE 4 "trans" "trans" "fwd"
            MAC_DrawTransport_Buttons_Separator             SCALE 4 "trans" "trans"

            ; pause / stop / play
            set VAL_trans_button_group_count 0
            MAC_DrawTransport_Buttons_SingleButton          SCALE 8 "trans" "trans" "stop"
            MAC_DrawTransport_Buttons_SingleButton          SCALE 16 "trans" "trans" "pause"
            MAC_DrawTransport_Buttons_SingleButton          SCALE 32 "trans" "trans" "play"
            MAC_DrawTransport_Buttons_Separator             SCALE 32 "trans" "trans"

            ; record
            set VAL_trans_button_group_count 0
            MAC_DrawTransport_Buttons_SingleButton          SCALE 64 "trans" "trans" "rec"
            MAC_DrawTransport_Buttons_Separator             SCALE 64 "trans" "trans"

            ; repeat
            set VAL_trans_button_group_count 0
            MAC_DrawTransport_Buttons_SingleButton          SCALE 128 "trans" "trans" "repeat"
            MAC_DrawTransport_Buttons_Separator             SCALE 128 "trans" "trans"

            set CUR_w VAL_Button_Trans{2}

            ; automation
            set VAL_trans_button_group_count 0
            MAC_DrawTransport_Buttons_SingleButton          SCALE 256 "trans" "trans" "automode"
            MAC_DrawTransport_Buttons_Separator             SCALE 256 "trans" "trans"

            ; bpm / timebase / playrate
            set VAL_trans_button_section_count 0
            set VAL_trans_button_group_count 0
            MAC_DrawTransport_Buttons_Bpm                   SCALE 512 "trans" "trans"

        endmacro

        ;  ### Draw : Transport : Buttons : Single Button
        ; -----------------------------------------------------------------

            macro MAC_DrawTransport_Buttons_SingleButton SCALE INDEX WALTER_ELEMENT PARAMETER_SECTION ELEMENT

                ; section offset
                set CUR_x                                   \
                    ?VAL_trans_button_count{0}              \
                        + CUR_x{0} VAL_trans_spacing_x{0}

                ; hiding logic
                set CUR_x_target + CUR_x{0} CUR_w{0}

                set VAL_trans_hide_buttons                  \
                    CUR_x_target{0}>VAL_trans_hide_x{0}     \
                        1

                ; visibility
                set VAL_trans_show_##ELEMENT                            \
                    ?VAL_trans_hide_buttons{0}                          \
                        0                                               \
                        par_##PARAMETER_SECTION##_element_vis&INDEX     \
                            1                                           \
                            0

                ; [DRAW] Button
                set DRAW_trans_##ELEMENT                    \
                    ?VAL_trans_show_##ELEMENT##{0}          \
                        [CUR_x CUR_y CUR_w CUR_h 0 0 0 0]   \
                        0

                ; group count
                set VAL_trans_button_group_count                \
                    ?VAL_trans_show_##ELEMENT##{0}              \
                        + VAL_trans_button_group_count{0} 1

                ; button count
                set VAL_trans_button_count          +  VAL_trans_show_##ELEMENT##{0}
                set VAL_trans_button_group_count    +  VAL_trans_show_##ELEMENT##{0}
                set VAL_trans_button_section_count  +  VAL_trans_show_##ELEMENT##{0}

                ; increment x position
                set CUR_x                           \
                    ?VAL_trans_show_##ELEMENT##{0}  \
                        + CUR_x{0} CUR_w{0}

            endmacro

        ;  ### Draw : Transport : Buttons : Bpm
        ; -----------------------------------------------------------------

            macro MAC_DrawTransport_Buttons_Bpm SCALE INDEX WALTER_ELEMENT PARAMETER_SECTION

                ; side padding value
                set VAL_trans_timepad * SCALE 10

                ; section offset
                set CUR_x                                           \
                    ?VAL_trans_button_count{0}                      \
                        !VAL_trans_button_section_count{0}          \
                            + CUR_x{0} VAL_trans_spacing_section_x{0}

                ; bpm visibility
                set VAL_trans_show_bpm                              \
                    par_##PARAMETER_SECTION##_element_vis&INDEX     \
                        1                                           \
                        0

                ; timesignature visibility
                set VAL_trans_show_timesig      \
                    ?VAL_trans_show_bpm{0}      \
                        trans_flags&4           \
                            1                   \
                            0                   \
                        0

                ; playrate visibility
                set VAL_trans_show_playrate     \
                    ?VAL_trans_show_bpm{0}      \
                        trans_flags&2           \
                            1                   \
                            0                   \
                        0

                ; tap visibility
                set VAL_trans_show_bpm_tap  * VAL_trans_show_bpm{0} par_##PARAMETER_SECTION##_element_adj_bpm_tap

                ; elements width
                set CUR_w_edit      * VAL_trans_show_bpm{0}         * SCALE 32
                set CUR_w_tap       * VAL_trans_show_bpm_tap{0}     * SCALE 24
                set CUR_w_timesig   * VAL_trans_show_timesig{0}     * SCALE 24
                set CUR_w_rate      * VAL_trans_show_playrate{0}    * SCALE 80

               ; playrate fader size
                set CUR_w_rate_fader                                    \
                    ?VAL_trans_show_playrate{0}                         \
                        par_trans_playrate_mode==0                      \
                            0                                           \
                        par_trans_playrate_mode==1                      \
                            VAL_button_trans{1}                         \
                        par_trans_playrate_mode==2                      \
                            * SCALE + 20 par_trans_playrate_size        \
                            0                                           \
                        0

                ; total width
                set VAL_trans_time_spacing_count + VAL_trans_show_timesig VAL_trans_show_playrate

                set CUR_w_section                                                                               \
                     + * 2 VAL_trans_timepad{0}                                                                 \
                     + * VAL_trans_time_spacing_count{0} VAL_trans_spacing_time_x{0}                            \
                     + CUR_w_edit{0} + CUR_w_tap{0} + CUR_w_timesig{0} + CUR_w_rate{0} CUR_w_rate_fader{0}

                ; hiding logic
                set CUR_x_target + CUR_x{0} CUR_w_section{0}

                set VAL_trans_hide_buttons                      \
                    ?VAL_trans_show_bpm{0}                      \
                        CUR_x_target{0}>VAL_trans_hide_x{0}     \
                        1

                set VAL_trans_show_bpm          ?VAL_trans_hide_buttons{0}      0
                set VAL_trans_show_timesig      ?VAL_trans_hide_buttons{0}      0
                set VAL_trans_show_playrate     ?VAL_trans_hide_buttons{0}      0
                set VAL_trans_show_bpm_tap      ?VAL_trans_hide_buttons{0}      0

                ; [DRAW] Background
                set DRAW_trans_time_bg                                  \
                    ?VAL_trans_show_bpm{0}                              \
                        [CUR_x CUR_y CUR_w_section CUR_h 0 0 0 0]       \
                        0

                ; increment x position
                set CUR_x + * VAL_trans_show_bpm{0} VAL_trans_timepad{0}

                ; [DRAW] BPM Edit Field
                set DRAW_trans_time_bpm_edit                        \
                    ?VAL_trans_show_bpm{0}                          \
                        [CUR_x CUR_y CUR_w_edit CUR_h 0 0 0 0]      \
                        0

                ; increment x position
                set CUR_x + * VAL_trans_show_bpm{0} CUR_w_edit{0}

                ; [DRAW] BPM Tap Button
                set DRAW_trans_time_bpm_tap                         \
                    ?VAL_trans_show_bpm{0}                          \
                        [CUR_x CUR_y CUR_w_tap CUR_h 0 0 0 0]       \
                        0

                ; increment x position
                set CUR_x + * VAL_trans_show_bpm_tap{0} CUR_w_tap{0}

                ; add x spacing before time signature
                set CUR_x + * VAL_trans_show_timesig{0} VAL_trans_spacing_time_x{0}

                ; [DRAW] Time Signature
                set DRAW_trans_time_timesig                                 \
                    ?VAL_trans_show_bpm{0}                                  \
                        ?VAL_trans_show_timesig{0}                          \
                            [CUR_x CUR_y CUR_w_timesig CUR_h 0 0 0 0]       \
                            0                                               \
                        0

                ; increment x position
                set CUR_x + * VAL_trans_show_timesig{0} CUR_w_timesig{0}

                ; add x spacing before playrate
                set CUR_x + * VAL_trans_show_playrate{0} VAL_trans_spacing_time_x{0}

                ; [DRAW] Playrate
                set DRAW_trans_time_rate                                \
                    ?VAL_trans_show_bpm{0}                              \
                        ?VAL_trans_show_playrate{0}                     \
                            [CUR_x CUR_y CUR_w_rate CUR_h 0 0 0 0]      \
                            0                                           \
                        0

                ; increment x position
                set CUR_x + CUR_x{0} * VAL_trans_show_playrate{0} CUR_w_rate{0}

                ; playrate fader knob mode
                set WALTER_ELEMENT##.rate.fader.fadermode           \
                    par_##PARAMETER_SECTION##_playrate_mode==1      \
                        1                                           \
                    par_##PARAMETER_SECTION##_playrate_mode==2      \
                        -1

                ; [DRAW] Playrate Fader
                set CUR_h_fader                                     \
                    par_##PARAMETER_SECTION##_playrate_mode==2      \
                        * VAL_Button{1} 0.5                         \
                        VAL_Button_Trans{1}


                set CUR_y_fader                                     \
                    par_##PARAMETER_SECTION##_playrate_mode==2      \
                        + CUR_y{0} * 0.5 - CUR_h{0} CUR_h_fader{0}  \
                        VAL_trans_y_top

                set DRAW_trans_time_rate_fader                                              \
                    ?VAL_trans_show_playrate{0}                                             \
                        ?par_##PARAMETER_SECTION##_playrate_mode                            \
                            [CUR_x CUR_y_fader CUR_w_rate_fader CUR_h_fader 0 0 0 0]        \
                            0                                                               \
                        0

                ; element counter
                set VAL_trans_button_section_count  +   VAL_trans_button_section_count{0}      VAL_trans_show_bpm{0}
                set VAL_trans_button_group_count    +   VAL_trans_button_group_count{0}        VAL_trans_show_bpm{0}
                set VAL_trans_button_count          +   VAL_trans_button_count{0}              VAL_trans_show_bpm{0}

                ; increment x position post rate-fader
                set CUR_x                                                                   \
                    ?par_##PARAMETER_SECTION##_playrate_mode                                \
                        + CUR_x{0} * VAL_trans_show_playrate{0} CUR_w_rate_fader{0}

                ; post-section spacing
                set CUR_x + CUR_x{0} * VAL_trans_show_bpm{0} + VAL_trans_timepad{0} VAL_trans_spacing_section_x{0}

            endmacro


        ;  ### Draw : Transport : Buttons : Separator
        ; -----------------------------------------------------------------

            macro MAC_DrawTransport_Buttons_Separator SCALE INDEX WALTER_ELEMENT PARAMETER_SECTION

                ; visibility
                set VAL_trans_show_separator##INDEX                         \
                    ?VAL_trans_hide_buttons{0}                              \
                        0                                                   \
                    par_##PARAMETER_SECTION##_element_separator&INDEX       \
                        ?VAL_trans_button_group_count{0}                    \
                            1                                               \
                            0                                               \
                        0

                ; increment x position
                set CUR_x + * VAL_trans_show_separator##INDEX##{0} VAL_trans_spacing_separator{0}

            endmacro

    ;   ## Draw : Transport : Status
    ; -----------------------------------------------------------------

        macro MAC_DrawTransport_Status SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; width
            set VAL_remaining_w - w + CUR_x VAL_trans_x_rightmost_padding

            set CUR_w                                                                       \
                ?par_trans_element_adj_status_size_scale                                    \
                    * VAL_remaining_w{0}    * 0.01      par_trans_element_adj_status_size   \
                    * SCALE                 * 3 + 20    par_trans_element_adj_status_size

            ; hiding logic
            set CUR_x_target + CUR_x_target{0} CUR_w{0}

            set VAL_trans_hide_buttons                  \
                CUR_x_target{0}>VAL_trans_hide_x{0}     \
                    1

            ; visibility
            set VAL_trans_show_status                           \
                ?VAL_trans_hide_buttons{0}                      \
                    0                                           \
                par_##PARAMETER_SECTION##_element_vis&1024      \
                    1                                           \
                    0

            ; [DRAW] Status
            set DRAW_trans_status                           \
                ?VAL_trans_show_status{0}                   \
                    [CUR_x CUR_y CUR_w CUR_h 0 0 0 0]       \
                    0

            ; section count
            set VAL_trans_button_section_count + VAL_trans_button_section_count{0} VAL_trans_show_status{0}

            ; increment x position
            set CUR_x + CUR_x{0} * VAL_trans_show_status{0} + CUR_w{0} VAL_trans_spacing_section_x{0}

        endmacro

    ;   ## Draw : Transport : Selection
    ; -----------------------------------------------------------------

        macro MAC_DrawTransport_Selection SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; width
            set VAL_remaining_w - w + CUR_x{0} VAL_trans_x_rightmost_padding{0}

            set CUR_w                                                                           \
                ?par_trans_element_adj_selection_size_scale                                     \
                    * VAL_remaining_w{0}    * 0.01      par_trans_element_adj_selection_size    \
                    * SCALE                 * 3 + 50    par_trans_element_adj_selection_size

            ; hiding logic
            set CUR_x_target + CUR_x{0} CUR_w{0}

            set VAL_trans_hide_buttons                  \
                CUR_x_target{0}>VAL_trans_hide_x{0}     \
                    1

            ; visibility
            set VAL_trans_show_selection                        \
                ?VAL_trans_hide_buttons{0}                      \
                    0                                           \
                par_##PARAMETER_SECTION##_element_vis&2048      \
                    1                                           \
                    0

            ; target x position
            set CUR_x_target + CUR_x{0} CUR_w{0}

            ; [DRAW] Status
            set DRAW_trans_selection                        \
                ?VAL_trans_show_selection{0}                \
                    [CUR_x CUR_y CUR_w CUR_h 0 0 0 0]       \
                    0

            ; increment x position
            set CUR_x + CUR_x{0} * VAL_trans_show_selection{0} CUR_w{0}

        endmacro

    ;   ## Draw : Transport : Size
    ; -----------------------------------------------------------------

        macro MAC_DrawTransport_Size SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; store x end position
            set VAL_trans_w_content - CUR_x{0} VAL_trans_x_leftmost{0}

            ; height
            set VAL_trans_h + CUR_y{0} + CUR_h{0} + VAL_trans_extrapad_y{0} VAL_Pad{0}

            ; minimal width
            set VAL_trans_w_min * SCALE 100
            set VAL_trans_w_max * SCALE 1920

            ; transport size
            set WALTER_ELEMENT##.size [VAL_trans_w VAL_trans_h]
            set WALTER_ELEMENT##.size.dockedheight [VAL_trans_h]
            set WALTER_ELEMENT##.size.minmax [VAL_trans_w_min VAL_trans_h VAL_trans_w_max VAL_trans_h]

        endmacro

    ;   ## Draw : Transport : Place Elements
    ; -----------------------------------------------------------------

        macro MAC_DrawTransport_PlaceElements SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; x position offset (optional centering)
            set VAL_x_offset * trans_center - * 0.5 - w + VAL_trans_w_content{0} VAL_trans_w_bank_section{0} VAL_trans_extrapad_x{0}

            ; transport buttons
            MAC_DrawTransport_PlaceElements_Draw SCALE WALTER_ELEMENT PARAMETER_SECTION "rew"               "rew"               VAL_x_offset
            MAC_DrawTransport_PlaceElements_Draw SCALE WALTER_ELEMENT PARAMETER_SECTION "fwd"               "fwd"               VAL_x_offset
            MAC_DrawTransport_PlaceElements_Draw SCALE WALTER_ELEMENT PARAMETER_SECTION "stop"              "stop"              VAL_x_offset
            MAC_DrawTransport_PlaceElements_Draw SCALE WALTER_ELEMENT PARAMETER_SECTION "pause"             "pause"             VAL_x_offset
            MAC_DrawTransport_PlaceElements_Draw SCALE WALTER_ELEMENT PARAMETER_SECTION "play"              "play"              VAL_x_offset
            MAC_DrawTransport_PlaceElements_Draw SCALE WALTER_ELEMENT PARAMETER_SECTION "rec"               "rec"               VAL_x_offset
            MAC_DrawTransport_PlaceElements_Draw SCALE WALTER_ELEMENT PARAMETER_SECTION "repeat"            "repeat"            VAL_x_offset
            MAC_DrawTransport_PlaceElements_Draw SCALE WALTER_ELEMENT PARAMETER_SECTION "automode"          "automode"          VAL_x_offset

            ; time settings
            MAC_DrawTransport_PlaceElements_Draw SCALE WALTER_ELEMENT PARAMETER_SECTION "time_bg"           "custom.time_bg"    VAL_x_offset
            MAC_DrawTransport_PlaceElements_Draw SCALE WALTER_ELEMENT PARAMETER_SECTION "time_bpm_edit"     "bpm.edit"          VAL_x_offset
            MAC_DrawTransport_PlaceElements_Draw SCALE WALTER_ELEMENT PARAMETER_SECTION "time_bpm_tap"      "bpm.tap"           VAL_x_offset
            MAC_DrawTransport_PlaceElements_Draw SCALE WALTER_ELEMENT PARAMETER_SECTION "time_timesig"      "curtimesig"        VAL_x_offset
            MAC_DrawTransport_PlaceElements_Draw SCALE WALTER_ELEMENT PARAMETER_SECTION "time_rate"         "rate"              VAL_x_offset
            MAC_DrawTransport_PlaceElements_Draw SCALE WALTER_ELEMENT PARAMETER_SECTION "time_rate_fader"   "rate.fader"        VAL_x_offset
            MAC_DrawTransport_PlaceElements_Draw SCALE WALTER_ELEMENT PARAMETER_SECTION "rew"               "rew"               VAL_x_offset

            ; status / selection
            MAC_DrawTransport_PlaceElements_Draw SCALE WALTER_ELEMENT PARAMETER_SECTION "status"            "status"            VAL_x_offset
            MAC_DrawTransport_PlaceElements_Draw SCALE WALTER_ELEMENT PARAMETER_SECTION "selection"         "sel"               VAL_x_offset

        endmacro

        ;   ### Draw : Transport : Place Elements : Draw
        ; -----------------------------------------------------------------

            macro MAC_DrawTransport_PlaceElements_Draw SCALE WALTER_ELEMENT PARAMETER_SECTION VAR_NAME TARGET_ELEMENT X_OFFSET
                set WALTER_ELEMENT##.##TARGET_ELEMENT + DRAW_trans_##VAR_NAME [X_OFFSET 0 0 0 0 0 0 0]
                front WALTER_ELEMENT##.##TARGET_ELEMENT
            endmacro

        ;   ### Draw : Transport : Bank Buttons
        ; -----------------------------------------------------------------

            macro MAC_DrawTransport_BankButtons SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; dimensions
                set CUR_w VAL_Button_Trans{1}
                set CUR_h VAL_Button_Trans{1}

                ; x position
                set CUR_x - trans.size{0} VAL_trans_w_bank_section{0}

                ; background
                set WALTER_ELEMENT##.custom.bank_bg                                 \
                    par_trans_settings_theme_macros>0                               \
                        [CUR_x CUR_y VAL_trans_w_bank_section{0} CUR_h 1 0 1 0]     \
                        0

                ; logo
                set WALTER_ELEMENT##.custom.bank_logo                       \
                    par_trans_settings_theme_macros>0                       \
                        [CUR_x CUR_y VAL_Button_Trans{0} CUR_h 1 0 1 0]     \
                        0

                ; z order
                front WALTER_ELEMENT##.custom.bank_bg
                front WALTER_ELEMENT##.custom.bank_logo

                ; increment x position
                set CUR_x + CUR_x + VAL_Button_Trans{0} VAL_Pad{0}

                ; bank buttons
                MAC_DrawTransport_BankButtons_SingleButton  SCALE WALTER_ELEMENT PARAMETER_SECTION  1 "0" 2
                MAC_DrawTransport_BankButtons_SingleButton  SCALE WALTER_ELEMENT PARAMETER_SECTION  2 "1" 3
                MAC_DrawTransport_BankButtons_SingleButton  SCALE WALTER_ELEMENT PARAMETER_SECTION  3 "2" 4
                MAC_DrawTransport_BankButtons_SingleButton  SCALE WALTER_ELEMENT PARAMETER_SECTION  4 "3" 5
                MAC_DrawTransport_BankButtons_SingleButton  SCALE WALTER_ELEMENT PARAMETER_SECTION  5 "4" 6
                MAC_DrawTransport_BankButtons_SingleButton  SCALE WALTER_ELEMENT PARAMETER_SECTION  6 "5" 7
                MAC_DrawTransport_BankButtons_SingleButton  SCALE WALTER_ELEMENT PARAMETER_SECTION  7 "6" 8
                MAC_DrawTransport_BankButtons_SingleButton  SCALE WALTER_ELEMENT PARAMETER_SECTION  8 "7" 9

            endmacro

            ;   #### Draw : Transport : Bank Buttons : Single Button
            ; -----------------------------------------------------------------

                macro MAC_DrawTransport_BankButtons_SingleButton SCALE WALTER_ELEMENT PARAMETER_SECTION THRESHOLD INDEX BANK_INDEX

                    ; off button
                    set WALTER_ELEMENT##.custom.bank_##INDEX        \
                        par_trans_settings_theme_macros>=THRESHOLD  \
                            par_bank_selected!=BANK_INDEX           \
                                [CUR_x CUR_y CUR_w CUR_h 1 0 1 0]

                    ; on button
                    set WALTER_ELEMENT##.custom.bank_##INDEX##_on   \
                        par_trans_settings_theme_macros>=THRESHOLD  \
                            par_bank_selected==BANK_INDEX           \
                                [CUR_x CUR_y CUR_w CUR_h 1 0 1 0]

                    ; z order
                    front WALTER_ELEMENT##.custom.bank_##INDEX
                    front WALTER_ELEMENT##.custom.bank_##INDEX##_on

                    ; increment x position
                    set CUR_x + CUR_x{0} + CUR_w{0} VAL_Pad{0}

                endmacro

        ;   ### Draw : Transport : Font
        ; -----------------------------------------------------------------

            macro MAC_DrawTransport_Font SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; bpm tap
                set WALTER_ELEMENT##.bpm.tap.font       VAL_Font_Large
                set WALTER_ELEMENT##.bpm.tap.margin     [VAL_Margin_Label_Trans_Time{0} VAL_Margin_Label_Trans_Time{1} VAL_Margin_Label_Trans_Time{2} VAL_Margin_Label_Trans_Time{3}]

                ; bpm edit
                set WALTER_ELEMENT##.bpm.edit.font      VAL_Font_Large
                set WALTER_ELEMENT##.bpm.edit.margin    [VAL_Margin_Label_Trans_Time{0} VAL_Margin_Label_Trans_Time{1} VAL_Margin_Label_Trans_Time{2} VAL_Margin_Label_Trans_Time{3}]

                ; time signature
                set WALTER_ELEMENT##.curtimesig.font    VAL_Font_Large

                ; playrate
                set WALTER_ELEMENT##.rate.font          VAL_Font_Large
                set WALTER_ELEMENT##.rate.margin        [VAL_Margin_Label_Trans_Time{0} VAL_Margin_Label_Trans_Time{1} VAL_Margin_Label_Trans_Time{2} VAL_Margin_Label_Trans_Time{3}]

                ; status
                set WALTER_ELEMENT##.status.margin      [VAL_Margin_Label_Trans_Status{0} VAL_Margin_Label_Trans_Status{1} VAL_Margin_Label_Trans_Status{2} VAL_Margin_Label_Trans_Status{3}]

                ; selection
                set WALTER_ELEMENT##.sel.margin         [VAL_Margin_Label_Trans_Selection{0} VAL_Margin_Label_Trans_Selection{1} VAL_Margin_Label_Trans_Selection{2} VAL_Margin_Label_Trans_Selection{3}]
                set WALTER_ELEMENT##.sel.font           VAL_Font_Large


            endmacro


; ====================================================================================================================================
;   # MCP
; ====================================================================================================================================

    ;   ## Draw : MCP : Draw
    ; -----------------------------------------------------------------

        macro MAC_DrawMcp SCALE

            ; track
            clear mcp.*
            MAC_DrawMcp_Setup_Track     SCALE   "mcp"   "track"
            MAC_DrawMcp_Label_Track     SCALE   "mcp"   "track"
            MAC_DrawMcp_Inserts         SCALE   "mcp"   "track"
            MAC_DrawMcp_Buttons_Track   SCALE   "mcp"   "track"
            MAC_DrawMcp_Meter_Top       SCALE   "mcp"   "track"
            MAC_DrawMcp_Faders_Top	    SCALE   "mcp"   "track"
            MAC_DrawMcp_Meter_Bottom    SCALE   "mcp"   "track"
            MAC_DrawMcp_Faders_Bottom   SCALE   "mcp"   "track"
            MAC_DrawMcp_Size            SCALE   "mcp"   "track"
            MAC_DrawMcp_Folder          SCALE   "mcp"   "track"
            MAC_DrawMcp_Font_Track      SCALE   "mcp"   "track"

            ; master
            clear master.mcp.*
            MAC_DrawMcp_Setup_Master        SCALE   "master.mcp"   "master"
            MAC_DrawMcp_Label_Master        SCALE   "master.mcp"   "master"
            MAC_DrawMcp_Inserts             SCALE   "master.mcp"   "master"
            MAC_DrawMcp_PostInsert_Master   SCALE   "master.mcp"   "master"
            MAC_DrawMcp_Buttons_Master      SCALE   "master.mcp"   "master"
            MAC_DrawMcp_Meter_Top           SCALE   "master.mcp"   "master"
            MAC_DrawMcp_Faders_Top	        SCALE   "master.mcp"   "master"
            MAC_DrawMcp_Meter_Bottom        SCALE   "master.mcp"   "master"
            MAC_DrawMcp_Faders_Bottom       SCALE   "master.mcp"   "master"
            MAC_DrawMcp_Size                SCALE   "master.mcp"   "master"
            MAC_DrawMcp_Font_Master         SCALE   "master.mcp"   "master"

        endmacro


    ;   ## Draw : MCP : Setup
    ; -----------------------------------------------------------------

        ;   ### Draw : MCP : Setup : Open
        ; -----------------------------------------------------------------

            macro MAC_DrawMcp_Setup_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; custom elements
                custom WALTER_ELEMENT##.custom.meter_frame      "" "" "" "meter_custom_border"
                custom WALTER_ELEMENT##.custom.vol_frame        "" "" "" "track_custom_fader_frame"
                custom WALTER_ELEMENT##.custom.pan_frame        "" "" "" "track_custom_fader_frame"
                custom WALTER_ELEMENT##.custom.wid_frame        "" "" "" "track_custom_fader_frame"
                custom WALTER_ELEMENT##.custom.vol_knob_frame   "" "" "" "track_custom_knob_l_border"
                custom WALTER_ELEMENT##.custom.pan_knob_frame   "" "" "" "track_custom_knob_l_border"
                custom WALTER_ELEMENT##.custom.wid_knob_frame   "" "" "" "track_custom_knob_l_border"
                custom WALTER_ELEMENT##.custom.readout_bg       "" "" "" "meter_custom_readout_bg_vert"
                custom WALTER_ELEMENT##.custom.index_bg         "" "" "" "track_custom_idx_bg"
                custom WALTER_ELEMENT##.custom.env_icon         "" "" "" "track_custom_env_icon"


                ; readout color
                set WALTER_ELEMENT##.volume.label.color [THEME_color_readout_font{0} THEME_color_readout_font{1} THEME_color_readout_font{2}]

                ; hide flag
                set VAL_mcp_hide_rest 0

                ; volume readout height
                set VAL_mcp_vol_readout_h                                   \
                    par_mcp_##PARAMETER_SECTION##_meter_vol_readout{0}==1   \
                        * SCALE 12                                          \
                    par_mcp_##PARAMETER_SECTION##_meter_vol_readout{0}==2   \
                        * SCALE 30                                          \
                        0

                ; additional element padding
                set VAL_mcp_insert_padding  par_mcp_##PARAMETER_SECTION##_insert_pad
                set VAL_mcp_meter_padding   par_mcp_##PARAMETER_SECTION##_meter_padding

                ; element pre-calculations
                MAC_DrawMcp_Setup_Faders    SCALE WALTER_ELEMENT PARAMETER_SECTION
                MAC_DrawMcp_Setup_Meter     SCALE WALTER_ELEMENT PARAMETER_SECTION

                set VAL_mcp_precalc_w_buttons                               \
                    par_mcp_##PARAMETER_SECTION##_element_width{0}==0       \
                        VAL_mcp_w_button_slim{0}                            \
                        par_mcp_##PARAMETER_SECTION##_element_vis{0}!=0     \
                            VAL_mcp_w_button_wide{0}                        \
                            VAL_mcp_w_button_slim{0}

                ; initialize pre-calculated width
                set VAL_mcp_precalc_w 0

                ; update mcp width
                set VAL_mcp_precalc_w                                       \
                    VAL_mcp_precalc_w{0}<VAL_mcp_precalc_w_buttons{0}       \
                        VAL_mcp_precalc_w_buttons{0}

                ; top fader width extension
                set VAL_mcp_precalc_w_faders_top                                                                                \
                    par_mcp_##PARAMETER_SECTION##_fader_layout{0}!=0                                                            \
                        0                                                                                                       \
                        + + * 2 VAL_Knob{0} VAL_mcp_spacing_fader_x{0} * SCALE par_mcp_##PARAMETER_SECTION##_fader_pan_width

                set VAL_mcp_precalc_w_faders_top_full                       \
                    par_mcp_##PARAMETER_SECTION##_fader_layout{0}==0        \
                        + VAL_mcp_precalc_w_faders_top{0} * 2 VAL_Unit{0}   \
                        0

                ; update mcp width
                set VAL_mcp_precalc_w                                               \
                    par_mcp_##PARAMETER_SECTION##_fader_layout{0}==0                \
                        VAL_mcp_precalc_w{0}<VAL_mcp_precalc_w_faders_top_full{0}   \
                            VAL_mcp_precalc_w_faders_top_full{0}

                ; bottom section width
                set VAL_mcp_precalc_w_bottom                                                \
                    par_mcp_##PARAMETER_SECTION##_fader_layout{0}==2                        \
                        +   VAL_Unit{0}   +   VAL_mcp_spacing_fader_x{0} * 2 VAL_Button{0}   \
                    par_mcp_##PARAMETER_SECTION##_fader_layout{0}==1                        \
                        +   VAL_Unit{0}       VAL_Knob{0}                                   \
                    +       VAL_Unit{0} VAL_Knob{0}

                set VAL_Mcp_precalc_w_bottom                                                                            \
                    par_mcp_##PARAMETER_SECTION##_meter_pos{0}==2                                                       \
                        + VAL_Mcp_precalc_w_bottom{0} + VAL_mcp_spacing_section_x{0} VAL_mcp_meter_bottom_w_precalc{0}

                set VAL_Mcp_precalc_w_bottom_nobuttons VAL_Mcp_precalc_w_bottom{0}

                ; update mcp width
                set VAL_mcp_precalc_w                                   \
                    VAL_mcp_precalc_w{0}<VAL_mcp_precalc_w_bottom{0}    \
                        VAL_mcp_precalc_w_bottom{0}

            endmacro

            ;   #### Draw : MCP : Setup : Track
            ; -----------------------------------------------------------------

                macro MAC_DrawMcp_Setup_Track SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; custom elements
                    custom WALTER_ELEMENT##.custom.recinput_off         "" "" "" "track_custom_recinput_off"
                    custom WALTER_ELEMENT##.custom.recinput_on          "" "" "" "track_custom_recinput_on"
                    custom WALTER_ELEMENT##.custom.recinput_vert_off    "" "" "" "track_custom_recinput_vert_off"
                    custom WALTER_ELEMENT##.custom.recinput_vert_on     "" "" "" "track_custom_recinput_vert_on"
                    custom WALTER_ELEMENT##.custom.label_recmode        "" "" "" "track_custom_label_recmode"
                    custom WALTER_ELEMENT##.custom.label_infx           "" "" "" "track_custom_label_fxin"

                    ; side trimming
                    set VAL_mcp_trim_left 0
                    set VAL_mcp_trim_right VAL_Border{0}

                    ; [SHARED] Open
                    MAC_DrawMcp_Setup_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; wide recinput
                    set VAL_mcp_show_recinput_top                               \
                        ?par_mcp_##PARAMETER_SECTION##_element_width{0}         \
                            par_mcp_##PARAMETER_SECTION##_element_vis{0}&2      \
                                1                                               \
                                0                                               \
                            0

                    ; sidebar usage
                    set VAL_mcp_use_sidebar                                     \
                        par_mcp_##PARAMETER_SECTION##_insert_mode{0}==3         \
                            1                                                   \
                        par_mcp_##PARAMETER_SECTION##_insert_mode{0}==2         \
                            ?mcp_fxembed{0}                                     \
                                1                                               \
                                0                                               \
                            0

                    ; width extra padding
                    set VAL_mcp_padding + VAL_unit{0} * SCALE par_mcp_track_settings_extrapad{0}

                    ; left x offset
                    set VAL_mcp_x_offset_folder                                 \
                        folderstate>0                                           \
                            * SCALE par_mcp_gen_folder_pad_folder_parent        \
                            0

                    set VAL_mcp_x_offset                                        \
                        folderstate>0                                           \
                            + VAL_mcp_padding{0} VAL_mcp_x_offset_folder{0}     \
                            VAL_mcp_padding{0}

                    ; width right extension
                    set VAL_mcp_x_extension_folder                      \
                        folderstate<0                                   \
                            * SCALE par_mcp_gen_folder_pad_folder_last  \
                            0

                    set VAL_mcp_x_extension                                     \
                        folderstate<0                                           \
                            + VAL_mcp_padding{0} VAL_mcp_x_extension_folder{0}  \
                            VAL_mcp_padding{0}

                    ; inserts sidebar width
                    set VAL_mcp_precalc_w_sidebar                                                                                                       \
                        !VAL_mcp_use_sidebar{0}                                                                                                         \
                            0                                                                                                                           \
                            par_mcp_##PARAMETER_SECTION##_insert_mode{0}==2                                                                             \
                                * SCALE * 2     par_mcp_##PARAMETER_SECTION##_insert_size_embed                                                         \
                                !mcp_fxembed                                                                                                            \
                                    * SCALE * 2     par_mcp_##PARAMETER_SECTION##_insert_size                                                           \
                                    * SCALE + * 2   par_mcp_##PARAMETER_SECTION##_insert_size_embed     * 2 par_mcp_##PARAMETER_SECTION##_insert_size

                    ; size calculations
                    MAC_DrawMcp_Setup_Size SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; folder indentation
                    set VAL_Mcp_FolderFeatures  \
                        !maxfolderdepth         \
                            0                   \
                            1

                    set VAL_Mcp_FolderFeatures                  \
                        !par_mcp_gen_folder_icon_folder         \
                            !par_mcp_gen_folder_icon_last       \
                                0

                    set VAL_mcp_genFolderOffset         \
                        ?VAL_Mcp_FolderFeatures{0}      \
                            VAL_Button_Folder{0}        \
                            0

                    set VAL_mcp_y_offset        + VAL_mcp_genFolderOffset{0} * folderdepth      * SCALE par_mcp_gen_folder_indent
                    set VAL_mcp_y_offset_max    + VAL_mcp_genFolderOffset{0} * maxfolderdepth   * SCALE par_mcp_gen_folder_indent

                    ; indent background
                    set CUR_y - VAL_mcp_h{0} VAL_mcp_y_offset{0}
                    MAC_Draw_Box 1 WALTER_ELEMENT "indent_bg" THEME_color_mcp_empty_space{0} THEME_color_mcp_empty_space{1} THEME_color_mcp_empty_space{2} 0 0 VAL_mcp_w_full{0} VAL_mcp_h 0 0 1 1

                    ; background coordinates
                    set CUR_x_bg + VAL_Border_Neg{0} VAL_mcp_x_offset_folder
                    set CUR_w_bg -      + VAL_mcp_w_full{0} VAL_Border{0}       + VAL_mcp_x_offset_folder VAL_mcp_x_extension_folder
                    set CUR_h_bg - VAL_mcp_h{0} VAL_mcp_y_offset{0}

                    ; [SHARED] Close
                    MAC_DrawMcp_Setup_Close SCALE WALTER_ELEMENT PARAMETER_SECTION

                endmacro

            ;   #### Draw : MCP : Setup : Master
            ; -----------------------------------------------------------------

                macro MAC_DrawMcp_Setup_Master SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; side trimming
                    set VAL_mcp_trim_left VAL_Border{0}
                    set VAL_mcp_trim_right VAL_Border{0}

                    ; [SHARED] Open
                    MAC_DrawMcp_Setup_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; sidebar usage
                    set VAL_mcp_use_sidebar                                 \
                        par_mcp_##PARAMETER_SECTION##_insert_mode==2        \
                            1                                               \
                            0

                    ; width extra padding
                    set VAL_mcp_padding                                         \
                        + VAL_unit{0} * SCALE par_mcp_master_settings_extrapad

                    ; left x offset
                    set VAL_mcp_x_offset + VAL_mcp_padding{0} VAL_Border{0}

                    ; width right extension
                    set VAL_mcp_x_extension_folder 0
                    set VAL_mcp_x_extension VAL_mcp_padding{0}

                    ; inserts full sidebar width
                    set VAL_mcp_precalc_w_sidebar                                                                   \
                        !VAL_mcp_use_sidebar{0}                                                                     \
                            0                                                                                       \
                            + VAL_mcp_spacing_section_x{0} * SCALE * 2 par_mcp_##PARAMETER_SECTION##_insert_size

                    ; size calculations
                    MAC_DrawMcp_Setup_Size SCALE WALTER_ELEMENT PARAMETER_SECTION

                    set VAL_mcp_y_offset 0
                    set VAL_mcp_y_offset_max 0

                    ; background coordinates
                    set CUR_x_bg 0
                    set CUR_w_bg VAL_mcp_w_full{0}
                    set CUR_h_bg VAL_mcp_h{0}

                    ; meter rms channel division
                    set CUR_chan_div * SCALE par_mcp_##PARAMETER_SECTION##_meter_channeldiv_rms
                    set WALTER_ELEMENT##.meter.vu.rmsdiv [CUR_chan_div{0} 0]

                    ; [SHARED] Close
                    MAC_DrawMcp_Setup_Close SCALE WALTER_ELEMENT PARAMETER_SECTION

                endmacro

        ;   ### Draw : MCP : Setup : Close
        ; -----------------------------------------------------------------

            macro MAC_DrawMcp_Setup_Close SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; button leftmost x position
                set VAL_mcp_x_button_start + VAL_mcp_x_offset{0} * 0.5 - VAL_mcp_w{0} VAL_mcp_precalc_w_buttons{0}

                ; background
                MAC_Draw_Box    1 WALTER_ELEMENT "bg"                           VAL_Color_Track_Bg{0} VAL_Color_Track_Bg{1} VAL_Color_Track_Bg{2}   CUR_x_bg 0 CUR_w_bg CUR_h_bg 0 0 1 1
                MAC_Draw_Image  1 WALTER_ELEMENT "bg" "track_custom_bg_frame"                                                                       CUR_x_bg 0 CUR_w_bg CUR_h_bg 0 0 1 1

                ; bottom position
                set VAL_mcp_bottom CUR_h{0}

                ; store positions
                set VAL_mcp_available_space - h + VAL_Pad{0} VAL_mcp_y_offset{0}

            endmacro

        ;   ### Draw : MCP : Setup : Faders
        ; -----------------------------------------------------------------

            macro MAC_DrawMcp_Setup_Faders SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; has vertical fader
                set VAL_mcp_faders_has_vert                                 \
                    par_mcp_##PARAMETER_SECTION##_fader_pan_mode_dual==1    \
                        1                                                   \
                    par_mcp_##PARAMETER_SECTION##_fader_pan_mode_stereo==1  \
                        1                                                   \
                    par_mcp_##PARAMETER_SECTION##_fader_pan_mode_mono==1    \
                        1                                                   \
                        0

                ; has horizontal fader
                set VAL_mcp_faders_has_horz                                 \
                    par_mcp_##PARAMETER_SECTION##_fader_pan_mode_dual==2    \
                        1                                                   \
                    par_mcp_##PARAMETER_SECTION##_fader_pan_mode_stereo==2  \
                        1                                                   \
                    par_mcp_##PARAMETER_SECTION##_fader_pan_mode_mono==2    \
                        1                                                   \
                        0

                ; pan display mode
                set VAL_mcp_faders_panmode                                      \
                    trackpanmode==6                                             \
                        par_mcp_##PARAMETER_SECTION##_fader_pan_mode_dual       \
                    trackpanmode==5                                             \
                        par_mcp_##PARAMETER_SECTION##_fader_pan_mode_stereo     \
                        par_mcp_##PARAMETER_SECTION##_fader_pan_mode_mono

            endmacro

        ;   ### Draw : MCP : Setup : Meter
        ; -----------------------------------------------------------------

            macro MAC_DrawMcp_Setup_Meter SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; width
                set VAL_mcp_meter_bottom_w_precalc + VAL_Button{0} * SCALE par_mcp_##PARAMETER_SECTION##_meter_size

                ; width expansion
                set VAL_channels                                                    \
                    /                                                               \
                        - tracknch * - par_mcp_track_meter_expand_threshold 1 2     \
                    2

                set VAL_channels        \
                    VAL_channels{0}<0   \
                        0

                ; optional limit
                set VAL_channels                            \
                    ?par_mcp_track_meter_expand_mode        \
                        VAL_channels{0}>1                   \
                            1

                ; additional width
                set CUR_w_add                                                   \
                    trackidx>0                                                  \
                        * VAL_channels{0} * SCALE par_mcp_track_meter_expand    \
                        0

                ; update mcp widith pre-calculation
                set VAL_mcp_meter_bottom_w_precalc                          \
                    trackidx>0                                              \
                        + VAL_mcp_meter_bottom_w_precalc{0} CUR_w_add{0}

            endmacro

        ;   ### Draw : MCP : Setup : Size
        ; -----------------------------------------------------------------

            macro MAC_DrawMcp_Setup_Size SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; internal mcp width (excluding padding)
                set VAL_mcp_w VAL_mcp_precalc_w{0}
                set VAL_mcp_h 400
                set VAL_mcp_w_label VAL_mcp_precalc_w{0}

                ; autofit sections (insert + meter)
                MAC_DrawMcp_Setup_Size_AutofitSection SCALE WALTER_ELEMENT PARAMETER_SECTION "insert"   VAL_mcp_x_insert VAL_mcp_w_insert
                MAC_DrawMcp_Setup_Size_AutofitSection SCALE WALTER_ELEMENT PARAMETER_SECTION "meter"    VAL_mcp_x_meter  VAL_mcp_w_meter

                ; final precalculated mcp width
                set VAL_mcp_w_label + VAL_mcp_precalc_w{0} +    * 2 VAL_mcp_padding{0} VAL_mcp_precalc_w_sidebar{0}
                set VAL_mcp_w_full  + VAL_mcp_precalc_w{0} +        VAL_mcp_x_offset{0}     + VAL_mcp_x_extension{0} VAL_mcp_precalc_w_sidebar{0}

            endmacro

            ;   #### Draw : MCP : Setup : AutoFit
            ; -----------------------------------------------------------------

            macro MAC_DrawMcp_Setup_Size_AutofitSection SCALE WALTER_ELEMENT PARAMETER_SECTION ELEMENT TARGET_VALUE_X TARGET_VALUE_W

                ; x position
                set TARGET_VALUE_X                                                                                  \
                    VAL_mcp_##ELEMENT##_padding{0}==2                                                               \
                        + VAL_mcp_x_offset_folder{0} + VAL_mcp_padding{0}   VAL_mcp_trim_left{0}                    \
                    VAL_mcp_##ELEMENT##_padding{0}==1                                                               \
                        + VAL_mcp_x_offset_folder{0} + VAL_border_Neg{0} +  VAL_mcp_trim_left{0}    VAL_Pad{0}      \
                        + VAL_mcp_x_offset_folder{0} + VAL_border_Neg{0}    VAL_mcp_trim_left{0}

                ; width
                set TARGET_VALUE_W                                                                      \
                    VAL_mcp_##ELEMENT##_padding{0}==2                                                   \
                        - VAL_mcp_w{0} VAL_mcp_trim_right{0}                                            \
                    VAL_mcp_##ELEMENT##_padding{0}==1                                                   \
                        + VAL_mcp_w{0} - * 2 VAL_mcp_padding{0} +   VAL_mcp_trim_right{0} VAL_Pad{0}    \
                        + VAL_mcp_w{0} + * 2 VAL_mcp_padding{0}     VAL_mcp_trim_right{0}

            endmacro


    ;   ## Draw : MCP : Label
    ; -----------------------------------------------------------------

        ;   ### Draw : MCP : Label : Open
        ; -----------------------------------------------------------------

            macro MAC_DrawMcp_Label_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; selection marker height
                set CUR_h_selection                                     \
                    ?par_mcp_gen_highlight_selection                    \
                        * SCALE + 2 par_mcp_gen_highlight_selection     \
                        0

                ; initial y position
                set CUR_y - VAL_mcp_h{0} VAL_mcp_y_offset{0}
                set CUR_y_init CUR_y{0}

            endmacro

            ;   #### Draw : MCP : Label : Track
            ; -----------------------------------------------------------------

                macro MAC_DrawMcp_Label_Track SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; color marker height
                    set CUR_h_color                                         \
                        ?par_mcp_gen_highlight_color                        \
                            * SCALE + 2 par_mcp_gen_highlight_color         \
                            0

                    ; [SHARED] Open
                    MAC_DrawMcp_Label_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; label height
                    set VAL_remaining_h - h VAL_mcp_y_offset_max{0}

                    set CUR_h_min                                                   \
                        !par_mcp_##PARAMETER_SECTION##_settings_label_vertical      \
                            * SCALE 18                                              \
                            * 4 VAL_MCP_Label{0}

                    set CUR_h                                                                                   \
                        !par_mcp_##PARAMETER_SECTION##_settings_label_vertical                                  \
                            + CUR_h_min{0} * SCALE      par_mcp_##PARAMETER_SECTION##_settings_label_size       \
                            + CUR_h_min{0} * SCALE * 2  par_mcp_##PARAMETER_SECTION##_settings_label_size

                    ; label background
                    set CUR_y - CUR_y{0} CUR_h{0}
                    set CUR_x + VAL_Border_Neg{0} VAL_mcp_x_offset_folder{0}
                    set CUR_w + VAL_mcp_w_label{0} VAL_Border{0}

                    ; [DRAW] background
                    MAC_Draw_Box    1 WALTER_ELEMENT "label_bg" VAL_Color_Track_Label_Bg{0} VAL_Color_Track_Label_Bg{1} VAL_Color_Track_Label_Bg{2}     CUR_x{0} CUR_y{0} CUR_w{0} CUR_h{0} 0 1 1 1
                    MAC_Draw_Image  1 WALTER_ELEMENT "label_bg" "track_custom_label_frame"                                                              CUR_x{0} CUR_y{0} CUR_w{0} CUR_h{0} 0 1 1 1

                    ; index width
                    set CUR_w_index                                                 \
                        par_mcp_##PARAMETER_SECTION##_settings_label_index==1       \
                            * SCALE + 6 * 6 VAL_index_letters{0}                    \
                            0

                    ; label width
                    set CUR_w_label                                                 \
                        ?par_mcp_##PARAMETER_SECTION##_settings_label_vertical      \
                            VAL_MCP_Label{0}                                        \
                            - CUR_w{0} CUR_w_index

                    ; label height
                    set CUR_h_label                                             \
                        ?par_mcp_##PARAMETER_SECTION##_settings_label_vertical  \
                            - CUR_h{0} CUR_w_index{0}                           \
                            VAL_MCP_Label{0}

                    ; label x position
                    set CUR_x_label                                             \
                        !par_mcp_##PARAMETER_SECTION##_settings_label_vertical  \
                            + CUR_x{0}                  CUR_w_index{0}          \
                            + CUR_x{0} * 0.5 - CUR_w{0} CUR_w_label{0}

                    ; label y position
                    set CUR_y_label                                             \
                        !par_mcp_##PARAMETER_SECTION##_settings_label_vertical  \
                            + CUR_y{0} * 0.5 - CUR_h{0} CUR_h_label{0}          \
                            + CUR_y{0}                  CUR_w_index{0}

                    ; [DRAW] label
                    set WALTER_ELEMENT##.label [CUR_x_label{0} CUR_y_label{0} CUR_w_label{0} CUR_h_label{0} 0 1 1 1]

                    ; index x position
                    set CUR_x_index                                             \
                        !par_mcp_##PARAMETER_SECTION##_settings_label_vertical  \
                            CUR_x                                               \
                            CUR_x_label

                    ; index y position
                    set CUR_y_index                                             \
                        !par_mcp_##PARAMETER_SECTION##_settings_label_vertical  \
                            CUR_y_label                                         \
                            CUR_y

                    ; [DRAW] index
                    set WALTER_ELEMENT##.trackidx                                                           \
                        par_mcp_##PARAMETER_SECTION##_settings_label_index==1                               \
                            !par_mcp_##PARAMETER_SECTION##_settings_label_vertical                          \
                                [CUR_x_index{0} CUR_y_index{0} CUR_w_label{0} VAL_MCP_Label{0} 0 1 1 1]     \
                                [CUR_x_index{0} CUR_y_index{0} VAL_MCP_Label{0} CUR_h_label{0} 0 1 1 1]     \
                            0

                    ; z order
                    front WALTER_ELEMENT##.trackidx
                    front WALTER_ELEMENT##.label

                    ; selection marker
                    set CUR_y                                               \
                        ?par_mcp_gen_highlight_selection                    \
                            - CUR_y{0} - CUR_h_selection{0} VAL_Border{0}

                    MAC_Draw_Box    par_mcp_gen_highlight_selection WALTER_ELEMENT "highlight_select" VAL_color_selectbar{0} VAL_color_selectbar{1} VAL_color_selectbar{2}    CUR_x CUR_y CUR_w CUR_h_selection 0 1 1 1
                    MAC_Draw_Image  par_mcp_gen_highlight_selection WALTER_ELEMENT "highlight_select" "track_custom_selmarker_frame"                                          CUR_x CUR_y CUR_w CUR_h_selection 0 1 1 1

                    ; color marker
                    set CUR_y                                           \
                        ?par_mcp_gen_highlight_color                    \
                            - CUR_y{0} - CUR_h_color{0} VAL_Border{0}

                    MAC_Draw_Box    par_mcp_gen_highlight_color WALTER_ELEMENT "highlight_color" VAL_color_colorbar{0} VAL_color_colorbar{1} VAL_color_colorbar{2}   CUR_x CUR_y CUR_w CUR_h_color 0 1 1 1
                    MAC_Draw_Image  par_mcp_gen_highlight_color WALTER_ELEMENT "highlight_color" "track_custom_colorbar_frame"                                       CUR_x CUR_y CUR_w CUR_h_color 0 1 1 1

                    ; separate index
                    set CUR_y                                                       \
                        ?par_mcp_##PARAMETER_SECTION##_settings_label_index==2      \
                            - CUR_y{0} VAL_MCP_Label{0}

                    ; [DRAW] index bg
                    set WALTER_ELEMENT##.custom.index_bg                            \
                        par_mcp_##PARAMETER_SECTION##_settings_label_index==2       \
                            [CUR_x{0} CUR_y{0} CUR_w{0} VAL_MCP_Label{0} 0 1 1 1]   \
                            0

                    front WALTER_ELEMENT##.custom.index_bg

                    ; [DRAW] index
                    set WALTER_ELEMENT##.trackidx                                   \
                        ?par_mcp_##PARAMETER_SECTION##_settings_label_index==2      \
                            [CUR_x{0} CUR_y{0} CUR_w{0} VAL_MCP_Label{0} 0 1 1 1]

                    front WALTER_ELEMENT##.trackidx

                    ; [SHARED] Close
                    MAC_DrawMcp_Label_Close SCALE WALTER_ELEMENT PARAMETER_SECTION

                endmacro

            ;   #### Draw : MCP : Label : Master
            ; -----------------------------------------------------------------

                macro MAC_DrawMcp_Label_Master SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; [SHARED] Open
                    MAC_DrawMcp_Label_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; label height
                    set CUR_h_min * SCALE 18
                    set CUR_h + CUR_h_min{0} * SCALE par_mcp_##PARAMETER_SECTION##_settings_label_size

                    set CUR_h                       \
                        CUR_h{0}<CUR_h_min{0}       \
                            CUR_h_min{0}

                    ; label position
                    set CUR_y - CUR_y{0} CUR_h{0}
                    set CUR_x   VAL_mcp_x_offset_folder{0}
                    set CUR_w + VAL_mcp_w_label{0} * 2 VAL_Border{0}

                    ; [DRAW] background
                    MAC_Draw_Box    1 WALTER_ELEMENT "label_bg" VAL_color_master_icon{0} VAL_color_master_icon{1} VAL_color_master_icon{2}  CUR_x{0} CUR_y{0} CUR_w{0} CUR_h{0} 0 1 1 1
                    MAC_Draw_Image  1 WALTER_ELEMENT "label_bg" "track_custom_label_frame"                                                  CUR_x{0} CUR_y{0} CUR_w{0} CUR_h{0} 0 1 1 1

                    ; [DRAW] Menu Button
                    set WALTER_ELEMENT##.menubutton [CUR_x{0} CUR_y{0} CUR_w{0} CUR_h{0} 0 1 1 1]
                    front WALTER_ELEMENT##.menubutton

                    set CUR_w_icon VAL_Button{0}
                    set CUR_h_icon VAL_Button{1}
                    set CUR_x_icon + CUR_x{0} * 0.5 - VAL_mcp_w_full{0} CUR_w_icon{0}
                    set CUR_y_icon + CUR_y{0} * 0.5 - CUR_h{0}          CUR_h_icon{0}


                    custom WALTER_ELEMENT##.custom.menubutton_icon "" "" "" "track_custom_master"
                    set WALTER_ELEMENT##.custom.menubutton_icon [CUR_x_icon{0} CUR_y_icon{0} CUR_w_icon{0} CUR_h_icon{0} 0 1 1 1]
                    front WALTER_ELEMENT##.custom.menubutton_icon

                    ; selection marker
                    set CUR_y                                       \
                        ?par_mcp_gen_highlight_selection            \
                            - CUR_y{0} - CUR_h_selection{0} VAL_Border{0}

                    MAC_Draw_Box    par_mcp_gen_highlight_selection WALTER_ELEMENT "highlight_select" VAL_color_selectbar{0} VAL_color_selectbar{1} VAL_color_selectbar{2} CUR_x{0} CUR_y{0} CUR_w{0} CUR_h_selection{0} 0 1 1 1
                    MAC_Draw_Image  par_mcp_gen_highlight_selection WALTER_ELEMENT "highlight_select" "track_custom_selmarker_frame"                                       CUR_x{0} CUR_y{0} CUR_w{0} CUR_h_selection{0} 0 1 1 1

                    ; [SHARED] Close
                    MAC_DrawMcp_Label_Close SCALE WALTER_ELEMENT PARAMETER_SECTION

                endmacro

        ;   ### Draw : MCP : Label : Close
        ; -----------------------------------------------------------------

            macro MAC_DrawMcp_Label_Close SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; store end position
                set VAL_mcp_y_post_label CUR_y{0}
                set VAL_mcp_y_post_label_parallel - CUR_y{0} - VAL_mcp_y_offset_max{0} VAL_mcp_y_offset{0}

                ; dynamic hiding point
                set VAL_mcp_y_labelHide - h - VAL_mcp_h{0} - VAL_mcp_y_post_label_parallel{0} VAL_Pad{0}

            endmacro


    ;   ## Draw : MCP : Inserts
    ; -----------------------------------------------------------------

        macro MAC_DrawMcp_Inserts SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; visibility
            set VAL_mcp_show_inserts                        \
                ?par_mcp_##PARAMETER_SECTION##_insert_mode  \
                    1                                       \
                    0

            ; y position
            set CUR_y_inserts                       \
                ?VAL_mcp_use_sidebar{0}             \
                    0                               \
                    ?VAL_mcp_insert_padding{0}      \
                        VAL_Pad{0}                  \
                        0

            ; height
            set VAL_remaining_h - h + - VAL_mcp_y_offset_max{0} VAL_mcp_y_offset{0} + CUR_y_inserts{0} - VAL_mcp_h{0} VAL_mcp_y_post_label{0}

            set CUR_h                                                                                                                               \
                !VAL_mcp_show_inserts{0}                                                                                                            \
                    0                                                                                                                               \
                ?par_mcp_##PARAMETER_SECTION##_insert_size_scale                                                                                    \
                    + VAL_mcp_inserts_min_h{0} * - VAL_remaining_h{0} VAL_mcp_inserts_min_h{0}  * 0.01  par_mcp_##PARAMETER_SECTION##_insert_size   \
                    + VAL_mcp_inserts_min_h{0} * SCALE                                          * 2     par_mcp_##PARAMETER_SECTION##_insert_size

            ; width
            set CUR_w                               \
                !VAL_mcp_use_sidebar{0}             \
                    VAL_mcp_w_insert{0}             \
                    VAL_mcp_precalc_w_sidebar{0}

            ; x position
            set CUR_x                                                           \
                !VAL_mcp_use_sidebar{0}                                         \
                    VAL_mcp_x_insert{0}                                         \
                    + VAL_mcp_x_offset{0} + VAL_mcp_w{0} VAL_mcp_padding{0}

            ; overhoot correction
            set VAL_mcp_insert_overshoot - h - VAL_mcp_h{0} - VAL_mcp_y_post_label{0} CUR_y_inserts{0}

            set CUR_h                                   \
                VAL_mcp_insert_overshoot{0}<CUR_h{0}    \
                    VAL_mcp_insert_overshoot{0}

            ; [DRAW] inserts
            set WALTER_ELEMENT##.extmixer.position                                  \
                ?VAL_mcp_use_sidebar{0}                                             \
                    [CUR_x{0} CUR_y_inserts CUR_w{0} VAL_remaining_h{0} 0 0 1 0]    \
                    ?VAL_mcp_show_inserts{0}                                        \
                        [CUR_x{0} CUR_y_inserts{0} CUR_w{0} CUR_h{0} 0 0 1 0]

            set WALTER_ELEMENT##.extmixer.mode [1]
            front WALTER_ELEMENT##.extmixer

            ; inserts on top marker
            set VAL_mcp_inserts_on_top          \
                ?VAL_mcp_show_inserts{0}        \
                    !VAL_mcp_use_sidebar{0}     \
                        1                       \
                        0                       \
                    0

            ; increment / reset y position
            set CUR_y                                                               \
                ?VAL_mcp_inserts_on_top{0}                                          \
                    + CUR_y_inserts{0} CUR_h{0}                                     \
                    0

        endmacro

    ;   ## Draw : MCP : RecInput
    ; -----------------------------------------------------------------

        macro MAC_DrawMcp_Recinput SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; y position
                set CUR_y_recinput          \
                    CUR_y_next_button{0}

                set CUR_y_recinput                                      \
                    par_mcp_##PARAMETER_SECTION##_element_width==0      \
                        ?VAL_mcp_inserts_on_top{0}                      \
                            + CUR_y{0} VAL_mcp_spacing_section_y{0}     \
                            + CUR_y{0} VAL_Pad{0}                       \
                        ?VAL_mcp_inserts_on_top{0}                      \
                            - CUR_y{0} VAL_Border{0}                    \
                            CUR_y{0}

                ; height
                set CUR_h_recinput                                                                          \
                    par_mcp_##PARAMETER_SECTION##_element_vis&2                                             \
                        par_mcp_##PARAMETER_SECTION##_element_width==1                                      \
                            VAL_Button{1}                                                                   \
                            + VAL_Button{1} * SCALE + 40 par_mcp_##PARAMETER_SECTION##_element_input_size   \
                        0

                ; hiding logic
                set CUR_y_hide + CUR_y_recinput{0} CUR_h_recinput{0}

                set VAL_mcp_hide_rest                               \
                    par_mcp_##PARAMETER_SECTION##_element_vis&2     \
                        CUR_y_hide{0}>VAL_mcp_y_labelHide{0}        \
                            1

                ; record input
                set VAL_mcp_show_recinput                           \
                    ?VAL_mcp_hide_rest{0}                           \
                        0                                           \
                    par_mcp_##PARAMETER_SECTION##_element_vis&2     \
                        1                                           \
                        0

                ; width
                set CUR_W_recinput                                      \
                    ?VAL_mcp_show_recinput{0}                           \
                        par_mcp_##PARAMETER_SECTION##_element_width==1  \
                            VAL_mcp_w_insert{0}                         \
                            VAL_Button{0}                               \
                        0

                ; x position
                set CUR_x_recinput                               	        \
                    ?VAL_mcp_show_recinput{0}                               \
                        par_mcp_##PARAMETER_SECTION##_element_width==1      \
                            VAL_mcp_x_insert{0}                             \
                            VAL_Mcp_x_button_start{0}                       \
                        0

                ; [DRAW] Input
                set WALTER_ELEMENT##.recinput                                                               \
                    ?VAL_mcp_show_recinput{0}                                                               \
                        [CUR_x_recinput{0} CUR_y_recinput{0} CUR_w_recinput{0} CUR_h_recinput{0} 0 0 0 0]   \
                        0

                set WALTER_ELEMENT##.recinput                                                               \
                    ?VAL_mcp_show_recinput{0}                                                               \
                        [CUR_x_recinput{0} CUR_y_recinput{0} CUR_w_recinput{0} CUR_h_recinput{0} 0 0 0 0]   \
                        0

                set WALTER_ELEMENT##.custom.recinput_off                                                            \
                    ?VAL_mcp_show_recinput{0}                                                                       \
                        !recarm                                                                                     \
                            par_mcp_##PARAMETER_SECTION##_element_width==1                                          \
                                [CUR_x_recinput{0} CUR_y_recinput{0} CUR_w_recinput{0} CUR_h_recinput{0} 0 0 0 0]   \
                                0                                                                                   \
                            0                                                                                       \
                        0

                set WALTER_ELEMENT##.custom.recinput_on                                                             \
                    ?VAL_mcp_show_recinput{0}                                                                       \
                        ?recarm                                                                                     \
                            par_mcp_##PARAMETER_SECTION##_element_width==1                                          \
                                [CUR_x_recinput{0} CUR_y_recinput{0} CUR_w_recinput{0} CUR_h_recinput{0} 0 0 0 0]   \
                                0                                                                                   \
                            0                                                                                       \
                        0

                set WALTER_ELEMENT##.custom.recinput_vert_off                                                       \
                    ?VAL_mcp_show_recinput{0}                                                                       \
                        !recarm                                                                                     \
                            par_mcp_##PARAMETER_SECTION##_element_width==0                                          \
                                [CUR_x_recinput{0} CUR_y_recinput{0} CUR_w_recinput{0} CUR_h_recinput{0} 0 0 0 0]   \
                                0                                                                                   \
                            0                                                                                       \
                        0

                set WALTER_ELEMENT##.custom.recinput_vert_on                                                        \
                    ?VAL_mcp_show_recinput{0}                                                                       \
                        ?recarm                                                                                     \
                            par_mcp_##PARAMETER_SECTION##_element_width==0                                          \
                                [CUR_x_recinput{0} CUR_y_recinput{0} CUR_w_recinput{0} CUR_h_recinput{0} 0 0 0 0]   \
                                0                                                                                   \
                            0                                                                                       \
                        0

                ; z order
                front WALTER_ELEMENT##.custom.recinput_off
                front WALTER_ELEMENT##.custom.recinput_on
                front WALTER_ELEMENT##.custom.recinput_vert_off
                front WALTER_ELEMENT##.custom.recinput_vert_on
                front WALTER_ELEMENT##.recinput

                ; increment y position
                set CUR_y                                                                       \
                    ?VAL_mcp_show_recinput{0}                                                   \
                        + CUR_y_recinput{0} +   CUR_h_recinput{0} VAL_mcp_spacing_section_y{0}  \
                        ?par_mcp_##PARAMETER_SECTION##_element_vis                              \
                            + CUR_y{0} VAL_mcp_spacing_section_y{0}

                ; update button placement y position
                set CUR_y_next_button CUR_y{0}

        endmacro


    ;   ## Draw : MCP : Master : Post Insert
    ; -----------------------------------------------------------------

        macro MAC_DrawMcp_PostInsert_Master SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; increment y position
            set CUR_y                                           \
                ?par_mcp_##PARAMETER_SECTION##_element_vis      \
                    + CUR_y{0} VAL_mcp_spacing_section_y{0}

        endmacro

    ;   ## Draw : MCP : Buttons
    ; -----------------------------------------------------------------

        ;   ### Draw : MCP : Buttons : Open
        ; -----------------------------------------------------------------

            macro MAC_DrawMcp_Buttons_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; flags
                set VAL_mcp_button_line_count 0
                set VAL_mcp_button_group_count 0
                set VAL_mcp_button_count 0
                set CUR_Linebreak 0

                ; initial position
                set CUR_x VAL_mcp_x_button_start{0}

                ; next y position
                set CUR_y_next_button CUR_y{0}

                ; center offset x position
                set VAL_mcp_button_x_center_offset                                                                      \
                    par_mcp_##PARAMETER_SECTION##_element_width==1                                                      \
                        + VAL_mcp_x_button_start{0} * 0.5 - VAL_mcp_precalc_w_buttons{0} + VAL_Button{0} VAL_Pad{0}     \
                        VAL_mcp_x_button_start{0}

                ; dimensions
                set CUR_w VAL_Button{0}
                set CUR_h VAL_Button{1}

                ; width pre-calculation
                set CUR_w_2 + VAL_mcp_spacing_x{0} * 2 VAL_Button{0}
                set CUR_h_2 + VAL_mcp_spacing_y{0} * 2 VAL_Button{1}

                ; separator dimensions
                set CUR_w_separator - VAL_mcp_precalc_w_buttons{0} * 2 VAL_Pad{0}
                set CUR_x_separator + CUR_x{0} * 0.5 - VAL_mcp_precalc_w_buttons{0} CUR_w_separator{0}

            endmacro

            ;   #### Draw : MCP : Buttons : Track
            ; -----------------------------------------------------------------

                macro MAC_DrawMcp_Buttons_Track SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; [SHARED] Open
                    MAC_DrawMcp_Buttons_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; [BUTTON] Record Input
                    MAC_DrawMcp_Recinput SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; [BUTTON] Record Mode
                    MAC_DrawMcp_Buttons_SingleButton SCALE 4 WALTER_ELEMENT PARAMETER_SECTION "recmode" 1

                    ; record mode extension icon
                    set WALTER_ELEMENT##.custom.label_recmode                                                                                                           \
                        par_mcp_##PARAMETER_SECTION##_element_width==1                                                                                                  \
                            ?VAL_mcp_show_button_recmode{0}                                                                                                             \
                                + [WALTER_ELEMENT##.recmode{x} WALTER_ELEMENT##.recmode{y} CUR_w{0} CUR_h{0} 0 0 0 0] + VAL_mcp_spacing_x@w CUR_w@w

                    front WALTER_ELEMENT##.custom.label_recmode
                    front WALTER_ELEMENT##.recmode

                    ; separator
                    MAC_DrawMcp_Buttons_Separator SCALE 4 WALTER_ELEMENT PARAMETER_SECTION

                    ; [BUTTON] Record Arm / Record Monitor
                    set CUR_Linebreak                                   \
                        par_mcp_##PARAMETER_SECTION##_element_width==0  \
                            1                                           \
                            0

                    MAC_DrawMcp_Buttons_CenterOffset SCALE WALTER_ELEMENT PARAMETER_SECTION 8 16
                    MAC_DrawMcp_Buttons_SingleButton SCALE 8 WALTER_ELEMENT PARAMETER_SECTION "recarm" CUR_Linebreak
                    MAC_DrawMcp_Buttons_SingleButton SCALE 16 WALTER_ELEMENT PARAMETER_SECTION "recmon" 1

                    ; separator
                    MAC_DrawMcp_Buttons_Separator SCALE 16 WALTER_ELEMENT PARAMETER_SECTION

                    ; [BUTTON] Input FX
                    set CUR_w VAL_Button{0}

                    MAC_DrawMcp_Buttons_SingleButton SCALE 32 WALTER_ELEMENT PARAMETER_SECTION "fxin" 1

                    ; input fx extension icon
                    set WALTER_ELEMENT##.custom.label_infx                                                                                                          \
                        par_mcp_##PARAMETER_SECTION##_element_width==1                                                                                              \
                            ?VAL_mcp_show_button_fxin{0}                                                                                                            \
                                + [WALTER_ELEMENT##.fxin{x} WALTER_ELEMENT##.fxin{y} CUR_w{0} CUR_h{0} 0 0 0 0] + VAL_mcp_spacing_x@w CUR_w@w

                    front WALTER_ELEMENT##.custom.label_infx
                    front WALTER_ELEMENT##.fxin

                    ; [BUTTON] FX
                    set CUR_H                                           \
                        par_mcp_##PARAMETER_SECTION##_element_width==0  \
                            CUR_h_2{0}                                  \
                            VAL_button{1}

                    set CUR_W                                                   \
                        par_mcp_##PARAMETER_SECTION##_element_width==0          \
                            VAL_button{0}                                       \
                            CUR_w_2{0}

                    MAC_DrawMcp_Buttons_SingleButton SCALE 64 WALTER_ELEMENT PARAMETER_SECTION "fx" 1

                    ; [BUTTON] FX Bypass
                    MAC_DrawMcp_Buttons_FxBypass SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; separator
                    MAC_DrawMcp_Buttons_Separator SCALE 64 WALTER_ELEMENT PARAMETER_SECTION

                    ; [BUTTON] Envelope
                    set CUR_H VAL_Button{1}

                    set CUR_w                                               \
                        par_mcp_##PARAMETER_SECTION##_element_width==0      \
                            VAL_button{0}                                   \
                            CUR_w_2{0}

                    MAC_DrawMcp_Buttons_SingleButton SCALE 128 WALTER_ELEMENT PARAMETER_SECTION "env" 1

                    set WALTER_ELEMENT##.custom.env_icon                                                                \
                        ?VAL_mcp_show_button_env{0}                                                                     \
                            par_mcp_##PARAMETER_SECTION##_element_width==1                                              \
                                [WALTER_ELEMENT##.env{0} WALTER_ELEMENT##.env{1} VAL_Button{0} VAL_Button{1} 0 0 0 0]   \
                                0                                                                                       \
                            0

                    front WALTER_ELEMENT##.custom.env_icon

                    MAC_DrawMcp_Buttons_Separator SCALE 128 WALTER_ELEMENT PARAMETER_SECTION

                    ; [BUTTON] IO / Phase

                    set CUR_w VAL_Button{0}

                    set CUR_Linebreak                                   \
                        par_mcp_##PARAMETER_SECTION##_element_width==0  \
                            1                                           \
                            0

                    MAC_DrawMcp_Buttons_CenterOffset SCALE WALTER_ELEMENT PARAMETER_SECTION 256 512
                    MAC_DrawMcp_Buttons_SingleButton SCALE 256 WALTER_ELEMENT PARAMETER_SECTION "io" CUR_Linebreak
                    MAC_DrawMcp_Buttons_SingleButton SCALE 512 WALTER_ELEMENT PARAMETER_SECTION "phase" 1
                    MAC_DrawMcp_Buttons_Separator SCALE 512 WALTER_ELEMENT PARAMETER_SECTION

                    ; [BUTTON] Mute / Solo
                    set CUR_W VAL_Button{0}
                    set CUR_Linebreak                                       \
                        par_mcp_##PARAMETER_SECTION##_element_width==0      \
                            1                                               \
                            0

                    MAC_DrawMcp_Buttons_CenterOffset SCALE WALTER_ELEMENT PARAMETER_SECTION 1024 2048
                    MAC_DrawMcp_Buttons_SingleButton SCALE 1024 WALTER_ELEMENT PARAMETER_SECTION "mute" CUR_Linebreak
                    MAC_DrawMcp_Buttons_SingleButton SCALE 2048 WALTER_ELEMENT PARAMETER_SECTION "solo" 1



                    ; [SHARED] Close
                    MAC_DrawMcp_Buttons_Close SCALE WALTER_ELEMENT PARAMETER_SECTION

                endmacro

            ;   #### Draw : MCP : Buttons : Master
            ; -----------------------------------------------------------------

                macro MAC_DrawMcp_Buttons_Master SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; [SHARED] Open
                    MAC_DrawMcp_Buttons_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; [BUTTON] FX
                    set CUR_H                                           \
                        par_mcp_##PARAMETER_SECTION##_element_width==0  \
                            CUR_h_2{0}                                  \
                            VAL_button{1}

                    set CUR_W                                               \
                        par_mcp_##PARAMETER_SECTION##_element_width==0      \
                            VAL_button{0}                                   \
                            CUR_w_2{0}


                    MAC_DrawMcp_Buttons_SingleButton SCALE 2 WALTER_ELEMENT PARAMETER_SECTION "fx" 1

                    ; [BUTTON] FX Bypass
                    MAC_DrawMcp_Buttons_FxBypass SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; separator
                    MAC_DrawMcp_Buttons_Separator SCALE 2 WALTER_ELEMENT PARAMETER_SECTION

                    ; [BUTTON] Envelope
                    set CUR_H VAL_Button{1}

                    set CUR_w                                               \
                        par_mcp_##PARAMETER_SECTION##_element_width==0      \
                            VAL_button{0}                                   \
                            CUR_w_2{0}

                    MAC_DrawMcp_Buttons_SingleButton SCALE 4 WALTER_ELEMENT PARAMETER_SECTION "env" 1

                    set WALTER_ELEMENT##.custom.env_icon                                                                \
                        ?VAL_mcp_show_button_env{0}                                                                     \
                            par_mcp_##PARAMETER_SECTION##_element_width==1                                              \
                                [WALTER_ELEMENT##.env{0} WALTER_ELEMENT##.env{1} VAL_Button{0} VAL_Button{1} 0 0 0 0]   \
                                0                                                                                       \
                            0

                    front WALTER_ELEMENT##.custom.env_icon

                    ; separator
                    MAC_DrawMcp_Buttons_Separator SCALE 4 WALTER_ELEMENT PARAMETER_SECTION


                    ; [BUTTON] IO / Mono

                    set CUR_w VAL_Button{0}

                    set CUR_Linebreak                                       \
                        par_mcp_##PARAMETER_SECTION##_element_width==0      \
                            1                                               \
                            0

                    MAC_DrawMcp_Buttons_CenterOffset SCALE WALTER_ELEMENT PARAMETER_SECTION 8 16
                    MAC_DrawMcp_Buttons_SingleButton SCALE 8 WALTER_ELEMENT PARAMETER_SECTION "io" CUR_Linebreak
                    MAC_DrawMcp_Buttons_SingleButton SCALE 16 WALTER_ELEMENT PARAMETER_SECTION "mono" 1

                    ; separator
                    MAC_DrawMcp_Buttons_Separator SCALE 16 WALTER_ELEMENT PARAMETER_SECTION

                    ; [BUTTON] Mute / Solo
                    set CUR_W VAL_Button{0}
                    set CUR_Linebreak                                       \
                        par_mcp_##PARAMETER_SECTION##_element_width==0      \
                            1                                               \
                            0

                    MAC_DrawMcp_Buttons_CenterOffset SCALE WALTER_ELEMENT PARAMETER_SECTION 32 64
                    MAC_DrawMcp_Buttons_SingleButton SCALE 32 WALTER_ELEMENT PARAMETER_SECTION "mute" CUR_Linebreak
                    MAC_DrawMcp_Buttons_SingleButton SCALE 64 WALTER_ELEMENT PARAMETER_SECTION "solo" 1

                    ; [SHARED] Close
                    MAC_DrawMcp_Buttons_Close SCALE WALTER_ELEMENT PARAMETER_SECTION

                endmacro


                ;   ##### Draw : MCP : Buttons : FX Bypass
                ; -----------------------------------------------------------------

                    macro MAC_DrawMcp_Buttons_FxBypass SCALE WALTER_ELEMENT PARAMETER_SECTION

                        ; dimensions
                        set CUR_w VAL_Button{0}
                        set CUR_h VAL_Button{1}

                        ; visibility
                        set VAL_fxbyp_show                          \
                            ?VAL_mcp_show_button_fx{0}              \
                                ?VAL_mcp_button_group_count{0}      \
                                    1                               \
                                    0                               \
                                0                                   \

                        ; x position
                        set VAL_fxbyp_x                                                             \
                            ?VAL_fxbyp_show{0}                                                      \
                                par_mcp_##PARAMETER_SECTION##_element_width==0                      \
                                    WALTER_ELEMENT##.fx{0}                                          \
                                    + WALTER_ELEMENT##.fx{0} + VAL_mcp_spacing_x{0} VAL_Button{0}

                        ; y position
                        set VAL_fxbyp_y                                                                 \
                            ?VAL_fxbyp_show{0}                                                          \
                                par_mcp_##PARAMETER_SECTION##_element_width==0                          \
                                        + WALTER_ELEMENT##.fx{1} + VAL_Button{1} VAL_mcp_spacing_y      \
                                        WALTER_ELEMENT##.fx{1}                                          \
                                    0


                        ; [DRAW] Fx Bypass
                        set WALTER_ELEMENT##.fxbyp                                  \
                            ?VAL_fxbyp_show{0}                                      \
                                [VAL_fxbyp_x VAL_fxbyp_y CUR_w CUR_h 0 0 0 0]

                        front WALTER_ELEMENT##.fxbyp


                    endmacro

                ;   ##### Draw : MCP : Buttons : Center Offset
                ; -----------------------------------------------------------------

                    macro MAC_DrawMcp_Buttons_CenterOffset SCALE WALTER_ELEMENT PARAMETER_SECTION INDEX_1 INDEX_2

                        set CUR_x                                                   \
                            par_mcp_##PARAMETER_SECTION##_element_vis&INDEX_1       \
                                par_mcp_##PARAMETER_SECTION##_element_vis&INDEX_2   \
                                    .                                               \
                                    VAL_mcp_button_x_center_offset{0}               \
                            par_mcp_##PARAMETER_SECTION##_element_vis&INDEX_2       \
                                par_mcp_##PARAMETER_SECTION##_element_vis&INDEX_1   \
                                    .                                               \
                                    VAL_mcp_button_x_center_offset{0}

                    endmacro


                ;   ##### Draw : MCP : Buttons : Single Button
                ; -----------------------------------------------------------------

                    macro MAC_DrawMcp_Buttons_SingleButton SCALE INDEX WALTER_ELEMENT PARAMETER_SECTION ELEMENT LINEBREAK

                        ; y target position
                        set CUR_y_hide + CUR_y_next_button{0} CUR_h{0}

                        ; hiding logic
                        set VAL_mcp_hide_rest                                       \
                            par_mcp_##PARAMETER_SECTION##_element_vis&INDEX         \
                                CUR_y_hide{0}>VAL_mcp_y_labelHide{0}                \
                                    1

                        ; visibility
                        set VAL_mcp_show_button_##ELEMENT                       \
                            ?VAL_mcp_hide_rest{0}                               \
                                0                                               \
                            par_mcp_##PARAMETER_SECTION##_element_vis&INDEX     \
                                1                                               \
                                0

                        ; update y position (including button spacing)
                        set CUR_y                                   \
                            ?VAL_mcp_show_button_##ELEMENT##{0}     \
                                CUR_y_next_button{0}

                        ; line count
                        set VAL_mcp_button_line_count               \
                            ?VAL_mcp_show_button_##ELEMENT##{0}     \
                                + VAL_mcp_button_line_count{0} 1

                        set VAL_mcp_new_line                    \
                            ?LINEBREAK{0}                       \
                                ?VAL_mcp_button_line_count{0}   \
                                    1                           \
                                    0                           \
                                0

                        ; counter
                        set VAL_mcp_button_group_count  +   VAL_mcp_button_group_count{0}   VAL_mcp_show_button_##ELEMENT##{0}
                        set VAL_mcp_button_count        +   VAL_mcp_button_count{0}         VAL_mcp_show_button_##ELEMENT##{0}

                        ; drawing
                        set WALTER_ELEMENT##.##ELEMENT              \
                            ?VAL_mcp_show_button_##ELEMENT##{0}     \
                                [CUR_x{0} CUR_y{0} CUR_w{0} CUR_h{0} 0 0 0 0]

                        front WALTER_ELEMENT##.##ELEMENT

                        ; increment x position
                        set CUR_x                                               \
                            ?VAL_mcp_show_button_##ELEMENT##{0}                 \
                                !VAL_mcp_new_line{0}                            \
                                    + CUR_x{0} + CUR_w{0} VAL_mcp_spacing_x{0}

                        ; x position reset
                        set CUR_x                           \
                            ?VAL_mcp_new_line{0}            \
                                VAL_mcp_x_button_start{0}

                        ; increment y position
                        set CUR_y                       \
                            ?VAL_mcp_new_line{0}        \
                                + CUR_y{0} CUR_h{0}

                        set CUR_y_next_button                   \
                            ?VAL_mcp_new_line{0}                \
                                + CUR_y{0} VAL_mcp_spacing_y{0}

                        ; reset line count
                        set VAL_mcp_button_line_count       \
                            ?VAL_mcp_new_line{0}            \
                                0

                        set VAL_mcp_new_line 0

                    endmacro

                ;   ##### Draw : MCP : Buttons : Separator
                ; -----------------------------------------------------------------

                    macro MAC_DrawMcp_Buttons_Separator SCALE INDEX WALTER_ELEMENT PARAMETER_SECTION

                        ; hiding logic
                        set VAL_mcp_hide_rest                                       \
                            par_mcp_##PARAMETER_SECTION##_element_vis&INDEX         \
                                CUR_y_next_button{0}>VAL_mcp_y_labelHide{0}         \
                                    1

                        ; visibility
                        set VAL_mcp_show_separator##INDEX                               \
                            ?VAL_mcp_hide_rest{0}                                       \
                                0                                                       \
                            ?VAL_mcp_button_group_count{0}                              \
                                par_mcp_##PARAMETER_SECTION##_element_separator&INDEX   \
                                    1                                                   \
                                    0                                                   \
                                0

                        ; separator marker x position
                        set CUR_y_separator                                                                                     \
                            ?par_mcp_gen_element_adj_separator_line                                                             \
                                ?VAL_mcp_show_separator##INDEX##{0}                                                             \
                                    + CUR_y{0} * 0.5 - + VAL_mcp_spacing_separator{0} VAL_mcp_spacing_y{0} VAL_Separator{0}

                        ; [DRAW] Separator Marker
                        custom WALTER_ELEMENT##.custom.separator##INDEX "" "" "" "track_custom_separator"
                        set WALTER_ELEMENT##.custom.separator##INDEX                                                        \
                            ?par_mcp_gen_element_adj_separator_line                                                         \
                                ?VAL_mcp_show_separator##INDEX##{0}                                                         \
                                    [CUR_x_separator{0} CUR_y_separator{0} CUR_w_separator{0} VAL_Separator{0} 1 0 1 0]     \
                                    0                                                                                       \
                                0

                        front WALTER_ELEMENT##.custom.separator##INDEX

                        ; increment y position
                        set CUR_y_next_button                                           \
                            ?VAL_mcp_show_separator##INDEX##{0}                         \
                                + CUR_y_next_button{0} VAL_mcp_spacing_separator{0}

                        ; reset values
                        set VAL_mcp_button_group_count 0

                    endmacro

        ;   ### Draw : MCP : Buttons : Close
        ; -----------------------------------------------------------------

            macro MAC_DrawMcp_Buttons_Close SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; x position reset
                set CUR_x VAL_mcp_x_button_start{0}

                ; y section spacer
                set CUR_y                                       \
                    ?VAL_mcp_button_count{0}                    \
                        + CUR_y{0} VAL_mcp_spacing_section_y{0}

            endmacro


    ;   ## Draw : MCP : Meter : Top
    ; -----------------------------------------------------------------

        macro MAC_DrawMcp_Meter_Top SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; visibility
            set VAL_mcp_show_meter_top                              \
                ?VAL_mcp_hide_rest{0}                               \
                    0                                               \
                par_mcp_##PARAMETER_SECTION##_meter_pos{0}==1       \
                    1                                               \
                    0

            ; width
            set CUR_w VAL_mcp_w_meter{0}

            ; x position
            set CUR_x VAL_mcp_x_meter{0}

            ; height
            set VAL_mcp_meter_top_remaining_h - h + - VAL_mcp_y_offset_max{0} VAL_mcp_y_offset{0} + CUR_y{0} - VAL_mcp_h{0} VAL_mcp_y_post_label{0}

            set CUR_h                                                                                                                                               \
                ?VAL_mcp_show_meter_top{0}                                                                                                                          \
                    ?par_mcp_##PARAMETER_SECTION##_meter_size_scale                                                                                                 \
                        + VAL_mcp_meter_min_h{0} * - VAL_mcp_meter_top_remaining_h{0} VAL_mcp_meter_min_h{0}    * 0.01  par_mcp_##PARAMETER_SECTION##_meter_size    \
                        + VAL_mcp_meter_min_h{0} * SCALE                                                        * 2     par_mcp_##PARAMETER_SECTION##_meter_size    \
                    0

            ; padding correction
            set CUR_y                           \
                ?VAL_mcp_meter_padding{0}       \
                    + CUR_y{0} VAL_Border{0}

            set CUR_h                           \
                ?VAL_mcp_meter_padding{0}       \
                    - CUR_h{0} VAL_Border_2{0}

            ; empty button section offset (force border overlap)
            set CUR_y                                                   \
                ?VAL_mcp_inserts_on_top{0}                              \
                    par_mcp_##PARAMETER_SECTION##_element_vis{0}==0     \
                        - CUR_y VAL_Border

            ; overshoot
            set VAL_mcp_meter_top_overshoot - h - VAL_mcp_h{0} - VAL_mcp_y_post_label_parallel{0} CUR_y{0}

            ; readout visibility
            set VAL_mcp_meter_top_overshoot_readout - VAL_mcp_meter_top_overshoot{0} VAL_mcp_vol_readout_h{0}

            set VAL_mcp_show_vol_readout                                    \
                ?VAL_mcp_show_meter_top{0}                                  \
                    VAL_mcp_meter_top_overshoot_readout{0}>CUR_h{0}         \
                        ?par_mcp_##PARAMETER_SECTION##_meter_vol_readout    \
                            1                                               \
                            0                                               \
                        0                                                   \
                    0

            ; overshoot height correction
            set CUR_h                                       \
                VAL_mcp_meter_top_overshoot{0}<CUR_h{0}     \
                    VAL_mcp_meter_top_overshoot{0}

            ; meter overshoot marker
            set VAL_mcp_hide_rest                                       \
                ?VAL_mcp_show_meter_top{0}                              \
                    VAL_mcp_meter_top_overshoot_readout{0}<=CUR_h{0}    \
                        1

            ; [DRAW] Meter
            set CUR_meter + [CUR_x{0} CUR_y{0} CUR_w{0} CUR_h{0}] [VAL_Border{0} VAL_Border{0} VAL_Border_Neg_2{0} VAL_Border_Neg_2{0}]

            set WALTER_ELEMENT##.custom.meter_frame                 \
                ?VAL_mcp_show_meter_top{0}                          \
                    [CUR_x{0} CUR_y{0} CUR_w{0} CUR_h{0} 0 0 1 0]   \
                    0

            set WALTER_ELEMENT##.meter                                              \
                ?VAL_mcp_show_meter_top{0}                                          \
                    [CUR_meter{0} CUR_meter{1} CUR_meter{2} CUR_meter{3} 0 0 1 0]

            ; meter text
            set WALTER_ELEMENT##.meter.scale.color.lit.top          ?par_mcp_##PARAMETER_SECTION##_meter_vu_db          VAL_meter_lit_top
            set WALTER_ELEMENT##.meter.scale.color.lit.bottom       ?par_mcp_##PARAMETER_SECTION##_meter_vu_db          VAL_meter_lit_bottom
            set WALTER_ELEMENT##.meter.scale.color.unlit.top        ?par_mcp_##PARAMETER_SECTION##_meter_vu_db          VAL_meter_unlit_top
            set WALTER_ELEMENT##.meter.scale.color.unlit.bottom     ?par_mcp_##PARAMETER_SECTION##_meter_vu_db          VAL_meter_unlit_bottom
            set WALTER_ELEMENT##.meter.readout.color                ?par_mcp_##PARAMETER_SECTION##_meter_vu_readout     VAL_meter_readout

            ; meter channel division
            set CUR_chan_div * SCALE par_mcp_##PARAMETER_SECTION##_meter_channeldiv
            set WALTER_ELEMENT##.meter.vu.div [CUR_chan_div{0} 0]

            ; increment y position
            set CUR_y                           \
                ?VAL_mcp_show_meter_top{0}      \
                    + CUR_y{0} CUR_h{0}

            ; readout width
            set VAL_mcp_vol_readout_w                                   \
                ?VAL_mcp_show_vol_readout{0}                            \
                    par_mcp_##PARAMETER_SECTION##_meter_vol_readout==1  \
                        CUR_w{0}                                        \
                        VAL_MCP_Label{0}                                \
                    0

            ; readout x
            set VAL_mcp_vol_readout_x                                           \
                ?VAL_mcp_show_vol_readout{0}                                    \
                    par_mcp_##PARAMETER_SECTION##_meter_vol_readout==1          \
                        CUR_x{0}                                                \
                        + CUR_x{0} * 0.5 - CUR_w{0} VAL_mcp_vol_readout_w{0}    \
                    0

            ; [DRAW] Volume Readout
            set WALTER_ELEMENT##.volume.label                                                                       \
                ?VAL_mcp_show_vol_readout{0}                                                                        \
                    [VAL_mcp_vol_readout_x{0} CUR_y{0} VAL_mcp_vol_readout_w{0} VAL_mcp_vol_readout_h{0} 0 0 1 0]

            ; readout bg
            set WALTER_ELEMENT##.custom.readout_bg                                  \
                ?VAL_mcp_show_vol_readout{0}                                        \
                    [CUR_x{0} CUR_y{0} CUR_w{0} VAL_mcp_vol_readout_h{0} 0 0 1 0]   \
                    0

            ; increment y position
            set CUR_y                                       \
                ?VAL_mcp_show_vol_readout{0}                \
                    + CUR_y{0} VAL_mcp_vol_readout_h{0}

            ; y section spacer
            ; --> also add a section spacer if no buttons are shown
            set CUR_y                                                   \
                ?VAL_mcp_show_meter_top{0}                              \
                    + CUR_y{0} VAL_mcp_spacing_section_y{0}             \
                    par_mcp_##PARAMETER_SECTION##_element_vis{0}==0     \
                        + CUR_y{0} VAL_mcp_spacing_section_y{0}

        endmacro

    ;   ## Draw : MCP : Faders : Top
    ; -----------------------------------------------------------------

        macro MAC_DrawMcp_Faders_Top SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; visibility - layout detection
            set VAL_mcp_show_faders_top                             \
                ?VAL_mcp_hide_rest{0}                               \
                    0                                               \
                par_mcp_##PARAMETER_SECTION##_fader_layout==0       \
                    !VAL_mcp_button_count{0}                        \
                        1                                           \
                    !VAL_mcp_hide_rest{0}                           \
                        1                                           \
                        0                                           \
                    0

            ; horizontal fader correction
            set VAL_mcp_faders_panmode                              \
                par_mcp_##PARAMETER_SECTION##_fader_layout{0}==2    \
                    1                                               \
                par_mcp_##PARAMETER_SECTION##_fader_layout{0}!=0    \
                    VAL_mcp_faders_panmode{0}==2                    \
                        1

            ; fadermodes
            set WALTER_ELEMENT##.volume.fadermode -1

            set WALTER_ELEMENT##.pan.fadermode      \
                !VAL_mcp_faders_panmode{0}          \
                    1                               \
                    -1

            set WALTER_ELEMENT##.width.fadermode WALTER_ELEMENT##.pan.fadermode

            ; show width fader
            set VAL_mcp_faders_show_width                           \
                !par_mcp_##PARAMETER_SECTION##_fader_wid_always     \
                    trackpanmode>=5                                 \
                        1                                           \
                        0                                           \
                    1

            ; visibility - layout detection
            set VAL_mcp_show_faders_top                             \
                ?VAL_mcp_hide_rest{0}                               \
                    0                                               \
                par_mcp_##PARAMETER_SECTION##_fader_layout==0       \
                    !VAL_mcp_button_count{0}                        \
                        1                                           \
                    !VAL_mcp_hide_rest{0}                           \
                        1                                           \
                        0                                           \
                    0

            ; horizontal fader correction
            set VAL_mcp_faders_panmode                              \
                par_mcp_##PARAMETER_SECTION##_fader_layout!=0       \
                    VAL_mcp_faders_panmode{0}==2                    \
                        1

            ; show width fader
            set VAL_mcp_faders_show_width                           \
                !par_mcp_##PARAMETER_SECTION##_fader_wid_always     \
                    trackpanmode>=5                                 \
                        1                                           \
                        0                                           \
                    1

            ; fader width
            set CUR_w                                               \
                VAL_mcp_faders_panmode{0}==2                        \
                    - VAL_mcp_precalc_w_faders_top VAL_Unit         \
                VAL_mcp_faders_panmode{0}==1                        \
                    VAL_Button{0}                                   \
                    VAL_Knob{0}


            ; fader height
            set CUR_h                           \
                VAL_mcp_faders_panmode{0}==2    \
                    VAL_Fader{2}                \
                VAL_mcp_faders_panmode{0}==1    \
                    VAL_Button{0}               \
                    VAL_Knob{0}

            ; remaining height
            set VAL_mcp_faders_top_remaining_h - h + - VAL_mcp_y_offset_max VAL_mcp_y_offset + CUR_y - VAL_mcp_h VAL_mcp_y_post_label

            ; section minimal height
            set CUR_h_section_min_vert      VAL_mcp_fader_min_h{0}
            set CUR_h_section_min_horz      + VAL_mcp_spacing_fader_y{0} * 2 CUR_h{2}

            set CUR_h_section_min CUR_h{0}

            set CUR_h_section_min                                   \
                ?VAL_mcp_faders_has_vert{0}                         \
                    CUR_h_section_min{0}<CUR_h_section_min_vert{0}  \
                        CUR_h_section_min_vert{0}

            set CUR_h_section_min                                   \
                ?VAL_mcp_faders_has_horz{0}                         \
                    CUR_h_section_min{0}<CUR_h_section_min_horz{0}  \
                        CUR_h_section_min_horz{0}

            ; section actual height
            set CUR_h_section                                                                                                                                       \
                ?VAL_mcp_show_faders_top{0}                                                                                                                         \
                    ?par_mcp_##PARAMETER_SECTION##_fader_pan_height_scale                                                                                           \
                        + CUR_h_section_min{0} * - VAL_mcp_faders_top_remaining_h{0} CUR_h_section_min  * 0.01  par_mcp_##PARAMETER_SECTION##_fader_pan_height      \
                        + CUR_h_section_min{0} * SCALE                                                  * 2     par_mcp_##PARAMETER_SECTION##_fader_pan_height      \
                    0

            ; hiding logic
            set CUR_y_hide + CUR_y{0} CUR_h_section{0}

            set VAL_mcp_hide_faders_top                     \
                ?VAL_mcp_show_faders_top{0}                 \
                    CUR_y_hide{0}>VAL_mcp_y_labelHide{0}    \
                        1                                   \
                        0                                   \
                    0

            set VAL_mcp_show_faders_top         \
                ?VAL_mcp_hide_faders_top{0}     \
                    0

            ; end position
            set CUR_y_faders_top_end    	                                    \
                ?VAL_mcp_show_faders_top{0}                                     \
                    + CUR_y{0} + CUR_h_section{0} VAL_mcp_spacing_section_y{0}  \
                    0

            ; initial x position
            set CUR_x                                                                                                                               \
                ?VAL_mcp_show_faders_top{0}                                                                                                         \
                    VAL_mcp_faders_panmode{0}==2                                                                                                    \
                        +       VAL_mcp_x_offset{0} * 0.5 - - VAL_mcp_w{0} VAL_mcp_trim_right{0}          CUR_w{0}                                  \
                        ?VAL_mcp_faders_show_width{0}                                                                                               \
                            +   VAL_mcp_x_offset{0} * 0.5 - - VAL_mcp_w{0} VAL_mcp_trim_right{0} + * 2    CUR_w{0}    VAL_mcp_spacing_fader_x{0}    \
                            +   VAL_mcp_x_offset{0} * 0.5 - - VAL_mcp_w{0} VAL_mcp_trim_right{0}          CUR_w{0}

            ; y position center offset
            set CUR_y_offset                                                                            \
                ?VAL_mcp_show_faders_top{0}                                                             \
                    VAL_mcp_faders_panmode{0}==1                                                        \
                        0                                                                               \
                    VAL_mcp_faders_panmode{0}==2                                                        \
                        ?VAL_mcp_faders_show_width{0}                                                   \
                            * 0.5 - CUR_h_section{0} + VAL_mcp_spacing_fader_y{0} * 2 CUR_h{2}          \
                            * 0.5 - CUR_h_section{0} CUR_h{0}                                           \
                        * 0.5 - CUR_h_section{0} CUR_h{0}                                               \
                    0

            ; initial y offset
            set CUR_y                           \
                ?VAL_mcp_show_faders_top{0}     \
                    + CUR_y{0} CUR_y_offset{0}

            ; [DRAW] pan
            set WALTER_ELEMENT##.pan                                                                    \
                ?VAL_mcp_show_faders_top{0}                                                             \
                    ?VAL_mcp_faders_panmode{0}==2                                                       \
                        [CUR_x{0} CUR_y{0} CUR_w{0}      VAL_fader{2}        0 0 0 0]                   \
                    ?VAL_mcp_faders_panmode{0}==1                                                       \
                        + [CUR_x{0} CUR_y{0} VAL_Fader{0}  CUR_h_section{0} 0 0 0 0] VAL_Fader{1}@x     \
                        [CUR_x{0} CUR_y{0} VAL_Knob{0} VAL_Knob{0} 0 0 0 0]

            set WALTER_ELEMENT##.custom.pan_frame       \
                ?VAL_mcp_show_faders_top{0}             \
                    VAL_mcp_faders_panmode{0}!=0        \
                        WALTER_ELEMENT##.pan            \
                        0                               \
                    0

            set WALTER_ELEMENT##.custom.pan_knob_frame      \
                ?VAL_mcp_show_faders_top{0}                 \
                    VAL_mcp_faders_panmode{0}==0            \
                        WALTER_ELEMENT##.pan                \
                        0                                   \
                    0

            ; increment y position
            set CUR_y                                                               \
                ?VAL_mcp_show_faders_top{0}                                         \
                    ?VAL_mcp_faders_show_width{0}                                   \
                        VAL_mcp_faders_panmode{0}==2                                \
                            + CUR_y{0} + CUR_h{0} VAL_mcp_spacing_fader_y{0}

            ; increment x position
            set CUR_x                                                           \
                ?VAL_mcp_show_faders_top{0}                                     \
                    ?VAL_mcp_faders_show_width{0}                               \
                        VAL_mcp_faders_panmode{0}!=2                            \
                            + CUR_x{0} + CUR_w{0} VAL_mcp_spacing_fader_x{0}

            ; [DRAW] width
            set WALTER_ELEMENT##.width                                                                      \
                ?VAL_mcp_show_faders_top{0}                                                                 \
                    ?VAL_mcp_faders_show_width{0}                                                           \
                        VAL_mcp_faders_panmode{0}==2                                                        \
                            [CUR_x{0} CUR_y{0} CUR_w{0}      VAL_fader{2}        0 0 0 0]                   \
                        VAL_mcp_faders_panmode{0}==1                                                        \
                            + [CUR_x{0} CUR_y{0} VAL_Fader{0}  CUR_h_section{0} 0 0 0 0] VAL_Fader{1}@x     \
                            [CUR_x{0} CUR_y{0} VAL_Knob{0} VAL_Knob{0} 0 0 0 0]

            set WALTER_ELEMENT##.custom.wid_frame       \
                ?VAL_mcp_show_faders_top{0}             \
                    ?VAL_mcp_faders_show_width{0}       \
                        VAL_mcp_faders_panmode{0}!=0    \
                            WALTER_ELEMENT##.width      \
                            0                           \
                        0                               \
                    0

            set WALTER_ELEMENT##.custom.wid_knob_frame      \
                ?VAL_mcp_show_faders_top{0}                 \
                    ?VAL_mcp_faders_show_width{0}           \
                        VAL_mcp_faders_panmode{0}==0        \
                            WALTER_ELEMENT##.width          \
                            0                               \
                        0                                   \
                    0

            ; update cursor end postion
            set CUR_y                           \
                ?VAL_mcp_show_faders_top{0}     \
                    CUR_y_faders_top_end{0}

        endmacro


    ;   ## Draw : MCP : Meter : Bottom
    ; -----------------------------------------------------------------

        macro MAC_DrawMcp_Meter_Bottom SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; y position
            set VAL_mcp_bottom_faders_y CUR_y{0}

            ; visibility
            set VAL_mcp_show_meter_bottom                       \
                ?VAL_mcp_hide_rest{0}                           \
                    0                                           \
                par_mcp_##PARAMETER_SECTION##_meter_pos!=2      \
                    0                                           \
                    !VAL_mcp_hide_rest{0}                       \
                        1                                       \
                        0

            ; height
            set VAL_mcp_meter_bottom_remaining_h - h + - VAL_mcp_y_offset_max{0} VAL_mcp_y_offset{0} + CUR_y{0} - VAL_mcp_h{0} - VAL_mcp_y_post_label{0} VAL_Pad{0}

            set CUR_h VAL_mcp_meter_bottom_remaining_h{0}

            ; readout visibility
            set VAL_mcp_show_vol_readout                                \
                ?VAL_mcp_show_meter_bottom{0}                           \
                    ?par_mcp_##PARAMETER_SECTION##_meter_vol_readout    \
                        1                                               \
                        0                                               \
                    0

            ; meter height (including optional readout)
            set CUR_h_meter - CUR_h{0} VAL_mcp_vol_readout_h{0}

            ; readout overshoot check
            set VAL_mcp_show_vol_readout                    \
                CUR_h_meter{0}<VAL_mcp_vol_readout_h{0}     \
                0

            ; revert height when missing readout
            set CUR_h_meter                     \
                !VAL_mcp_show_vol_readout{0}    \
                    CUR_h{0}

            ; width
            set CUR_w VAL_mcp_meter_bottom_w_precalc{0}

            ; x position
            set CUR_x + VAL_mcp_x_offset{0} * 0.5 - VAL_mcp_w{0} VAL_mcp_precalc_w_bottom{0}

            ; [DRAW] meter
            set CUR_meter + [CUR_x{0} CUR_y{0} CUR_w{0} CUR_h_meter{0}] [VAL_Border{0} VAL_Border{0} VAL_Border_Neg_2{0} VAL_Border_Neg_2{0}]

            set WALTER_ELEMENT##.custom.meter_frame                         \
                ?VAL_mcp_show_meter_bottom{0}                               \
                    [CUR_x{0} CUR_y{0} CUR_w{0} CUR_h_meter{0} 0 0 0 0]

            set WALTER_ELEMENT##.meter                                              \
                ?VAL_mcp_show_meter_bottom{0}                                       \
                    [CUR_meter{0} CUR_meter{1} CUR_meter{2} CUR_meter{3} 0 0 0 0]

            ; readout width
            set VAL_mcp_vol_readout_w                                   \
                ?VAL_mcp_show_vol_readout{0}                            \
                    par_mcp_##PARAMETER_SECTION##_meter_vol_readout==1  \
                        CUR_w{0}                                        \
                        VAL_MCP_Label{0}

            ; readout x
            set VAL_mcp_vol_readout_x                                           \
                ?VAL_mcp_show_vol_readout{0}                                    \
                    par_mcp_##PARAMETER_SECTION##_meter_vol_readout==1          \
                        CUR_x{0}                                                \
                        + CUR_x{0} * 0.5 - CUR_w{0} VAL_mcp_vol_readout_w{0}    \
                    0

            ; readout y
            set CUR_readout_y                   \
                ?VAL_mcp_show_vol_readout{0}    \
                    + CUR_y{0} CUR_h_meter{0}   \
                    0

            ; [DRAW] Volume Readout
            set WALTER_ELEMENT##.volume.label                                                                               \
                ?VAL_mcp_show_vol_readout{0}                                                                                \
                    [VAL_mcp_vol_readout_x{0} CUR_readout_y{0} VAL_mcp_vol_readout_w{0} VAL_mcp_vol_readout_h{0} 0 0 0 0]

            ; readout bg
            set CUR_w_readout_bg                \
                ?VAL_mcp_show_vol_readout{0}    \
                    CUR_w{0}                    \
                    0

            ; readout bg
            set WALTER_ELEMENT##.custom.readout_bg                                          \
                ?VAL_mcp_show_vol_readout{0}                                                \
                    [CUR_x{0} CUR_readout_y{0} CUR_w{0} VAL_mcp_vol_readout_h{0} 0 0 0 0]

            ; increment x position
            set CUR_x                                                   \
                ?VAL_mcp_show_meter_bottom{0}                           \
                    + CUR_x{0} + CUR_w{0} VAL_mcp_spacing_section_x{0}

            front WALTER_ELEMENT##.custom.meter_frame
            front WALTER_ELEMENT##.meter
            front WALTER_ELEMENT##.custom.readout_bg
            front WALTER_ELEMENT##.volume.label



        endmacro

    ;   ## Draw : MCP : Faders : Bottom
    ; -----------------------------------------------------------------

        macro MAC_DrawMcp_Faders_Bottom SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; visibility
            set VAL_mcp_show_faders_pan_bottom                  \
                par_mcp_##PARAMETER_SECTION##_fader_layout!=0   \
                    1                                           \
                    0

            set VAL_mcp_hide_faders_bottom      \
                ?VAL_mcp_hide_rest{0}           \
                    1                           \
                ?VAL_mcp_hide_rest{0}           \
                    1                           \
                    0

            ; ::: Layout [Pan above Volume]

            ; pan section visibility
            set VAL_mcp_show_pansection                             \
                ?VAL_mcp_show_faders_pan_bottom{0}                  \
                    par_mcp_##PARAMETER_SECTION##_fader_layout==1   \
                        1                                           \
                        0                                           \
                    0

            ; width
            set CUR_w VAL_Button{0}
            set CUR_w_fader VAL_Fader{0}

            ; x position offset
            set CUR_x_fader + CUR_x VAL_Fader{1}

            ; pan section height calculation
            set VAL_bottom_remaining_h - h - 0 + CUR_y{0} - VAL_mcp_h{0} - VAL_mcp_y_post_label{0} VAL_Pad{0}
            set CUR_h VAL_bottom_remaining_h{0}

            set CUR_h_section_min                                       \
                !VAL_mcp_faders_has_horz{0}                             \
                    !VAL_mcp_faders_has_vert{0}                         \
                        + VAL_mcp_spacing_fader_y{0} * 2 VAL_Knob{0}    \
                        VAL_mcp_fader_min_h_2{0}                        \
                    VAL_mcp_fader_min_h_2{0}

            set CUR_h_section                                                                                                   \
                ?par_mcp_##PARAMETER_SECTION##_fader_pan_height_scale                                                           \
                    + CUR_h_section_min{0} * VAL_bottom_remaining_h{0}  * 0.01  par_mcp_##PARAMETER_SECTION##_fader_pan_height  \
                    + CUR_h_section_min{0} * SCALE                      * 2     par_mcp_##PARAMETER_SECTION##_fader_pan_height

            set CUR_y_post_pan + CUR_y{0} + CUR_h_section{0} * 2 VAL_mcp_spacing_fader_y{0}

            ; individual fader height
            set CUR_h                           \
                VAL_mcp_faders_panmode{0}==0    \
                    VAL_Knob{0}                 \
                ?VAL_mcp_faders_show_width{0}   \
                    * 0.5 CUR_h_section{0}      \
                    CUR_h_section{0}

            ; pan knob y offset
            set CUR_y_offset                                        \
                VAL_mcp_faders_panmode{0}!=0                        \
                    0                                               \
                    ?VAL_mcp_faders_show_width{0}                   \
                        * 0.5 - CUR_h_section{0} * 2    CUR_h{0}    \
                        * 0.5 - CUR_h_section{0}        CUR_h{0}

            ; pan hiding logic
            set CUR_y_hide + CUR_y CUR_h_section

            set VAL_mcp_hide_faders_Pan                 \
                CUR_y_hide{0}>VAL_mcp_y_labelHide{0}    \
                    1                                   \
                    0

            set VAL_mcp_show_pansection         \
                ?VAL_mcp_hide_faders_Pan{0}     \
                    0

            ; pan knob pre y offset
            set CUR_y                               \
                ?VAL_mcp_show_pansection{0}         \
                    VAL_mcp_faders_panmode{0}==0    \
                        + CUR_y{0} CUR_y_offset{0}

            ; [DRAW] pan
            set WALTER_ELEMENT##.pan                                                    \
                ?VAL_mcp_show_pansection{0}                                             \
                    !VAL_mcp_hide_faders_bottom{0}                                      \
                        VAL_mcp_faders_panmode{0}==0                                    \
                            [CUR_x{0}       CUR_y{0} CUR_w{0}       CUR_h{0} 0 0 0 0]   \
                            [CUR_x_fader{0} CUR_y{0} CUR_w_fader{0} CUR_h{0} 0 0 0 0]

            set WALTER_ELEMENT##.custom.pan_frame           \
                ?VAL_mcp_show_pansection{0}                 \
                    !VAL_mcp_hide_faders_bottom{0}          \
                        VAL_mcp_faders_panmode{0}!=0        \
                            WALTER_ELEMENT##.pan

            set WALTER_ELEMENT##.custom.pan_knob_frame      \
                ?VAL_mcp_show_pansection{0}                 \
                    !VAL_mcp_hide_faders_bottom{0}          \
                        VAL_mcp_faders_panmode{0}==0        \
                            WALTER_ELEMENT##.pan

            ; pan knob post y offset
            set CUR_y                                                   \
                ?VAL_mcp_show_pansection{0}                             \
                    + CUR_y{0} + CUR_h{0} VAL_mcp_spacing_fader_y{0}

            ; [DRAW] width
            set WALTER_ELEMENT##.width                                                      \
                ?VAL_mcp_show_pansection{0}                                                 \
                    ?VAL_mcp_faders_show_width{0}                                           \
                        !VAL_mcp_hide_faders_bottom{0}                                      \
                            VAL_mcp_faders_panmode{0}==0                                    \
                                [CUR_x{0}       CUR_y{0} CUR_w{0}       CUR_h{0} 0 0 0 0]   \
                                [CUR_x_fader{0} CUR_y{0} CUR_w_fader{0} CUR_h{0} 0 0 0 0]

            set WALTER_ELEMENT##.custom.wid_frame               \
                ?VAL_mcp_show_pansection{0}                     \
                    ?VAL_mcp_faders_show_width{0}               \
                        !VAL_mcp_hide_faders_bottom{0}          \
                            VAL_mcp_faders_panmode{0}!=0        \
                                WALTER_ELEMENT##.width

            set WALTER_ELEMENT##.custom.wid_knob_frame          \
                ?VAL_mcp_show_pansection{0}                     \
                    ?VAL_mcp_faders_show_width{0}               \
                        !VAL_mcp_hide_faders_bottom{0}          \
                            VAL_mcp_faders_panmode{0}==0        \
                                WALTER_ELEMENT##.width

            ; width fader post y offset
            set CUR_y                           \
                ?VAL_mcp_show_pansection{0}     \
                    CUR_y_post_pan{0}

            ; ::: End [Pan above Volume]

            ; [DRAW] volume
            set CUR_h - h + - VAL_mcp_y_offset_max{0} VAL_mcp_y_offset{0} + CUR_y{0} - VAL_mcp_h{0} - VAL_mcp_y_post_label{0} VAL_Pad{0}

            set VAL_mcp_show_vol                    \
                CUR_h{0}>VAL_mcp_vol_h_min_show{0}  \
                    1                               \
                    0

            set VAL_mcp_vol_knob                    \
                CUR_h{0}>VAL_mcp_vol_h_min_knob{0}  \
                    0                               \
                    1

            set WALTER_ELEMENT##.volume.fadermode   \
                ?VAL_mcp_vol_knob{0}                \
                    1                               \
                    -1

            set CUR_y_volknob + CUR_y * 0.5 - CUR_h VAL_Knob

            set WALTER_ELEMENT##.volume                                                                     \
                !VAL_mcp_hide_faders_bottom{0}                                                              \
                    ?VAL_mcp_show_vol{0}                                                                    \
                        !VAL_mcp_vol_knob{0}                                                                \
                            [CUR_x_fader{0} CUR_y{0}            CUR_w_fader{0}  CUR_h{0}        0 0 0 0]    \
                            [CUR_x{0}       CUR_y_volknob{0}    VAL_Knob{0}     VAL_Knob{0}     0 0 0 0]

            set WALTER_ELEMENT##.custom.vol_frame       \
                !VAL_mcp_hide_faders_bottom{0}          \
                    ?VAL_mcp_show_vol{0}                \
                        !VAL_mcp_vol_knob{0}            \
                            WALTER_ELEMENT##.volume     \
                            0                           \
                        0                               \
                    0

            set WALTER_ELEMENT##.custom.vol_knob_frame                                                      \
                !VAL_mcp_hide_faders_bottom{0}                                                              \
                    ?VAL_mcp_show_vol{0}                                                                    \
                        ?VAL_mcp_vol_knob{0}                                                                \
                            [CUR_x{0}       CUR_y_volknob{0}    VAL_Knob{0}     VAL_Knob{0}     0 0 0 0]    \
                            0                                                                               \
                        0                                                                                   \
                    0

    	    ; ::: Layout [Pan next to Volume]

            ; pan section visibility
            set VAL_mcp_show_pansection                         \
                par_mcp_##PARAMETER_SECTION##_fader_layout==2   \
                    1                                           \
                    0


            ; starting y position
            set CUR_y                           \
                ?VAL_mcp_show_pansection{0}     \
                    VAL_mcp_bottom_faders_y{0}

            ; x position increment
            set CUR_x                                                   \
                ?VAL_mcp_show_pansection{0}                             \
                    + CUR_x{0} + CUR_w{0} VAL_mcp_spacing_fader_x{0}

            ; x position offset
            set CUR_x_fader + CUR_x VAL_Fader{1}

            ; fader height
            set CUR_h                                               \
                ?VAL_mcp_faders_show_width{0}                       \
                    * 0.5 - CUR_h{0} VAL_mcp_spacing_fader_y{0}

            set VAL_mcp_show_pansection                 \
                CUR_h{0}<VAL_mcp_vol_h_min_show{0}      \
                    0

            ; minimal height hiding
            set VAL_mcp_show_pansection                 \
                    CUR_h{0}<VAL_mcp_vol_h_min_show{0}  \
                        0

            ; minimal height knob mode
            set VAL_mcp_pan_knobs                       \
                    CUR_h{0}<VAL_mcp_vol_h_min_knob{0}  \
                        1                               \
                        0

            ; knob y offset
            set CUR_y_knob_offset * 0.5 - CUR_h{0} VAL_Knob{0}

            set WALTER_ELEMENT##.pan.fadermode      \
                ?VAL_mcp_show_pansection{0}         \
                    ?VAL_mcp_pan_knobs{0}           \
                        1                           \
                        -1

            set WALTER_ELEMENT##.width.fadermode    \
                ?VAL_mcp_show_pansection{0}         \
                    ?VAL_mcp_pan_knobs{0}           \
                        1                           \
                        -1

            ; [DRAW] pan
            set WALTER_ELEMENT##.pan                                                                                                    \
                ?VAL_mcp_show_pansection{0}                                                                                             \
                    !VAL_mcp_hide_faders_bottom{0}                                                                                      \
                        !VAL_mcp_pan_knobs{0}                                                                                           \
                            [   CUR_x_fader{0}  CUR_y{0} CUR_w_fader{0}     CUR_h{0}    0 0 0 0]                                        \
                            + [ CUR_x{0}        CUR_y{0} VAL_Knob{0}        VAL_Knob{0} 0 0 0 0] CUR_y_knob_offset{0}@y

            set WALTER_ELEMENT##.custom.pan_frame       \
                ?VAL_mcp_show_pansection{0}             \
                    !VAL_mcp_hide_faders_bottom{0}      \
                        !VAL_mcp_pan_knobs{0}           \
                            WALTER_ELEMENT##.pan

            set WALTER_ELEMENT##.custom.pan_knob_frame  \
                ?VAL_mcp_show_pansection{0}             \
                    !VAL_mcp_hide_faders_bottom{0}      \
                        ?VAL_mcp_pan_knobs{0}           \
                            WALTER_ELEMENT##.pan

            ; y position increment
            set CUR_y                                                   \
                ?VAL_mcp_show_pansection{0}                             \
                    + CUR_y{0} + CUR_h{0} VAL_mcp_spacing_fader_y{0}

            ; [DRAW] width
            set WALTER_ELEMENT##.width                                                                                                          \
                ?VAL_mcp_show_pansection{0}                                                                                                     \
                    ?VAL_mcp_faders_show_width{0}                                                                                               \
                        !VAL_mcp_hide_faders_bottom{0}                                                                                          \
                            !VAL_mcp_pan_knobs{0}                                                                                               \
                                [   CUR_x_fader{0}  CUR_y{0}    CUR_w_fader{0}  CUR_h{0}        0 0 0 0]                                        \
                                + [ CUR_x{0}        CUR_y{0}    VAL_Knob{0}     VAL_Knob{0}     0 0 0 0] CUR_y_knob_offset{0}@y

            set WALTER_ELEMENT##.custom.wid_frame           \
                ?VAL_mcp_show_pansection{0}                 \
                    ?VAL_mcp_faders_show_width{0}           \
                        !VAL_mcp_hide_faders_bottom{0}      \
                            !VAL_mcp_pan_knobs{0}           \
                                WALTER_ELEMENT##.width

            set WALTER_ELEMENT##.custom.wid_knob_frame      \
                ?VAL_mcp_show_pansection{0}                 \
                    ?VAL_mcp_faders_show_width{0}           \
                        !VAL_mcp_hide_faders_bottom{0}      \
                            ?VAL_mcp_pan_knobs{0}           \
                                WALTER_ELEMENT##.width

            ; ::: End [Pan next to Volume]

            ; z order
            front WALTER_ELEMENT##.volume
            front WALTER_ELEMENT##.pan
            front WALTER_ELEMENT##.width
            front WALTER_ELEMENT##.custom.vol_frame
            front WALTER_ELEMENT##.custom.pan_frame
            front WALTER_ELEMENT##.custom.wid_frame
            front WALTER_ELEMENT##.custom.vol_knob_frame
            front WALTER_ELEMENT##.custom.pan_knob_frame
            front WALTER_ELEMENT##.custom.wid_knob_frame

        endmacro

    ;   ## Draw : MCP : Size
    ; -----------------------------------------------------------------

        macro MAC_DrawMcp_Size SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; final mcp size
            set WALTER_ELEMENT##.size [VAL_mcp_w_full{0} VAL_mcp_h{0} VAL_mcp_w_full{0} VAL_mcp_y_offset_max{0}]

        endmacro

    ;   ## Draw : MCP : Folder
    ; -----------------------------------------------------------------

        macro MAC_DrawMcp_Folder SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; position setup
            set CUR_x + VAL_Pad{0} VAL_mcp_x_offset_folder{0}
            set CUR_y - VAL_mcp_h{0} VAL_mcp_y_offset{0}

            ; [DRAW] Folder Icon
            set WALTER_ELEMENT##.folder                                                         \
                ?par_mcp_gen_folder_icon_folder{0}                                              \
                    folderstate>0                                                               \
                        [CUR_x{0} CUR_y{0} VAL_Button_Folder{0} VAL_Button_Folder{0} 0 1 0 1]

            ; last track x position
            set CUR_x - VAL_mcp_w_full{0} + VAL_Button_Folder{0} VAL_mcp_x_extension_folder{0}

            ; [DRAW] Last Track in Folder Icon
            set WALTER_ELEMENT##.folder                                                         \
                ?par_mcp_gen_folder_icon_folder{0}                                              \
                    folderstate<0                                                               \
                        [CUR_x{0} CUR_y{0} VAL_Button_Folder{0} VAL_Button_Folder{0} 0 1 0 1]

            front WALTER_ELEMENT##.folder

        endmacro

    ;   ## Draw : MCP : Font
    ; -----------------------------------------------------------------

        ;   ### Draw : MCP : Font : Open
        ; -----------------------------------------------------------------

            macro MAC_DrawMcp_Font_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; inserts
                set WALTER_ELEMENT##.fxlist.font        [VAL_Font_Large VAL_insert_slot{0} 50 100 1 0 0 0]
                set WALTER_ELEMENT##.fxlist.margin      [VAL_Margin_Label{0} VAL_Margin_Label{1} VAL_Margin_Label{2} VAL_Margin_Label{3}]
                set WALTER_ELEMENT##.sendlist.font      WALTER_ELEMENT##.fxlist.font
                set WALTER_ELEMENT##.sendlist.margin    WALTER_ELEMENT##.fxlist.margin
                set WALTER_ELEMENT##.fxparm.font        WALTER_ELEMENT##.fxlist.font
                set WALTER_ELEMENT##.fxparm.margin      WALTER_ELEMENT##.fxlist.margin

                ; volume readout
                set WALTER_ELEMENT##.volume.label.font VAL_Font_Small
                set WALTER_ELEMENT##.volume.label.margin                                                        \
                    par_mcp_##PARAMETER_SECTION##_meter_vol_readout==2                                          \
                        [VAL_Margin_Label{1} VAL_Margin_Label{0} VAL_Margin_Label{3} VAL_Margin_Label{2} 0]     \
                        [VAL_Margin_Label{0} VAL_Margin_Label{1} VAL_Margin_Label{2} VAL_Margin_Label{3} 0.5]

            endmacro

        ;   ### Draw : MCP : Font : Track
        ; -----------------------------------------------------------------

            macro MAC_DrawMcp_Font_Track SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; [SHARED]
                MAC_DrawMcp_Font_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; track label
                set WALTER_ELEMENT##.label.font VAL_Font_Large
                set WALTER_ELEMENT##.label.margin                                                               \
                    !par_mcp_##PARAMETER_SECTION##_settings_label_vertical                                      \
                        [VAL_Margin_Label{0} VAL_Margin_Label{1} VAL_Margin_Label{2} VAL_Margin_Label{3} 0]     \
                        [VAL_Margin_Label{1} VAL_Margin_Label{0} VAL_Margin_Label{3} VAL_Margin_Label{2} 0]

                set WALTER_ELEMENT##.label.color    [VAL_Color_Track_Label_Text{0}  VAL_Color_Track_Label_Text{1}   VAL_Color_Track_Label_Text{2}]

                ; track index
                set WALTER_ELEMENT##.trackidx.font VAL_Font_Large
                set WALTER_ELEMENT##.trackidx.margin                                                            \
                    par_mcp_##PARAMETER_SECTION##_settings_label_index==2                                       \
                        [VAL_Margin_Label{0} VAL_Margin_Label{1} VAL_Margin_Label{2} VAL_Margin_Label{3} 0.5]   \
                    !par_mcp_##PARAMETER_SECTION##_settings_label_vertical                                      \
                        [VAL_Margin_Label{0} VAL_Margin_Label{1} VAL_Margin_Label{2} VAL_Margin_Label{3} 0]     \
                        [VAL_Margin_Label{1} VAL_Margin_Label{0} VAL_Margin_Label{3} VAL_Margin_Label{2} 0]

                set WALTER_ELEMENT##.trackidx.margin                            \
                    ?par_mcp_##PARAMETER_SECTION##_settings_label_index==2      \
                        [. . . . 0.5]

                set WALTER_ELEMENT##.trackidx.color [VAL_Color_Track_Index_MCP{0}   VAL_Color_Track_Index_MCP{1}    VAL_Color_Track_Index_MCP{2}]

                ; rec input
                set WALTER_ELEMENT##.recinput.color     \
                    ?recarm                             \
                        THEME_color_button_text_on      \
                        THEME_color_button_text_off

                set WALTER_ELEMENT##.recinput.font VAL_Font_Small
                set WALTER_ELEMENT##.recinput.margin                                                                            \
                    par_mcp_##PARAMETER_SECTION##_element_width==0                                                              \
                        [VAL_Margin_RecInput{2} VAL_Margin_RecInput{0} VAL_Margin_RecInput{3} VAL_Margin_RecInput{2} 1 0 0 0]   \
                        [VAL_Margin_RecInput{0} VAL_Margin_RecInput{1} VAL_Margin_RecInput{2} VAL_Margin_RecInput{3} 1 0 0 0]

            endmacro

        ;   ### Draw : MCP : Font : Master
        ; -----------------------------------------------------------------

            macro MAC_DrawMcp_Font_Master SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; [SHARED]
                MAC_DrawMcp_Font_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

            endmacro

; ====================================================================================================================================
;   # TCP
; ====================================================================================================================================

    ;   ## Draw : TCP : Draw
    ; -----------------------------------------------------------------

        macro MAC_DrawTcp   SCALE

            ; tcp
            clear tcp.*
            MAC_DrawTcp_Setup_Track         SCALE "tcp" "track"
            MAC_DrawTcp_Meter_Track         SCALE "tcp" "track"
            MAC_DrawTcp_Inserts             SCALE "tcp" "track"
            MAC_DrawTcp_Faders              SCALE "tcp" "track"
            MAC_DrawTcp_Buttons_Track       SCALE "tcp" "track"
            MAC_DrawTcp_Label               SCALE "tcp" "track"
            MAC_DrawTcp_EmbedFx             SCALE "tcp" "track"
            MAC_DrawTcp_Folder              SCALE "tcp" "track"
            MAC_DrawTcp_Font_Track          SCALE "tcp" "track"

            ; envcp
            clear envcp.*
            MAC_DrawEnvcp_Setup             SCALE "envcp" "envcp"
            MAC_DrawEnvcp_Fader             SCALE "envcp" "envcp"
            MAC_DrawEnvcp_Buttons           SCALE "envcp" "envcp"
            MAC_DrawEnvcp_Label             SCALE "envcp" "envcp"
            MAC_DrawEnvcp_Font              SCALE "envcp" "envcp"

            ; master
            clear master.tcp.*
            MAC_DrawTcp_Setup_Master        SCALE "master.tcp" "master"
            MAC_DrawTcp_Inserts             SCALE "master.tcp" "master"
            MAC_DrawTcp_Faders              SCALE "master.tcp" "master"
            MAC_DrawTcp_Buttons_Master      SCALE "master.tcp" "master"
            MAC_DrawTcp_Meter_Master        SCALE "master.tcp" "master"
            MAC_DrawTcp_EmbedFx             SCALE "master.tcp" "master"
            MAC_DrawTcp_Font_Master         SCALE "master.tcp" "master"


        endmacro

    ;   ## Draw : TCP : Setup
    ; -----------------------------------------------------------------

        ;   ### Draw : TCP : Setup : Open
        ; -----------------------------------------------------------------

            macro MAC_DrawTcp_Setup_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; custom elements
                custom WALTER_ELEMENT##.custom.meter_frame          "" "" "" "meter_custom_border"
                custom WALTER_ELEMENT##.custom.inserts_bg           "" "" "" "track_custom_insert_bg"
                custom WALTER_ELEMENT##.custom.inserts_bg_select    "" "" "" "track_custom_insert_bg_select"
                custom WALTER_ELEMENT##.custom.vol_frame            "" "" "" "track_custom_fader_frame"
                custom WALTER_ELEMENT##.custom.pan_frame            "" "" "" "track_custom_fader_frame"
                custom WALTER_ELEMENT##.custom.wid_frame            "" "" "" "track_custom_fader_frame"
                custom WALTER_ELEMENT##.custom.vol_knob_frame       "" "" "" "track_custom_knob_border"
                custom WALTER_ELEMENT##.custom.pan_knob_frame       "" "" "" "track_custom_knob_border"
                custom WALTER_ELEMENT##.custom.wid_knob_frame       "" "" "" "track_custom_knob_border"
                custom WALTER_ELEMENT##.custom.env_icon             "" "" "" "track_custom_env_icon"

                ; readout color
                set WALTER_ELEMENT##.volume.label.color [THEME_color_readout_font{0} THEME_color_readout_font{1} THEME_color_readout_font{2}]

                ; size
                set WALTER_ELEMENT##.size [400 200]

                ; rightmost position
                set VAL_tcp_x_rightmost WALTER_ELEMENT##.size{0}

            endmacro

            ;   #### Draw : TCP : Setup : Track
            ; -----------------------------------------------------------------

                macro MAC_DrawTcp_Setup_Track SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; custom elements
                    custom WALTER_ELEMENT##.custom.readout_bg       "" "" "" "meter_custom_readout_bg_horz"
                    custom WALTER_ELEMENT##.custom.recinput_off     "" "" "" "track_custom_recinput_r_off"
                    custom WALTER_ELEMENT##.custom.recinput_on      "" "" "" "track_custom_recinput_r_on"

                    ; label size
                    set VAL_tcp_label_size + VAL_tcp_label_min_w{0} * SCALE * 2 par_tcp_##PARAMETER_SECTION##_label_size

                    ; top position
                    set VAL_tcp_y_top 0

                    ; [SHARED] Open
                    MAC_DrawTcp_Setup_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ;folder indent
                    set VAL_tcp_FolderFeatures  \
                        !trackidx               \
                            0                   \
                        !maxfolderdepth         \
                            0                   \
                            1

                    set VAL_tcp_FolderFeatures                  \
                        !par_tcp_gen_folder_icon_collapse       \
                            !par_tcp_gen_folder_icon_mode       \
                                0

                    set VAL_tcp_x_offset_folder                     \
                        !VAL_tcp_FolderFeatures{0}                  \
                            0                                       \
                            * VAL_Button_Folder{0}                  \
                                +                                   \
                                par_tcp_gen_folder_icon_collapse    \
                                par_tcp_gen_folder_icon_mode

                    set VAL_tcp_x_offset                + VAL_tcp_x_offset_folder{0} * folderdepth  	* SCALE     par_tcp_gen_folder_indent
                    set VAL_tcp_x_offset_max_precomp    + VAL_tcp_x_offset_folder{0} * maxfolderdepth   * SCALE     par_tcp_gen_folder_indent

                    ; compact width
                    set VAL_compact_w + VAL_tcp_x_offset_max_precomp{0} * SCALE 100
                    set VAL_tcp_compact         \
                        w<VAL_compact_w{0}      \
                            1                   \
                            0

                    set VAL_tcp_x_offset                \
                        ?VAL_tcp_compact{0}             \
                            VAL_tcp_x_offset_folder{0}

                    set VAL_tcp_x_offset_max                    \
                        ?VAL_tcp_compact{0}                     \
                            VAL_tcp_x_offset_folder{0}          \
                            VAL_tcp_x_offset_max_precomp{0}

                    ; update minimal tcp width
                    set VAL_tcp_min_w * VAL_compact_w{0} 0.75
                    set WALTER_ELEMENT##.size [WALTER_ELEMENT##.size{0} WALTER_ELEMENT##.size{1} VAL_tcp_min_w{0}]

                    ; indentation background
                    MAC_Draw_Box 1 WALTER_ELEMENT "indent_bg" THEME_color_tcp_empty_space{0} THEME_color_tcp_empty_space{1} THEME_color_tcp_empty_space{2} 0 0 VAL_tcp_x_offset{0} WALTER_ELEMENT##.size{1} 0 0 0 1

                    ; background
                    set CUR_y VAL_Border_Neg{0}
                    set CUR_h + WALTER_ELEMENT##.size{1} VAL_Border{0}

                    MAC_DrawTcp_Setup_Background SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; selection highlight
                    set CUR_x VAL_tcp_x_rightmost{0}

                    set CUR_x                                               \
                        !par_tcp_gen_highlight_selection                    \
                            !par_tcp_gen_highlight_color                    \
                                - WALTER_ELEMENT##.size{0} VAL_Border{0}


                    MAC_DrawTcp_Setup_Highlight_Selection SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; color highlight
                    MAC_DrawTcp_Setup_Highlight_Color SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; [SHARED] Close
                    MAC_DrawTcp_Setup_Close SCALE WALTER_ELEMENT PARAMETER_SECTION

                endmacro

            ;   #### Draw : TCP : Setup : Master
            ; -----------------------------------------------------------------

                macro MAC_DrawTcp_Setup_Master SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; custom elements
                    custom WALTER_ELEMENT##.custom.readout_bg       "" "" "" "meter_custom_readout_bg_horz_flip"

                    ; label size
                    set VAL_tcp_label_size + VAL_tcp_label_min_w{0} * SCALE * 2 par_tcp_##PARAMETER_SECTION##_meter_size

                    ; top position
                    set VAL_tcp_y_top VAL_Border{0}

                    ; [SHARED] Open
                    MAC_DrawTcp_Setup_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; indent offset
                    set VAL_tcp_x_offset 0
                    set VAL_tcp_x_offset_max_precomp 0

                    ; compact width
                    set VAL_compact_w * SCALE 100
                    set VAL_tcp_compact         \
                        w<VAL_compact_w{0}      \
                            1                   \
                            0

                    ; background
                    set CUR_y 0
                    set CUR_h WALTER_ELEMENT##.size{1}
                    MAC_DrawTcp_Setup_Background SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; icon
                    set CUR_w VAL_Button{0}
                    set CUR_x - VAL_tcp_x_rightmost{0} CUR_w{0}

                    MAC_Draw_FramedBox 1 WALTER_ELEMENT "master_icon_bg" VAL_color_master_icon{0} VAL_color_master_icon{1} VAL_color_master_icon{2} CUR_x{0} CUR_y{0} CUR_w{0} WALTER_ELEMENT##.size{1} 1 0 1 1

                    set CUR_y_mastericon * 0.5 - h VAL_Button{1}
                    custom WALTER_ELEMENT##.custom.master_icon "" "" "" "track_custom_master"

                    set WALTER_ELEMENT##.custom.master_icon [CUR_x{0} CUR_y_mastericon CUR_w{0} VAL_Button{1} 1 0 1 0]
                    front WALTER_ELEMENT##.custom.master_icon

                    ; update rightmost position
                    set VAL_tcp_x_master_post_icon CUR_x{0}

                    set CUR_x + CUR_x{0} VAL_Border{0}

                    set CUR_x                                   \
                        !par_tcp_gen_highlight_selection        \
                            !par_tcp_gen_highlight_color        \
                                VAL_tcp_x_master_post_icon{0}

                    ; selection highlight
                    MAC_DrawTcp_Setup_Highlight_Selection SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; [SHARED] Close
                    MAC_DrawTcp_Setup_Close SCALE WALTER_ELEMENT PARAMETER_SECTION

                endmacro

                ;   ##### Draw : TCP : Setup : Background
                ; -----------------------------------------------------------------

                    macro MAC_DrawTcp_Setup_Background SCALE WALTER_ELEMENT PARAMETER_SECTION

                        ; background
                        set CUR_w - WALTER_ELEMENT##.size{0} VAL_tcp_x_offset{0}
                        MAC_Draw_Box    1 WALTER_ELEMENT "bg" Val_Color_Track_Bg{0} Val_Color_Track_Bg{1} Val_Color_Track_Bg{2}     VAL_tcp_x_offset{0} CUR_y{0} CUR_w{0} CUR_h{0} 0 0 1 1
                        MAC_Draw_Image  1 WALTER_ELEMENT "bg" "track_custom_bg_frame"                                               VAL_tcp_x_offset{0} CUR_y{0} CUR_w{0} CUR_h{0} 0 0 1 1

                    endmacro

                ;   ##### Draw : TCP : Setup : Highlights
                ; -----------------------------------------------------------------

                    ;   ###### Draw : TCP : Setup : Highlights : Selection
                    ; -----------------------------------------------------------------

                        macro MAC_DrawTcp_Setup_Highlight_Selection SCALE WALTER_ELEMENT PARAMETER_SECTION

                            ; width
                            set CUR_w                                               \
                                ?par_tcp_gen_highlight_selection                    \
                                    * SCALE + 2 par_tcp_gen_highlight_selection     \
                                    0

                            set CUR_x - CUR_x{0} CUR_w{0}

                            MAC_Draw_Box    par_tcp_gen_highlight_selection WALTER_ELEMENT "highlight_select" VAL_color_selectbar{0} VAL_color_selectbar{1} VAL_color_selectbar{2}    CUR_x{0} CUR_y{0} CUR_w{0} CUR_h{0} 1 0 1 1
                            MAC_Draw_Image  par_tcp_gen_highlight_selection WALTER_ELEMENT "highlight_select" "track_custom_selmarker_frame"                                          CUR_x{0} CUR_y{0} CUR_w{0} CUR_h{0} 1 0 1 1

                        endmacro

                    ;   ###### Draw : TCP : Setup : Highlights : Color
                    ; -----------------------------------------------------------------

                        macro MAC_DrawTcp_Setup_Highlight_Color SCALE WALTER_ELEMENT PARAMETER_SECTION

                            set CUR_w                                           \
                                ?par_tcp_gen_highlight_color                    \
                                    * SCALE + 2 par_tcp_gen_highlight_color     \
                                    0

                            set CUR_x                                           \
                                ?par_tcp_gen_highlight_selection                \
                                    - CUR_x{0} -    CUR_w{0} VAL_Border{0}      \
                                    - CUR_x{0}      CUR_w{0}

                            MAC_Draw_Box    par_tcp_gen_highlight_color WALTER_ELEMENT "highlight_color" VAL_color_colorbar{0} VAL_color_colorbar{1} VAL_color_colorbar{2}    CUR_x{0} CUR_y{0} CUR_w{0} CUR_h{0} 1 0 1 1
                            MAC_Draw_Image  par_tcp_gen_highlight_color WALTER_ELEMENT "highlight_color" "track_custom_colorbar_frame"                                        CUR_x{0} CUR_y{0} CUR_w{0} CUR_h{0} 1 0 1 1

                        endmacro


        ;   ### Draw : TCP : Setup : Close
        ; -----------------------------------------------------------------

            macro MAC_DrawTcp_Setup_Close SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; reset custom elements
                set WALTER_ELEMENT##.custom.meter_frame         0
                set WALTER_ELEMENT##.custom.vol_frame           0
                set WALTER_ELEMENT##.custom.pan_frame           0
                set WALTER_ELEMENT##.custom.wid_frame           0
                set WALTER_ELEMENT##.custom.vol_knob_frame      0
                set WALTER_ELEMENT##.custom.pan_knob_frame      0
                set WALTER_ELEMENT##.custom.wid_knob_frame      0
                set WALTER_ELEMENT##.custom.readout_bg          0
                set WALTER_ELEMENT##.custom.inserts_bg          0
                set WALTER_ELEMENT##.custom.inserts_bg_select   0

                ; update minimal tcp width
                set VAL_tcp_min_w * VAL_compact_w{0} 0.75
                set WALTER_ELEMENT##.size [WALTER_ELEMENT##.size{0} WALTER_ELEMENT##.size{1} VAL_tcp_min_w{0}]

                ; positions
                set VAL_tcp_x_rightmost         CUR_x{0}
                set VAL_tcp_x_start_button      CUR_x{0}
                set VAL_tcp_x_leftmost          + VAL_tcp_x_offset{0} VAL_Pad{0}
                set VAL_tcp_y_start_fxembed     + VAL_tcp_h{0} VAL_tcp_spacing_section_y{0}
                set VAL_tcp_x_end_inserts       CUR_x{0}

                set VAL_tcp_hide_x_buttons                              \
                    -                                                   \
                        + * SCALE 10 + WALTER_ELEMENT##.size{0} +       \
                        VAL_tcp_x_offset_max{0} VAL_tcp_label_size{0}   \
                    w

                set VAL_tcp_hide_x_faders                                   \
                    -                                                       \
                        + WALTER_ELEMENT##.size{0} VAL_tcp_x_offset_max{0}  \
                    w


                set VAL_tcp_hide_x_leftmost                                             \
                    -                                                                   \
                        + WALTER_ELEMENT##.size{0} + VAL_tcp_x_offset{0} VAL_Pad{0}     \
                    w

                ; available space
                set VAL_tcp_available_space - w + VAL_tcp_x_offset_max{0} VAL_Pad{0}


            endmacro

    ;   ## Draw : TCP : Faders
    ; -----------------------------------------------------------------

        macro MAC_DrawTcp_Faders SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; override hiding
            set VAL_tcp_hide_faders                                     \
                !VAL_tcp_h_level{0}                                     \
                    1                                                   \
                par_tcp_##PARAMETER_SECTION##_fader_placement{0}==0     \
                    ?VAL_tcp_compact{0}                                 \
                        1                                               \
                        0                                               \
                    0

            ; x position
            set CUR_x                                                   \
                par_tcp_##PARAMETER_SECTION##_fader_placement{0}==0     \
                    VAL_tcp_x_start_button{0}                           \
                    VAL_tcp_x_end_inserts{0}

            ; y position
            set CUR_y                                                                                   \
                par_tcp_##PARAMETER_SECTION##_fader_placement{0}!=0                                     \
                    + VAL_tcp_y_top{0}  +   VAL_Button{1}   + VAL_Pad{0} VAL_tcp_spacing_section_y{0}   \
                    + VAL_tcp_y_top{0}      VAL_Unit{0}

            ; height
            set CUR_h VAL_Button{1}

            ; draw
            set VAL_tcp_fadercount 0
            MAC_DrawTcp_Faders_SingleFader_##PARAMETER_SECTION SCALE WALTER_ELEMENT     "volume"    PARAMETER_SECTION     "vol"
            MAC_DrawTcp_Faders_SingleFader_##PARAMETER_SECTION SCALE WALTER_ELEMENT     "pan"       PARAMETER_SECTION     "pan"
            MAC_DrawTcp_Faders_SingleFader_##PARAMETER_SECTION SCALE WALTER_ELEMENT     "width"     PARAMETER_SECTION     "wid"

            ; store fader end y-position
            set VAL_tcp_y_start_fxembed                                         \
                ?VAL_tcp_fadercount{0}                                          \
                    par_tcp_##PARAMETER_SECTION##_fader_placement{0}==2         \
                        + CUR_Y{0}      VAL_tcp_spacing_section_y{0}            \
                    par_tcp_##PARAMETER_SECTION##_fader_placement{0}==1         \
                        + CUR_Y{0} +    VAL_tcp_spacing_section_y{0}  CUR_h

        endmacro

        ;   ### Draw : TCP : Faders : Single Fader
        ; -----------------------------------------------------------------

                ;   ##### Draw : TCP : Faders : Single Fader : Track
                ; -----------------------------------------------------------------

                    macro MAC_DrawTcp_Faders_SingleFader_Track SCALE WALTER_ELEMENT TARGET_ELEMENT PAR_SECTION PAR_NAME

                        ; visibility
                        set VAL_tcp_show_##PAR_NAME                                                 \
                            ?par_tcp_##PARAMETER_SECTION##_fader_##PAR_NAME##_vis{0}                \
                                ?par_tcp_##PARAMETER_SECTION##_fader_##PAR_NAME##_vis_mixer{0}      \
                                    !mixer_visible                                                  \
                                        1                                                           \
                                        0                                                           \
                                1                                                                   \
                                0

                        MAC_DrawTcp_Faders_SingleFader_Close SCALE WALTER_ELEMENT TARGET_ELEMENT PAR_SECTION PAR_NAME

                    endmacro

                ;   ##### Draw : TCP : Faders : Single Fader : Master
                ; -----------------------------------------------------------------

                    macro MAC_DrawTcp_Faders_SingleFader_Master SCALE WALTER_ELEMENT TARGET_ELEMENT PAR_SECTION PAR_NAME

                        ; visibility
                        set VAL_tcp_show_##PAR_NAME                                     \
                            ?par_tcp_##PARAMETER_SECTION##_fader_##PAR_NAME##_vis{0}    \
                                1                                                       \
                                0

                        MAC_DrawTcp_Faders_SingleFader_Close SCALE WALTER_ELEMENT TARGET_ELEMENT PAR_SECTION PAR_NAME

                    endmacro

            ;   #### Draw : TCP : Faders : Single Fader : Close
            ; -----------------------------------------------------------------

                macro MAC_DrawTcp_Faders_SingleFader_Close SCALE WALTER_ELEMENT TARGET_ELEMENT PAR_SECTION PAR_NAME

                    ; vertical hiding logic
                    set CUR_y_target + CUR_y{0} + CUR_h{0} VAL_Pad{0}

                    set VAL_tcp_show_##PAR_NAME##                               \
                        par_tcp_##PARAMETER_SECTION##_fader_placement{0}==0     \
                            ?VAL_tcp_hide_faders{0}                             \
                                0 .                                             \
                        h<CUR_y_target{0}                                       \
                                0 .

                    ; knob mode
                    set VAL_tcp_##PAR_NAME##_knob                                   \
                        !par_tcp_##PARAMETER_SECTION##_fader_##PAR_NAME##_size      \
                            1                                                       \
                            0

                    set WALTER_ELEMENT##.##TARGET_ELEMENT##.fadermode    \
                        ?VAL_tcp_##PAR_NAME##_knob{0}       \
                            1                               \
                            -1

                    ; size
                    set VAL_remaining_w - VAL_tcp_available_space{0} - WALTER_ELEMENT##.size{0} CUR_x{0}

                    set CUR_w                                                                                                                                               \
                        ?VAL_tcp_show_##PAR_NAME##{0}                                                                                                                       \
                            ?VAL_tcp_##PAR_NAME##_knob{0}                                                                                                                   \
                                VAL_Knob_s{0}                                                                                                                               \
                            !par_tcp_##PARAMETER_SECTION##_fader_##PAR_NAME##_size_scale                                                                                    \
                                + VAL_tcp_fader_min_w{0}    +   VAL_Button{0}                                       par_tcp_##PARAMETER_SECTION##_fader_##PAR_NAME##_size   \
                                + VAL_tcp_fader_min_w{0}    * - VAL_remaining_w{0} VAL_tcp_fader_min_w{0}   * 0.01  par_tcp_##PARAMETER_SECTION##_fader_##PAR_NAME##_size

                    ; x position
                    set CUR_x_target                                            \
                        par_tcp_##PARAMETER_SECTION##_fader_placement{0}==2     \
                            - CUR_x{0} + CUR_w{0} VAL_tcp_spacing_section_x{0}  \
                        !VAL_tcp_fadercount{0}                                  \
                            - CUR_x{0} + CUR_w{0} VAL_tcp_spacing_section_x{0}  \
                            - CUR_x{0} + CUR_w{0} VAL_tcp_spacing_x_fader{0}

                    ; hiding mechanisms
                    set VAL_tcp_hide_faders                                         \
                        ?VAL_tcp_show_##PAR_NAME##{0}                               \
                            par_tcp_##PARAMETER_SECTION##_fader_placement{0}==0     \
                                VAL_tcp_hide_x_buttons{0}>CUR_x_target{0}           \
                                    1 .                                             \
                            par_tcp_##PARAMETER_SECTION##_fader_placement{0}==1     \
                                VAL_tcp_hide_x_faders{0}>CUR_x_target{0}            \
                                    1

                    set VAL_tcp_show_##PAR_NAME     \
                        ?VAL_tcp_hide_faders{0}     \
                            0

                    set VAL_tcp_show_##PAR_NAME                                 \
                        par_tcp_##PARAMETER_SECTION##_fader_placement{0}==2     \
                            VAL_tcp_hide_x_faders{0}>CUR_x_target{0}            \
                                0

                    ; update cursor
                    set CUR_x                           \
                        ?VAL_tcp_show_##PAR_NAME##{0}   \
                            CUR_x_target{0}

                    ; [DRAW] fader
                    set WALTER_ELEMENT##.##TARGET_ELEMENT                                                                                           \
                        ?VAL_tcp_show_##PAR_NAME##{0}                                                                                               \
                            ?VAL_tcp_##PAR_NAME##_knob{0}                                                                                           \
                                [   CUR_x{0}    CUR_y{0}        CUR_w{0}    CUR_h{0}    1 0 1 0]                                                    \
                                + [ 0           VAL_Fader{3}    0           0           0 0 0 0] [CUR_x{0} CUR_y{0} CUR_w{0} VAL_Fader{2} 1 0 1 0]

                    set WALTER_ELEMENT##.custom.##PAR_NAME##_frame      \
                        ?VAL_tcp_show_##PAR_NAME##{0}                   \
                            !VAL_tcp_##PAR_NAME##_knob{0}               \
                                WALTER_ELEMENT##.##TARGET_ELEMENT

                    set WALTER_ELEMENT##.custom.##PAR_NAME##_knob_frame     \
                        ?VAL_tcp_show_##PAR_NAME##{0}                       \
                            ?VAL_tcp_##PAR_NAME##_knob{0}                   \
                                WALTER_ELEMENT##.##TARGET_ELEMENT

                    front WALTER_ELEMENT##.##TARGET_ELEMENT
                    front WALTER_ELEMENT##.custom.##PAR_NAME##_frame
                    front WALTER_ELEMENT##.custom.##PAR_NAME##_knob_frame

                    ; reset x position
                    set CUR_x                                                       \
                        ?VAL_tcp_show_##PAR_NAME##{0}                               \
                            par_tcp_##PARAMETER_SECTION##_fader_placement{0}==2     \
                                VAL_tcp_x_end_inserts{0}

                    ; increment y position
                    set CUR_y                                                           \
                        ?VAL_tcp_show_##PAR_NAME##{0}                                   \
                            par_tcp_##PARAMETER_SECTION##_fader_placement{0}==2         \
                                + CUR_y{0} + VAL_Button{1}  VAL_tcp_spacing_y_fader{0}  \

                    ; store x end position
                    set VAL_tcp_x_start_button                                          \
                        par_tcp_##PARAMETER_SECTION##_fader_placement{0}==0             \
                            ?VAL_tcp_show_##PAR_NAME##{0}                               \
                                CUR_x{0}

                    ; fader count
                    set VAL_tcp_fadercount              \
                        ?VAL_tcp_show_##PAR_NAME##{0}   \
                            + VAL_tcp_fadercount{0} 1

                endmacro

    ;   ## Draw : TCP : Meter
    ; -----------------------------------------------------------------

            ;   #### Draw : TCP : Meter : Track
            ; -----------------------------------------------------------------

                macro MAC_DrawTcp_Meter_Track SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; meter visibility
                    set VAL_tcp_show_meter                              \
                        ?par_tcp_##PARAMETER_SECTION##_meter_mode       \
                            1                                           \
                            0

                    ; y position
                    set CUR_y                                   \
                        ?VAL_tcp_show_meter{0}                  \
                            - VAL_tcp_y_top{0} VAL_Border{0}

                    ; height
                    set CUR_h + WALTER_ELEMENT##.size{1} VAL_border{0}

                    ; width
                    set VAL_tcp_meter_remaining_w - VAL_tcp_available_space{0} - WALTER_ELEMENT##.size{0} CUR_x{0}

                    set CUR_w                                                                                                                                           \
                        ?VAL_tcp_show_meter{0}                                                                                                                          \
                            !par_tcp_##PARAMETER_SECTION##_meter_size_scale                                                                                             \
                                + VAL_tcp_meter_min_w{0}    * SCALE + 2                                             * 2     par_tcp_##PARAMETER_SECTION##_meter_size    \
                                + VAL_tcp_meter_min_w{0}    * - VAL_tcp_meter_remaining_w{0} VAL_tcp_meter_min_w{0} * 0.01  par_tcp_##PARAMETER_SECTION##_meter_size    \
                            0

                    ; readout visibility
                    set VAL_tcp_show_vol_readout                            \
                        ?par_tcp_##PARAMETER_SECTION##_meter_vol_readout    \
                            1                                               \
                            0

                    ; readout width
                    set CUR_w_readout                   \
                        ?VAL_tcp_show_vol_readout{0}    \
                            VAL_tcp_vol_readout_w{0}    \
                            0

                    ; x position
                    set CUR_x - + VAL_tcp_x_start_button{0} VAL_Border{0} + CUR_w{0} CUR_w_readout{0}

                    ; overshoot correction
                    set VAL_tcp_meter_w_overshoot - VAL_tcp_hide_x_buttons{0} CUR_x{0}

                    set CUR_x                                       \
                        VAL_tcp_meter_w_overshoot{0}>0              \
                            + CUR_x{0} VAL_tcp_meter_w_overshoot{0}

                    set CUR_w                                       \
                        VAL_tcp_meter_w_overshoot{0}>0              \
                            - CUR_w{0} VAL_tcp_meter_w_overshoot{0}

                    ; hiding logic
                    set VAL_tcp_show_meter                  \
                        CUR_w{0}<=VAL_tcp_meter_min_w{0}    \
                            0

                    set VAL_tcp_show_vol_readout    \
                        !VAL_tcp_show_meter{0}      \
                            0

                    ; meter x position
                    set CUR_x_meter                             \
                        ?VAL_tcp_show_vol_readout{0}            \
                            + CUR_x{0} VAL_tcp_vol_readout_w{0} \
                            CUR_x{0}

                    ; button offset
                    set VAL_tcp_x_start_button      \
                        ?VAL_tcp_show_meter{0}      \
                            CUR_x{0}

                    ; [DRAW] Meter
                    set CUR_meter + [CUR_x_meter{0} CUR_y{0} CUR_w{0} CUR_h{0}] [VAL_Border{0} VAL_Border{0} VAL_Border_Neg_2{0} VAL_Border_Neg_2{0}]

                    set WALTER_ELEMENT##.custom.meter_frame                                                 \
                        ?VAL_tcp_show_meter{0}                                                              \
                            [CUR_x_meter{0}     CUR_y{0}        CUR_w{0}        CUR_h{0}        1 0 1 1]

                    set WALTER_ELEMENT##.meter                                                              \
                        ?VAL_tcp_show_meter{0}                                                              \
                            [CUR_meter{0}       CUR_meter{1}    CUR_meter{2}    CUR_meter{3}    1 0 1 1]

                    ; readout y position
                    set CUR_y_readout * 0.5 - h + VAL_TCP_Label{0} VAL_Pad{0}

                    ; [DRAW] Volume Readout
                    set WALTER_ELEMENT##.volume.label                                                                           \
                        ?VAL_tcp_h_level{0}                                                                                     \
                            ?VAL_tcp_show_vol_readout{0}                                                                        \
                                [CUR_X{0}       CUR_y_readout{0}    VAL_tcp_vol_readout_w{0}    VAL_TCP_Label{0}    1 0 1 0]

                    set WALTER_ELEMENT##.custom.readout_bg                                                                      \
                        ?VAL_tcp_h_level{0}                                                                                     \
                            ?VAL_tcp_show_vol_readout{0}                                                                        \
                                [CUR_X{0}       CUR_y{0}            VAL_tcp_vol_readout_w{0}    CUR_h{0}            1 0 1 1]

                    front WALTER_ELEMENT##.custom.readout_bg



                    ; insert position marker
                    set VAL_tcp_x_end_inserts       \
                        ?VAL_tcp_show_meter{0}      \
                            CUR_x{0}

                    ; [SHARED] close
                    MAC_DrawTcp_Meter_Close SCALE WALTER_ELEMENT PARAMETER_SECTION

                endmacro

            ;   #### Draw : TCP : Meter : Master
            ; -----------------------------------------------------------------

                macro MAC_DrawTcp_Meter_Master SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; preparations
                    set CUR_x   VAL_tcp_x_leftmost{0}
                    set CUR_y   + VAL_tcp_y_top{0} VAL_Unit{0}
                    set CUR_w   - VAL_tcp_x_end_buttons{0} CUR_x{0}
                    set CUR_h   VAL_Button{1}

                    ; remaining width
                    set CUR_w_remaining - VAL_tcp_available_space{0} - WALTER_ELEMENT##.size{0} -  VAL_tcp_x_end_buttons{0} VAL_tcp_vol_readout_w{0}

                    ; readout visibility
                    set VAL_tcp_show_vol_readout                                \
                        ?par_tcp_##PARAMETER_SECTION##_meter_vol_readout{0}     \
                            CUR_w_remaining{0}>VAL_tcp_vol_readout_w{0}         \
                                1                                               \
                                0                                               \
                            0

                    ; meter width
                    set CUR_w_meter                                 \
                        !VAL_tcp_show_vol_readout{0}                \
                            CUR_w{0}                                \
                            - CUR_w{0} VAL_tcp_vol_readout_w{0}

                    set CUR_meter + [CUR_x{0} CUR_y{0} CUR_w_meter{0} CUR_h{0}] [VAL_Border{0} VAL_Border{0} VAL_Border_Neg_2{0} VAL_Border_Neg_2{0}]

                    ; [DRAW] Meter
                    set WALTER_ELEMENT##.custom.meter_frame [CUR_x{0} CUR_y{0} CUR_w_meter{0} CUR_h{0} 0 0 1 0]
                    set WALTER_ELEMENT##.meter [CUR_meter{0} CUR_meter{1} CUR_meter{2} CUR_meter{3} 0 0 1 0]

                    ; readout x position
                    set CUR_x_readout                                               \
                        ?VAL_tcp_show_vol_readout{0}                                \
                            - VAL_tcp_x_end_buttons{0} VAL_tcp_vol_readout_w{0}

                    ; [DRAW] Volume Readout
                    set WALTER_ELEMENT##.volume.label                                                       \
                        ?VAL_tcp_show_vol_readout{0}                                                        \
                            [       CUR_x_readout{0} CUR_y{0} VAL_tcp_vol_readout_w{0} CUR_h{0} 1 0 1 0]


                    set WALTER_ELEMENT##.custom.readout_bg                                                  \
                        ?VAL_tcp_h_level{0}                                                                 \
                            ?VAL_tcp_show_vol_readout{0}                                                    \
                                [   CUR_x_readout{0} CUR_y{0} VAL_tcp_vol_readout_w{0} CUR_h{0} 1 0 1 0]

                    front WALTER_ELEMENT##.custom.readout_bg

                    ; [SHARED] close
                    MAC_DrawTcp_Meter_Close SCALE WALTER_ELEMENT PARAMETER_SECTION


                endmacro

        ;   ### Draw : TCP : Meter : Close
        ; -----------------------------------------------------------------

            macro MAC_DrawTcp_Meter_Close SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; meter text
                set WALTER_ELEMENT##.meter.scale.color.lit.top          ?VAL_tcp_h_level{0} ?par_tcp_##PARAMETER_SECTION##_meter_vu_db VAL_meter_lit_top
                set WALTER_ELEMENT##.meter.scale.color.lit.bottom       ?VAL_tcp_h_level{0} ?par_tcp_##PARAMETER_SECTION##_meter_vu_db VAL_meter_lit_bottom
                set WALTER_ELEMENT##.meter.scale.color.unlit.top        ?VAL_tcp_h_level{0} ?par_tcp_##PARAMETER_SECTION##_meter_vu_db VAL_meter_unlit_top
                set WALTER_ELEMENT##.meter.scale.color.unlit.bottom     ?VAL_tcp_h_level{0} ?par_tcp_##PARAMETER_SECTION##_meter_vu_db VAL_meter_unlit_bottom
                set WALTER_ELEMENT##.meter.readout.color                ?VAL_tcp_h_level{0} ?par_tcp_##PARAMETER_SECTION##_meter_vu_readout VAL_meter_readout

                ; meter channel division
                set CUR_chan_div * SCALE par_tcp_##PARAMETER_SECTION##_meter_channeldiv
                set WALTER_ELEMENT##.meter.vu.div [CUR_chan_div{0} 0]

                ; z order
                front WALTER_ELEMENT##.custom.meter_frame
                front WALTER_ELEMENT##.meter
                front WALTER_ELEMENT##.volume.label

            endmacro


    ;   ## Draw : TCP : Inserts
    ; -----------------------------------------------------------------

        macro MAC_DrawTcp_Inserts SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; visibility detection
            set VAL_tcp_show_inserts                                \
                ?VAL_tcp_compact{0}                                 \
                    0                                               \
                !VAL_tcp_h_level{0}                                 \
                    0                                               \
                par_tcp_##PARAMETER_SECTION##_insert_mode{0}==0     \
                    0                                               \
                    1

            ; y position
            set CUR_y                                                                   \
                par_tcp_##PARAMETER_SECTION##_insert_mode{0}==1                         \
                    - VAL_tcp_y_top{0}      VAL_Border{0}                               \
                    + VAL_tcp_y_top{0} +    VAL_Button{1} VAL_tcp_spacing_section_y{0}

            ; height
            set CUR_h - WALTER_ELEMENT##.size{1} CUR_y{0}

            ; width
            set VAL_remaining_w - VAL_tcp_available_space{0} + VAL_tcp_spacing_section_x{0} - WALTER_ELEMENT##.size{0} CUR_x{0}
            set CUR_w                                                                                                                                   \
                !par_tcp_##PARAMETER_SECTION##_insert_size_scale                                                                                        \
                    + VAL_tcp_insert_min_w{0} * SCALE + 10                                      * 4     par_tcp_##PARAMETER_SECTION##_insert_size       \
                    + VAL_tcp_insert_min_w{0} * - VAL_remaining_w{0} VAL_tcp_insert_min_w{0}    * 0.01  par_tcp_##PARAMETER_SECTION##_insert_size       \

            ; x position
            set CUR_x                                                       \
                ?VAL_tcp_show_inserts{0}                                    \
                    - VAL_tcp_x_start_button{0} - CUR_w{0} VAL_Border{0}

            ; overshoot correction
            set VAL_tcp_inserts_w_overshoot - VAL_tcp_hide_x_buttons{0} CUR_x{0}

            set CUR_x                                           \
                VAL_tcp_inserts_w_overshoot{0}>0                \
                    + CUR_x{0} VAL_tcp_inserts_w_overshoot{0}

            set CUR_w                                           \
                VAL_tcp_inserts_w_overshoot{0}>0                \
                    - CUR_w{0} VAL_tcp_inserts_w_overshoot{0}

            ; [DRAW] inserts
            set WALTER_ELEMENT##.fxparm                             \
                ?VAL_tcp_show_inserts{0}                            \
                    [CUR_x{0} CUR_y{0} CUR_w{0} CUR_h{0} 1 0 1 1]

            ; [DRAW] inserts bg - track unselected
            set WALTER_ELEMENT##.custom.inserts_bg                      \
                ?VAL_tcp_show_inserts{0}                                \
                    !track_selected                                     \
                        [CUR_x{0} CUR_y{0} CUR_w{0} CUR_h{0} 1 0 1 1]

            ; [DRAW] inserts bg - track selected
            set WALTER_ELEMENT##.custom.inserts_bg_select               \
                ?VAL_tcp_show_inserts{0}                                \
                    ?track_selected                                     \
                        [CUR_x{0} CUR_y{0} CUR_w{0} CUR_h{0} 1 0 1 1]

            ; z order
            front WALTER_ELEMENT##.custom.inserts_bg
            front WALTER_ELEMENT##.custom.inserts_bg_select
            front WALTER_ELEMENT##.fxparm

            ; inline button offset
            set VAL_tcp_x_start_button                          \
                par_tcp_##PARAMETER_SECTION##_insert_mode==1    \
                    ?VAL_tcp_show_inserts{0}                    \
                        CUR_x{0}

            ; store x position
            set VAL_tcp_x_end_inserts       \
                ?VAL_tcp_show_inserts{0}    \
                    CUR_x{0}

        endmacro

    ;   ## Draw : TCP : Buttons
    ; -----------------------------------------------------------------

        ;   ### Draw : TCP : Buttons : Open
        ; -----------------------------------------------------------------

            macro MAC_DrawTcp_Buttons_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; preparation
                set CUR_x                   - VAL_tcp_x_start_button{0} VAL_tcp_spacing_section_x{0}
                set CUR_y                   + VAL_tcp_y_top{0} VAL_Unit{0}
                set VAL_tcp_x_end_buttons   CUR_x{0}
                set CUR_w                   VAL_Button{0}
                set CUR_h                   VAL_Button{1}

                set VAL_tcp_button_count 0

                ; separator height
                set CUR_h_separator - VAL_Button{1} * 4 VAL_Unit{0}

                ; separator y position
                set CUR_y_separator + CUR_y{0} * 0.5 - VAL_Button{1} CUR_h_separator{0}

                ; compact hiding
                set VAL_tcp_hide_buttons         	                        \
                    ?VAL_tcp_compact{0}        	                            \
                        1                   	                            \
                    !VAL_tcp_h_level{0}        	                            \
                        1                   	                            \
                        !par_tcp_##PARAMETER_SECTION##_fader_placement      \
                            VAL_tcp_hide_faders{0}                          \
                            0

            endmacro


            ;   #### Draw : TCP : Buttons : Track
            ; -----------------------------------------------------------------

                macro MAC_DrawTcp_Buttons_Track SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; [SHARED] Open
                    MAC_DrawTcp_Buttons_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; [BUTTON] Envelope
                    set VAL_tcp_button_group_count 0

                    set CUR_w       ?par_tcp_##PARAMETER_SECTION##_element_adj_size_env{0}         VAL_Button_2{0}
                    MAC_DrawTcp_Buttons_SingleButton_Track SCALE 2 WALTER_ELEMENT PARAMETER_SECTION "env"
                    set CUR_w       ?par_tcp_##PARAMETER_SECTION##_element_adj_size_env{0}         VAL_Button{0}

                    set WALTER_ELEMENT##.custom.env_icon                                                                \
                        ?VAL_tcp_show_button_env{0}                                                                     \
                            ?par_tcp_##PARAMETER_SECTION##_element_adj_size_env{0}                                      \
                                [WALTER_ELEMENT##.env{0} WALTER_ELEMENT##.env{1} VAL_Button{0} VAL_Button{1} 1 0 1 0]   \
                                0                                                                                       \
                            0

                    front WALTER_ELEMENT##.custom.env_icon

                    ; separator
                    MAC_DrawTcp_Buttons_Separator SCALE 2 WALTER_ELEMENT PARAMETER_SECTION


                    ; [BUTTON] Record Arm / Record Monitor
                    set VAL_tcp_button_group_count 0

                    MAC_DrawTcp_Buttons_SingleButton_Track SCALE 4 WALTER_ELEMENT PARAMETER_SECTION "recarm"
                    MAC_DrawTcp_Buttons_SingleButton_Track SCALE 8 WALTER_ELEMENT PARAMETER_SECTION "recmon"

                    ; separator
                    MAC_DrawTcp_Buttons_Separator SCALE 8 WALTER_ELEMENT PARAMETER_SECTION


                    ; [BUTTON] Mute / Solo
                    set VAL_tcp_button_group_count 0

                    MAC_DrawTcp_Buttons_SingleButton_Track SCALE 16 WALTER_ELEMENT PARAMETER_SECTION "mute"
                    MAC_DrawTcp_Buttons_SingleButton_Track SCALE 32 WALTER_ELEMENT PARAMETER_SECTION "solo"

                    ; separator
                    MAC_DrawTcp_Buttons_Separator SCALE 32 WALTER_ELEMENT PARAMETER_SECTION

                    ; [BUTTON] IO / Phase
                    set VAL_tcp_button_group_count 0

                    MAC_DrawTcp_Buttons_SingleButton_Track SCALE 64 WALTER_ELEMENT PARAMETER_SECTION "io"
                    MAC_DrawTcp_Buttons_SingleButton_Track SCALE 128 WALTER_ELEMENT PARAMETER_SECTION "phase"

                    ; separator
                    MAC_DrawTcp_Buttons_Separator SCALE 128 WALTER_ELEMENT PARAMETER_SECTION

                    ; [BUTTON] FX
                    set VAL_tcp_button_group_count 0
                    set CUR_w       VAL_Button_2{0}
                    MAC_DrawTcp_Buttons_SingleButton_Track SCALE 256 WALTER_ELEMENT PARAMETER_SECTION "fx"
                    set CUR_w       VAL_Button{0}

                    ; [BUTTON] FX Bypass
                    set VAL_fxbyp_x                                                             \
                        ?VAL_tcp_button_group_count{0}                                          \
                            - + WALTER_ELEMENT##.fx{0} WALTER_ELEMENT##.fx{2} VAL_Button{0}     \
                            0

                    set WALTER_ELEMENT##.fxbyp                                  \
                        ?VAL_tcp_show_button_fx{0}                              \
                            [VAL_fxbyp_x{0} CUR_y{0} CUR_w{0} CUR_h{0} 1 0 1 0]

                    front WALTER_ELEMENT##.fxbyp

                    ; [BUTTON] FX Input
                    MAC_DrawTcp_Buttons_SingleButton_Track SCALE 512 WALTER_ELEMENT PARAMETER_SECTION "fxin"

                    ; separator
                    MAC_DrawTcp_Buttons_Separator SCALE 512 WALTER_ELEMENT PARAMETER_SECTION

                    ; [BUTTON] Record Mode
                    set CUR_w       VAL_Button{0}

                    set WALTER_ELEMENT##.recinput.color     \
                        ?recarm                             \
                            THEME_color_button_text_on      \
                            THEME_color_button_text_off

                    MAC_DrawTcp_Buttons_SingleButton_Track SCALE 1024 WALTER_ELEMENT PARAMETER_SECTION "recmode"

                    ; [BUTTON] Record Input
                    set VAL_tcp_button_group_count 0

                    set CUR_w + CUR_w{0} * SCALE + 20 * 2 par_tcp_##PARAMETER_SECTION##_element_adj_size_input
                    MAC_DrawTcp_Buttons_SingleButton_Track SCALE 2048 WALTER_ELEMENT PARAMETER_SECTION "recinput"

                    set CUR_w_recin_bg                      \
                        ?VAL_tcp_show_button_recinput{0}    \
                            CUR_w{0}                        \
                            0

                    set WALTER_ELEMENT##.custom.recinput_off                \
                        ?VAL_tcp_show_button_recinput{0}                    \
                            !recarm                                         \
                                [CUR_x CUR_y CUR_w_recin_bg CUR_h 1 0 1 0]  \
                                0                                           \
                            0

                    set WALTER_ELEMENT##.custom.recinput_on                 \
                        ?VAL_tcp_show_button_recinput{0}                    \
                            ?recarm                                         \
                                [CUR_x CUR_y CUR_w_recin_bg CUR_h 1 0 1 0]  \
                                0                                           \
                            0

                    front WALTER_ELEMENT##.custom.recinput_off
                    front WALTER_ELEMENT##.custom.recinput_on
                    front WALTER_ELEMENT##.recinput



                endmacro

            ;   #### Draw : TCP : Buttons : Master
            ; -----------------------------------------------------------------

                macro MAC_DrawTcp_Buttons_Master SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; [SHARED] Open
                    MAC_DrawTcp_Buttons_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; [BUTTON] Envelope
                    set VAL_tcp_button_group_count 0

                    set CUR_w       ?par_tcp_##PARAMETER_SECTION##_element_adj_size_env         VAL_Button_2{0}
                    MAC_DrawTcp_Buttons_SingleButton_Master SCALE 2 WALTER_ELEMENT PARAMETER_SECTION "env"
                    set CUR_w       ?par_tcp_##PARAMETER_SECTION##_element_adj_size_env         VAL_Button{0}

                    set WALTER_ELEMENT##.custom.env_icon                                                                \
                        ?VAL_tcp_show_button_env{0}                                                                     \
                            ?par_tcp_##PARAMETER_SECTION##_element_adj_size_env{0}                                      \
                                [WALTER_ELEMENT##.env{0} WALTER_ELEMENT##.env{1} VAL_Button{0} VAL_Button{1} 1 0 1 0]   \
                                0                                                                                       \
                            0

                    front WALTER_ELEMENT##.custom.env_icon

                    ; separator
                    MAC_DrawTcp_Buttons_Separator SCALE 2 WALTER_ELEMENT PARAMETER_SECTION

                    ; [BUTTON] Mute / Solo
                    set VAL_tcp_button_group_count 0

                    MAC_DrawTcp_Buttons_SingleButton_Master SCALE 4 WALTER_ELEMENT PARAMETER_SECTION "mute"
                    MAC_DrawTcp_Buttons_SingleButton_Master SCALE 8 WALTER_ELEMENT PARAMETER_SECTION "solo"

                    ; separator
                    MAC_DrawTcp_Buttons_Separator SCALE 8 WALTER_ELEMENT PARAMETER_SECTION

                    ; [BUTTON] IO / Mono
                    set VAL_tcp_button_group_count 0

                    MAC_DrawTcp_Buttons_SingleButton_master SCALE 16 WALTER_ELEMENT PARAMETER_SECTION "io"
                    MAC_DrawTcp_Buttons_SingleButton_master SCALE 32 WALTER_ELEMENT PARAMETER_SECTION "mono"

                    ; separator
                    MAC_DrawTcp_Buttons_Separator SCALE 32 WALTER_ELEMENT PARAMETER_SECTION

                    ; [BUTTON] FX
                    set VAL_tcp_button_group_count 0
                    set CUR_w       VAL_Button_2{0}
                    MAC_DrawTcp_Buttons_SingleButton_Master SCALE 64 WALTER_ELEMENT PARAMETER_SECTION "fx"
                    set CUR_w       VAL_Button{0}

                    ; [BUTTON] FX Bypass
                    set VAL_fxbyp_x                                                             \
                        ?VAL_tcp_button_group_count{0}                                          \
                            - + WALTER_ELEMENT##.fx{0} WALTER_ELEMENT##.fx{2} VAL_Button{0}

                    set WALTER_ELEMENT##.fxbyp                                      \
                        ?VAL_tcp_show_button_fx{0}                                  \
                            [VAL_fxbyp_x{0} CUR_y{0} CUR_w{0} CUR_h{0} 1 0 1 0]

                    front WALTER_ELEMENT##.fxbyp

                endmacro

                ;   ##### Draw : TCP : Buttons : SingleButton
                ; -----------------------------------------------------------------

                    ;   ####### Draw : TCP : Buttons : SingleButton : Track
                    ; -----------------------------------------------------------------

                        macro MAC_DrawTcp_Buttons_SingleButton_Track SCALE INDEX WALTER_ELEMENT PARAMETER_SECTION ELEMENT

                            ; visibility
                            set VAL_tcp_show_button_##ELEMENT                                   \
                                ?VAL_tcp_hide_buttons{0}                                        \
                                    0                                                           \
                                ?par_tcp_##PARAMETER_SECTION##_element_vis&INDEX##              \
                                    ?par_tcp_##PARAMETER_SECTION##_element_vis_mixer&INDEX##    \
                                        !mixer_visible                                          \
                                            1                                                   \
                                            0                                                   \
                                        1                                                       \
                                        0

                            ; [SHARED] close
                            MAC_DrawTcp_Buttons_SingleButton_Close SCALE INDEX WALTER_ELEMENT PARAMETER_SECTION ELEMENT

                        endmacro

                    ;   ####### Draw : TCP : Buttons : SingleButton : Master
                    ; -----------------------------------------------------------------

                        macro MAC_DrawTcp_Buttons_SingleButton_Master SCALE INDEX WALTER_ELEMENT PARAMETER_SECTION ELEMENT

                            ; visibility
                            set VAL_tcp_show_button_##ELEMENT                                   \
                                ?VAL_tcp_hide_buttons{0}                                        \
                                    0                                                           \
                                ?par_tcp_##PARAMETER_SECTION##_element_vis&INDEX##              \
                                    1                                                           \
                                    0

                            ; [SHARED] close
                            MAC_DrawTcp_Buttons_SingleButton_Close SCALE INDEX WALTER_ELEMENT PARAMETER_SECTION ELEMENT

                        endmacro

                    ;   ####### Draw : TCP : Buttons : SingleButton : Envcp
                    ; -----------------------------------------------------------------

                        macro MAC_DrawTcp_Buttons_SingleButton_Envcp SCALE INDEX WALTER_ELEMENT PARAMETER_SECTION ELEMENT FX_EXCLUSIVE

                            ; visibility
                            set VAL_envcp_show_button_##ELEMENT                         \
                                ?VAL_tcp_hide_buttons{0}                                \
                                    0                                                   \
                                ?par_tcp_##PARAMETER_SECTION##_element_vis&INDEX##      \
                                    1                                                   \
                                    0

                            ; x position
                            set CUR_x_target                                            \
                                !VAL_tcp_button_count{0}                                \
                                    - CUR_x{0}      	CUR_w{0}                        \
                                    - CUR_x{0} +        CUR_w{0} VAL_tcp_spacing_x{0}

                            ; overshoot hiding
                            set VAL_tcp_hide_buttons                        \
                                VAL_tcp_hide_x_buttons{0}>CUR_x_target{0}   \
                                    1

                            set VAL_envcp_show_button_##ELEMENT##{0}    \
                                ?VAL_tcp_hide_buttons{0}                \
                                    0

                            ; update cursor
                            set CUR_x                                   \
                                ?VAL_envcp_show_button_##ELEMENT##{0}   \
                                    CUR_x_target{0}                     \
                                ?FX_EXCLUSIVE{0}                        \
                                    !VAL_tcp_hide_buttons{0}            \
                                        CUR_x_target{0}

                            ; draw
                            set WALTER_ELEMENT##.##ELEMENT                          \
                                ?VAL_envcp_show_button_##ELEMENT##{0}               \
                                    [CUR_x{0} CUR_y{0} CUR_w{0} CUR_h{0} 1 0 1 0]

                            front WALTER_ELEMENT##.##ELEMENT

                            ; counter
                            set VAL_tcp_button_group_count  +   VAL_tcp_button_group_count{0}  VAL_envcp_show_button_##ELEMENT##{0}
                            set VAL_tcp_button_count        +   VAL_tcp_button_count{0}        VAL_envcp_show_button_##ELEMENT##{0}

                            ; store x position
                            set VAL_tcp_x_end_buttons                       \
                                ?VAL_envcp_show_button_##ELEMENT##{0}       \
                                    - CUR_x{0} VAL_tcp_spacing_section_x{0}

                        endmacro

                    ;   ####### Draw : TCP : Buttons : Separator
                    ; -----------------------------------------------------------------

                        macro MAC_DrawTcp_Buttons_Separator SCALE INDEX WALTER_ELEMENT PARAMETER_SECTION

                            ; x position
                            set CUR_x_target - CUR_x{0} VAL_tcp_spacing_separator{0}

                            ; overshoot hiding
                            set VAL_tcp_hide_buttons                        \
                                VAL_tcp_hide_x_buttons{0}>CUR_x_target{0}   \
                                    1

                            ; visibility
                            set VAL_tcp_show_separator##INDEX                                       \
                                ?VAL_tcp_hide_buttons{0}                                            \
                                    0                                                               \
                                ?VAL_tcp_button_group_count{0}                                      \
                                    ?par_tcp_##PARAMETER_SECTION##_element_separator&INDEX##{0}     \
                                        1                                                           \
                                        0                                                           \
                                    0

                            ; separator marker x position
                            set CUR_x_separator                                                                                             \
                                ?par_tcp_gen_element_adj_separator_line                                                                     \
                                    ?VAL_tcp_show_separator##INDEX##{0}                                                                     \
                                        + CUR_x_target{0} * 0.5 - VAL_tcp_spacing_separator{0} + VAL_tcp_spacing_x{0} VAL_Separator{0}      \
                                        0                                                                                                   \
                                    0

                            ;par_tcp_gen_element_adj_separator_lin

                            ; [DRAW] Separator Marker
                            custom WALTER_ELEMENT##.custom.separator##INDEX "" "" "" "track_custom_separator"
                            set WALTER_ELEMENT##.custom.separator##INDEX##                                                      \
                                ?par_tcp_gen_element_adj_separator_line                                                         \
                                    ?VAL_tcp_show_separator##INDEX##{0}                                                         \
                                        [CUR_x_separator{0} CUR_y_separator{0} VAL_Separator{0} CUR_h_separator{0} 1 0 1 0]     \
                                        0                                                                                       \
                                    0

                            front WALTER_ELEMENT##.custom.separator##INDEX

                            ; update cursor
                            set CUR_x                                   \
                                ?VAL_tcp_show_separator##INDEX##{0}     \
                                    CUR_x_target{0}

                        endmacro

                ;   ###### Draw : TCP : Buttons : SingleButton : Close
                ; -----------------------------------------------------------------

                    macro MAC_DrawTcp_Buttons_SingleButton_Close SCALE INDEX WALTER_ELEMENT PARAMETER_SECTION ELEMENT

                        ; x position
                        set CUR_x_target                                        \
                            ?VAL_tcp_button_count{0}                            \
                                - CUR_x{0} + CUR_w{0} VAL_tcp_spacing_x{0}      \
                                - CUR_x{0} CUR_w{0}

                        ; hiding logic
                        set VAL_tcp_hide_buttons                        \
                            VAL_tcp_hide_x_buttons{0}>CUR_x_target{0}   \
                                1

                        set VAL_tcp_show_button_##ELEMENT       \
                            ?VAL_tcp_hide_buttons{0}            \
                                0

                        ; update cursor
                        set CUR_x                                   \
                            ?VAL_tcp_show_button_##ELEMENT##{0}     \
                                CUR_x_target{0}

                        ; draw
                        set WALTER_ELEMENT##.##ELEMENT                          \
                            ?VAL_tcp_show_button_##ELEMENT##{0}                 \
                                [CUR_x{0} CUR_y{0} CUR_w{0} CUR_h{0} 1 0 1 0]

                        front WALTER_ELEMENT##.##ELEMENT

                        ; counter
                        set VAL_tcp_button_group_count  +   VAL_tcp_button_group_count{0}  VAL_tcp_show_button_##ELEMENT##{0}
                        set VAL_tcp_button_count        +   VAL_tcp_button_count{0}        VAL_tcp_show_button_##ELEMENT##{0}

                        ; store x position
                        set VAL_tcp_x_end_buttons                       \
                            ?VAL_tcp_show_button_##ELEMENT##{0}         \
                                - CUR_x{0} VAL_tcp_spacing_section_x{0}

                    endmacro

    ;   ## Draw : TCP : Label
    ; -----------------------------------------------------------------

        macro MAC_DrawTcp_Label SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; preparations
            set CUR_x VAL_tcp_x_leftmost{0}
            set CUR_y VAL_Unit{0}
            set CUR_w - VAL_tcp_x_end_buttons{0} CUR_x{0}
            set CUR_h VAL_Button{1}

            ; index width
            set CUR_w_idx                               \
                * SCALE + 8 * 8 VAL_index_letters{0}

            ; label x
            set CUR_x_label                                         \
                par_tcp_##PARAMETER_SECTION##_label_index_vis==1    \
                    + CUR_x{0} CUR_w_idx{0}                         \
                    CUR_x{0}

            ; label width index compensation
            set CUR_w                                               \
                par_tcp_##PARAMETER_SECTION##_label_index_vis==1    \
                    - CUR_w{0} CUR_w_idx{0}

            ; label font x
            set CUR_x_innerLabel                                    \
                par_tcp_##PARAMETER_SECTION##_label_index_vis!=0    \
                    + CUR_x{0} CUR_w_idx{0}                         \
                    CUR_x{0}

            ; label font width
            set CUR_w_innerLabel                                    \
                par_tcp_##PARAMETER_SECTION##_label_index_vis==2    \
                    - CUR_w{0} CUR_w_idx{0}                         \
                    CUR_w{0}

            ; draw
            MAC_Draw_Box    1 WALTER_ELEMENT "label" VAL_Color_Track_Label_Bg{0} VAL_Color_Track_Label_Bg{1} VAL_Color_Track_Label_Bg{2}    CUR_x_label{0} CUR_y{0} CUR_w{0} CUR_h{0} 0 0 1 0
            MAC_Draw_Image  1 WALTER_ELEMENT "label" "track_custom_bg_frame"                                                                CUR_x_label{0} CUR_y{0} CUR_w{0} CUR_h{0} 0 0 1 0

            set WALTER_ELEMENT##.custom.Box_label   \
                !VAL_tcp_h_level{0}                 \
                    [0 0 0 0 0 0 0 0]

            set WALTER_ELEMENT##.custom.Image_label     \
                !VAL_tcp_h_level{0}                     \
                    [0 0 0 0 0 0 0 0]

            set WALTER_ELEMENT##.label                                                      \
                ?VAL_tcp_h_level{0}                                                         \
                    [CUR_x_innerLabel{0} CUR_y{0} CUR_w_innerLabel{0} CUR_h{0} 0 0 1 0]

            set WALTER_ELEMENT##.trackidx                                   \
                ?par_tcp_##PARAMETER_SECTION##_label_index_vis              \
                    ?VAL_tcp_h_level{0}                                     \
                        [CUR_x{0} CUR_y{0} CUR_w_idx{0} CUR_h{0} 0 0 0 0]

            set VAL_tcp_IndexOffset * SCALE 4

            ; z order
            front WALTER_ELEMENT##.label
            front WALTER_ELEMENT##.trackidx

        endmacro

    ;   ## Draw : TCP : Embedded FX
    ; -----------------------------------------------------------------

        macro MAC_DrawTcp_EmbedFx SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; preparations
            set CUR_y   VAL_tcp_y_start_fxembed{0}
            set CUR_x   VAL_tcp_x_leftmost{0}
            set CUR_w   - - VAL_tcp_x_end_inserts{0} VAL_tcp_spacing_section_x{0} CUR_x{0}
            set CUR_h   - WALTER_ELEMENT##.size{1} VAL_tcp_y_start_fxembed{0}

            ; draw
            set WALTER_ELEMENT##.fxembed [CUR_x{0} CUR_y{0} CUR_w{0} CUR_h{0} 0 0 1 1]

            ; font color
            set WALTER_ELEMENT##.fxembedheader.color THEME_color_button_text_off

        endmacro

    ;   ## Draw : TCP : Folder
    ; -----------------------------------------------------------------

        macro MAC_DrawTcp_Folder SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; position setup
            set CUR_w   VAL_Button_Folder{0}
            set CUR_x   - VAL_tcp_x_offset{0} CUR_w{0}
            set CUR_y   0

            ; [DRAW] folder collapse button
            set WALTER_ELEMENT##.foldercomp                                                     \
                ?par_tcp_gen_folder_icon_collapse                                               \
                    ?VAL_tcp_h_level{0}                                                         \
                        [CUR_x{0} CUR_y{0} VAL_Button_Folder{0} VAL_Button_Folder{0} 0 0 0 0]

            ; mode icon offset
            set CUR_x                               \
                ?par_tcp_gen_folder_icon_collapse   \
                    - CUR_x{0} CUR_w{0}

            ; [DRAW] folder mode icon
            set WALTER_ELEMENT##.folder                                                         \
                ?par_tcp_gen_folder_icon_mode                                                   \
                    ?VAL_tcp_h_level{0}                                                         \
                        [CUR_x{0} CUR_y{0} VAL_Button_Folder{0} VAL_Button_Folder{0} 0 0 0 0]

            front WALTER_ELEMENT##.foldercomp
            front WALTER_ELEMENT##.folder

        endmacro

    ;   ## Draw : TCP : Font
    ; -----------------------------------------------------------------

        ;   ### Draw : TCP : Font : Open
        ; -----------------------------------------------------------------

            macro MAC_DrawTcp_Font_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; inserts
                set WALTER_ELEMENT##.fxparm.font        [VAL_Font_Large VAL_insert_slot{0} 50 100 1 0 0 0]
                set WALTER_ELEMENT##.fxparm.margin      [VAL_Margin_Label{0} VAL_Margin_Label{1} VAL_Margin_Label{2} VAL_Margin_Label{3}]
                set WALTER_ELEMENT##.fxlist.font        WALTER_ELEMENT##.fxparm.font
                set WALTER_ELEMENT##.fxlist.margin      WALTER_ELEMENT##.fxparm.margin
                set WALTER_ELEMENT##.sendlist.font      WALTER_ELEMENT##.fxparm.font
                set WALTER_ELEMENT##.sendlist.margin    WALTER_ELEMENT##.fxparm.margin
                ; volume readout
                set WALTER_ELEMENT##.volume.label.margin [VAL_Margin_Label{1} VAL_Margin_Label{1} VAL_Margin_Label{1} VAL_Margin_Label{1} 0.5]

            endmacro

        ;   ### Draw : TCP : Font : Track
        ; -----------------------------------------------------------------

            macro MAC_DrawTcp_Font_Track SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; [SHARED]
                MAC_DrawTcp_Font_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; recinput
                set WALTER_ELEMENT##.recinput.font      VAL_Font_Small
                set WALTER_ELEMENT##.recinput.margin    [VAL_Margin_RecInput{0} VAL_Margin_RecInput{1} VAL_Margin_RecInput{2} VAL_Margin_RecInput{3} 1 0 0 0]

                ; track index
                set WALTER_ELEMENT##.trackidx.font VAL_Font_Large
                set WALTER_ELEMENT##.trackidx.margin                                                \
                par_tcp_##PARAMETER_SECTION##_label_index_vis==1                                    \
                    [VAL_Margin_Label{0} VAL_Margin_Label{1} VAL_Margin_Label{2} VAL_Margin_Label{3} 0.5 0 0 0]     \
                    [VAL_Margin_Label{0} VAL_Margin_Label{1} VAL_Margin_Label{2} VAL_Margin_Label{3} 1 0 0 0]

                set WALTER_ELEMENT##.trackidx.color [VAL_Color_Track_Index_TCP{0} VAL_Color_Track_Index_TCP{1} VAL_Color_Track_Index_TCP{2} . . . .]

                ; name label
                set WALTER_ELEMENT##.label.font VAL_Font_Large
                set WALTER_ELEMENT##.label.margin [VAL_Margin_Label{0} VAL_Margin_Label{1} VAL_Margin_Label{2} VAL_Margin_Label{3} 0 0 0 0]
                set WALTER_ELEMENT##.label.color [VAL_Color_Track_Label_Text{0} VAL_Color_Track_Label_Text{1} VAL_Color_Track_Label_Text{2} . . . .]

            endmacro

        ;   ### Draw : TCP : Font : Master
        ; -----------------------------------------------------------------

            macro MAC_DrawTcp_Font_Master SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; [SHARED]
                MAC_DrawTcp_Font_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

            endmacro

; ====================================================================================================================================
;   # ENVCP
; ====================================================================================================================================

    ;   ## Draw : ENVCP : Setup
    ; -----------------------------------------------------------------

        macro MAC_DrawEnvcp_Setup SCALE WALTER_ELEMENT PARAMETER_SECTION

            set WALTER_ELEMENT##.size tcp.size

            ; custom element
            custom WALTER_ELEMENT##.custom.envcp_symbol         "" "" "" "track_custom_env_icon_tail"
            custom WALTER_ELEMENT##.custom.iconlane             "" "" "" "tcp_iconbg"
            custom WALTER_ELEMENT##.custom.iconlane_select      "" "" "" "tcp_iconbgsel"
            custom WALTER_ELEMENT##.custom.fader_frame          "" "" "" "track_custom_fader_frame"
            custom WALTER_ELEMENT##.custom.fader_knob_frame     "" "" "" "track_custom_knob_border"

            ; height detection
            set VAL_Envcp_h_level   \
                h>=VAL_Envcp_h{0}   \
                    1               \
                    0

            ; compact width
            set VAL_envcp_compact_w + tcp_iconsize + VAL_tcp_x_offset_max_precomp * SCALE 100
            set VAL_tcp_compact             \
                w<VAL_envcp_compact_w{0}    \
                    1                       \
                    0

            ; envcp indentation
            set VAL_envcp_indent                                                                    \
                !par_tcp_envcp_settings_symbol                                                      \
                    * SCALE par_tcp_##PARAMETER_SECTION##_settings_indent                           \
                    + * SCALE par_tcp_##PARAMETER_SECTION##_settings_indent VAL_Envcp_Symbol{0}

            ; x offset
            set VAL_envcp_x_offset                              \
                ?VAL_tcp_compact{0}                             \
                    VAL_tcp_x_offset_folder{0}                  \
                    + VAL_tcp_x_offset{0} VAL_envcp_indent{0}

            ; [DRAW] indentation background
            MAC_Draw_Box 1 WALTER_ELEMENT "indent" THEME_color_tcp_empty_space{0} THEME_color_tcp_empty_space{1} THEME_color_tcp_empty_space{2} 0 0 VAL_envcp_x_offset WALTER_ELEMENT##.size{1} 0 0 0 1

            ; [DRAW] Envcp Symbol
            set WALTER_ELEMENT##.custom.envcp_symbol                            \
                ?par_tcp_envcp_settings_symbol{0}                               \
                    [0 0 VAL_envcp_x_offset{0} VAL_Envcp_Symbol{1} 0 0 0 0]     \
                    0

            front WALTER_ELEMENT##.custom.envcp_symbol

            ; icon lane usage
            set VAL_envcp_use_icon_lane                                     \
                trackidx>0                                                  \
                    ?par_tcp_##PARAMETER_SECTION##_settings_lane_display    \
                        tcp_iconsize>0                                      \
                            1                                               \
                            0                                               \
                        0                                                   \
                    0

            ; icon background
            set CUR_w + tcp_iconsize VAL_Border{0}
            set CUR_x                                                   \
                ?VAL_envcp_use_icon_lane{0}                             \
                    - WALTER_ELEMENT##.size{0} CUR_w{0}                 \
                    WALTER_ELEMENT##.size{0}

            set CUR_h + WALTER_ELEMENT##.size{1} 1

            ; [DRAW] icon background
            set WALTER_ELEMENT##.custom.iconlane                                \
                ?VAL_envcp_use_icon_lane{0}                                     \
                    !env_selected                                               \
                        [CUR_x{0} VAL_Border_Neg{0} CUR_w{0} CUR_h{0} 1 0 1 1]

            set WALTER_ELEMENT##.custom.iconlane_select                             \
                ?VAL_envcp_use_icon_lane{0}                                         \
                        ?env_selected                                               \
                            [CUR_x{0} VAL_Border_Neg{0} CUR_w{0} CUR_h{0} 1 0 1 1]

            ; select bar
            set CUR_x                                                       \
                ?par_tcp_gen_highlight_selection                            \
                    ?VAL_envcp_use_icon_lane{0}                             \
                        - tcp.custom.box_highlight_select{x} tcp_iconsize   \
                        tcp.custom.box_highlight_select{x}

            set CUR_w tcp.custom.box_highlight_select{w}

            MAC_Draw_Box        1 WALTER_ELEMENT "highlight_select" VAL_color_selectbar_envcp{0} VAL_color_selectbar_envcp{1} VAL_color_selectbar_envcp{2}  CUR_x{0} VAL_Border_Neg{0} CUR_w{0} CUR_h{0} 1 0 1 1
            MAC_Draw_Image      1 WALTER_ELEMENT "highlight_select" "track_custom_selmarker_frame"                                                          CUR_x{0} VAL_Border_Neg{0} CUR_w{0} CUR_h{0} 1 0 1 1

            ; color bar
            set CUR_x                                                       \
                ?par_tcp_gen_highlight_color                                \
                    ?VAL_envcp_use_icon_lane{0}                             \
                        - tcp.custom.box_highlight_color{x} tcp_iconsize    \
                        tcp.custom.box_highlight_color{x}

            set CUR_w tcp.custom.box_highlight_color{w}

            MAC_Draw_Box    1 WALTER_ELEMENT "highlight_color" VAL_color_colorbar_envcp{0} VAL_color_colorbar_envcp{1} VAL_color_colorbar_envcp{2}  CUR_x{0} VAL_Border_Neg{0} CUR_w{0} CUR_h{0} 1 0 1 1
            MAC_Draw_Image  1 WALTER_ELEMENT "highlight_color" "track_custom_colorbar_frame"                                                        CUR_x{0} VAL_Border_Neg{0} CUR_w{0} CUR_h{0} 1 0 1 1

            ; rightmost position
            set VAL_envcp_x_start_button CUR_x

            ; background
            set CUR_w + VAL_Border{0} - CUR_x{0} VAL_envcp_x_offset{0}

            MAC_Draw_Box    1 WALTER_ELEMENT "bg" VAL_Color_Envcp_Bg{0} VAL_Color_Envcp_Bg{1} VAL_Color_Envcp_Bg{2}     VAL_envcp_x_offset{0} VAL_Border_Neg{0} CUR_w{0} CUR_h{0} 0 0 1 1
            MAC_Draw_Image  1 WALTER_ELEMENT "bg" "track_custom_bg_frame"                                               VAL_envcp_x_offset{0} VAL_Border_Neg{0} CUR_w{0} CUR_h{0} 0 0 1 1

            ; leftmost position
            set VAL_envcp_x_leftmost + VAL_envcp_x_offset{0} VAL_Pad{0}

            ; dynamic hiding points
            set VAL_envcp_label_size + VAL_tcp_label_min_w{0} * SCALE * 2 par_tcp_##PARAMETER_SECTION##_label_size

            set VAL_tcp_hide_x_buttons                                                              \
                -                                                                                   \
                    + * SCALE 10 + tcp.size{0} +                                                    \
                    VAL_tcp_x_offset_max_precomp{0} + VAL_envcp_indent{0} VAL_envcp_label_size{0}   \
                w

            set VAL_tcp_hide_x_faders                                                           \
                -                                                                               \
                    + WALTER_ELEMENT##.size{0} + VAL_tcp_x_offset_max{0} VAL_envcp_indent{0}    \
                w

            set VAL_tcp_hide_x_leftmost                                             \
                -                                                                   \
                    + WALTER_ELEMENT##.size{0} + VAL_tcp_x_offset{0} VAL_Pad{0}     \
                w

            ; available space
            set VAL_envcp_available_space - w + VAL_tcp_x_offset_max{0} + VAL_envcp_indent{0} + VAL_Pad{0} - WALTER_ELEMENT##.size{0} CUR_x{0}


        endmacro

    ;   ## Draw : ENVCP : Fader
    ; -----------------------------------------------------------------

        macro MAC_DrawEnvcp_Fader SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; show buttons
            set VAL_tcp_hide_buttons 0

            ; inline display
            set VAL_envcp_fader_inline                          \
                par_tcp_##PARAMETER_SECTION##_value_mode==1     \
                    1                                           \
                    0

            ; show in icon lane
            set VAL_envcp_lanedisplay                                   \
                ?VAL_envcp_use_icon_lane{0}                             \
                    par_tcp_##PARAMETER_SECTION##_value_mode==3         \
                        1                                               \
                        0                                               \
                    0

            ; force inline when there's no icon lane
            set VAL_envcp_fader_inline                              \
                !VAL_envcp_lanedisplay{0}                           \
                    par_tcp_##PARAMETER_SECTION##_value_mode==3     \
                        1

            ; visibility
            set VAL_envcp_show_fader                                \
                !VAL_tcp_compact{0}                                 \
                    par_tcp_##PARAMETER_SECTION##_value_mode>0      \
                        1                                           \
                        0                                           \
                    0

            ; y position
            set CUR_y                                               \
                par_tcp_##PARAMETER_SECTION##_value_mode!=2         \
                    VAL_Border{0}                                   \
                    + VAL_Envcp_h{0} VAL_tcp_spacing_section_y{0}

            ; height
            set CUR_h                                                       \
                !par_tcp_##PARAMETER_SECTION##_value_vertical               \
                    VAL_Button{1}                                           \
                par_tcp_##PARAMETER_SECTION##_value_mode!=2                 \
                    - WALTER_ELEMENT##.size{1}              * 2 VAL_Pad{0}  \
                    - WALTER_ELEMENT##.size{1} + CUR_y{0}   * 2 VAL_Pad{0}

            ; vertical hiding logic
            set CUR_y_target + CUR_y{0} + VAL_Button{1} VAL_Pad{0}

            set VAL_envcp_show_fader                            \
                par_tcp_##PARAMETER_SECTION##_value_mode==2     \
                    h<CUR_y_target{0}                           \
                        0

            ; knob mode
            set VAL_envcp_h_vert_knob + CUR_y_target{0} * SCALE 20

            set VAL_envcp_fader_knob                                \
                ?par_tcp_##PARAMETER_SECTION##_value_vertical       \
                    h<VAL_envcp_h_vert_knob{0}                      \
                        1                                           \
                        0                                           \
                    ?VAL_envcp_lanedisplay{0}                       \
                        0                                           \
                        !par_tcp_##PARAMETER_SECTION##_value_size   \
                            1                                       \
                            0

            ; width
            set CUR_w                                                                                                                                               \
                ?par_tcp_##PARAMETER_SECTION##_value_vertical                                                                                                       \
                    VAL_Knob_s{0}                                                                                                                                   \
                ?VAL_envcp_lanedisplay{0}                                                                                                                           \
                    - tcp_iconsize * 3 VAL_Pad{0}                                                                                                                   \
                ?VAL_envcp_fader_knob{0}                                                                                                                            \
                    VAL_Knob_s{0}                                                                                                                                   \
                !par_tcp_##PARAMETER_SECTION##_value_scale                                                                                                          \
                    + VAL_tcp_fader_min_w{0} + VAL_Knob{0}                                              * 2 * SCALE     par_tcp_##PARAMETER_SECTION##_value_size    \
                    + VAL_tcp_fader_min_w{0} * - VAL_envcp_available_space{0} VAL_tcp_fader_min_w{0}    * 0.01          par_tcp_##PARAMETER_SECTION##_value_size

            ; target x position
            set CUR_x_target                                                                    \
                ?VAL_envcp_show_fader{0}                                                        \
                    ?VAL_envcp_lanedisplay{0}                                                   \
                        ?par_tcp_##PARAMETER_SECTION##_value_vertical                           \
                            - WALTER_ELEMENT##.size{0} + CUR_w{0}           * 4 VAL_Pad{0}      \
                            !VAL_envcp_fader_knob{0}                                            \
                                - WALTER_ELEMENT##.size{0} - tcp_iconsize       VAL_Pad{0}      \
                                - WALTER_ELEMENT##.size{0} + VAL_Knob_s{0}  * 4 VAL_Pad{0}      \
                        - CUR_x{0} + CUR_w{0} VAL_tcp_spacing_section_x{0}

            ; hiding logic
            set VAL_envcp_show_fader                            \
                par_tcp_##PARAMETER_SECTION##_value_mode{0}==2  \
                   VAL_tcp_hide_x_faders{0}>CUR_x_target{0}     \
                        0                                       \
                        .                                       \
                ?VAL_envcp_fader_inline{0}                      \
                    VAL_tcp_hide_x_buttons{0}>CUR_x_target{0}   \
                        0

            set VAL_tcp_hide_buttons            \
                ?VAL_envcp_fader_inline{0}      \
                    !VAL_envcp_show_fader{0}    \
                        1

            ; drawing
            set WALTER_ELEMENT##.fader.fadermode    \
                ?VAL_envcp_fader_knob{0}            \
                    1                               \
                    -1

            set WALTER_ELEMENT##.fader                                                                              \
                ?VAL_envcp_show_fader{0}                                                                            \
                    ?VAL_envcp_fader_knob{0}                                                                        \
                        + [0 0 0 0 0 0 0 0] [CUR_x_target{0} CUR_y{0} VAL_Knob_s{0} VAL_Knob_s{0} 1 0 1 0]          \
                    !par_tcp_##PARAMETER_SECTION##_value_vertical                                                   \
                        + [0 VAL_Fader{3} 0 0 0 0 0 0] [CUR_x_target{0} CUR_y{0} CUR_w{0} VAL_Fader{2} 1 0 1 0]     \
                        + [VAL_Fader{3} 0 0 0 0 0 0 0] [CUR_x_target{0} CUR_y{0} VAL_Fader{2} CUR_h{0} 1 0 1 1]

            set WALTER_ELEMENT##.custom.fader_frame     \
                ?VAL_envcp_show_fader{0}                \
                    !VAL_envcp_fader_knob{0}            \
                        WALTER_ELEMENT##.fader          \
                        0                               \
                    0

            set WALTER_ELEMENT##.custom.fader_knob_frame    \
                ?VAL_envcp_show_fader{0}                    \
                    ?VAL_envcp_fader_knob{0}                \
                        WALTER_ELEMENT##.fader              \
                        0                                   \
                    0

            front WALTER_ELEMENT##.fader
            front WALTER_ELEMENT##.custom.fader_frame
            front WALTER_ELEMENT##.custom.fader_knob_frame

            ; store x position
            set CUR_x                           \
                ?VAL_envcp_show_fader{0}        \
                    CUR_x_target{0}

            set VAL_envcp_x_start_button        \
                ?VAL_envcp_show_fader{0}        \
                    ?VAL_envcp_fader_inline{0}  \
                        CUR_x_target{0}


        endmacro

    ;   ## Draw : ENVCP : Buttons
    ; -----------------------------------------------------------------

        macro MAC_DrawEnvcp_Buttons SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; preparation
            set CUR_x - VAL_envcp_x_start_button{0} VAL_tcp_spacing_section_x{0}
    	    set CUR_y VAL_Unit{0}
            set CUR_w VAL_Button{0}
            set CUR_h VAL_Button{1}

            set VAL_tcp_button_count 0

            set VAL_tcp_x_end_buttons CUR_x{0}
            set VAL_envcp_x_postfx CUR_x{0}

            ; compact hiding
            set VAL_tcp_hide_buttons    \
                ?VAL_tcp_compact{0}     \
                    1                   \
                !VAL_tcp_h_level{0}     \
                    1

            ; learn visibility
            set VAL_envcp_fx_learn                                  \
                envcp_type{0}==4                                    \
                    par_tcp_##PARAMETER_SECTION##_element_vis&16    \
                        1                                           \
                        0                                           \
                    0

            ; mod visibility
            set VAL_envcp_fx_mod                                    \
                envcp_type{0}==4                                    \
                    par_tcp_##PARAMETER_SECTION##_element_vis&32    \
                        1                                           \
                        0                                           \
                    0

            ; [BUTTON] Arm
            set VAL_tcp_button_group_count 0
            MAC_DrawTcp_Buttons_SingleButton_Envcp SCALE 2 WALTER_ELEMENT PARAMETER_SECTION "arm" 0

            ; separator
            MAC_DrawTcp_Buttons_Separator SCALE 2 WALTER_ELEMENT PARAMETER_SECTION

            ; [BUTTON] Bypass / Hide
            set VAL_tcp_button_group_count 0
            MAC_DrawTcp_Buttons_SingleButton_Envcp SCALE 4 WALTER_ELEMENT PARAMETER_SECTION "bypass" 0
            MAC_DrawTcp_Buttons_SingleButton_Envcp SCALE 8 WALTER_ELEMENT PARAMETER_SECTION "hide" 0

            ; separator
            MAC_DrawTcp_Buttons_Separator SCALE 8 WALTER_ELEMENT PARAMETER_SECTION

            ; [BUTTON] Mod / Lean
            MAC_DrawTcp_Buttons_SingleButton_Envcp SCALE 16 WALTER_ELEMENT PARAMETER_SECTION "mod" VAL_envcp_fx_learn
            MAC_DrawTcp_Buttons_SingleButton_Envcp SCALE 32 WALTER_ELEMENT PARAMETER_SECTION "learn" VAL_envcp_fx_mod

            ; rightmost last x position
            set VAL_tcp_x_end_buttons                                       \
                VAL_tcp_button_count{0}>0                                   \
                    - VAL_tcp_x_end_buttons{0} VAL_tcp_spacing_section_x{0}

        endmacro

    ;   ## Draw : ENVCP : Label
    ; -----------------------------------------------------------------

        macro MAC_DrawEnvcp_Label SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; preparations
            set CUR_x VAL_envcp_x_leftmost{0}
            set CUR_y VAL_Unit{0}
            set CUR_w - VAL_tcp_x_end_buttons{0} CUR_x{0}
            set CUR_h VAL_Button{1}
            set VAL_readout_margin * SCALE 10

            ; absolute width
            set CUR_w_abs - w - WALTER_ELEMENT##.size{0} CUR_w{0}

            ; readout width
            set CUR_w_readout                                                                       \
                ?par_tcp_##PARAMETER_SECTION##_label_readout_size_scale                             \
                    * CUR_w_abs{0}  * 0.008     par_tcp_##PARAMETER_SECTION##_label_readout_size    \
                    * 2             * SCALE     par_tcp_##PARAMETER_SECTION##_label_readout_size

            ; readout absolute width
            set CUR_w_readout_abs - w - WALTER_ELEMENT##.size{0} CUR_w_readout{0}

            ; label width
            set CUR_w_label                                                     \
                par_tcp_##PARAMETER_SECTION##_label_readout_placement{0}>=1     \
                    - CUR_w{0} CUR_w_readout{0}                                 \
                    CUR_w{0}

            ; label background
            set CUR_w_label_bg                                                  \
                par_tcp_##PARAMETER_SECTION##_label_readout_placement{0}==2     \
                    CUR_w_label{0}                                              \
                    CUR_w{0}

            ; readout x position
            set CUR_x_readout + CUR_x{0} CUR_w_label{0}

            ; readout hiding logic
            set CUR_x_readout_abs - w - WALTER_ELEMENT##.size{0} - CUR_x_readout{0} - VAL_envcp_label_size{0} VAL_tcp_x_offset{0}

            set VAL_Show_readout                                            \
                !par_tcp_##PARAMETER_SECTION##_label_readout_placement      \
                    0                                                       \
                CUR_x_readout_abs{0}>CUR_x{0}                               \
                    !VAL_tcp_compact{0}                                     \
                        1                                                   \
                        0                                                   \
                    0

            set CUR_w_label                 \
                !VAL_Show_readout{0}        \
                    CUR_w{0}

            set CUR_w_label_bg              \
                !VAL_Show_readout{0}        \
                    CUR_w{0}

            ; [DRAW] label background
            MAC_Draw_Box    1 WALTER_ELEMENT "label" VAL_Color_Envcp_label_Bg{0} VAL_Color_Envcp_label_Bg{1} VAL_Color_Envcp_label_Bg{2}    CUR_x{0} CUR_y{0} CUR_w_label_bg{0} CUR_h{0} 0 0 1 0
            MAC_Draw_Image  1 WALTER_ELEMENT "label" "track_custom_bg_frame"                                                                CUR_x{0} CUR_y{0} CUR_w_label_bg{0} CUR_h{0} 0 0 1 0

            ; [DRAW] label
            set WALTER_ELEMENT##.label [CUR_x{0} CUR_y{0} CUR_w_label{0} CUR_h{0} 0 0 1 0]

            ; [DRAW] readout
            set WALTER_ELEMENT##.value                                  \
                ?VAL_Show_readout{0}                                    \
                    [CUR_x_readout{0} CUR_y{0} CUR_w_readout{0} CUR_h{0} 1 0 1 0]

            ; z order
            front WALTER_ELEMENT##.label
            front WALTER_ELEMENT##.value

        endmacro

    ;   ## Draw : ENVCP : Font
    ; -----------------------------------------------------------------

        macro MAC_DrawEnvcp_Font SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; name label
            set WALTER_ELEMENT##.label.font     VAL_Font_Large
            set WALTER_ELEMENT##.label.margin   [VAL_Margin_Label{0} VAL_Margin_Label{1} VAL_Margin_Label{2} VAL_Margin_Label{3} 0 0 0 0]
            set WALTER_ELEMENT##.label.color    [VAL_Color_Envcp_Label_Text{0}  VAL_Color_Envcp_Label_Text{1}   VAL_Color_Envcp_Label_Text{2}   . . . .]

            ; readout value
            set WALTER_ELEMENT##.value.font     VAL_Font_Large
            set WALTER_ELEMENT##.value.margin   [VAL_readout_margin{0} 0 VAL_readout_margin{0} 0]
            set WALTER_ELEMENT##.value.color    [VAL_Color_Envcp_Readout{0}     VAL_Color_Envcp_Readout{1}      VAL_Color_Envcp_Readout{2}      . . . .]

        endmacro

; ====================================================================================================================================
;   # GLOBAL
; ====================================================================================================================================

    ;   ## Draw
    ; -----------------------------------------------------------------

        macro MAC_Draw     SCALE
            MAC_Setup           SCALE
            MAC_DrawTransport   SCALE
            MAC_DrawTcp         SCALE
            MAC_DrawMcp         SCALE
        endmacro

    ;   ## Settings
    ; -----------------------------------------------------------------

        ; colors
        tcp_vol_zeroline A0000000
        tcp_pan_zeroline A0000000
        mcp_vol_zeroline A0000000
        mcp_pan_zeroline A0000000
        trans_speed_zeroline A0000000
        gen_vol_zeroline A0000000
        gen_pan_zeroline A0000000
        item_volknobfg 00000000 00000000 00000000

        ; general
        version 7
        use_pngs 1
        use_overlays 0
        warnings pedantic
        tcp_showborders 0
        mcp_showborders 0
        transport_showborders 0
        no_meter_reclbl 1
        tcp_vupeakwidth 1
        tinttcp 1536
        mcp_mastervupeakheight 1
        peaksedges 0

        ; mcp
        mcp_voltext_flags 5 3
        mcp_vupeakheight 1
        mcp_master_voltext_flags 1 0
        mcp_altmeterpos 0
        mcp_min_height 0

        ; tcp
        tcp_voltext_flags 5 3
        tcp_master_voltext_flags 5 3
        tcp_folderindent 0
        tcp_heights 5 17 50 100
        tcp_master_minheight 18

        ; envcp
        envcp_min_height 17

    ;   ## DPI translation
    ; -----------------------------------------------------------------

        ; non-WALTER dpi translation
        misc_dpi_translate  125     125
        misc_dpi_translate  150     150
        misc_dpi_translate  175     175
        misc_dpi_translate  200     200
        misc_dpi_translate  225     225
        misc_dpi_translate  250     250

        ; WALTR dpi translation
        layout_dpi_translate    ''  1.25    '125'
        layout_dpi_translate    ''  1.5     '150'
        layout_dpi_translate    ''  1.75    '175'
        layout_dpi_translate    ''  2.0     '200'
        layout_dpi_translate    ''  2.25    '225'
        layout_dpi_translate    ''  2.5     '250'

    ;   ## Layouts
    ; -----------------------------------------------------------------

        MAC_Draw            1.0

        ; Layout : 100
        Layout '100' ''
        endLayout

        ; Layout : 125
        Layout '125' '125'
            MAC_Draw           1.25
        endLayout

        ; Layout : 150
        Layout '150' '150'
            MAC_Draw           1.5
        endLayout

        ; Layout : 175
        Layout '175' '175'
            MAC_Draw           1.75
        endLayout

        ; Layout : 200
        Layout '200' '200'
            MAC_Draw           2.0
        endLayout

        ; Layout : 225
        Layout '225' '225'
            MAC_Draw           2.25
        endLayout

        ; Layout : 250
        Layout '250' '250'
            MAC_Draw           2.5
        endLayout

        ; global layouts
        GlobalLayout '100'
        GlobalLayout '125'
        GlobalLayout '150'
        GlobalLayout '175'
        GlobalLayout '200'
        GlobalLayout '225'
        GlobalLayout '250'
