; ::::::::::::::::::::::: THEME_HEADER :::::::::::::::::::::::::::::
;       paRt WALTER file
;
;       Theme: light
;       Version: 1.3.1
;       Date: 2026-03-01 02:38:54
; ::::::::::::::::::::::: THEME_HEADER_CLOSE :::::::::::::::::::::::












;THEMEBUILDER_INSERT_README
;~ ~ ~ ~ ~ ~ ~ ~ ~ ~ THEME_BLOCK ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ 

;
;   ==============================================
;       paRt WALTER File Readme
;   ==============================================
;
;   This file contains all the custom layouts provided by Reaper’s theming layout engine.
;   Since the theme offers a high amount of user customization, this file is pretty large and challenging to maintain or even modify.
;   This guide gives you a quick overview of what’s going on in here.
;   
;   -----------------------------------
;       Formatting
;   -----------------------------------
;
;   WALTER doesn’t enforce any formatting rules.
;   Still, to keep things readable this file relies heavily on line breaks
;   and follows a somewhat consistent visual layout:
;
;       set TargetVariable                                      \
;           ?condition                                          \
;               >> value if condition is true <<                \
;               >> value if condition is false <<
;
;   This increases the linecount, but you avoids overly long lines most of the time.
;
;   -----------------------------------
;       Variable Names
;   -----------------------------------
;
;   WALTER doesn’t have variable types, but to keep things organized
;   this file uses a simple naming scheme:
;
;       "VAL_..."       ->  pre-computed semi-constants meant for repeated use later
;       "CUR_..."       ->  cursor values that keep getting updated while drawing
;       "VARIABLE"      ->  plain uppercase names are reserved for macro arguments
;
;   -----------------------------------
;       "THEMEBUILDER" Blocks
;   -----------------------------------
;
;    Several comment lines in this file contain the word "THEMEBUILDER".
;    They sometimes come with matching opening and closing comment markers.
;
;    These are placeholders that get dynamically replaced with content from other files
;    during the theme-building process whenever a new release is created.
;    They include things like the WALTER parameter list or static color values reserved for each theme file.
;
;    Best to leave them as they are. If you're modifying the theme, it's recommended to replace them with
;    the content from newer official paRt releases. An incomplete or altered parameter list, for example,
;    can easily make the Theme Adjuster crash.
;
;   -----------------------------------
;       [BOOKMARKS]
;   -----------------------------------
;
;    There are several comment lines in this file that contain hints written like [THIS].
;    They’re basically little bookmarks that point to edge cases, exceptions, and other important events.
;    Here’s a quick overview:
;
;    [LINUX OS FIX]      - exception for Linux operating systems
;    [MAC OS FIX]        - exception for Apple operating systems
;    [DRAW]              - marks a command that tells Reaper to actually place an object somewhere
;    [ROUND]             - marks calculations that use a pseudo-rounding algorithm
;    [SHARED]            - inserts a macro that’s also used elsewhere
;    [DEV]               - development tools (these blocks should be commented out for release)
;
;   -----------------------------------
;       Macros
;   -----------------------------------
;
;    This theme file uses macros extensively to streamline repeated code.
;    All macros start with "MAC_..." so they are easy to identify.
;
;    "Shared" Macro Concept:
;        Some macros end with "..._SharedCode_Open" or "..._SharedCode_Close".
;        These exist to reduce redundancy by covering sections shared across multiple elements.
;        You don't need to duplicate these sections manually.
;
;        Here's an abstract example:
;
;            MAC_drawContents_SharedCode_Open
;                >> code applied to all track types before individual track code <<
;            endmacro
                ;
;            MAC_drawContents_SharedCode_Close
;                >> code applied to all track types after individual track code <<
;            endmacro
;
;            MAC_drawContentsOfMasterTrack
;                MAC_drawContents_SharedCode_Open
;                >> code specific to the master track <<
;                MAC_drawContents_SharedCode_Close
;            endmacro
;
;            MAC_drawContentsOfArrangeTrack
;                MAC_drawContents_SharedCode_Open
;                >> code applied to all non-master tracks <<
;                MAC_drawContents_SharedCode_Close
;            endmacro
;

;~ ~ ~ ~ ~ ~ ~ ~ ~ ~ THEME_BLOCK_CLOSE ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ 

;THEMEBUILDER_INSERT_PARAMETERS
;~ ~ ~ ~ ~ ~ ~ ~ ~ ~ THEME_BLOCK ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ 

adjuster_script "paRt - Theme Adjuster.lua"
define_parameter part_version 'paRt Theme v1.3.1' 0 0 0
define_parameter par_user_range_0 'User - Range - 0' 0 0 1000
define_parameter par_user_range_1 'User - Range - 1' 0 0 1000
define_parameter par_user_range_10 'User - Range - 10' 0 0 1000
define_parameter par_user_range_11 'User - Range - 11' 0 0 1000
define_parameter par_user_range_12 'User - Range - 12' 0 0 1000
define_parameter par_user_range_13 'User - Range - 13' 0 0 1000
define_parameter par_user_range_14 'User - Range - 14' 0 0 1000
define_parameter par_user_range_15 'User - Range - 15' 0 0 1000
define_parameter par_user_range_2 'User - Range - 2' 0 0 1000
define_parameter par_user_range_3 'User - Range - 3' 0 0 1000
define_parameter par_user_range_4 'User - Range - 4' 0 0 1000
define_parameter par_user_range_5 'User - Range - 5' 0 0 1000
define_parameter par_user_range_6 'User - Range - 6' 0 0 1000
define_parameter par_user_range_7 'User - Range - 7' 0 0 1000
define_parameter par_user_range_8 'User - Range - 8' 0 0 1000
define_parameter par_user_range_9 'User - Range - 9' 0 0 1000
define_parameter par_user_selection_0 'User - Selection - 0' 0 0 8
define_parameter par_user_selection_1 'User - Selection - 1' 0 0 8
define_parameter par_user_selection_2 'User - Selection - 2' 0 0 8
define_parameter par_user_selection_3 'User - Selection - 3' 0 0 8
define_parameter par_user_selection_4 'User - Selection - 4' 0 0 8
define_parameter par_user_selection_5 'User - Selection - 5' 0 0 8
define_parameter par_user_selection_6 'User - Selection - 6' 0 0 8
define_parameter par_user_selection_7 'User - Selection - 7' 0 0 8
define_parameter par_user_switch_0 'User - Switch - 0' 0 0 1
define_parameter par_user_switch_1 'User - Switch - 1' 0 0 1
define_parameter par_user_switch_2 'User - Switch - 2' 0 0 1
define_parameter par_user_switch_3 'User - Switch - 3' 0 0 1
define_parameter par_user_switch_4 'User - Switch - 4' 0 0 1
define_parameter par_user_switch_5 'User - Switch - 5' 0 0 1
define_parameter par_user_switch_6 'User - Switch - 6' 0 0 1
define_parameter par_user_switch_7 'User - Switch - 7' 0 0 1
define_parameter par_bank_selected 'Selected Bank' 2 2 9
define_parameter par_colors_track_envcp_bg_tint 'Colors - Track - ENVCP Background Select' 260 0 1000
define_parameter par_colors_track_envcp_bg_tone 'Colors - Track - ENVCP Background Tone' 653 0 1000
define_parameter par_colors_track_envcp_label_bg_Tone 'Colors - Track - ENVCP Label Background Tone' 453 0 1000
define_parameter par_colors_track_envcp_label_bg_tint 'Colors - Track - ENVCP Label Background Select' 0 0 1000
define_parameter par_colors_track_envcp_label_readout_tone 'Colors - Track - ENVCP Label Readout Tone' 0 0 1000
define_parameter par_colors_track_envcp_label_text_tone 'Colors - Track - ENVCP Label Text Tone' 459 0 1000
define_parameter par_colors_track_folder_foldertrack_tint 'Colors - Track - Folder Track Tint' 500 0 1000
define_parameter par_colors_track_folder_foldertrack_tone 'Colors - Track - Folder Track Tone' 500 0 1000
define_parameter par_colors_track_folder_foldertree_tint 'Colors - Track - Folder Tree Tint' 500 0 1000
define_parameter par_colors_track_folder_foldertree_tone 'Colors - Track - Folder Tree Tone' 500 0 1000
define_parameter par_colors_track_meter_text_alpha_mcp 'Colors - Track - Meter Text Alpha MCP' 784 0 1000
define_parameter par_colors_track_meter_text_alpha_tcp 'Colors - Track - Meter Text Alpha TCP' 784 0 1000
define_parameter par_colors_track_meter_text_shadow_lit 'Colors - Track - Meter Text Shadow Top' 0 0 1000
define_parameter par_colors_track_meter_text_shadow_unlit 'Colors - Track - Meter Text Shadow Bottom' 0 0 1000
define_parameter par_colors_track_meter_text_tone_lit 'Colors - Track - Meter Text Tone Lit' 0 0 1000
define_parameter par_colors_track_meter_text_tone_readout 'Colors - Track - Meter Text Tone Readout' 509 0 1000
define_parameter par_colors_track_meter_text_tone_readout_clip 'Colors - Track - Meter Text Tone Readout Clip' 1000 0 1000
define_parameter par_colors_track_meter_text_tone_unlit 'Colors - Track - Meter Text Tone Unlit' 845 0 1000
define_parameter par_colors_track_track_bg_select_tint 'Colors - Track - Track Background Selection Tint' 33 0 1000
define_parameter par_colors_track_track_bg_select_tone 'Colors - Track - Track Background Selection Tone' 241 0 1000
define_parameter par_colors_track_track_bg_tint 'Colors - Track - Track Background Select' 53 0 1000
define_parameter par_colors_track_track_bg_tone 'Colors - Track - Track Background Tone' 500 0 1000
define_parameter par_colors_track_track_colorbar_intensity 'Colors - Track - Track Colorbar Intensity' 405 0 1000
define_parameter par_colors_track_track_index_tone_mcp 'Colors - Track - Track Label Index Tone MCP' 190 0 1000
define_parameter par_colors_track_track_index_tone_tcp 'Colors - Track - Track Label Index Tone TCP' 410 0 1000
define_parameter par_colors_track_track_label_bg_tint 'Colors - Track - Track Label Background Tint' 0 0 1000
define_parameter par_colors_track_track_label_bg_tone 'Colors - Track - Track Label Background Tone' 484 0 1000
define_parameter par_colors_track_track_label_select_tint 'Colors - Track - Track Label Selection Tint' 0 0 1000
define_parameter par_colors_track_track_label_select_tone 'Colors - Track - Track Label Selection Tone' 345 0 1000
define_parameter par_colors_track_track_label_text_tone 'Colors - Track - Track Label Text Tone' 507 0 1000
define_parameter par_colors_track_track_selectionframe_tint 'Colors - Track - Track Selection Frame Tint' 164 0 1000
define_parameter par_colors_track_track_selectionframe_tone 'Colors - Track - Track Selection Frame Tone' 198 0 1000
define_parameter par_config_selected 'Selected Configuration' 0 0 7
define_parameter par_mcp_gen_element_adj_pad 'MCP - General - Element Adjustments Padding' 0 0 1000
define_parameter par_mcp_gen_element_adj_separator 'MCP - General - Element Adjustments Separator' 67 0 1000
define_parameter par_mcp_gen_element_adj_separator_line 'MCP - General - Element Adjustments Separator Line' 1 0 1
define_parameter par_mcp_gen_element_adj_spacing_fader_x 'MCP - General - Element Adjustments Spacing Fader X' 0 0 1000
define_parameter par_mcp_gen_element_adj_spacing_fader_y 'MCP - General - Element Adjustments Spacing Fader Y' 0 0 1000
define_parameter par_mcp_gen_element_adj_spacing_section_x 'MCP - General - Element Adjustments Spacing Section X' 0 0 1000
define_parameter par_mcp_gen_element_adj_spacing_section_y 'MCP - General - Element Adjustments Spacing Section Y' 138 0 1000
define_parameter par_mcp_gen_element_adj_spacing_x 'MCP - General - Element Adjustments Spacing X' 0 0 1000
define_parameter par_mcp_gen_element_adj_spacing_y 'MCP - General - Element Adjustments Spacing Y' 0 0 1000
define_parameter par_mcp_gen_folder_icon_folder 'MCP - General - Folder Icon Parent' 2 0 2
define_parameter par_mcp_gen_folder_indent 'MCP - General - Folder Indent' 0 0 1000
define_parameter par_mcp_gen_folder_pad_folder_last 'MCP - General - Folder Padding Last' 0 0 1000
define_parameter par_mcp_gen_folder_pad_folder_parent 'MCP - General - Folder Padding Parent' 0 0 1000
define_parameter par_mcp_gen_highlight_color 'MCP - General - Highlight Color Bar' 375 0 1000
define_parameter par_mcp_gen_highlight_selection 'MCP - General - Highlight Selection Bar' 134 0 1000
define_parameter par_mcp_gen_highlight_selectionframe 'MCP - General - Highlight Selection Frame' 1 0 1000
define_parameter par_mcp_gen_settings_multirow 'MCP - General - Settings MultiRow' 0 0 1
define_parameter par_mcp_gen_settings_multirow_compact 'MCP - General - Settings MultiRow Compact' 0 0 1
define_parameter par_mcp_gen_settings_trackicons 'MCP - General - Settings Track Icons' 0 0 1
define_parameter par_mcp_master_element_separator 'MCP - Master - Element Separator' 0 0 1000000
define_parameter par_mcp_master_element_vis 'MCP - Master - Element Visibility' 126 0 1000000
define_parameter par_mcp_master_element_width 'MCP - Master - Element Width' 2 0 2
define_parameter par_mcp_master_fader_layout 'MCP - Master - Faders Layout' 1 0 10
define_parameter par_mcp_master_fader_pan_height 'MCP - Master - Faders Pan Height' 0 0 1000
define_parameter par_mcp_master_fader_pan_height_scale 'MCP - Master - Faders Pan Height Scale' 0 0 1
define_parameter par_mcp_master_fader_pan_mode_dual 'MCP - Master - Faders Pan Mode Dual' 0 0 10
define_parameter par_mcp_master_fader_pan_mode_mono 'MCP - Master - Faders Pan Mode Mono' 0 0 10
define_parameter par_mcp_master_fader_pan_mode_stereo 'MCP - Master - Faders Pan Mode Stereo' 0 0 10
define_parameter par_mcp_master_fader_pan_width 'MCP - Master - Faders Pan Width' 414 0 1000
define_parameter par_mcp_master_fader_wid_always 'MCP - Master - Faders Always Show Width' 1 0 1
define_parameter par_mcp_master_insert_mode 'MCP - Master - Inserts Mode' 1 0 2
define_parameter par_mcp_master_insert_pad 'MCP - Master - Inserts Padding' 0 0 2
define_parameter par_mcp_master_insert_size 'MCP - Master - Inserts Size' 140 0 1000
define_parameter par_mcp_master_insert_size_scale 'MCP - Master - Inserts Size Scale' 0 0 1
define_parameter par_mcp_master_meter_channeldiv 'MCP - Master - Meter Channel Division' 0 0 1000
define_parameter par_mcp_master_meter_channeldiv_rms 'MCP - Master - Meter Channel Division RMS' 0 0 1000
define_parameter par_mcp_master_meter_gaindiv 'MCP - Master - Meter Gain Division' 0 0 1000
define_parameter par_mcp_master_meter_gainwid 'MCP - Master - Meter Gain Width' 0 0 1000
define_parameter par_mcp_master_meter_padding 'MCP - Master - Meter Padding' 2 0 2
define_parameter par_mcp_master_meter_pos 'MCP - Master - Meter Position' 2 0 2
define_parameter par_mcp_master_meter_size 'MCP - Master - Meter Size' 407 0 1000
define_parameter par_mcp_master_meter_size_scale 'MCP - Master - Meter Size Scale' 1 0 1
define_parameter par_mcp_master_meter_vol_readout 'MCP - Master - Meter Volume Readout' 1 0 2
define_parameter par_mcp_master_meter_vu_db 'MCP - Master - Meter VU dB' 1 0 1
define_parameter par_mcp_master_meter_vu_readout 'MCP - Master - Meter VU Readout' 1 0 1
define_parameter par_mcp_master_settings_extrapad 'MCP - Master - Settigns Extra Padding' 121 0 1000
define_parameter par_mcp_master_settings_label_size 'MCP - Master - Settigns Label Size' 0 0 1000
define_parameter par_mcp_track_element_input_size 'MCP - Track - Element Input Size' 0 0 1000
define_parameter par_mcp_track_element_separator 'MCP - Track - Element Separator' 276 0 1000000
define_parameter par_mcp_track_element_vis 'MCP - Track - Element Visibility' 4094 0 1000000
define_parameter par_mcp_track_element_width 'MCP - Track - Element Width' 1 0 2
define_parameter par_mcp_track_fader_layout 'MCP - Track - Faders Layout' 0 0 1000
define_parameter par_mcp_track_fader_pan_height 'MCP - Track - Faders Pan Height' 0 0 1000
define_parameter par_mcp_track_fader_pan_height_scale 'MCP - Track - Faders Pan Height Scale' 0 0 1
define_parameter par_mcp_track_fader_pan_mode_dual 'MCP - Track - Faders Pan Mode Dual' 2 0 1000
define_parameter par_mcp_track_fader_pan_mode_mono 'MCP - Track - Faders Pan Mode Mono' 2 0 1000
define_parameter par_mcp_track_fader_pan_mode_stereo 'MCP - Track - Faders Pan Mode Stereo' 2 0 1000
define_parameter par_mcp_track_fader_pan_width 'MCP - Track - Faders Pan Width' 0 0 1000
define_parameter par_mcp_track_fader_wid_always 'MCP - Track - Faders Always Show Width' 1 0 1
define_parameter par_mcp_track_insert_mode 'MCP - Track - Inserts Mode' 2 0 3
define_parameter par_mcp_track_insert_pad 'MCP - Track - Inserts Padding' 1 0 2
define_parameter par_mcp_track_insert_size 'MCP - Track - Inserts Size' 209 0 1000
define_parameter par_mcp_track_insert_size_embed 'MCP - Track - Inserts Size Embed' 190 0 1000
define_parameter par_mcp_track_insert_size_scale 'MCP - Track - Inserts Size Scale' 1 0 1
define_parameter par_mcp_track_meter_channeldiv 'MCP - Track - Meter Channel Division' 0 0 1000
define_parameter par_mcp_track_meter_expand 'MCP - Track - Meter Expansion' 0 0 1000
define_parameter par_mcp_track_meter_expand_mode 'MCP - Track - Meter Expansion Mode' 0 0 1
define_parameter par_mcp_track_meter_expand_threshold 'MCP - Track - Meter Expansion Threshold' 2 2 36
define_parameter par_mcp_track_meter_gaindiv 'MCP - Track - Meter Gain Division' 23 0 1000
define_parameter par_mcp_track_meter_gainwid 'MCP - Track - Meter Gain Width' 32 0 1000
define_parameter par_mcp_track_meter_padding 'MCP - Track - Meter Padding' 0 0 2
define_parameter par_mcp_track_meter_pos 'MCP - Track - Meter Position' 2 0 2
define_parameter par_mcp_track_meter_size 'MCP - Track - Meter Size' 0 0 1000
define_parameter par_mcp_track_meter_size_scale 'MCP - Track - Meter Size Scale' 0 0 1
define_parameter par_mcp_track_meter_vol_readout 'MCP - Track - Meter Volume Readout' 0 0 2
define_parameter par_mcp_track_meter_vu_db 'MCP - Track - Meter VU dB' 1 0 1
define_parameter par_mcp_track_meter_vu_readout 'MCP - Track - Meter VU Readout' 1 0 1
define_parameter par_mcp_track_settings_extrapad 'MCP - Track - Settings Extra Padding' 60 0 1000
define_parameter par_mcp_track_settings_label_index 'MCP - Track - Settings Label Index Position' 2 0 2
define_parameter par_mcp_track_settings_label_size 'MCP - Track - Settings Label Size' 0 0 1000
define_parameter par_mcp_track_settings_label_vertical 'MCP - Track - Settings Label Vertical' 0 0 1
define_parameter par_tcp_envcp_element_adj_wrap_buttons 'TCP - ENVCP - Element Adjustment Wrap Buttons' 3 0 3
define_parameter par_tcp_envcp_element_separator 'TCP - ENVCP - Element Separator' 0 0 1000000
define_parameter par_tcp_envcp_element_vis 'TCP - ENVCP - Element Visibility' 14 0 1000000
define_parameter par_tcp_envcp_label_margin 'TCP - ENVCP - Label Margin' 0 0 1000
define_parameter par_tcp_envcp_label_readout_placement 'TCP - ENVCP - Label Readout Placement' 2 0 2
define_parameter par_tcp_envcp_label_readout_size 'TCP - ENVCP - Label Readout Separator Size' 558 0 1000
define_parameter par_tcp_envcp_label_readout_size_scale 'TCP - ENVCP - Label Readout Separator Size Scale' 1 0 1
define_parameter par_tcp_envcp_label_size 'TCP - ENVCP - Label Size' 190 0 1000
define_parameter par_tcp_envcp_settings_indent 'TCP - ENVCP - Settings Indentation' 0 0 1000
define_parameter par_tcp_envcp_settings_lane_display 'TCP - ENVCP - Settings Lane Display' 1 0 2
define_parameter par_tcp_envcp_settings_symbol 'TCP - ENVCP - Settings Symbol' 1 0 1
define_parameter par_tcp_envcp_value_lane 'TCP - ENVCP - Value Display Lane' 0 0 1
define_parameter par_tcp_envcp_value_mode 'TCP - ENVCP - Value Display Mode' 3 0 3
define_parameter par_tcp_envcp_value_scale 'TCP - ENVCP - Value Size Scaling' 0 0 1
define_parameter par_tcp_envcp_value_size 'TCP - ENVCP - Value Size' 0 0 1000
define_parameter par_tcp_envcp_value_vertical 'TCP - ENVCP - Value Display Vertical' 1 0 1
define_parameter par_tcp_gen_element_adj_separator 'TCP - General - Element Adjustment Separator Size' 250 0 1000
define_parameter par_tcp_gen_element_adj_separator_line 'TCP - General - Element Adjustment Separator Line' 1 0 1
define_parameter par_tcp_gen_element_adj_show_fx 'TCP - General - Element Adjustment Show FX' 0 0 1
define_parameter par_tcp_gen_element_adj_show_sends 'TCP - General - Element Adjustment Show Sends' 0 0 1
define_parameter par_tcp_gen_element_adj_spacing_section_x 'TCP - General - Element Adjustment Spacing Section X' 147 0 1000
define_parameter par_tcp_gen_element_adj_spacing_section_y 'TCP - General - Element Adjustment Spacing Section Y' 129 0 1000
define_parameter par_tcp_gen_element_adj_spacing_x 'TCP - General - Element Adjustment Spacing X' 0 0 1000
define_parameter par_tcp_gen_element_adj_spacing_x_fader 'TCP - General - Element Adjustment Spacing X Fader' 0 0 1000
define_parameter par_tcp_gen_element_adj_spacing_y 'TCP - General - Element Adjustment Spacing Y' 0 0 1000
define_parameter par_tcp_gen_element_adj_spacing_y_fader 'TCP - General - Element Adjustment Spacing Y Fader' 0 0 1000
define_parameter par_tcp_gen_folder_icon_collapse 'TCP - General - Folder Collapse' 2 0 2
define_parameter par_tcp_gen_folder_icon_mode 'TCP - General - Folder Mode' 0 0 1
define_parameter par_tcp_gen_folder_indent 'TCP - General - Folder Indentation' 290 0 1000
define_parameter par_tcp_gen_highlight_color 'TCP - Highlight - Color Bar' 308 0 1000
define_parameter par_tcp_gen_highlight_selection 'TCP - Highlight - Selection Bar' 181 0 1000
define_parameter par_tcp_gen_highlight_selectionframe 'TCP - Highlight - Selection Frame' 1 0 1000
define_parameter par_tcp_gen_insert_slot_width 'TCP - General - Inserts - Slot Width' 1000 0 1000
define_parameter par_tcp_gen_insert_slot_width_sends 'TCP - General - Inserts - Slot Width Sends' 1000 0 1000
define_parameter par_tcp_gen_insert_split 'TCP - General - Inserts Split' 0 0 9
define_parameter par_tcp_gen_insert_split_send_crossover 'TCP - General - Inserts Split Send Crossover' 493 0 1000
define_parameter par_tcp_master_element_adj_size_env 'TCP - Master - Element Adjustment Envelope Size' 1 0 1
define_parameter par_tcp_master_element_adj_size_fx 'TCP - Master - Element Adjustment FX Size' 0 0 1
define_parameter par_tcp_master_element_adj_wrap_buttons 'TCP - Master - Element Adjustment Wrap Buttons' 3 0 3
define_parameter par_tcp_master_element_separator 'TCP - Master - Element Separator' 26 0 1000000
define_parameter par_tcp_master_element_vis 'TCP - Master - Element Visibility Flags' 126 0 1000000
define_parameter par_tcp_master_fader_pan_size 'TCP - Master - Faders Pan Size' 0 0 1000
define_parameter par_tcp_master_fader_pan_size_scale 'TCP - Master - Faders Pan Size Scaling' 0 0 1
define_parameter par_tcp_master_fader_pan_vis 'TCP - Master - Faders Pan Visibility' 1 0 1
define_parameter par_tcp_master_fader_placement 'TCP - Master - Faders Placement' 0 0 3
define_parameter par_tcp_master_fader_vol_size 'TCP - Master - Faders Volume Size' 0 0 1000
define_parameter par_tcp_master_fader_vol_size_scale 'TCP - Master - Faders Volume Size Scaling' 0 0 1
define_parameter par_tcp_master_fader_vol_vis 'TCP - Master - Faders Volume Visibility' 1 0 1
define_parameter par_tcp_master_fader_wid_size 'TCP - Master - Faders Width Size' 0 0 1000
define_parameter par_tcp_master_fader_wid_size_scale 'TCP - Master - Faders Width Size Scaling' 0 0 1
define_parameter par_tcp_master_fader_wid_vis 'TCP - Master - Faders Width Visibility' 1 0 1
define_parameter par_tcp_master_insert_mode 'TCP - Master - Inserts Mode' 2 0 2
define_parameter par_tcp_master_insert_size 'TCP - Master - Inserts Size' 211 0 1000
define_parameter par_tcp_master_insert_size_scale 'TCP - Master - Inserts Size Scaling' 0 0 1
define_parameter par_tcp_master_meter_channeldiv 'TCP - Master - Meter Channel Division' 0 0 1000
define_parameter par_tcp_master_meter_gaindiv 'TCP - Master - Meter Gain Reduction Division' 0 0 1000
define_parameter par_tcp_master_meter_gainwid 'TCP - Master - Meter Gain Reduction Width' 38 0 1000
define_parameter par_tcp_master_meter_mode 'TCP - Master - Mode' 1 0 1
define_parameter par_tcp_master_meter_size 'TCP - Master - Meter Size' 430 0 1000
define_parameter par_tcp_master_meter_size_scale 'TCP - Master - Meter Size Scaling' 1 0 1
define_parameter par_tcp_master_meter_vol_readout 'TCP - Master - Meter Volume Readout' 1 0 1
define_parameter par_tcp_master_meter_vu_db 'TCP - Master - Meter VU dB' 1 0 1
define_parameter par_tcp_master_meter_vu_readout 'TCP - Master - Meter VU Readout' 0 0 1
define_parameter par_tcp_track_element_adj_label_margin 'TCP - Track - Element Adjustment Label Margin' 0 0 1000
define_parameter par_tcp_track_element_adj_label_size 'TCP - Track - Element Adjustment Label Size' 0 0 1000
define_parameter par_tcp_track_element_adj_size_env 'TCP - Track - Element Adjustment Envelope Size' 0 0 1
define_parameter par_tcp_track_element_adj_size_input 'TCP - Track - Element Adjustment Input Size' 240 0 1000
define_parameter par_tcp_track_element_adj_wrap_buttons 'TCP - Track - Element Adjustment Wrap Buttons' 3 0 3
define_parameter par_tcp_track_element_separator 'TCP - Track - Element Separator' 648 0 1000000
define_parameter par_tcp_track_element_vis 'TCP - Track - Element Visibility' 4094 0 1000000
define_parameter par_tcp_track_element_vis_mixer 'TCP - Track - Element Visibility Mixer' 4042 0 1000000
define_parameter par_tcp_track_fader_pan_size 'TCP - Track - Faders Pan Size' 0 0 1000
define_parameter par_tcp_track_fader_pan_size_scale 'TCP - Track - Faders Pan Size Scaling' 0 0 1
define_parameter par_tcp_track_fader_pan_vis 'TCP - Track - Faders Pan Visibility' 1 0 1
define_parameter par_tcp_track_fader_pan_vis_mixer 'TCP - Track - Faders Pan Mixer Visibility' 0 0 1
define_parameter par_tcp_track_fader_placement 'TCP - Track - Faders Placement' 0 0 3
define_parameter par_tcp_track_fader_vol_size 'TCP - Track - Faders Volume Size' 208 0 1000
define_parameter par_tcp_track_fader_vol_size_scale 'TCP - Track - Faders Volume Size Scaling' 0 0 1
define_parameter par_tcp_track_fader_vol_vis 'TCP - Track - Faders Volume Visibility' 1 0 1
define_parameter par_tcp_track_fader_vol_vis_mixer 'TCP - Track - Faders Volume Mixer Visibility' 0 0 1
define_parameter par_tcp_track_fader_wid_size 'TCP - Track - Faders Width Size' 0 0 1000
define_parameter par_tcp_track_fader_wid_size_scale 'TCP - Track - Faders Width Size Scaling' 0 0 1
define_parameter par_tcp_track_fader_wid_vis 'TCP - Track - Faders Width Visibility' 1 0 1
define_parameter par_tcp_track_fader_wid_vis_mixer 'TCP - Track - Faders Width Mixer Visibility' 0 0 1
define_parameter par_tcp_track_insert_mode 'TCP - Track - Inserts Mode' 1 0 2
define_parameter par_tcp_track_insert_size 'TCP - Track - Inserts Size' 116 0 1000
define_parameter par_tcp_track_insert_size_scale 'TCP - Track - Inserts Size Scaling' 0 0 1
define_parameter par_tcp_track_label_index_vis 'TCP - Track - Index Vsibility' 2 0 2
define_parameter par_tcp_track_label_infobox 'TCP - Track - Info Box' 0 0 1
define_parameter par_tcp_track_label_size 'TCP - Track - Size' 155 0 1000
define_parameter par_tcp_track_meter_channeldiv 'TCP - Track - Meter Channel Division' 0 0 1000
define_parameter par_tcp_track_meter_gaindiv 'TCP - Track - Meter Gain Reduction Division' 23 0 1000
define_parameter par_tcp_track_meter_gainwid 'TCP - Track - Meter Gain Reduction Width' 22 0 1000
define_parameter par_tcp_track_meter_mode 'TCP - Track - Mode' 1 0 2
define_parameter par_tcp_track_meter_size 'TCP - Track - Meter Size' 26 0 1000
define_parameter par_tcp_track_meter_size_scale 'TCP - Track - Meter Size Scaling' 0 0 1
define_parameter par_tcp_track_meter_vol_readout 'TCP - Track - Meter Volume Readout' 0 0 1
define_parameter par_tcp_track_meter_vu_db 'TCP - Track - Meter VU dB' 0 0 1
define_parameter par_tcp_track_meter_vu_readout 'TCP - Track - Meter VU Readout' 0 0 1
define_parameter par_trans_element_adj_bpm_tap 'Transport - Element Adjustments BPM Tap' 1 0 1
define_parameter par_trans_element_adj_selection_size 'Transport - Element Adjustments Selection Size' 279 0 1000
define_parameter par_trans_element_adj_selection_size_scale 'Transport - Element Adjustments Selection Size Scale' 0 0 1
define_parameter par_trans_element_adj_separator_size 'Transport - Element Adjustments Separator Size' 147 0 1000
define_parameter par_trans_element_adj_spacing_section_x 'Transport - Element Adjustments Spacing Section X' 181 0 1000
define_parameter par_trans_element_adj_spacing_time_x 'Transport - Element Adjustments Spacing Time X' 0 0 1000
define_parameter par_trans_element_adj_spacing_x 'Transport - Element Adjustments Spacing X' 0 0 1000
define_parameter par_trans_element_adj_status_size 'Transport - Element Adjustments Status Size' 295 0 1000
define_parameter par_trans_element_adj_status_size_scale 'Transport - Element Adjustments Status Size Scale' 0 0 1
define_parameter par_trans_element_adj_timebase 'Transport - Element Adjustments Timebase' 1 0 1
define_parameter par_trans_element_separator 'Transport - Element Separator' 196 0 1000000
define_parameter par_trans_element_vis 'Transport - Element Visibility' 4094 0 1000000
define_parameter par_trans_playrate_mode 'Transport - Playrate Display Mode' 2 0 2
define_parameter par_trans_playrate_size 'Transport - Playrate Fader Size' 353 0 1000
define_parameter par_trans_settings_extrapad_x 'Transport - Settings Extra Padding X' 0 0 1000
define_parameter par_trans_settings_extrapad_y 'Transport - Settings Extra Padding Y' 0 0 1000
define_parameter par_trans_settings_theme_bank 'Transport - Settings Theme Bank' 4 0 8
define_parameter par_trans_settings_theme_menu 'Transport - Settings Theme Menu' 1 0 1
define_parameter paRt_end 'paRt end' 0 0 1

;~ ~ ~ ~ ~ ~ ~ ~ ~ ~ THEME_BLOCK_CLOSE ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ 

; ====================================================================================================================================
;   # TOOLS
; ====================================================================================================================================


    ;   ## Development
    ; --------------------------------------------------------------------------------

        ; Various development overlays to highlight drawing regions.
        ; Used mainly for measuring pixels.

        ;   ### Development : Draw Overlay : TCP
        ; --------------------------------------------------------------------------------

            macro MAC_Development_Overlay_TCP SCALE WALTER_ELEMENT PARAMETER_SECTION
                custom WALTER_ELEMENT##.custom.dev_overlay              "" "" "" "" 
                custom WALTER_ELEMENT##.custom.dev_overlay_line_r       "" "" "" "" 
                set WALTER_ELEMENT##.custom.dev_overlay.color           [0 0 0 0 255 0 0 255]
                set WALTER_ELEMENT##.custom.dev_overlay_line_r.color    [0 0 0 0 0 0 255 255]
                set WALTER_ELEMENT##.custom.dev_overlay                 [0 0 WALTER_ELEMENT##.size{0} WALTER_ELEMENT##.size{1} 0 0 1 1]
                set WALTER_ELEMENT##.custom.dev_overlay_line_r          - [0 WALTER_ELEMENT##.size{1} WALTER_ELEMENT##.size{0} 1 0 1 1] [0 1 0 0 0 0 0 0]
                front WALTER_ELEMENT##.custom.dev_overlay
                front WALTER_ELEMENT##.custom.dev_overlay_line_r
            endmacro

        ;   ### Development : Draw Overlay : MCP
        ; --------------------------------------------------------------------------------

            macro MAC_Development_Overlay_MCP SCALE WALTER_ELEMENT PARAMETER_SECTION
                custom WALTER_ELEMENT##.custom.dev_overlay              "" "" "" "" 
                custom WALTER_ELEMENT##.custom.dev_overlay_line_r       "" "" "" "" 
                set WALTER_ELEMENT##.custom.dev_overlay.color           [0 0 0 0 255 0 0 255]
                set WALTER_ELEMENT##.custom.dev_overlay_line_r.color    [0 0 0 0 0 0 255 255]
                set WALTER_ELEMENT##.custom.dev_overlay                 [0 0 WALTER_ELEMENT##.size{0} WALTER_ELEMENT##.size{1} 0 0 1 1]
                set WALTER_ELEMENT##.custom.dev_overlay_line_r          - [WALTER_ELEMENT##.size{0} 0 1 WALTER_ELEMENT##.size{1} 0 0 0 1] [1 0 0 0 0 0 0 0]
                front WALTER_ELEMENT##.custom.dev_overlay
                front WALTER_ELEMENT##.custom.dev_overlay_line_r
            endmacro



    ;   ## Math
    ; --------------------------------------------------------------------------------

        ;   ### Math : Interpolate
        ; --------------------------------------------------------------------------------

            ; Interpolate between two values using a 0-1 input range.

            macro MAC_Math_Interpolate VAL_A VAL_B   FACTOR  TARGET

                set TARGET##    + VAL_A * FACTOR{0} - VAL_B VAL_A

            endmacro

        ;   ### Math : Clamp
        ; --------------------------------------------------------------------------------

            ; Clamp value between a minimum and maximum limit.

            macro MAC_Math_Cap VAL_INPUT VAL_MIN VAL_MAX

                set VAL_INPUT##                            \
                    VAL_INPUT##{0}<VAL_MIN{0} VAL_MIN{0}   \
                    VAL_INPUT##{0}>VAL_MAX{0} VAL_MAX{0}

            endmacro

        ;   ### Math : Minimal
        ; --------------------------------------------------------------------------------

            ; Pick the smallest value.

            macro MAC_Math_Min VAL_INPUT VAL_MIN

                set VAL_INPUT## VAL_INPUT##{0}<VAL_MIN{0} VAL_MIN{0}

            endmacro

        ;   ### Math : Maximum
        ; --------------------------------------------------------------------------------

            ; Pick the largest value.

            macro MAC_Math_Max VAL_INPUT VAL_MAX

                set VAL_INPUT## VAL_INPUT##{0}>VAL_MAX{0} VAL_MAX{0}

            endmacro

    ;   ## Transform
    ; --------------------------------------------------------------------------------

        ;   ### Transform : Move Element
        ; --------------------------------------------------------------------------------

            ; Move an existing element using 2D offset values.

            macro MAC_Transform_Move_Element CONDITION ELEMENT MOVE_X MOVE_Y

                set ELEMENT##                                               \
                    ?CONDITION{0}                                           \
                        + [. . . . . . . .] [MOVE_X MOVE_Y 0 0 0 0 0 0]

            endmacro


    ;   ## Draw
    ; --------------------------------------------------------------------------------

        ; Various macros for drawing generic shapes.

        ;   ### Draw : Image
        ; --------------------------------------------------------------------------------

            macro MAC_Draw_Image CONDITION SECTION NAME IMAGE_NAME POS_X POS_Y POS_W POS_H ATT_L ATT_T ATT_R ATT_B
                custom SECTION##.custom.Image_##NAME "" "" "" IMAGE_NAME

                ; [DRAW] Custom Image
                set SECTION##.custom.Image_##NAME                           \
                    ?CONDITION{0}                                           \
                        [POS_X POS_Y POS_W POS_H ATT_L ATT_T ATT_R ATT_B]

                front SECTION##.custom.Image_##NAME
            endmacro

        ;   ### Draw : Box
        ; --------------------------------------------------------------------------------

            macro MAC_Draw_Box CONDITION SECTION NAME CLR_R CLR_G CLR_B POS_X POS_Y POS_W POS_H ATT_L ATT_T ATT_R ATT_B
                custom SECTION##.custom.Box_##NAME "" "" "" ""

                ; [DRAW] Custom Box
                set SECTION##.custom.Box_##NAME                             \
                    ?CONDITION{0}                                           \
                        [POS_X POS_Y POS_W POS_H ATT_L ATT_T ATT_R ATT_B]

                ; Box Color
                set SECTION##.custom.Box_##NAME##.color [0 0 0 0 CLR_R CLR_G CLR_B 255]

                front SECTION##.custom.Box_##NAME
            endmacro

        ;   ### Draw : Frame
        ; --------------------------------------------------------------------------------

            macro MAC_Draw_Frame CONDITION SECTION NAME POS_X POS_Y POS_W POS_H ATT_L ATT_T ATT_R ATT_B
                custom SECTION##.custom.Border_##NAME "" "" "" "custom_border"

                ; [DRAW] Custom Border
                set SECTION##.custom.Border_##NAME                          \
                    ?CONDITION{0}                                           \
                        [POS_X POS_Y POS_W POS_H ATT_L ATT_T ATT_R ATT_B]

                front SECTION##.custom.Border_##NAME
            endmacro

        ;   ### Draw : Framed Box
        ; --------------------------------------------------------------------------------

            ; combination of two macros to create a box with a frame

            macro MAC_Draw_FramedBox CONDITION SECTION NAME CLR_R CLR_G CLR_B POS_X POS_Y POS_W POS_H ATT_L ATT_T ATT_R ATT_B
                MAC_Draw_Box    CONDITION SECTION NAME  CLR_R CLR_G CLR_B       POS_X POS_Y POS_W POS_H     ATT_L ATT_T ATT_R ATT_B
                MAC_Draw_Frame  CONDITION SECTION NAME                          POS_X POS_Y POS_W POS_H     ATT_L ATT_T ATT_R ATT_B
            endmacro


; ====================================================================================================================================
;   # SETUP
; ====================================================================================================================================

    ;   ## Setup
    ; --------------------------------------------------------------------------------

        macro MAC_Setup         SCALE

            ; dpi dependent constants
            MAC_SetupValues             SCALE

            ; shared track data
            MAC_Setup_Values_Tcp        SCALE
            MAC_Setup_Values_Mcp        SCALE

            ; dynamically calculated colors
            MAC_SetupColors             SCALE

        endmacro

        ;   ### Setup : Values
        ; --------------------------------------------------------------------------------

            ;   Pre-defined values covering the various scale factors.
            ;   This macro is called as soon as possible to give layout code some solid numbers to work with.
            ; 
            ;   The values are defined using pseudo-lookup tables in form of long if-else statements.
            ;
            ;   Some variables end with something like "_2".
            ;   Those are pre-multiplied variants of a variable, reducing later calculations and general code length.

            macro MAC_SetupValues      SCALE

                
                ; constant used for fake rounding
                set VAL_rounding_constant 10000000

                ;   --------------------------------------------------------------------------------------------------------
                ;      - On Pseudo-Rounding -
                ;
                ;   Applied pseudo-rounding works like this:
                ;       y = (input_value - rounding_constant) + rounding_constant
                ;
                ;   Not sure why this works. In theory it might force a truncation of values beyond the decimal point.
                ;   --------------------------------------------------------------------------------------------------------

                ; fader parameter rescaling factor (for ranges 0-1000)
                set VAL_Fader_Scale 0.001

                ; base unit
                set VAL_Unit            \
                    SCALE>2         2   \
                    SCALE>1         2   \
                                    1

                ; minimum padding
                set VAL_Pad             \
                    SCALE>=2        6   \
                    SCALE>1         4   \
                                    2

                ; border
                set VAL_Border          \
                    SCALE>=2.5      2   \
                    SCALE>=2        2   \
                                    1

                set VAL_Border_Neg          - 0     VAL_Border
                set VAL_Border_Neg_2        * -2    VAL_Border
                set VAL_Border_2            * 2     VAL_Border

                ; average button
                set VAL_Button                  \
                    SCALE>=2.5      [45 35]     \
                    SCALE>=2.25     [41 32]     \
                    SCALE>=2        [36 28]     \
                    SCALE>=1.75     [32 25]     \
                    SCALE>=1.5      [27 21]     \
                    SCALE>=1.25     [23 18]     \
                                    [18 14]

                ; info box (w / h)
                set VAL_InfoBox                     \
                    SCALE>=2.5      [125    35]     \
                    SCALE>=2.25     [113    32]     \
                    SCALE>=2        [100    28]     \
                    SCALE>=1.75     [88     24]     \
                    SCALE>=1.5      [75     21]     \
                    SCALE>=1.25     [62     18]     \
                                    [50     14]



                set VAL_Button_2            * 2     VAL_Button

                ; transport button (width / height / extended width / tempo button width)
                set VAL_Button_Trans                            \
                    SCALE>=2.5      [85     45  127     95]     \
                    SCALE>=2.25     [77     41  115     87]     \
                    SCALE>=2        [68     36  102     77]     \
                    SCALE>=1.75     [60     32  90      68]     \
                    SCALE>=1.5      [51     27  76      58]     \
                    SCALE>=1.25     [43     23  64      47]     \
                                    [34     18  51      38]

                ; folder button / icon
                set VAL_Button_Folder       \
                    SCALE>=2.5      35      \
                    SCALE>=2.25     32      \
                    SCALE>=2        28      \
                    SCALE>=1.75     24      \
                    SCALE>=1.5      21      \
                    SCALE>=1.25     17      \
                                    14

                ; large knob
                set VAL_Knob                \
                    SCALE>=2.5      45      \
                    SCALE>=2.25     41      \
                    SCALE>=2        36      \
                    SCALE>=1.75     32      \
                    SCALE>=1.5      27      \
                    SCALE>=1.25     23      \
                                    18

                ; small knob
                set VAL_Knob_s              \
                    SCALE>=2.5      35      \
                    SCALE>=2.25     32      \
                    SCALE>=2        28      \
                    SCALE>=1.75     25      \
                    SCALE>=1.5      21      \
                    SCALE>=1.25     18      \
                                    14

                ; mcp label
                set VAL_MCP_Label           \
                    SCALE>=2.5      35      \
                    SCALE>=2.25     32      \
                    SCALE>=2        28      \
                    SCALE>=1.75     24      \
                    SCALE>=1.5      21      \
                    SCALE>=1.25     18      \
                                    14

                ; tcp label
                set VAL_TCP_Label           \
                    SCALE>=2.5      35      \
                    SCALE>=2.25     32      \
                    SCALE>=2        28      \
                    SCALE>=1.75     24      \
                    SCALE>=1.5      21      \
                    SCALE>=1.25     18      \
                                    14

                ; tcp minimal height / y position offset for buttons
                set VAL_tcp_h                   \
                    SCALE>=2.5      [47 5]      \
                    SCALE>=2.25     [42 4]      \
                    SCALE>=2        [38 4]      \
                    SCALE>=1.75     [33 3]      \
                    SCALE>=1.5      [28 3]      \
                    SCALE>=1.25     [23 2]      \
                                    [19 2]

                ; envcp minimal height
                set VAL_Envcp_h VAL_tcp_h

                ; separator icon thickness
                set VAL_Separator       \
                    SCALE>=2.5      3   \
                    SCALE>=2.25     2   \
                    SCALE>=2        2   \
                    SCALE>=1.75     2   \
                    SCALE>=1.5      2   \
                    SCALE>=1.25     1   \
                                    1

                ; insert slot
                set VAL_insert_slot         \
                    SCALE>=2.5      42      \
                    SCALE>=2.25     38      \
                    SCALE>=2        34      \
                    SCALE>=1.75     31      \
                    SCALE>=1.5      26      \
                    SCALE>=1.25     21      \
                                    16

                ; track index number count
                set VAL_index_letters       \
                    ntracks>=100000     6   \
                    ntracks>=10000      5   \
                    ntracks>=1000       4   \
                    ntracks>=100        3   \
                    ntracks>=10         2   \
                                        1

                ; [MAC OS FIX]
                ; MAC gets one more letter. Greedy bastard.
                set VAL_index_letters               \
                    os_type==1                      \
                        + VAL_index_letters{0} 1

                ; [MAC OS FIX]
                ; [LINUX OS FIX]
                ; label margins
                set VAL_Margin_Label                            \
                    os_type==2                                  \
                        SCALE>=2.5      [6      -2  6   VAL_Border]     \
                        SCALE>=2.25     [5      -6  5   VAL_Border]     \
                        SCALE>=2        [4      -4  4   VAL_Border]     \
                        SCALE>=1.75     [4      -3  4   VAL_Border]     \
                        SCALE>=1.5      [3      -1  3   VAL_Border]     \
                        SCALE>=1.25     [3      -2  3   VAL_Border]     \
                                        [3      -1  3   VAL_Border]     \
                    os_type==1                                          \
                        SCALE>=2.5      [16     4   16  VAL_Border]     \
                        SCALE>=2.25     [14     4   14  VAL_Border]     \
                        SCALE>=2        [12     3   12  VAL_Border]     \
                        SCALE>=1.75     [11     5   11  VAL_Border]     \
                        SCALE>=1.5      [9      5   9   VAL_Border]     \
                        SCALE>=1.25     [8      4   8   VAL_Border]     \
                                        [6      2   6   VAL_Border]     \
                        SCALE>=2.5      [6      -4  6   VAL_Border]     \
                        SCALE>=2.25     [5      -3  5   VAL_Border]     \
                        SCALE>=2        [4      -2  4   VAL_Border]     \
                        SCALE>=1.75     [4      -2  4   VAL_Border]     \
                        SCALE>=1.5      [3      0   3   VAL_Border]     \
                        SCALE>=1.25     [3      -1  3   VAL_Border]     \
                                        [3      0   3   VAL_Border]


                ; vertical label margins
                set VAL_Margin_Label_vertical               \
                        SCALE>=2.5      [1  10  1   10  ]   \
                        SCALE>=2.25     [1  9   1   9   ]   \
                        SCALE>=2        [1  8   1   8   ]   \
                        SCALE>=1.75     [1  7   1   7   ]   \
                        SCALE>=1.5      [1  6   1   6   ]   \
                        SCALE>=1.25     [1  5   1   5   ]   \
                                        [1  4   1   4   ]

                ; transport time section label margins
                set VAL_Margin_Label_Trans_Time             \
                    SCALE>=2.5      [10     5   10  5   ]   \
                    SCALE>=2.25     [9      4   9   4   ]   \
                    SCALE>=2        [8      4   8   4   ]   \
                    SCALE>=1.75     [7      3   7   3   ]   \
                    SCALE>=1.5      [6      3   6   3   ]   \
                    SCALE>=1.25     [5      2   5   2   ]   \
                                    [4      2   4   2   ]

                ; transport status margins
                set VAL_Margin_Label_Trans_Status           \
                    SCALE>=2.5      [10     0   10  0   ]   \
                    SCALE>=2.25     [9      0   9   0   ]   \
                    SCALE>=2        [8      0   8   0   ]   \
                    SCALE>=1.75     [7      0   7   0   ]   \
                    SCALE>=1.5      [6      0   6   0   ]   \
                    SCALE>=1.25     [5      0   5   0   ]   \
                                    [4      0   4   0   

                ; transport selection margins
                set VAL_Margin_Label_Trans_Selection            \
                    SCALE>=2.5      [20     0   20      0   ]   \
                    SCALE>=2.25     [18     0   18      0   ]   \
                    SCALE>=2        [16     0   16      0   ]   \
                    SCALE>=1.75     [14     0   14      0   ]   \
                    SCALE>=1.5      [12     0   12      0   ]   \
                    SCALE>=1.25     [10     0   10      0   ]   \
                                    [8      0   8       0   ]

                ; [MAC OS FIX]
                ; [LINUX OS FIX]
                ; record input margins
                set VAL_Margin_RecInput                         \
                    os_type==2                                  \
                        SCALE>=2.5      [6      -1  6   2   ]   \
                        SCALE>=2.25     [4      -1  4   2   ]   \
                        SCALE>=2        [3      -1  3   2   ]   \
                        SCALE>=1.75     [2      1   2   1   ]   \
                        SCALE>=1.5      [2      1   2   1   ]   \
                        SCALE>=1.25     [2      1   2   1   ]   \
                                        [2      1   2   1   ]   \
                    os_type==1                                  \
                        SCALE>=2.5      [6      0   6   0   ]   \
                        SCALE>=2.25     [4      0   4   0   ]   \
                        SCALE>=2        [3      0   3   0   ]   \
                        SCALE>=1.75     [2      0   2   0   ]   \
                        SCALE>=1.5      [2      0   2   0   ]   \
                        SCALE>=1.25     [2      0   2   0   ]   \
                                        [2      0   2   0   ]   \
                        SCALE>=2.5      [6      1   6   2   ]   \
                        SCALE>=2.25     [4      1   4   2   ]   \
                        SCALE>=2        [3      1   3   2   ]   \
                        SCALE>=1.75     [2      0   2   1   ]   \
                        SCALE>=1.5      [2      0   2   1   ]   \
                        SCALE>=1.25     [2      0   2   1   ]   \
                                        [2      0   2   1   ]

                ; fader size
                ; [mcp_size mcp_offset tcp_size tcp_offset]
                set VAL_Fader                       \
                    SCALE>=2.5      [31 7 25 5]     \
                    SCALE>=2.25     [29 6 22 4]     \
                    SCALE>=2        [24 6 20 4]     \
                    SCALE>=1.75     [22 6 18 3]     \
                    SCALE>=1.5      [19 4 15 3]     \
                    SCALE>=1.25     [17 3 13 2]     \
                                    [12 3 10 2]

                ; average button
                set VAL_Button                  \
                    SCALE>=2.5      [45 35]     \
                    SCALE>=2.25     [41 32]     \
                    SCALE>=2        [36 28]     \
                    SCALE>=1.75     [32 25]     \
                    SCALE>=1.5      [27 21]     \
                    SCALE>=1.25     [23 18]     \
                                    [18 14]

                ; envcp indent symbol
                set VAL_Envcp_Symbol VAL_Button

                ; font
                set VAL_Font_Label      \
                    SCALE>=2.5      10  \
                    SCALE>=2.25     9   \
                    SCALE>=2        8   \
                    SCALE>=1.75     6   \
                    SCALE>=1.5      5   \
                    SCALE>=1.25     4   \
                                    1

                ; [MAC OS FIX]
                ; [LINUX OS FIX]
                ; font - fx
                set VAL_Font_Label_Inserts      \
                    os_type==0                  \
                        VAL_Font_Label          \
                        SCALE>=2.5      10      \
                        SCALE>=2.25     9       \
                        SCALE>=2        8       \
                        SCALE>=1.75     6       \
                        SCALE>=1.5      5       \
                        SCALE>=1.25     4       \
                                        1

                ; [MAC OS FIX]
                ; [LINUX OS FIX]
                ; larger font on non-Windows OS
                set VAL_Font_Label          \
                    os_type!=0              \
                        + VAL_Font_Label 1


                ; font - small
                set VAL_fxlist_scrollbar            \
                    SCALE>=2.5      [16     8]      \
                    SCALE>=2.25     [10     5]      \
                    SCALE>=2        [8      4]      \
                    SCALE>=1.75     [6      2]      \
                    SCALE>=1.5      [6      2]      \
                    SCALE>=1.25     [6      2]      \
                                    [4      2]



            endmacro


        ;   ### Setup : Values : TCP
        ; --------------------------------------------------------------------------------

            macro MAC_Setup_Values_Tcp   SCALE

                ; [ROUND]
                ; spacing
                set VAL_tcp_spacing_x           + VAL_rounding_constant{0} - + VAL_Pad{0} * SCALE * 0.025 par_tcp_gen_element_adj_spacing_x               VAL_rounding_constant{0}
                set VAL_tcp_spacing_y           + VAL_rounding_constant{0} - + VAL_Pad{0} * SCALE * 0.025 par_tcp_gen_element_adj_spacing_y               VAL_rounding_constant{0}
                set VAL_tcp_spacing_x_fader     + VAL_rounding_constant{0} - + VAL_Pad{0} * SCALE * 0.025 par_tcp_gen_element_adj_spacing_x_fader         VAL_rounding_constant{0}
                set VAL_tcp_spacing_y_fader     + VAL_rounding_constant{0} - + VAL_Pad{0} * SCALE * 0.025 par_tcp_gen_element_adj_spacing_y_fader         VAL_rounding_constant{0}
                set VAL_tcp_spacing_section_x   + VAL_rounding_constant{0} - + VAL_Pad{0} * SCALE * 0.025 par_tcp_gen_element_adj_spacing_section_x       VAL_rounding_constant{0}
                set VAL_tcp_spacing_section_y   + VAL_rounding_constant{0} - + VAL_Pad{0} * SCALE * 0.025 par_tcp_gen_element_adj_spacing_section_y       VAL_rounding_constant{0}
                set VAL_tcp_spacing_separator   + VAL_rounding_constant{0} - + VAL_Pad{0} * SCALE * 0.025 par_tcp_gen_element_adj_separator               VAL_rounding_constant{0}
                
                ; height detection
                set VAL_tcp_h_level     \
                    h>=VAL_tcp_h{0}     \
                        1               \
                        0

                ; [ROUND]
                ; volume readout size
                set VAL_tcp_vol_readout_w   + VAL_rounding_constant{0} - * SCALE 40 VAL_rounding_constant{0}

                ; minimal width values
                set VAL_tcp_inserts_min_w           * SCALE 20
                set VAL_tcp_meter_min_w             * SCALE 6
                set VAL_tcp_fader_min_w             * SCALE 10
                set VAL_tcp_label_min_w             * SCALE 50
                set VAL_tcp_label_min_w_infobar     + VAL_tcp_label_min_w + VAL_Pad{0} VAL_InfoBox{0}


            endmacro

        ;   ### Setup : Values : MCP
        ; --------------------------------------------------------------------------------

            macro MAC_Setup_Values_Mcp SCALE

                ; [ROUND]
                ; spacing
                set VAL_mcp_spacing_x           + VAL_rounding_constant{0} - + VAL_Pad{0} * SCALE * 0.025 par_mcp_gen_element_adj_spacing_x             VAL_rounding_constant{0}
                set VAL_mcp_spacing_y           + VAL_rounding_constant{0} - + VAL_Pad{0} * SCALE * 0.025 par_mcp_gen_element_adj_spacing_y             VAL_rounding_constant{0}
                set VAL_mcp_spacing_fader_x     + VAL_rounding_constant{0} - + VAL_Pad{0} * SCALE * 0.025 par_mcp_gen_element_adj_spacing_fader_x       VAL_rounding_constant{0}
                set VAL_mcp_spacing_fader_y     + VAL_rounding_constant{0} - + VAL_Pad{0} * SCALE * 0.025 par_mcp_gen_element_adj_spacing_fader_y       VAL_rounding_constant{0}
                set VAL_mcp_spacing_section_x   + VAL_rounding_constant{0} - + VAL_Pad{0} * SCALE * 0.025 par_mcp_gen_element_adj_spacing_section_x     VAL_rounding_constant{0}
                set VAL_mcp_spacing_section_y   + VAL_rounding_constant{0} - + VAL_Pad{0} * SCALE * 0.025 par_mcp_gen_element_adj_spacing_section_y     VAL_rounding_constant{0}
                set VAL_mcp_spacing_separator   + VAL_rounding_constant{0} - + VAL_Pad{0} * SCALE * 0.025 par_mcp_gen_element_adj_separator             VAL_rounding_constant{0}

                ; [ROUND]
                ; minimal height values
                set VAL_mcp_inserts_min_h   + VAL_rounding_constant{0} - * SCALE 30     VAL_rounding_constant{0}
                set VAL_mcp_meter_min_h     + VAL_rounding_constant{0} - * SCALE 10     VAL_rounding_constant{0}
                set VAL_mcp_fader_min_h     + VAL_rounding_constant{0} - * SCALE 30     VAL_rounding_constant{0}
                set VAL_mcp_fader_min_h_2   + * 2 VAL_mcp_fader_min_h{0} VAL_mcp_spacing_fader_y{0}

                ; button section width
                set VAL_mcp_w_button_slim   + VAL_Unit{0}       VAL_Button{0}
                set VAL_mcp_w_button_wide   + VAL_Unit{0} + * 2 VAL_Button{0}       VAL_mcp_spacing_x{0}
                set VAL_mcp_w_button_large  + VAL_Unit{0} + * 4 VAL_Button{0} * 3   VAL_mcp_spacing_x{0}

                ; minimal fader height before hiding
                set VAL_mcp_vol_h_min_show  + VAL_Knob{0} VAL_Pad{0}

                ; minimal fader height for forced knob layout
                set VAL_mcp_vol_h_min_knob  + VAL_mcp_vol_h_min_show{0} * SCALE 24

            endmacro

        ;   ### Setup : Colors
        ; --------------------------------------------------------------------------------

            macro MAC_SetupColors   SCALE

                ;   ::: Theme Specific Colors :::

;THEMEBUILDER_INSERT_COLORS
;~ ~ ~ ~ ~ ~ ~ ~ ~ ~ THEME_BLOCK ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ 

set THEME_color_track_neutral               [112 210 173]
set THEME_color_track_frame                 [40 40 40]
set THEME_color_tcp_empty_space             [214 214 214]
set THEME_color_mcp_empty_space             [214 214 214]
set THEME_color_track_bg                    [190 190 190]
set THEME_color_track_label_bg              [160 160 160]
set THEME_color_track_label_text            [10 10 10]
set THEME_color_envcp_bg                    THEME_color_track_bg
set THEME_color_envcp_label_bg              THEME_color_track_label_bg
set THEME_color_envcp_label_text            THEME_color_track_label_text
set THEME_color_select_bar                  [107 107 107 0 245 245 245 0]
set THEME_color_colorbar_offset             [50 50 50 0]
set THEME_color_icon_bg                     [190 190 190 0 195 195 195 0]
set THEME_color_master_icon_bg              [135 135 135 0 140 140 140 0]
set THEME_color_meter_text                  [125 125 125 0]
set THEME_color_meter_shadow                [1 1 1 0]
set THEME_color_meter_readout               [255 255 255]
set THEME_color_button_text_off             [255 255 255]
set THEME_color_button_text_on              [30 30 30]
set THEME_color_button_bg_off               [131 131 131]
set THEME_color_readout_font                [1 1 1]
set THEME_color_red                         [234 154 154]
set THEME_color_infobox_text                [50 50 50]
;~ ~ ~ ~ ~ ~ ~ ~ ~ ~ THEME_BLOCK_CLOSE ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ 

                ;   ::: Folder Tree Analysis :::

                set VAL_folder_depth_factor / folderdepth maxfolderdepth

                ;   ::: Tint Factors :::

                ; track bg
                set VAL_color_track_bg_tint_factor                                                          \
                    !track_selected                                                                         \
                        * 0.0005 par_colors_track_track_bg_tint                                             \
                        * 0.0005 + par_colors_track_track_bg_tint  par_colors_track_track_bg_select_tint

                ; track bg folder modulation
                set VAL_color_track_bg_tint_factor                                                                      \
                    folderstate>0                                                                                       \
                        + VAL_color_track_bg_tint_factor{0} + -0.5 * 0.001 par_colors_track_folder_foldertrack_tint

                ; track bg folder tree modulation
                set VAL_color_track_bg_tint_factor                                                                                                                      \
                    ?maxfolderdepth                                                                                                                                     \
                        par_colors_track_folder_foldertree_tint==500                                                                                                    \
                            .                                                                                                                                           \
                        par_colors_track_folder_foldertree_tint<500                                                                                                     \
                            * VAL_color_track_bg_tint_factor{0} - 1 * VAL_folder_depth_factor{0}            * 0.002 - 500    par_colors_track_folder_foldertree_tint    \
                            * VAL_color_track_bg_tint_factor{0} - 1 * - 1 VAL_folder_depth_factor{0} + -1   * 0.002          par_colors_track_folder_foldertree_tint

                ; track label bg
                set VAL_color_track_label_bg_tint_factor                                                                \
                    !track_selected                                                                                     \
                        * 0.0005      par_colors_track_track_label_bg_tint                                              \
                        * 0.0005 +    par_colors_track_track_label_bg_tint par_colors_track_track_label_select_tint

                ; envcp bg
                set VAL_color_envcp_bg_tint_factor                                                              \
                    !env_selected                                                                               \
                        * 0.0005      par_colors_track_envcp_bg_tint                                            \
                        * 0.0005 +    par_colors_track_envcp_bg_tint par_colors_track_track_bg_select_tint

                ; envcp label bg
                set VAL_color_envcp_label_bg_tint_factor                                                                \
                    !env_selected                                                                                       \
                        * 0.0005      par_colors_track_envcp_label_bg_tint                                              \
                        * 0.0005 +    par_colors_track_envcp_label_bg_tint par_colors_track_track_label_select_tint

                ;   ::: Tint Factor Limiting :::

                MAC_Math_Cap    VAL_color_track_bg_tint_factor          0 1
                MAC_Math_Cap    VAL_color_track_label_bg_tint_factor    0 1
                MAC_Math_Cap    VAL_color_envcp_bg_tint_factor          0 1
                MAC_Math_Cap    VAL_color_envcp_label_bg_tint_factor    0 1

                ;   ::: Base Colors :::
                set VAL_color_track_bg_base             THEME_color_track_bg
                set VAL_color_track_label_bg_base       THEME_color_track_label_bg
                set VAL_color_envcp_bg_base             THEME_color_envcp_bg
                set VAL_color_envcp_label_bg_base       THEME_color_envcp_label_bg

                ; track bg
                set VAL_color_track_bg_tinted                       \
                    ?trackcolor_valid                               \
                        [trackcolor_r trackcolor_g trackcolor_b]    \
                        THEME_color_track_neutral

                ; track label bg
                set VAL_color_track_label_bg_tinted                 \
                    ?trackcolor_valid                               \
                        [trackcolor_r trackcolor_g trackcolor_b]    \
                        THEME_color_track_neutral

                ; envcp bg
                set VAL_color_envcp_bg_tinted                       \
                    ?trackcolor_valid                               \
                        [trackcolor_r trackcolor_g trackcolor_b]    \
                        THEME_color_track_neutral

                ; envcp label bg
                set VAL_color_envcp_label_bg_tinted                 \
                    ?trackcolor_valid                               \
                        [trackcolor_r trackcolor_g trackcolor_b]    \
                        THEME_color_track_neutral

                ;   ::: Tint Crossfading :::

                MAC_Math_Interpolate     VAL_color_track_bg_base         VAL_color_track_bg_tinted           VAL_color_track_bg_tint_factor          VAL_Color_Track_Bg
                MAC_Math_Interpolate     VAL_color_track_label_bg_base   VAL_color_track_label_bg_tinted     VAL_color_track_label_bg_tint_factor    VAL_Color_Track_Label_Bg
                MAC_Math_Interpolate     VAL_color_envcp_bg_base         VAL_color_envcp_bg_tinted           VAL_color_envcp_bg_tint_factor          VAL_Color_Envcp_Bg
                MAC_Math_Interpolate     VAL_color_envcp_label_bg_base   VAL_color_envcp_label_bg_tinted     VAL_color_envcp_label_bg_tint_factor    VAL_Color_Envcp_label_Bg

                ;   ::: Tone Adjustments :::

                ; track bg
                set VAL_Color_Track_Bg                                                                                                          \
                    !track_selected                                                                                                             \
                        + VAL_Color_Track_Bg + -62.5 * 0.125     par_colors_track_track_bg_tone                                                 \
                        + VAL_Color_Track_Bg + -62.5 * 0.125 +   par_colors_track_track_bg_tone * 0.5 par_colors_track_track_bg_select_tone

                ; track bg folder state modulation
                set VAL_Color_Track_Bg                                                                      \
                    folderstate>0                                                                           \
                        par_colors_track_folder_foldertrack_tone!=500                                       \
                            + VAL_Color_Track_BG + -62.5 * 0.125 par_colors_track_folder_foldertrack_tone

                ; track bg folder tree modulation
                set VAL_Color_Track_Bg                                                                                                                                  \
                    ?maxfolderdepth                                                                                                                                     \
                        par_colors_track_folder_foldertree_tone==500                                                                                                    \
                            .                                                                                                                                           \
                        par_colors_track_folder_foldertree_tone<500                                                                                                     \
                            * VAL_Color_Track_Bg - 1 * VAL_folder_depth_factor{0}           * VAL_Fader_Scale{0} - 500      par_colors_track_folder_foldertree_tone     \
                            * VAL_Color_Track_Bg - 1 * - 1 VAL_folder_depth_factor{0} + -1  + 0.5 * VAL_Fader_Scale{0}      par_colors_track_folder_foldertree_tone

                ; track label bg
                set VAL_Color_Track_Label_Bg                                                                                                                        \
                    !track_selected                                                                                                                                 \
                        + VAL_Color_Track_Label_Bg + -62.5 * 0.125       par_colors_track_track_label_bg_tone                                                       \
                        + VAL_Color_Track_Label_Bg + -62.5 * 0.125 +     par_colors_track_track_label_bg_tone * 0.5 par_colors_track_track_label_select_tone

                ; track label text
                set VAL_Color_Track_Label_Text                                                                                                                                          \
                    !track_selected                                                                                                                                                     \
                        + [1 1 1 0 0 0 0 0] + THEME_color_track_label_text + -255 * 0.512   par_colors_track_track_label_text_tone                                                      \
                        + [1 1 1 0 0 0 0 0] + THEME_color_track_label_text + -255 * 0.512 + par_colors_track_track_label_text_tone * 0.25 par_colors_track_track_label_select_tone

                MAC_Math_Min VAL_Color_Track_Label_Text 1

                ; track tcp index
                set VAL_Color_Track_Index_TCP                                                                                                                                               \
                    !track_selected                                                                                                                                                         \
                        + [1 1 1 0 0 0 0 0] + THEME_color_track_label_text + -255 * 0.512 par_colors_track_track_index_tone_tcp                                                             \
                        par_tcp_track_label_index_vis==1                                                                                                                                    \
                            + [1 1 1 0 0 0 0 0] + THEME_color_track_label_text  + -255 * 0.512 + par_colors_track_track_index_tone_tcp  * 0.1   par_colors_track_track_label_select_tone    \
                            + [1 1 1 0 0 0 0 0] + THEME_color_track_label_text  + -255 * 0.512 + par_colors_track_track_index_tone_tcp  * 0.15  par_colors_track_track_bg_select_tone

                MAC_Math_Min VAL_Color_Track_Index_TCP 1

                ; track mcp index
                set VAL_Color_Track_Index_MCP                                                                                                                                                   \
                    !track_selected                                                                                                                                                             \
                        + [1 1 1 0 0 0 0 0] + THEME_color_track_label_text      + -255 * 0.512    par_colors_track_track_index_tone_mcp                                                         \
                        par_mcp_track_settings_label_index==1                                                                                                                                   \
                            + [1 1 1 0 0 0 0 0] + THEME_color_track_label_text  + -255 * 0.512 +  par_colors_track_track_index_tone_mcp * 0.1   par_colors_track_track_label_select_tone        \
                            + [1 1 1 0 0 0 0 0] + THEME_color_track_label_text  + -255 * 0.512 +  par_colors_track_track_index_tone_mcp * 0.15  par_colors_track_track_bg_select_tone

                MAC_Math_Min VAL_Color_Track_Index_MCP 1

                ; envcp bg
                set VAL_Color_Envcp_Bg                                                                                                          \
                    !env_selected                                                                                                               \
                        + VAL_Color_Envcp_Bg + -62.5 * 0.125     par_colors_track_envcp_bg_tone                                                 \
                        + VAL_Color_Envcp_Bg + -62.5 * 0.125 +   par_colors_track_envcp_bg_tone * 0.5 par_colors_track_track_bg_select_tone

                ; envcp label bg
                set VAL_Color_Envcp_Label_Bg                                                                                                            \
                    !env_selected                                                                                                                       \
                        + VAL_Color_Envcp_Label_Bg + -62.5 * 0.125       par_colors_track_envcp_label_bg_tone                                           \
                        + VAL_Color_Envcp_Label_Bg + -62.5 * 0.125 +     par_colors_track_envcp_label_bg_tone par_colors_track_track_label_select_tone


                ; envcp label text
                set VAL_Color_Envcp_Label_Text                                                                                                                                                  \
                    !env_selected                                                                                                                                                               \
                        + [1 1 1 0 0 0 0 0] + THEME_color_envcp_label_text + -255 * 0.512   par_colors_track_envcp_label_text_tone                                                              \
                        + [1 1 1 0 0 0 0 0] + THEME_color_envcp_label_text + -255 * 0.512 + par_colors_track_envcp_label_text_tone * 0.15 par_colors_track_track_label_select_tone

                ; envcp readout
                set VAL_Color_Envcp_Readout                                                                                                                                                     \
                    !env_selected                                                                                                                                                               \
                        + [1 1 1 0 0 0 0 0] + THEME_color_envcp_label_text + -255 * 0.512   par_colors_track_envcp_label_readout_tone                                                           \
                        par_tcp_envcp_label_readout_placement!=2                                                                                                                                \
                            + [1 1 1 0 0 0 0 0] + THEME_color_envcp_label_text + -255 * 0.512 + par_colors_track_envcp_label_readout_tone * 0.15 par_colors_track_track_label_select_tone       \
                            + [1 1 1 0 0 0 0 0] + THEME_color_envcp_label_text + -255 * 0.512 + par_colors_track_envcp_label_readout_tone * 0.1 par_colors_track_track_bg_select_tone

                MAC_Math_Min VAL_Color_Envcp_Readout 1

                ;   ::: Highlights :::

                ; adjustable intensity
                set VAL_colorbar_tint_plus * 0.0003  par_colors_track_track_colorbar_intensity
                set VAL_colorbar_tone_plus * 0.0003  par_colors_track_track_colorbar_intensity
                set VAL_colorbar_tone_lift * 0.025   par_colors_track_track_colorbar_intensity

                ; increment base tint factor
                set VAL_colorbar_tint_factor_off    + VAL_colorbar_tint_plus 0.7
                set VAL_colorbar_tint_factor_on     + VAL_colorbar_tint_plus 0.4

                ; tcp colobar tint factor
                set VAL_colobar_tint_factor_tcp         \
                    ?track_selected                     \
                        VAL_colorbar_tint_factor_on     \
                        VAL_colorbar_tint_factor_off

                ; envcp colobar tint factor
                set VAL_colobar_tint_factor_env         \
                    ?env_selected                       \
                        VAL_colorbar_tint_factor_on     \
                        VAL_colorbar_tint_factor_off

                ; calculate colorbar tint
                MAC_Math_Interpolate     VAL_color_track_bg_base   VAL_color_track_bg_tinted     VAL_colobar_tint_factor_tcp    VAL_colorbar_tcp
                MAC_Math_Interpolate     VAL_color_track_bg_base   VAL_color_track_bg_tinted     VAL_colobar_tint_factor_env    VAL_colorbar_env

                ; final colorbar values
                set VAL_colorbar_on     + [THEME_color_colorbar_offset{0} THEME_color_colorbar_offset{1} THEME_color_colorbar_offset{2} 0] + [VAL_colorbar_tone_lift VAL_colorbar_tone_lift VAL_colorbar_tone_lift] * VAL_colorbar_tcp + VAL_colorbar_tone_plus 0.9
                set VAL_colorbar_off    + [THEME_color_colorbar_offset{0} THEME_color_colorbar_offset{1} THEME_color_colorbar_offset{2} 0] + [VAL_colorbar_tone_lift VAL_colorbar_tone_lift VAL_colorbar_tone_lift] * VAL_colorbar_tcp + VAL_colorbar_tone_plus 0.5

                ; color bar (track)
                set VAL_color_colorbar      \
                    ?track_selected         \
                        VAL_colorbar_on     \
                        VAL_colorbar_off

                ; color bar (envcp)
                set VAL_color_colorbar_envcp    \
                    ?track_selected             \
                        VAL_colorbar_on         \
                        VAL_colorbar_off

                ; selection bar
                set VAL_color_selectbar                                                                     \
                    ?track_selected                                                                         \
                        [THEME_color_select_bar{4} THEME_color_select_bar{5} THEME_color_select_bar{6}]     \
                        [THEME_color_select_bar{0} THEME_color_select_bar{1} THEME_color_select_bar{2}]

                ; selection frame
                set VAL_color_selection_frame_tint    *   VAL_Fader_Scale{0}    par_colors_track_track_selectionframe_tint
                set VAL_color_selection_frame_tone    *   VAL_Fader_Scale{0}    par_colors_track_track_selectionframe_tone
                
                MAC_Math_Interpolate     THEME_color_track_frame            VAL_color_track_bg_tinted           VAL_color_selection_frame_tint          VAL_color_selection_frame
                MAC_Math_Interpolate     VAL_color_selection_frame          255                                 VAL_color_selection_frame_tone          VAL_color_selection_frame
                
                ; selection bar (envcp)
                set VAL_color_selectbar_envcp                                                               \
                    ?env_selected                                                                           \
                        [THEME_color_select_bar{4} THEME_color_select_bar{5} THEME_color_select_bar{6}]     \
                        [THEME_color_select_bar{0} THEME_color_select_bar{1} THEME_color_select_bar{2}]

                ;   ::: Icons :::

                ; icon bg
                set VAL_color_envcp_iconbg                                                          \
                    ?env_selected                                                                   \
                        [THEME_color_icon_bg{4} THEME_color_icon_bg{5} THEME_color_icon_bg{6}]      \
                        [THEME_color_icon_bg{0} THEME_color_icon_bg{1} THEME_color_icon_bg{2}]

                ; master icon background
                set VAL_color_master_icon                                                                               \
                    ?track_selected                                                                                     \
                        [THEME_color_master_icon_bg{4} THEME_color_master_icon_bg{5} THEME_color_master_icon_bg{6}]     \
                        [THEME_color_master_icon_bg{0} THEME_color_master_icon_bg{1} THEME_color_master_icon_bg{2}]

                ;   ::: Meter :::

                ; tone
                set VAL_Color_Meter_Text_Lit            + [1 1 1 0] + THEME_color_meter_text + -127.5 * 0.255 par_colors_track_meter_text_tone_lit
                set VAL_Color_Meter_Text_Unlit          + [1 1 1 0] + THEME_color_meter_text + -127.5 * 0.255 par_colors_track_meter_text_tone_unlit

                ; readout colors
                set VAL_Color_Meter_Text_Readout        * THEME_color_meter_readout             * VAL_Fader_Scale{0} par_colors_track_meter_text_tone_readout
                set VAL_Color_Meter_Text_Readout_Clip   * THEME_color_meter_readout             * VAL_Fader_Scale{0} par_colors_track_meter_text_tone_readout_clip

                ; alpha value compensation:
                ;   There’s a strange difference in how alpha levels are interpreted between master and non-master tracks.
                ;   For now this is compensated by simply offsetting the alpha value depending on the track context.

                ; [MASTER]
                set VAL_meter_alpha_compensation_tcp    \
                    !trackidx                           \
                        0                               \
                        -50

                ; [MASTER]
                set VAL_meter_alpha_compensation_mcp    \
                    !trackidx                           \
                        0                               \
                        -50

                ; alpha values
                set VAL_Color_Meter_Alpha_TCP_NEUTRAL     * 0.255     par_colors_track_meter_text_alpha_tcp
                set VAL_Color_Meter_Alpha_TCP           + * 0.255     par_colors_track_meter_text_alpha_tcp VAL_meter_alpha_compensation_tcp{0}
                set VAL_Color_Meter_Alpha_MCP_NEUTRAL     * 0.255     par_colors_track_meter_text_alpha_mcp
                set VAL_Color_Meter_Alpha_MCP           + * 0.255     par_colors_track_meter_text_alpha_mcp VAL_meter_alpha_compensation_mcp{0}
                
                ; keep alpha values above 0 (will be treated as 255 by Reaper)
                set VAL_Color_Meter_Alpha_TCP               VAL_Color_Meter_Alpha_TCP{0}<1              1
                set VAL_Color_Meter_Alpha_MCP               VAL_Color_Meter_Alpha_MCP{0}<1              1
                set VAL_Color_Meter_Alpha_TCP_NEUTRAL       VAL_Color_Meter_Alpha_TCP_NEUTRAL{0}<1      1
                set VAL_Color_Meter_Alpha_MCP_NEUTRAL       VAL_Color_Meter_Alpha_MCP_NEUTRAL{0}<1      1

                ; shadow
                set VAL_Color_Meter_Shadow_Lit_TCP      *   / VAL_Color_Meter_Alpha_TCP{0}      255     *   0.255 par_colors_track_meter_text_shadow_lit
                set VAL_Color_Meter_Shadow_Unlit_TCP    *   / VAL_Color_Meter_Alpha_TCP{0}      255     *   0.255 par_colors_track_meter_text_shadow_unlit

                set VAL_Color_Meter_Shadow_Lit_MCP      *   / VAL_Color_Meter_Alpha_MCP{0}      255     *   0.255 par_colors_track_meter_text_shadow_lit
                set VAL_Color_Meter_Shadow_Unlit_MCP    *   / VAL_Color_Meter_Alpha_MCP{0}      255     *   0.255 par_colors_track_meter_text_shadow_unlit

                ; meter values - TCP
                set VAL_meter_tcp_lit_top           [VAL_Color_Meter_Text_Lit{0}        VAL_Color_Meter_Text_Lit{1}     VAL_Color_Meter_Text_Lit{2}     VAL_Color_Meter_Alpha_TCP{0}            0 0 0 VAL_Color_Meter_Shadow_Lit_TCP{0}]
                set VAL_meter_tcp_lit_bottom        [VAL_Color_Meter_Text_Lit{0}        VAL_Color_Meter_Text_Lit{1}     VAL_Color_Meter_Text_Lit{2}     VAL_Color_Meter_Alpha_TCP{0}            0 0 0 VAL_Color_Meter_Shadow_Lit_TCP{0}]
                set VAL_meter_tcp_unlit_top         [VAL_Color_Meter_Text_Unlit{0}      VAL_Color_Meter_Text_Unlit{1}   VAL_Color_Meter_Text_Unlit{2}   VAL_Color_Meter_Alpha_TCP{0}            0 0 0 VAL_Color_Meter_Shadow_Unlit_TCP{0}]
                set VAL_meter_tcp_unlit_bottom      [VAL_Color_Meter_Text_Unlit{0}      VAL_Color_Meter_Text_Unlit{1}   VAL_Color_Meter_Text_Unlit{2}   VAL_Color_Meter_Alpha_TCP{0}            0 0 0 VAL_Color_Meter_Shadow_Unlit_TCP{0}]
                set VAL_meter_tcp_readout           [VAL_Color_Meter_Text_Readout{0}    VAL_Color_Meter_Text_Readout{1} VAL_Color_Meter_Text_Readout{2} VAL_Color_Meter_Alpha_TCP_NEUTRAL{0}    VAL_Color_Meter_Text_Readout_Clip{0} VAL_Color_Meter_Text_Readout_Clip{1} VAL_Color_Meter_Text_Readout_Clip{2} VAL_Color_Meter_Alpha_TCP_NEUTRAL{0}]

                ; meter values - MCP
                set VAL_meter_mcp_lit_top           [VAL_Color_Meter_Text_Lit{0}        VAL_Color_Meter_Text_Lit{1}     VAL_Color_Meter_Text_Lit{2}     VAL_Color_Meter_Alpha_MCP{0}            0 0 0 VAL_Color_Meter_Shadow_Lit_MCP{0}]
                set VAL_meter_mcp_lit_bottom        [VAL_Color_Meter_Text_Lit{0}        VAL_Color_Meter_Text_Lit{1}     VAL_Color_Meter_Text_Lit{2}     VAL_Color_Meter_Alpha_MCP{0}            0 0 0 VAL_Color_Meter_Shadow_Lit_MCP{0}]
                set VAL_meter_mcp_unlit_top         [VAL_Color_Meter_Text_Unlit{0}      VAL_Color_Meter_Text_Unlit{1}   VAL_Color_Meter_Text_Unlit{2}   VAL_Color_Meter_Alpha_MCP{0}            0 0 0 VAL_Color_Meter_Shadow_Unlit_MCP{0}]
                set VAL_meter_mcp_unlit_bottom      [VAL_Color_Meter_Text_Unlit{0}      VAL_Color_Meter_Text_Unlit{1}   VAL_Color_Meter_Text_Unlit{2}   VAL_Color_Meter_Alpha_MCP{0}            0 0 0 VAL_Color_Meter_Shadow_Unlit_MCP{0}]
                set VAL_meter_mcp_readout           [VAL_Color_Meter_Text_Readout{0}    VAL_Color_Meter_Text_Readout{1} VAL_Color_Meter_Text_Readout{2} VAL_Color_Meter_Alpha_MCP_NEUTRAL{0}    VAL_Color_Meter_Text_Readout_Clip{0} VAL_Color_Meter_Text_Readout_Clip{1} VAL_Color_Meter_Text_Readout_Clip{2} VAL_Color_Meter_Alpha_MCP_NEUTRAL{0}]

            endmacro

; ====================================================================================================================================
;   # TRANSPORT
; ====================================================================================================================================

    ;   ## Draw : Transport : Draw
    ; --------------------------------------------------------------------------------

        macro MAC_DrawTransport     SCALE

            clear trans.*
            MAC_DrawTransport_Setup             SCALE   "trans" "trans"
            MAC_DrawTransport_Buttons           SCALE   "trans" "trans"
            MAC_DrawTransport_Playrate          SCALE   "trans" "trans"
            MAC_DrawTransport_Status            SCALE   "trans" "trans"
            MAC_DrawTransport_Selection         SCALE   "trans" "trans"
            MAC_DrawTransport_Size              SCALE   "trans" "trans"
            MAC_DrawTransport_PlaceElements     SCALE   "trans" "trans"
            MAC_DrawTransport_BankButtons       SCALE   "trans" "trans"
            MAC_DrawTransport_Font              SCALE   "trans" "trans"

        endmacro

    ;   ## Draw : Transport : Setup
    ; --------------------------------------------------------------------------------

        macro MAC_DrawTransport_Setup SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; custom elements
            custom WALTER_ELEMENT##.custom.themeadj     "" "_RS6cc1a19365fa0f5b0b1ad6d3d9018dc41f087917"    ""      "transport_custom_part_menu"
            custom WALTER_ELEMENT##.custom.bank_0       "" "_RS5ec6b0de2cf6300ec9658d65a17084bc7fd2664b"    ""      "transport_custom_bank_1_off"
            custom WALTER_ELEMENT##.custom.bank_1       "" "_RSfe1f33421e15d187e9477275688c3a0014dd0058"    ""      "transport_custom_bank_2_off"
            custom WALTER_ELEMENT##.custom.bank_2       "" "_RSeedb490eeeb50844c14d7cb2a53e0ceb8310ff79"    ""      "transport_custom_bank_3_off"
            custom WALTER_ELEMENT##.custom.bank_3       "" "_RSe796c2366e5ce1c3ad67e2550144cf678a8c958e"    ""      "transport_custom_bank_4_off"
            custom WALTER_ELEMENT##.custom.bank_4       "" "_RS98afe25766eaacc423ca3043e99d9274094880eb"    ""      "transport_custom_bank_5_off"
            custom WALTER_ELEMENT##.custom.bank_5       "" "_RS626f30c953f61e76ac530fc00d675cb12c875ad0"    ""      "transport_custom_bank_6_off"
            custom WALTER_ELEMENT##.custom.bank_6       "" "_RSab500c3c7adf7d1d514d28ba63b513ec20db5820"    ""      "transport_custom_bank_7_off"
            custom WALTER_ELEMENT##.custom.bank_7       "" "_RSb8071798d8eae6232100e3d1a56cb5ce8123895f"    ""      "transport_custom_bank_8_off"
            custom WALTER_ELEMENT##.custom.bank_0_on    "" ""                                               ""      "transport_custom_bank_1_on"
            custom WALTER_ELEMENT##.custom.bank_1_on    "" ""                                               ""      "transport_custom_bank_2_on"
            custom WALTER_ELEMENT##.custom.bank_2_on    "" ""                                               ""      "transport_custom_bank_3_on"
            custom WALTER_ELEMENT##.custom.bank_3_on    "" ""                                               ""      "transport_custom_bank_4_on"
            custom WALTER_ELEMENT##.custom.bank_4_on    "" ""                                               ""      "transport_custom_bank_5_on"
            custom WALTER_ELEMENT##.custom.bank_5_on    "" ""                                               ""      "transport_custom_bank_6_on"
            custom WALTER_ELEMENT##.custom.bank_6_on    "" ""                                               ""      "transport_custom_bank_7_on"
            custom WALTER_ELEMENT##.custom.bank_7_on    "" ""                                               ""      "transport_custom_bank_8_on"
            custom WALTER_ELEMENT##.custom.bank_logo    "" ""                                               ""      "transport_custom_bank_part"
            custom WALTER_ELEMENT##.custom.bank_bg      "" ""                                               ""      "transport_group_bg"
            custom WALTER_ELEMENT##.custom.time_bg      "" ""                                               ""      "transport_group_bg"
            custom WALTER_ELEMENT##.custom.rate_bg      "" ""                                               ""      "transport_group_bg"
            custom WALTER_ELEMENT##.custom.bpm_bg       "" ""                                               ""      "transport_custom_bpm"

            ; width
            set VAL_trans_w 600

            ; [ROUND]
            ; extra padding
            set VAL_trans_extrapad_x + VAL_rounding_constant{0} - * SCALE * 0.05 par_##PARAMETER_SECTION##_settings_extrapad_x       VAL_rounding_constant{0}
            set VAL_trans_extrapad_y + VAL_rounding_constant{0} - * SCALE * 0.05 par_##PARAMETER_SECTION##_settings_extrapad_y       VAL_rounding_constant{0}

            ; [ROUND]
            ; spacing
            set VAL_trans_spacing_x                 + VAL_rounding_constant{0} - + VAL_Pad{0} * SCALE * 0.025 par_##PARAMETER_SECTION##_element_adj_spacing_x           VAL_rounding_constant{0}
            set VAL_trans_spacing_time_x            + VAL_rounding_constant{0} - + VAL_Pad{0} * SCALE * 0.025 par_##PARAMETER_SECTION##_element_adj_spacing_time_x      VAL_rounding_constant{0}
            set VAL_trans_spacing_section_x         + VAL_rounding_constant{0} - + VAL_Pad{0} * SCALE * 0.04 par_##PARAMETER_SECTION##_element_adj_spacing_section_x    VAL_rounding_constant{0}
            set VAL_trans_spacing_separator         + VAL_rounding_constant{0} - + VAL_Pad{0} * SCALE * 0.04 par_##PARAMETER_SECTION##_element_adj_separator_size       VAL_rounding_constant{0}

            ; top position
            set VAL_trans_y_top + VAL_pad VAL_trans_extrapad_y{0}

            ; leftmost position
            set VAL_trans_x_leftmost + VAL_Pad VAL_trans_extrapad_x{0}

            ; rightmost position
            set VAL_trans_x_rightmost - VAL_trans_w + VAL_Pad{0} VAL_trans_extrapad_x{0}

            ; element hiding flag
            set VAL_trans_hide_buttons 0

            ; paRt shortcuts
            set VAL_trans_show_part_section + par_trans_settings_theme_bank par_trans_settings_theme_menu

            ; bank buttons section width
            set VAL_trans_w_bank_section                                                                        \
                !VAL_trans_show_part_section{0}                                                                 \
                    0                                                                                           \
                    + + VAL_Button_Trans{0} VAL_Pad{0}                                                          \
                        + * VAL_Button_Trans{1} + par_trans_settings_theme_bank par_trans_settings_theme_menu   \
                        * VAL_Pad{0} - + par_trans_settings_theme_bank par_trans_settings_theme_menu 1

            ; right edge padding
            set VAL_trans_x_rightmost_padding - VAL_trans_w{0} - VAL_trans_x_rightmost{0} VAL_trans_w_bank_section{0}

            ; hiding x position
            set VAL_trans_hide_x - w + VAL_trans_x_rightmost_padding{0} * SCALE 10


        endmacro

    ;   ## Draw : Transport : Buttons
    ; --------------------------------------------------------------------------------

        macro MAC_DrawTransport_Buttons SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; y position
            set CUR_y VAL_trans_y_top

            ; x position
            set CUR_x VAL_trans_x_leftmost

            ; preparation
            set VAL_trans_button_count 0
            set VAL_trans_button_group_count 0
            set VAL_trans_button_section_count 0

            set CUR_w VAL_Button_Trans{0}
            set CUR_h VAL_Button_Trans{1}

            ; rewind / forward
            MAC_DrawTransport_Buttons_SingleButton          SCALE 2 1 "trans" "trans" "rew"
            MAC_DrawTransport_Buttons_SingleButton          SCALE 4 1 "trans" "trans" "fwd"

            ; pause / stop / play
            set VAL_trans_button_group_count 0
            MAC_DrawTransport_Buttons_SingleButton          SCALE 8 1 "trans" "trans" "stop"
            MAC_DrawTransport_Buttons_SingleButton          SCALE 16 1 "trans" "trans" "pause"
            MAC_DrawTransport_Buttons_SingleButton          SCALE 32 1 "trans" "trans" "play"

            ; record
            set VAL_trans_button_group_count 0
            MAC_DrawTransport_Buttons_SingleButton          SCALE 64 1 "trans" "trans" "rec"

            ; repeat
            set VAL_trans_button_group_count 0
            MAC_DrawTransport_Buttons_SingleButton          SCALE 128 1 "trans" "trans" "repeat"

            set CUR_w VAL_Button_Trans{2}

            ; automation
            set VAL_trans_button_group_count 0
            MAC_DrawTransport_Buttons_SingleButton          SCALE 256 0 "trans" "trans" "automode"

            ; bpm / timebase / playrate
            set VAL_trans_button_section_count 0
            set VAL_trans_button_group_count 0
            MAC_DrawTransport_Buttons_Bpm                   SCALE 512 "trans" "trans"

        endmacro

        ;  ### Draw : Transport : Buttons : Single Button
        ; --------------------------------------------------------------------------------

            macro MAC_DrawTransport_Buttons_SingleButton SCALE INDEX HAS_SEPARATOR WALTER_ELEMENT PARAMETER_SECTION ELEMENT

                ; detect separator setting
                set trans_##ELEMENT##_separator                         \
                    par_##PARAMETER_SECTION##_element_separator&INDEX   \
                        1                                               \
                        0

                ; hiding logic
                set CUR_x_target                                                                        \
                    ?trans_##ELEMENT##_separator{0}                                                     \
                        + CUR_x{0} + CUR_w{0} + VAL_trans_spacing_x{0} VAL_trans_spacing_separator{0}   \
                        + CUR_x{0} + CUR_w{0} VAL_trans_spacing_x{0}

                
                set VAL_trans_hide_buttons                  \
                    CUR_x_target{0}>VAL_trans_hide_x{0}     \
                        1

                ; visibility
                set VAL_trans_show_##ELEMENT                            \
                    ?VAL_trans_hide_buttons{0}                          \
                        0                                               \
                        par_##PARAMETER_SECTION##_element_vis&INDEX     \
                            1                                           \
                            0

                ; button offset
                set CUR_x                                   \
                    ?VAL_trans_show_##ELEMENT##{0}          \
                        + CUR_x{0} VAL_trans_spacing_x{0}

                ; [DRAW] Button
                set DRAW_trans_##ELEMENT                    \
                    ?VAL_trans_show_##ELEMENT##{0}          \
                        [CUR_x CUR_y CUR_w CUR_h 0 0 0 0]   \
                        0

                ; group count
                set VAL_trans_button_group_count                \
                    ?VAL_trans_show_##ELEMENT##{0}              \
                        + VAL_trans_button_group_count{0} 1

                ; button count
                set VAL_trans_button_count          +  VAL_trans_show_##ELEMENT##{0}
                set VAL_trans_button_group_count    +  VAL_trans_show_##ELEMENT##{0}
                set VAL_trans_button_section_count  +  VAL_trans_show_##ELEMENT##{0}

                ; increment x position
                set CUR_x                                                               \
                    ?VAL_trans_show_##ELEMENT##{0}                                      \
                        ?trans_##ELEMENT##_separator{0}                                 \
                            ?HAS_SEPARATOR                                              \
                                + CUR_x{0} + CUR_w{0} VAL_trans_spacing_separator{0}    \
                                + CUR_x{0} CUR_w{0}                                     \
                            + CUR_x{0} CUR_w{0}

            endmacro

        ;  ### Draw : Transport : Buttons : Bpm
        ; --------------------------------------------------------------------------------

            macro MAC_DrawTransport_Buttons_Bpm SCALE INDEX WALTER_ELEMENT PARAMETER_SECTION

                ; side padding value
                set VAL_trans_timepad * 5 VAL_Unit{0}

                ; section offset
                set CUR_x                                               \
                    ?VAL_trans_button_count{0}                          \
                        !VAL_trans_button_section_count{0}              \
                            + CUR_x{0} VAL_trans_spacing_section_x{0}

                ; bpm visibility
                set VAL_trans_show_bpm                              \
                    par_##PARAMETER_SECTION##_element_vis&INDEX     \
                        1                                           \
                        0

                ; timesignature visibility
                set VAL_trans_show_timesig      \
                    ?VAL_trans_show_bpm{0}      \
                        trans_flags&4           \
                            1                   \
                            0                   \
                        0

                ; timebase visibility
                set VAL_trans_show_timebase  * VAL_trans_show_bpm{0} par_##PARAMETER_SECTION##_element_adj_timebase
                
                ; tap visibility
                set VAL_trans_show_bpm_tap  * VAL_trans_show_bpm{0} par_##PARAMETER_SECTION##_element_adj_bpm_tap
                

                ; elements width
                set CUR_w_bpm_text  * VAL_trans_show_bpm{0}         VAL_Button_Trans{3}
                set CUR_w_edit      * VAL_trans_show_bpm{0}         * SCALE 64
                set CUR_w_tap       * VAL_trans_show_bpm_tap{0}     VAL_Button_Trans{2}
                set CUR_w_timesig   * VAL_trans_show_timesig{0}     * SCALE 64
                set CUR_w_timebase  * VAL_trans_show_timebase{0}    VAL_Button_Trans{3}
                
                ; section width
                set CUR_w_section                                                                               \
                     + * 2 VAL_trans_timepad{0}                                                                 \
                     + * VAL_trans_show_bpm_tap{0}  VAL_trans_spacing_time_x{0}                                 \
                     + * VAL_trans_show_timesig{0}  VAL_trans_spacing_time_x{0}                                 \
                     + * VAL_trans_show_timebase{0} VAL_trans_spacing_time_x{0}                                 \
                     + CUR_w_bpm_text{0} + CUR_w_edit{0} + CUR_w_tap{0} + CUR_w_timesig{0} CUR_w_timebase{0}

                ; hiding logic
                set CUR_x_target + CUR_x{0} CUR_w_section{0}

                set VAL_trans_hide_buttons                      \
                    ?VAL_trans_show_bpm{0}                      \
                        CUR_x_target{0}>VAL_trans_hide_x{0}     \
                        1

                ; hide overwrite
                set VAL_trans_show_bpm          ?VAL_trans_hide_buttons{0}      0
                set VAL_trans_show_timesig      ?VAL_trans_hide_buttons{0}      0
                set VAL_trans_show_bpm_tap      ?VAL_trans_hide_buttons{0}      0

                ; [DRAW] Background
                set DRAW_trans_time_bg                                  \
                    ?VAL_trans_show_bpm{0}                              \
                        [CUR_x CUR_y CUR_w_section{0} CUR_h 0 0 0 0]    \
                        0

                ; increment x position
                set CUR_x                                   \
                    ?VAL_trans_show_bpm{0}                  \
                        + CUR_x{0} VAL_trans_timepad{0}
                
                ; [DRAW] BPM Text
                set DRAW_trans_time_bpm_text                                \
                    ?VAL_trans_show_bpm{0}                                  \
                        [CUR_x CUR_y VAL_Button_Trans{3} CUR_h 0 0 0 0]     \
                        0

                ; increment x position
                set CUR_x                                           \
                    ?VAL_trans_show_bpm{0}                          \
                        + CUR_x{0} VAL_Button_Trans{3}

                ; [DRAW] BPM Tap Button
                set DRAW_trans_time_bpm_tap                         \
                    ?VAL_trans_show_bpm{0}                          \
                        [CUR_x CUR_y CUR_w_tap CUR_h 0 0 0 0]       \
                        0

                ; increment x position
                set CUR_x + * VAL_trans_show_bpm_tap{0} + CUR_w_tap{0} VAL_trans_spacing_time_x{0}


                ; [DRAW] BPM Edit Field
                set DRAW_trans_time_bpm_edit                        \
                    ?VAL_trans_show_bpm{0}                          \
                        [CUR_x CUR_y CUR_w_edit CUR_h 0 0 0 0]      \
                        0

                ; increment x position
                set CUR_x + * VAL_trans_show_bpm{0} CUR_w_edit{0}

                ; add x spacing before time signature
                set CUR_x + * VAL_trans_show_timesig{0} VAL_trans_spacing_time_x{0}

                ; [DRAW] Time Signature
                set DRAW_trans_time_timesig                                 \
                    ?VAL_trans_show_bpm{0}                                  \
                        ?VAL_trans_show_timesig{0}                          \
                            [CUR_x CUR_y CUR_w_timesig CUR_h 0 0 0 0]       \
                            0                                               \
                        0

                ; increment x position
                set CUR_x                                                           \
                    ?VAL_trans_show_timesig{0}                                      \
                        + CUR_x{0} + CUR_w_timesig{0} VAL_trans_spacing_time_x{0}

                
                ; [DRAW] Timebase
                set DRAW_trans_timebase                                         \
                    ?VAL_trans_show_bpm{0}                                      \
                        ?VAL_trans_show_timebase{0}                             \
                            [CUR_x CUR_y VAL_Button_Trans{3} CUR_h 0 0 0 0]     \
                            0                                                   \
                        0

                ; add x spacing after timebase playrate
                set CUR_x                                       \
                    ?VAL_trans_show_bpm{0}                      \
                        ?VAL_trans_show_timebase{0}             \
                            + CUR_x{0} VAL_Button_Trans{3}

                ; post-section spacing
                set CUR_x + CUR_x{0} * VAL_trans_show_bpm{0} + VAL_trans_timepad{0} VAL_trans_spacing_section_x{0}

            endmacro

    ;   ## Draw : Transport : Playrate
    ; --------------------------------------------------------------------------------

        macro MAC_DrawTransport_Playrate SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; playrate visibility
            set VAL_trans_show_playrate     \
                trans_flags&2               \
                    1                       \
                    0
            ; width
            set CUR_w_rate      * VAL_trans_show_playrate{0}    * SCALE 95

            ; playrate fader size
            set CUR_w_rate_fader                                        \
                ?VAL_trans_show_playrate{0}                             \
                    par_trans_playrate_mode==0                          \
                        0                                               \
                    par_trans_playrate_mode==1                          \
                        VAL_button_trans{1}                             \
                    par_trans_playrate_mode==2                          \
                        * SCALE + 20 * 0.2 par_trans_playrate_size      \
                        0                                               \
                    0
            
            ; section width
            set CUR_w_section + * 2 VAL_trans_timepad{0} + CUR_w_rate{0} CUR_w_rate_fader{0}

            ; hiding logic
            set CUR_x_target + CUR_x{0} CUR_w_section{0}

            set VAL_trans_hide_buttons                      \
                ?VAL_trans_show_playrate{0}                 \
                    CUR_x_target{0}>VAL_trans_hide_x{0}     \
                    1

            ; hide overwrite
            set VAL_trans_show_playrate      ?VAL_trans_hide_buttons{0}      0

            ; [DRAW] Background
            set DRAW_trans_rate_bg                                      \
                ?VAL_trans_show_playrate{0}                             \
                    !VAL_trans_hide_buttons{0}                          \
                        [CUR_x CUR_y CUR_w_section{0} CUR_h 0 0 0 0]    \
                        0                                               \
                    0

            ; initial x position
            set CUR_x                                   \
                ?VAL_trans_show_playrate{0}             \
                    + CUR_x{0} VAL_trans_timepad{0}

            ; [DRAW] Playrate
            set DRAW_trans_time_rate                                \
                    ?VAL_trans_show_playrate{0}                     \
                        [CUR_x CUR_y CUR_w_rate CUR_h 0 0 0 0]      \
                        0

            ; increment x position
            set CUR_x                           \
                ?VAL_trans_show_playrate{0}     \
                    + CUR_x{0} CUR_w_rate{0}

            ; playrate fader knob mode
            set WALTER_ELEMENT##.rate.fader.fadermode           \
                par_##PARAMETER_SECTION##_playrate_mode==1      \
                    1                                           \
                par_##PARAMETER_SECTION##_playrate_mode==2      \
                    -1

            ; fader height
            set CUR_h_fader                                     \
                par_##PARAMETER_SECTION##_playrate_mode==2      \
                    * VAL_Button{1} 0.5                         \
                    VAL_Button_Trans{1}

            ; fader y position
            set CUR_y_fader                                         \
                par_##PARAMETER_SECTION##_playrate_mode==2          \
                    + CUR_y{0} * 0.5 - CUR_h{0} CUR_h_fader{0}      \
                    VAL_trans_y_top

            ; [DRAW] Playrate Fader
            set DRAW_trans_time_rate_fader                                              \
                ?VAL_trans_show_playrate{0}                                             \
                    ?par_##PARAMETER_SECTION##_playrate_mode                            \
                        [CUR_x CUR_y_fader CUR_w_rate_fader CUR_h_fader 0 0 0 0]        \
                        0                                                               \
                    0

            ; element counter
            set VAL_trans_button_section_count  +   VAL_trans_button_section_count{0}      VAL_trans_show_bpm{0}
            set VAL_trans_button_group_count    +   VAL_trans_button_group_count{0}        VAL_trans_show_bpm{0}
            set VAL_trans_button_count          +   VAL_trans_button_count{0}              VAL_trans_show_bpm{0}

            ; increment x position post rate-fader
            set CUR_x                                                                   \
                ?par_##PARAMETER_SECTION##_playrate_mode                                \
                    + CUR_x{0} * VAL_trans_show_playrate{0} CUR_w_rate_fader{0}

            ; post-section spacing
            set CUR_x                                                                   \
                ?VAL_trans_show_playrate{0}                                             \
                    + CUR_x{0} + VAL_trans_timepad{0} VAL_trans_spacing_section_x{0}

        endmacro

    ;   ## Draw : Transport : Status
    ; --------------------------------------------------------------------------------

        macro MAC_DrawTransport_Status SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; width
            set VAL_remaining_w - w + CUR_x VAL_trans_x_rightmost_padding

            set CUR_w                                                                                       \
                ?par_trans_element_adj_status_size_scale                                                    \
                    * VAL_remaining_w{0}    * VAL_Fader_Scale{0}      par_trans_element_adj_status_size     \
                    * SCALE                 * 3 + 20  * 0.15  par_trans_element_adj_status_size

            ; hiding logic
            set CUR_x_target + CUR_x{0} CUR_w{0}

            set VAL_trans_hide_buttons                  \
                CUR_x_target{0}>VAL_trans_hide_x{0}     \
                    1

            ; visibility
            set VAL_trans_show_status                           \
                ?VAL_trans_hide_buttons{0}                      \
                    0                                           \
                par_##PARAMETER_SECTION##_element_vis&1024      \
                    1                                           \
                    0

            ; [DRAW] Status
            set DRAW_trans_status                           \
                ?VAL_trans_show_status{0}                   \
                    [CUR_x CUR_y CUR_w CUR_h 0 0 0 0]       \
                    0

            ; section count
            set VAL_trans_button_section_count + VAL_trans_button_section_count{0} VAL_trans_show_status{0}

            ; increment x position
            set CUR_x + CUR_x{0} * VAL_trans_show_status{0} + CUR_w{0} VAL_trans_spacing_section_x{0}

        endmacro

    ;   ## Draw : Transport : Selection
    ; --------------------------------------------------------------------------------

        macro MAC_DrawTransport_Selection SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; width
            set VAL_remaining_w - w + CUR_x{0} VAL_trans_x_rightmost_padding{0}

            set CUR_w                                                                                       \
                ?par_trans_element_adj_selection_size_scale                                                 \
                    * VAL_remaining_w{0}    * VAL_Fader_Scale{0}      par_trans_element_adj_selection_size  \
                    * SCALE                 * 3 + 75  * 0.175  par_trans_element_adj_selection_size

            ; hiding logic
            set CUR_x_target + CUR_x{0} CUR_w{0}

            set VAL_trans_hide_buttons                  \
                CUR_x_target{0}>VAL_trans_hide_x{0}     \
                    1

            ; visibility
            set VAL_trans_show_selection                        \
                ?VAL_trans_hide_buttons{0}                      \
                    0                                           \
                par_##PARAMETER_SECTION##_element_vis&2048      \
                    1                                           \
                    0

            ; target x position
            set CUR_x_target + CUR_x{0} CUR_w{0}

            ; [DRAW] Status
            set DRAW_trans_selection                        \
                ?VAL_trans_show_selection{0}                \
                    [CUR_x CUR_y CUR_w CUR_h 0 0 0 0]       \
                    0

            ; increment x position
            set CUR_x + CUR_x{0} * VAL_trans_show_selection{0} CUR_w{0}

        endmacro

    ;   ## Draw : Transport : Size
    ; --------------------------------------------------------------------------------

        macro MAC_DrawTransport_Size SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; store x end position
            set VAL_trans_w_content - CUR_x{0} VAL_trans_x_leftmost{0}

            ; height
            set VAL_trans_h + CUR_y{0} + CUR_h{0} + VAL_trans_extrapad_y{0} VAL_Pad{0}

            ; minimal width
            set VAL_trans_w_min * SCALE 100
            set VAL_trans_w_max * SCALE 1920

            ; transport size
            set WALTER_ELEMENT##.size [VAL_trans_w VAL_trans_h]
            set WALTER_ELEMENT##.size.dockedheight [VAL_trans_h]
            set WALTER_ELEMENT##.size.minmax [VAL_trans_w_min VAL_trans_h VAL_trans_w_max VAL_trans_h]

        endmacro

    ;   ## Draw : Transport : Place Elements
    ; --------------------------------------------------------------------------------

        ;   Transport elements aren't drawn immediately, instead their coordinates are pre-calculated and then
        ;   used in combination with offset values for the final drawing process.
        ;
        ;   This makes the optional centering of the entire transport section way easier.

        macro MAC_DrawTransport_PlaceElements SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; x position offset (optional centering)
            set VAL_x_offset * trans_center - * 0.5 - w + VAL_trans_w_content{0} VAL_trans_w_bank_section{0} VAL_trans_extrapad_x{0}

            ; transport buttons
            MAC_DrawTransport_PlaceElements_Draw SCALE WALTER_ELEMENT PARAMETER_SECTION "rew"               "rew"               VAL_x_offset
            MAC_DrawTransport_PlaceElements_Draw SCALE WALTER_ELEMENT PARAMETER_SECTION "fwd"               "fwd"               VAL_x_offset
            MAC_DrawTransport_PlaceElements_Draw SCALE WALTER_ELEMENT PARAMETER_SECTION "stop"              "stop"              VAL_x_offset
            MAC_DrawTransport_PlaceElements_Draw SCALE WALTER_ELEMENT PARAMETER_SECTION "pause"             "pause"             VAL_x_offset
            MAC_DrawTransport_PlaceElements_Draw SCALE WALTER_ELEMENT PARAMETER_SECTION "play"              "play"              VAL_x_offset
            MAC_DrawTransport_PlaceElements_Draw SCALE WALTER_ELEMENT PARAMETER_SECTION "rec"               "rec"               VAL_x_offset
            MAC_DrawTransport_PlaceElements_Draw SCALE WALTER_ELEMENT PARAMETER_SECTION "repeat"            "repeat"            VAL_x_offset
            MAC_DrawTransport_PlaceElements_Draw SCALE WALTER_ELEMENT PARAMETER_SECTION "automode"          "automode"          VAL_x_offset

            ; time settings
            MAC_DrawTransport_PlaceElements_Draw SCALE WALTER_ELEMENT PARAMETER_SECTION "time_bg"           "custom.time_bg"    VAL_x_offset
            MAC_DrawTransport_PlaceElements_Draw SCALE WALTER_ELEMENT PARAMETER_SECTION "rate_bg"           "custom.rate_bg"    VAL_x_offset
            MAC_DrawTransport_PlaceElements_Draw SCALE WALTER_ELEMENT PARAMETER_SECTION "time_bpm_text"     "custom.bpm_bg"     VAL_x_offset
            MAC_DrawTransport_PlaceElements_Draw SCALE WALTER_ELEMENT PARAMETER_SECTION "time_bpm_edit"     "bpm.edit"          VAL_x_offset
            MAC_DrawTransport_PlaceElements_Draw SCALE WALTER_ELEMENT PARAMETER_SECTION "time_bpm_tap"      "bpm.tap"           VAL_x_offset
            MAC_DrawTransport_PlaceElements_Draw SCALE WALTER_ELEMENT PARAMETER_SECTION "time_timesig"      "curtimesig"        VAL_x_offset
            MAC_DrawTransport_PlaceElements_Draw SCALE WALTER_ELEMENT PARAMETER_SECTION "timebase"          "timebase"          VAL_x_offset
            MAC_DrawTransport_PlaceElements_Draw SCALE WALTER_ELEMENT PARAMETER_SECTION "time_rate"         "rate"              VAL_x_offset
            MAC_DrawTransport_PlaceElements_Draw SCALE WALTER_ELEMENT PARAMETER_SECTION "time_rate_fader"   "rate.fader"        VAL_x_offset
            MAC_DrawTransport_PlaceElements_Draw SCALE WALTER_ELEMENT PARAMETER_SECTION "rew"               "rew"               VAL_x_offset

            ; status / selection
            MAC_DrawTransport_PlaceElements_Draw SCALE WALTER_ELEMENT PARAMETER_SECTION "status"            "status"            VAL_x_offset
            MAC_DrawTransport_PlaceElements_Draw SCALE WALTER_ELEMENT PARAMETER_SECTION "selection"         "sel"               VAL_x_offset

        endmacro

        ;   ### Draw : Transport : Place Elements : Draw
        ; --------------------------------------------------------------------------------

            macro MAC_DrawTransport_PlaceElements_Draw SCALE WALTER_ELEMENT PARAMETER_SECTION VAR_NAME TARGET_ELEMENT X_OFFSET
                set WALTER_ELEMENT##.##TARGET_ELEMENT + DRAW_trans_##VAR_NAME [X_OFFSET 0 0 0 0 0 0 0]
                front WALTER_ELEMENT##.##TARGET_ELEMENT
            endmacro

        ;   ### Draw : Transport : Bank Buttons
        ; --------------------------------------------------------------------------------

            macro MAC_DrawTransport_BankButtons SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; dimensions
                set CUR_w VAL_Button_Trans{1}
                set CUR_h VAL_Button_Trans{1}

                ; x position
                set CUR_x - trans.size{0} + VAL_trans_w_bank_section{0} * SCALE 6

                ; background
                set WALTER_ELEMENT##.custom.bank_bg                                 \
                    ?VAL_trans_show_part_section{0}                                 \
                        [CUR_x CUR_y VAL_trans_w_bank_section{0} CUR_h 1 0 1 0]     \
                        0

                ; logo
                set WALTER_ELEMENT##.custom.bank_logo                       \
                    ?VAL_trans_show_part_section{0}                         \
                        [CUR_x CUR_y VAL_Button_Trans{0} CUR_h 1 0 1 0]     \
                        0

                ; z order
                front WALTER_ELEMENT##.custom.bank_bg
                front WALTER_ELEMENT##.custom.bank_logo

                ; increment x position
                set CUR_x + CUR_x + VAL_Button_Trans{0} VAL_Pad{0}

                ; bank buttons
                MAC_DrawTransport_BankButtons_SingleButton  SCALE WALTER_ELEMENT PARAMETER_SECTION  1 "0" 2
                MAC_DrawTransport_BankButtons_SingleButton  SCALE WALTER_ELEMENT PARAMETER_SECTION  2 "1" 3
                MAC_DrawTransport_BankButtons_SingleButton  SCALE WALTER_ELEMENT PARAMETER_SECTION  3 "2" 4
                MAC_DrawTransport_BankButtons_SingleButton  SCALE WALTER_ELEMENT PARAMETER_SECTION  4 "3" 5
                MAC_DrawTransport_BankButtons_SingleButton  SCALE WALTER_ELEMENT PARAMETER_SECTION  5 "4" 6
                MAC_DrawTransport_BankButtons_SingleButton  SCALE WALTER_ELEMENT PARAMETER_SECTION  6 "5" 7
                MAC_DrawTransport_BankButtons_SingleButton  SCALE WALTER_ELEMENT PARAMETER_SECTION  7 "6" 8
                MAC_DrawTransport_BankButtons_SingleButton  SCALE WALTER_ELEMENT PARAMETER_SECTION  8 "7" 9

                ; theme adjuster icon
                set WALTER_ELEMENT##.custom.themeadj        \
                    ?par_trans_settings_theme_menu          \
                        [CUR_x CUR_y CUR_w CUR_h 1 0 1 0]   \
                        0

                front WALTER_ELEMENT##.custom.themeadj

            endmacro

            ;   #### Draw : Transport : Bank Buttons : Single Button
            ; --------------------------------------------------------------------------------

                macro MAC_DrawTransport_BankButtons_SingleButton SCALE WALTER_ELEMENT PARAMETER_SECTION THRESHOLD INDEX BANK_INDEX

                    ; off button
                    set WALTER_ELEMENT##.custom.bank_##INDEX        \
                        par_trans_settings_theme_bank>=THRESHOLD  \
                            par_bank_selected!=BANK_INDEX           \
                                [CUR_x CUR_y CUR_w CUR_h 1 0 1 0]

                    ; on button
                    set WALTER_ELEMENT##.custom.bank_##INDEX##_on   \
                        par_trans_settings_theme_bank>=THRESHOLD  \
                            par_bank_selected==BANK_INDEX           \
                                [CUR_x CUR_y CUR_w CUR_h 1 0 1 0]

                    ; z order
                    front WALTER_ELEMENT##.custom.bank_##INDEX
                    front WALTER_ELEMENT##.custom.bank_##INDEX##_on

                    ; increment x position
                    set CUR_x                                       \
                        par_trans_settings_theme_bank>=THRESHOLD    \
                            + CUR_x{0} + CUR_w{0} VAL_Pad{0}

                endmacro

        ;   ### Draw : Transport : Font
        ; --------------------------------------------------------------------------------

            macro MAC_DrawTransport_Font SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; bpm tap
                set WALTER_ELEMENT##.bpm.tap.font       VAL_Font_Label
                set WALTER_ELEMENT##.bpm.tap.margin     [VAL_Margin_Label_Trans_Time{0} VAL_Margin_Label_Trans_Time{1} VAL_Margin_Label_Trans_Time{2} VAL_Margin_Label_Trans_Time{3}]

                ; bpm edit
                set WALTER_ELEMENT##.bpm.edit.font      VAL_Font_Label
                set WALTER_ELEMENT##.bpm.edit.margin    [VAL_Margin_Label_Trans_Time{0} VAL_Margin_Label_Trans_Time{1} VAL_Margin_Label_Trans_Time{2} VAL_Margin_Label_Trans_Time{3} 0.5]

                ; time signature
                set WALTER_ELEMENT##.curtimesig.font    VAL_Font_Label

                ; playrate
                set WALTER_ELEMENT##.rate.font          VAL_Font_Label
                set WALTER_ELEMENT##.rate.margin        [VAL_Margin_Label_Trans_Time{0} VAL_Margin_Label_Trans_Time{1} VAL_Margin_Label_Trans_Time{2} VAL_Margin_Label_Trans_Time{3} 0.5]

                ; status
                set WALTER_ELEMENT##.status.margin      [VAL_Margin_Label_Trans_Status{0} VAL_Margin_Label_Trans_Status{1} VAL_Margin_Label_Trans_Status{2} VAL_Margin_Label_Trans_Status{3}]

                ; selection
                set WALTER_ELEMENT##.sel.margin         [VAL_Margin_Label_Trans_Selection{0} VAL_Margin_Label_Trans_Selection{1} VAL_Margin_Label_Trans_Selection{2} VAL_Margin_Label_Trans_Selection{3}]
                set WALTER_ELEMENT##.sel.font           VAL_Font_Label


            endmacro


; ====================================================================================================================================
;   # MCP
; ====================================================================================================================================

    ;   ## Draw : MCP : Draw
    ; --------------------------------------------------------------------------------

        macro MAC_DrawMcp SCALE

            ; track
            clear mcp.*
            MAC_DrawMcp_Setup_Track             SCALE   "mcp"   "track"
            MAC_DrawMcp_Label_Track             SCALE   "mcp"   "track"
            MAC_DrawMcp_Inserts                 SCALE   "mcp"   "track"
            MAC_DrawMcp_Buttons_Track           SCALE   "mcp"   "track"
            MAC_DrawMcp_Meter_Top               SCALE   "mcp"   "track"
            MAC_DrawMcp_Faders_Top	            SCALE   "mcp"   "track"
            MAC_DrawMcp_Meter_Bottom            SCALE   "mcp"   "track"
            MAC_DrawMcp_Meter_Format_Track      SCALE   "mcp"   "track"
            MAC_DrawMcp_Faders_Bottom           SCALE   "mcp"   "track"
            MAC_DrawMcp_Size                    SCALE   "mcp"   "track"
            MAC_DrawMcp_Folder                  SCALE   "mcp"   "track"
            MAC_DrawMcp_Font_Track              SCALE   "mcp"   "track"
            MAC_DrawMcp_Finish                  SCALE   "mcp"   "track"

            ; master
            clear master.mcp.*
            MAC_DrawMcp_Setup_Master            SCALE   "master.mcp"   "master"
            MAC_DrawMcp_Label_Master            SCALE   "master.mcp"   "master"
            MAC_DrawMcp_Inserts                 SCALE   "master.mcp"   "master"
            MAC_DrawMcp_PostInsert_Master       SCALE   "master.mcp"   "master"
            MAC_DrawMcp_Buttons_Master          SCALE   "master.mcp"   "master"
            MAC_DrawMcp_Meter_Top               SCALE   "master.mcp"   "master"
            MAC_DrawMcp_Faders_Top	            SCALE   "master.mcp"   "master"
            MAC_DrawMcp_Meter_Bottom            SCALE   "master.mcp"   "master"
            MAC_DrawMcp_Meter_Format_Master     SCALE   "master.mcp"   "master"
            MAC_DrawMcp_Faders_Bottom           SCALE   "master.mcp"   "master"
            MAC_DrawMcp_Size                    SCALE   "master.mcp"   "master"
            MAC_DrawMcp_Font_Master             SCALE   "master.mcp"   "master"
            MAC_DrawMcp_Finish                  SCALE   "master.mcp"   "master"

            ; [DEV] Development Overlay
            ;MAC_Development_Overlay_MCP         SCALE   "mcp"           "track"
            ;MAC_Development_Overlay_MCP         SCALE   "master.mcp"    "master"

        endmacro


    ;   ## Draw : MCP : Setup
    ; --------------------------------------------------------------------------------

        ;   The MCP layout does a full pre-calculation of its final width
        ;   before anything gets drawn.
        ;
        ;   This avoids elements constantly reacting to each other’s sizes.
        ;   Instead, they all use the total MCP width as their main anchor and
        ;   rely on pre-calculated values from this section.

        ;   ### Draw : MCP : Setup : Shared Code : Open
        ; --------------------------------------------------------------------------------

            macro MAC_DrawMcp_Setup_SharedCode_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; custom elements
                custom WALTER_ELEMENT##.custom.inserts_bg       "" "" "" "track_custom_insert_bg"
                custom WALTER_ELEMENT##.custom.meter_frame      "" "" "" "meter_custom_border"
                custom WALTER_ELEMENT##.custom.vol_frame        "" "" "" "track_custom_fader_frame"
                custom WALTER_ELEMENT##.custom.pan_frame        "" "" "" "track_custom_fader_frame"
                custom WALTER_ELEMENT##.custom.wid_frame        "" "" "" "track_custom_fader_frame"
                custom WALTER_ELEMENT##.custom.vol_knob_frame   "" "" "" "track_custom_knob_l_border"
                custom WALTER_ELEMENT##.custom.pan_knob_frame   "" "" "" "track_custom_knob_l_border"
                custom WALTER_ELEMENT##.custom.wid_knob_frame   "" "" "" "track_custom_knob_l_border"
                custom WALTER_ELEMENT##.custom.readout_bg       "" "" "" "meter_custom_readout_bg_vert"
                custom WALTER_ELEMENT##.custom.index_bg         "" "" "" "track_custom_idx_bg"
                custom WALTER_ELEMENT##.custom.env_icon         "" "" "" "track_custom_env_icon"

                ; visibility of the selection frame in track
                set VAL_show_selection_frame                \
                    ?par_mcp_gen_highlight_selectionframe   \
                        ?track_selected                     \
                            1                               \
                            0                               \
                        0

                ; hide flag
                set VAL_mcp_hide_rest 0

                ; volume readout height
                set VAL_mcp_vol_readout_h                                   \
                    par_mcp_##PARAMETER_SECTION##_meter_vol_readout{0}==1   \
                        * SCALE 14                                          \
                    par_mcp_##PARAMETER_SECTION##_meter_vol_readout{0}==2   \
                        * SCALE 34                                          \
                        0

                ; additional element padding
                set VAL_mcp_insert_padding  par_mcp_##PARAMETER_SECTION##_insert_pad
                set VAL_mcp_meter_padding   par_mcp_##PARAMETER_SECTION##_meter_padding

                ; button elements width pre-calculations
                MAC_DrawMcp_Setup_Faders    SCALE WALTER_ELEMENT PARAMETER_SECTION
                MAC_DrawMcp_Setup_Meter     SCALE WALTER_ELEMENT PARAMETER_SECTION
                
                set VAL_mcp_precalc_w_buttons                               \
                    par_mcp_##PARAMETER_SECTION##_element_vis{0}==0         \
                        VAL_mcp_w_button_slim{0}                            \
                        par_mcp_##PARAMETER_SECTION##_element_width{0}==2   \
                            VAL_mcp_w_button_large{0}                       \
                        par_mcp_##PARAMETER_SECTION##_element_width{0}==1   \
                            VAL_mcp_w_button_wide{0}                        \
                            VAL_mcp_w_button_slim{0}                         


                ; initialize pre-calculated width
                set VAL_mcp_precalc_w 0

                ; -> update mcp width if it has increased
                set VAL_mcp_precalc_w                                       \
                    VAL_mcp_precalc_w{0}<VAL_mcp_precalc_w_buttons{0}       \
                        VAL_mcp_precalc_w_buttons{0}

                ; [ROUND]
                ; top fader width extension
                set VAL_mcp_precalc_w_faders_top                                                                                                                                                \
                    par_mcp_##PARAMETER_SECTION##_fader_layout{0}!=0                                                                                                                            \
                        0                                                                                                                                                                       \
                        + VAL_rounding_constant{0} - + + * 2 VAL_Knob{0} VAL_mcp_spacing_fader_x{0} * SCALE * 0.1 par_mcp_##PARAMETER_SECTION##_fader_pan_width     VAL_rounding_constant{0}

                set VAL_mcp_precalc_w_faders_top_full                       \
                    par_mcp_##PARAMETER_SECTION##_fader_layout{0}==0        \
                        + VAL_mcp_precalc_w_faders_top{0} * 2 VAL_Unit{0}   \
                        0

                ; -> update mcp width if it has increased
                set VAL_mcp_precalc_w                                               \
                    par_mcp_##PARAMETER_SECTION##_fader_layout{0}==0                \
                        VAL_mcp_precalc_w{0}<VAL_mcp_precalc_w_faders_top_full{0}   \
                            VAL_mcp_precalc_w_faders_top_full{0}

                ; bottom section width
                set VAL_mcp_precalc_w_bottom                                                \
                    par_mcp_##PARAMETER_SECTION##_fader_layout{0}==2                        \
                        +   VAL_Unit{0}   +   VAL_mcp_spacing_fader_x{0} * 2 VAL_Button{0}   \
                    par_mcp_##PARAMETER_SECTION##_fader_layout{0}==1                        \
                        +   VAL_Unit{0}       VAL_Knob{0}                                   \
                    +       VAL_Unit{0} VAL_Knob{0}

                set VAL_Mcp_precalc_w_bottom                                                                            \
                    par_mcp_##PARAMETER_SECTION##_meter_pos{0}==2                                                       \
                        + VAL_Mcp_precalc_w_bottom{0} + VAL_mcp_spacing_section_x{0} VAL_mcp_meter_bottom_w_precalc{0}

                set VAL_Mcp_precalc_w_bottom_nobuttons VAL_Mcp_precalc_w_bottom{0}

                ; -> update mcp width if it has increased
                set VAL_mcp_precalc_w                                   \
                    VAL_mcp_precalc_w{0}<VAL_mcp_precalc_w_bottom{0}    \
                        VAL_mcp_precalc_w_bottom{0}

            endmacro

            ;   #### Draw : MCP : Setup : Track
            ; --------------------------------------------------------------------------------

                macro MAC_DrawMcp_Setup_Track SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; custom elements
                    custom WALTER_ELEMENT##.custom.recinput_off         "" "" "" "track_custom_recinput_off"
                    custom WALTER_ELEMENT##.custom.recinput_on          "" "" "" "track_custom_recinput_on"
                    custom WALTER_ELEMENT##.custom.recinput_vert_off    "" "" "" "track_custom_recinput_vert_off"
                    custom WALTER_ELEMENT##.custom.recinput_vert_on     "" "" "" "track_custom_recinput_vert_on"
                    custom WALTER_ELEMENT##.custom.label_recmode        "" "" "" "track_custom_label_recmode"
                    custom WALTER_ELEMENT##.custom.label_infx           "" "" "" "track_custom_label_fxin"
                    custom WALTER_ELEMENT##.custom.folder_last          "" "" "" "track_custom_mcp_folder_last"
                    custom WALTER_ELEMENT##.custom.folder_child         "" "" "" "track_custom_mcp_folder_child"

                    ; side trimming
                    set VAL_mcp_trim_left 0
                    set VAL_mcp_trim_right VAL_Border{0}

                    ; [SHARED] Open
                    MAC_DrawMcp_Setup_SharedCode_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; wide recinput
                    set VAL_mcp_show_recinput_top                               \
                        ?par_mcp_##PARAMETER_SECTION##_element_width{0}         \
                            par_mcp_##PARAMETER_SECTION##_element_vis{0}&2      \
                                1                                               \
                                0                                               \
                            0

                    ; sidebar usage
                    set VAL_mcp_use_sidebar                                     \
                        par_mcp_##PARAMETER_SECTION##_insert_mode{0}==3         \
                            1                                                   \
                        par_mcp_##PARAMETER_SECTION##_insert_mode{0}==2         \
                            ?mcp_fxembed{0}                                     \
                                1                                               \
                                0                                               \
                            0

                    ; [ROUND]
                    ; width extra padding
                    set VAL_mcp_padding + VAL_rounding_constant{0} - + * 2 VAL_Unit{0} * SCALE * 0.03 par_mcp_track_settings_extrapad{0} VAL_rounding_constant{0}

                    ; [ROUND]
                    ; left x offset
                    set VAL_mcp_x_offset_folder                                                                                                 \
                        folderstate>0                                                                                                           \
                            + VAL_rounding_constant{0} - * SCALE * 0.03 par_mcp_gen_folder_pad_folder_parent    VAL_rounding_constant{0}        \
                            0

                    set VAL_mcp_x_offset                                        \
                        folderstate>0                                           \
                            + VAL_mcp_padding{0} VAL_mcp_x_offset_folder{0}     \
                            VAL_mcp_padding{0}

                    ; [ROUND]
                    ; width right extension (folder)
                    set VAL_mcp_x_extension_folder                                                                                              \
                        folderstate<0                                                                                                           \
                            + VAL_rounding_constant{0} - * SCALE * 0.03 par_mcp_gen_folder_pad_folder_last      VAL_rounding_constant{0}        \
                            0
                    
                    ; width right extension
                    set VAL_mcp_x_extension                                         \
                        folderstate<0                                               \
                            + VAL_mcp_padding{0} VAL_mcp_x_extension_folder{0}      \
                            VAL_mcp_padding{0}
                    
                    ; [ROUND]
                    ; inserts sidebar width
                    set VAL_mcp_precalc_w_sidebar                                                                                                                                                                           \
                        !VAL_mcp_use_sidebar{0}                                                                                                                                                                             \
                            0                                                                                                                                                                                               \
                            par_mcp_##PARAMETER_SECTION##_insert_mode{0}==2                                                                                                                                                 \
                                + VAL_rounding_constant{0} - * SCALE + 20 * 0.3    par_mcp_##PARAMETER_SECTION##_insert_size_embed  VAL_rounding_constant{0}                                                                \
                                !mcp_fxembed                                                                                                                                                                                \
                                    + VAL_rounding_constant{0} - * SCALE + 20    * 0.3   par_mcp_##PARAMETER_SECTION##_insert_size                                                              VAL_rounding_constant{0}    \
                                    + VAL_rounding_constant{0} - * SCALE + 20 +  * 0.3   par_mcp_##PARAMETER_SECTION##_insert_size_embed     * 0.3 par_mcp_##PARAMETER_SECTION##_insert_size    VAL_rounding_constant{0}

                    ; size calculations
                    MAC_DrawMcp_Setup_Size SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; folder features
                    set VAL_Mcp_FolderFeatures par_mcp_gen_folder_icon_folder

                    set VAL_mcp_genFolderOffset         \
                        ?VAL_Mcp_FolderFeatures{0}      \
                            VAL_Button_Folder{0}        \
                            0

                    ; [ROUND]
                    ; y indentation
                    set VAL_mcp_folderindent    + VAL_rounding_constant{0} - * SCALE * 0.02 par_mcp_gen_folder_indent   VAL_rounding_constant{0}

                    set VAL_mcp_y_offset        + VAL_mcp_genFolderOffset{0} * folderdepth      VAL_mcp_folderindent{0}
                    set VAL_mcp_y_offset_max    + VAL_mcp_genFolderOffset{0} * maxfolderdepth   VAL_mcp_folderindent{0}

                    ; indent background
                    set CUR_y - VAL_mcp_h{0} VAL_mcp_y_offset{0}
                    MAC_Draw_Box 1 WALTER_ELEMENT "indent_bg" THEME_color_mcp_empty_space{0} THEME_color_mcp_empty_space{1} THEME_color_mcp_empty_space{2} 0 0 VAL_mcp_w_full{0} VAL_mcp_h 0 0 1 1

                    ; background coordinates
                    set CUR_x_bg VAL_mcp_x_offset_folder
                    set CUR_w_bg - VAL_mcp_w_full{0} + VAL_mcp_x_offset_folder + VAL_mcp_x_extension_folder VAL_Border{0}
                    set CUR_h_bg - VAL_mcp_h{0} VAL_mcp_y_offset{0}

                    ; [SHARED] Close
                    MAC_DrawMcp_Setup_SharedCode_Close SCALE WALTER_ELEMENT PARAMETER_SECTION

                endmacro

            ;   #### Draw : MCP : Setup : Master
            ; --------------------------------------------------------------------------------

                macro MAC_DrawMcp_Setup_Master SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; side trimming
                    set VAL_mcp_trim_left 0
                    set VAL_mcp_trim_right 0

                    ; [SHARED] Open
                    MAC_DrawMcp_Setup_SharedCode_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; sidebar usage
                    set VAL_mcp_use_sidebar                                 \
                        par_mcp_##PARAMETER_SECTION##_insert_mode==2        \
                            1                                               \
                            0

                    ; width extra padding
                    set VAL_mcp_padding + VAL_rounding_constant{0} - + * 2 VAL_unit{0} * SCALE * 0.03 par_mcp_master_settings_extrapad      VAL_rounding_constant{0}

                    ; left x offset
                    set VAL_mcp_x_offset VAL_mcp_padding{0}

                    ; width right extension
                    set VAL_mcp_x_extension_folder 0
                    set VAL_mcp_x_extension VAL_mcp_padding{0}

                    ; [ROUND]
                    ; inserts full sidebar width
                    set VAL_mcp_precalc_w_sidebar                                                                                                                                   \
                        !VAL_mcp_use_sidebar{0}                                                                                                                                     \
                            0                                                                                                                                                       \
                            + VAL_rounding_constant{0} - + VAL_mcp_spacing_section_x{0} * SCALE + 30 * 0.3 par_mcp_##PARAMETER_SECTION##_insert_size    VAL_rounding_constant{0}

                    ; size calculations
                    MAC_DrawMcp_Setup_Size SCALE WALTER_ELEMENT PARAMETER_SECTION

                    set VAL_mcp_y_offset 0
                    set VAL_mcp_y_offset_max 0

                    ; background coordinates
                    set CUR_x_bg 0
                    set CUR_w_bg VAL_mcp_w_full{0}
                    set CUR_h_bg VAL_mcp_h{0}

                    ; [SHARED] Close
                    MAC_DrawMcp_Setup_SharedCode_Close SCALE WALTER_ELEMENT PARAMETER_SECTION

                endmacro

        ;   ### Draw : MCP : Setup : Shared Code : Close
        ; --------------------------------------------------------------------------------

            macro MAC_DrawMcp_Setup_SharedCode_Close SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; button leftmost x position
                set VAL_mcp_x_button_start + VAL_mcp_x_offset{0} * 0.5 - VAL_mcp_w{0} VAL_mcp_precalc_w_buttons{0}

                ; background
                MAC_Draw_Box    1 WALTER_ELEMENT "bg"                           VAL_Color_Track_Bg{0} VAL_Color_Track_Bg{1} VAL_Color_Track_Bg{2}   CUR_x_bg 0 CUR_w_bg CUR_h_bg 0 0 1 1
                MAC_Draw_Image  1 WALTER_ELEMENT "frame" "track_custom_bg_frame"                                                                    CUR_x_bg 0 CUR_w_bg CUR_h_bg 0 0 1 1

                ; offset for covering border
                set CUR_xr_frame    -   +   CUR_x_bg{0}     CUR_w_bg{0}     VAL_Border{0}
                set CUR_w_frame     -       CUR_w_bg{0}                     0
                set CUR_h_frame     -       CUR_h_bg{0}                     VAL_Border{0}

                ; selection frame                            
                MAC_Draw_Box    VAL_show_selection_frame     WALTER_ELEMENT "selection_frame_l" VAL_color_selection_frame{0} VAL_color_selection_frame{1} VAL_color_selection_frame{2}     Cur_x_bg{0}          0                   VAL_Border{0}       CUR_h_frame{0}      0 0 0 1
                MAC_Draw_Box    VAL_show_selection_frame     WALTER_ELEMENT "selection_frame_r" VAL_color_selection_frame{0} VAL_color_selection_frame{1} VAL_color_selection_frame{2}     CUR_xr_frame{0}      0                   VAL_Border{0}       CUR_h_frame{0}      0 0 0 1
                MAC_Draw_Box    VAL_show_selection_frame     WALTER_ELEMENT "selection_frame_t" VAL_color_selection_frame{0} VAL_color_selection_frame{1} VAL_color_selection_frame{2}     Cur_x_bg{0}          0                   CUR_w_frame{0}      VAL_Border{0}       0 0 1 0
                MAC_Draw_Box    VAL_show_selection_frame     WALTER_ELEMENT "selection_frame_b" VAL_color_selection_frame{0} VAL_color_selection_frame{1} VAL_color_selection_frame{2}     Cur_x_bg{0}          CUR_h_frame{0}      CUR_w_frame{0}      VAL_Border{0}       0 1 1 1

                ; bottom position
                set VAL_mcp_bottom CUR_h{0}

                ; store positions
                set VAL_mcp_available_space - h + VAL_Pad{0} VAL_mcp_y_offset{0}

            endmacro

        ;   ### Draw : MCP : Setup : Faders
        ; --------------------------------------------------------------------------------

            macro MAC_DrawMcp_Setup_Faders SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; has vertical fader
                set VAL_mcp_faders_has_vert                                 \
                    par_mcp_##PARAMETER_SECTION##_fader_pan_mode_dual==1    \
                        1                                                   \
                    par_mcp_##PARAMETER_SECTION##_fader_pan_mode_stereo==1  \
                        1                                                   \
                    par_mcp_##PARAMETER_SECTION##_fader_pan_mode_mono==1    \
                        1                                                   \
                        0

                ; has horizontal fader
                set VAL_mcp_faders_has_horz                                 \
                    par_mcp_##PARAMETER_SECTION##_fader_pan_mode_dual==2    \
                        1                                                   \
                    par_mcp_##PARAMETER_SECTION##_fader_pan_mode_stereo==2  \
                        1                                                   \
                    par_mcp_##PARAMETER_SECTION##_fader_pan_mode_mono==2    \
                        1                                                   \
                        0

                ; pan display mode
                set VAL_mcp_faders_panmode                                      \
                    trackpanmode==6                                             \
                        par_mcp_##PARAMETER_SECTION##_fader_pan_mode_dual       \
                    trackpanmode==5                                             \
                        par_mcp_##PARAMETER_SECTION##_fader_pan_mode_stereo     \
                        par_mcp_##PARAMETER_SECTION##_fader_pan_mode_mono

            endmacro

        ;   ### Draw : MCP : Setup : Meter
        ; --------------------------------------------------------------------------------

            macro MAC_DrawMcp_Setup_Meter SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; [ROUND]
                ; width
                set VAL_mcp_meter_bottom_w_precalc + VAL_rounding_constant{0} - + VAL_Button{0} * SCALE * 0.1 par_mcp_##PARAMETER_SECTION##_meter_size VAL_rounding_constant{0}

                ; width expansion channel count
                set VAL_channels                                                    \
                    /                                                               \
                        - tracknch * - par_mcp_track_meter_expand_threshold 1 2     \
                    2

                set VAL_channels        \
                    VAL_channels{0}<0   \
                        0

                ; optional limit
                set VAL_channels                            \
                    ?par_mcp_track_meter_expand_mode        \
                        VAL_channels{0}>1                   \
                            1

                ; [ROUND]
                ; additional width
                set CUR_w_add                                                                                                                       \
                    trackidx>0                                                                                                                      \
                        !par_mcp_track_meter_expand_mode                                                                                            \
                            + VAL_rounding_constant{0} - * VAL_channels{0} * SCALE * 0.02 par_mcp_track_meter_expand   VAL_rounding_constant{0}     \
                            + VAL_rounding_constant{0} - * VAL_channels{0} * SCALE * 0.2 par_mcp_track_meter_expand    VAL_rounding_constant{0}     \
                        0

                ; update mcp widith pre-calculation
                set VAL_mcp_meter_bottom_w_precalc                          \
                    trackidx>0                                              \
                        + VAL_mcp_meter_bottom_w_precalc{0} CUR_w_add{0}

            endmacro

        ;   ### Draw : MCP : Setup : Size
        ; --------------------------------------------------------------------------------

            macro MAC_DrawMcp_Setup_Size SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; internal mcp width (excluding padding)
                set VAL_mcp_w VAL_mcp_precalc_w{0}
                set VAL_mcp_h 400
                set VAL_mcp_w_label VAL_mcp_precalc_w{0}

                ; autofit sections (insert + meter)
                MAC_DrawMcp_Setup_Size_AutofitSection SCALE WALTER_ELEMENT PARAMETER_SECTION "insert"   VAL_mcp_x_insert VAL_mcp_w_insert
                MAC_DrawMcp_Setup_Size_AutofitSection SCALE WALTER_ELEMENT PARAMETER_SECTION "meter"    VAL_mcp_x_meter  VAL_mcp_w_meter

                ; final precalculated mcp width
                set VAL_mcp_w_label + VAL_mcp_precalc_w{0} +    * 2 VAL_mcp_padding{0}                                  VAL_mcp_precalc_w_sidebar{0}
                set VAL_mcp_w_full  + VAL_mcp_precalc_w{0} +        VAL_mcp_x_offset{0}     + VAL_mcp_x_extension{0}    VAL_mcp_precalc_w_sidebar{0}

            endmacro

            ;   #### Draw : MCP : Setup : AutoFit
            ; --------------------------------------------------------------------------------

            macro MAC_DrawMcp_Setup_Size_AutofitSection SCALE WALTER_ELEMENT PARAMETER_SECTION ELEMENT TARGET_VALUE_X TARGET_VALUE_W

                ; x position
                set TARGET_VALUE_X                                                                  \
                    VAL_mcp_##ELEMENT##_padding{0}==2                                               \
                        + VAL_mcp_x_offset_folder{0} +  VAL_mcp_trim_left{0}    VAL_mcp_padding{0}  \
                    VAL_mcp_##ELEMENT##_padding{0}==1                                               \
                        + VAL_mcp_x_offset_folder{0} +  VAL_mcp_trim_left{0}    VAL_Pad{0}          \
                        + VAL_mcp_x_offset_folder{0}    VAL_mcp_trim_left{0}

                ; width
                set TARGET_VALUE_W                                                                                                      \
                    VAL_mcp_##ELEMENT##_padding{0}==2                                                                                   \
                        - VAL_mcp_w{0} + VAL_mcp_trim_right{0} VAL_mcp_trim_left{0}                                                     \
                    VAL_mcp_##ELEMENT##_padding{0}==1                                                                                   \
                        - - + VAL_mcp_w{0} * 2 VAL_mcp_padding{0} + VAL_mcp_trim_left{0} VAL_mcp_trim_right{0}      * 2 VAL_Pad{0}      \
                        -   + VAL_mcp_w{0} * 2 VAL_mcp_padding{0} + VAL_mcp_trim_left{0} VAL_mcp_trim_right{0}

            endmacro


    ;   ## Draw : MCP : Label
    ; --------------------------------------------------------------------------------

        ;   ### Draw : MCP : Label : Shared Code : Open
        ; --------------------------------------------------------------------------------

            macro MAC_DrawMcp_Label_SharedCode_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; [ROUND]
                ; selection marker height
                set CUR_h_selection                                                                                                     \
                    ?par_mcp_gen_highlight_selection                                                                                    \
                        + VAL_rounding_constant{0} - * SCALE + 3 * 0.02 par_mcp_gen_highlight_selection     VAL_rounding_constant{0}    \
                        0

                ; initial y position
                set CUR_y - VAL_mcp_h{0} VAL_mcp_y_offset{0}
                set CUR_y_init CUR_y{0}

            endmacro

            ;   #### Draw : MCP : Label : Track
            ; --------------------------------------------------------------------------------

                macro MAC_DrawMcp_Label_Track SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; [ROUND]
                    ; color marker height
                    set CUR_h_color                                                                                                         \
                        ?par_mcp_gen_highlight_color                                                                                        \
                            + VAL_rounding_constant{0} - * SCALE + 3 * 0.02  par_mcp_gen_highlight_color    VAL_rounding_constant{0}        \
                            0

                    ; [SHARED] Open
                    MAC_DrawMcp_Label_SharedCode_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; [ROUND]
                    ; label height
                    set VAL_remaining_h - h VAL_mcp_y_offset_max{0}

                    set CUR_h_min                                                                           \
                        !par_mcp_##PARAMETER_SECTION##_settings_label_vertical                              \
                            + VAL_rounding_constant{0} - * SCALE 18         VAL_rounding_constant{0}        \
                            * 4 VAL_MCP_Label{0}

                    set CUR_h                                                                                                                                           \
                        !par_mcp_##PARAMETER_SECTION##_settings_label_vertical                                                                                          \
                            + VAL_rounding_constant{0} - + CUR_h_min{0} * SCALE * 0.05   par_mcp_##PARAMETER_SECTION##_settings_label_size  VAL_rounding_constant{0}    \
                            + VAL_rounding_constant{0} - + CUR_h_min{0} * SCALE * 0.25  par_mcp_##PARAMETER_SECTION##_settings_label_size   VAL_rounding_constant{0}

                    ; label background
                    set CUR_y - CUR_y{0} CUR_h{0}
                    set CUR_x VAL_mcp_x_offset_folder{0}
                    set CUR_w - VAL_mcp_w_label{0} VAL_Border{0}

                    ; [DRAW] background
                    MAC_Draw_Box    1 WALTER_ELEMENT "label_bg" VAL_Color_Track_Label_Bg{0} VAL_Color_Track_Label_Bg{1} VAL_Color_Track_Label_Bg{2}     CUR_x{0} CUR_y{0} CUR_w{0} CUR_h{0} 0 1 1 1
                    MAC_Draw_Image  1 WALTER_ELEMENT "label_bg" "track_custom_label_frame"                                                              CUR_x{0} CUR_y{0} CUR_w{0} CUR_h{0} 0 1 1 1

                    ; index width
                    set CUR_w_index                                                 \
                        par_mcp_##PARAMETER_SECTION##_settings_label_index==1       \
                            * SCALE + 6 * 6 VAL_index_letters{0}                    \
                            0

                    ; label width
                    set CUR_w_label                                                 \
                        ?par_mcp_##PARAMETER_SECTION##_settings_label_vertical      \
                            VAL_MCP_Label{0}                                        \
                            - CUR_w{0} CUR_w_index

                    ; label height
                    set CUR_h_label                                             \
                        ?par_mcp_##PARAMETER_SECTION##_settings_label_vertical  \
                            - CUR_h{0} CUR_w_index{0}                           \
                            VAL_MCP_Label{0}

                    ; label x position
                    set CUR_x_label                                             \
                        !par_mcp_##PARAMETER_SECTION##_settings_label_vertical  \
                            + CUR_x{0}                  CUR_w_index{0}          \
                            + CUR_x{0} * 0.5 - CUR_w{0} CUR_w_label{0}

                    ; label y position
                    set CUR_y_label                                             \
                        !par_mcp_##PARAMETER_SECTION##_settings_label_vertical  \
                            + CUR_y{0} * 0.5 - CUR_h{0} CUR_h_label{0}          \
                            + CUR_y{0}                  CUR_w_index{0}

                    ; [DRAW] label
                    set WALTER_ELEMENT##.label [CUR_x_label{0} CUR_y_label{0} CUR_w_label{0} CUR_h_label{0} 0 1 1 1]

                    ; index x position
                    set CUR_x_index                                             \
                        !par_mcp_##PARAMETER_SECTION##_settings_label_vertical  \
                            CUR_x                                               \
                            CUR_x_label

                    ; index y position
                    set CUR_y_index                                             \
                        !par_mcp_##PARAMETER_SECTION##_settings_label_vertical  \
                            CUR_y_label                                         \
                            CUR_y

                    ; [DRAW] index
                    set WALTER_ELEMENT##.trackidx                                                           \
                        par_mcp_##PARAMETER_SECTION##_settings_label_index==1                               \
                            !par_mcp_##PARAMETER_SECTION##_settings_label_vertical                          \
                                [CUR_x_index{0} CUR_y_index{0} CUR_w_label{0} VAL_MCP_Label{0} 0 1 1 1]     \
                                [CUR_x_index{0} CUR_y_index{0} VAL_MCP_Label{0} CUR_h_label{0} 0 1 1 1]     \
                            0

                    ; z order
                    front WALTER_ELEMENT##.trackidx
                    front WALTER_ELEMENT##.label

                    ; selection marker
                    set CUR_y                                               \
                        ?par_mcp_gen_highlight_selection                    \
                            - CUR_y{0} - CUR_h_selection{0} VAL_Border{0}

                    MAC_Draw_Box    par_mcp_gen_highlight_selection WALTER_ELEMENT "highlight_select" VAL_color_selectbar{0} VAL_color_selectbar{1} VAL_color_selectbar{2}    CUR_x CUR_y CUR_w CUR_h_selection 0 1 1 1
                    MAC_Draw_Image  par_mcp_gen_highlight_selection WALTER_ELEMENT "highlight_select" "track_custom_selmarker_frame"                                          CUR_x CUR_y CUR_w CUR_h_selection 0 1 1 1

                    ; color marker
                    set CUR_y                                           \
                        ?par_mcp_gen_highlight_color                    \
                            - CUR_y{0} - CUR_h_color{0} VAL_Border{0}

                    MAC_Draw_Box    par_mcp_gen_highlight_color WALTER_ELEMENT "highlight_color" VAL_color_colorbar{0} VAL_color_colorbar{1} VAL_color_colorbar{2}   CUR_x CUR_y CUR_w CUR_h_color 0 1 1 1
                    MAC_Draw_Image  par_mcp_gen_highlight_color WALTER_ELEMENT "highlight_color" "track_custom_colorbar_frame"                                       CUR_x CUR_y CUR_w CUR_h_color 0 1 1 1

                    ; separate index
                    set CUR_y                                                       \
                        ?par_mcp_##PARAMETER_SECTION##_settings_label_index==2      \
                            - CUR_y{0} VAL_MCP_Label{0}

                    ; [DRAW] index
                    set WALTER_ELEMENT##.trackidx                                   \
                        ?par_mcp_##PARAMETER_SECTION##_settings_label_index==2      \
                            [CUR_x{0} CUR_y{0} CUR_w{0} VAL_MCP_Label{0} 0 1 1 1]

                    front WALTER_ELEMENT##.trackidx

                    ; [SHARED] Close
                    MAC_DrawMcp_Label_SharedCode_Close SCALE WALTER_ELEMENT PARAMETER_SECTION

                endmacro

            ;   #### Draw : MCP : Label : Master
            ; --------------------------------------------------------------------------------

                macro MAC_DrawMcp_Label_Master SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; [SHARED] Open
                    MAC_DrawMcp_Label_SharedCode_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; [ROUND]
                    ; label height
                    set CUR_h_min * SCALE 18
                    set CUR_h + VAL_rounding_constant{0} - + CUR_h_min{0} * SCALE * 0.05 par_mcp_##PARAMETER_SECTION##_settings_label_size  VAL_rounding_constant{0}

                    set CUR_h                       \
                        CUR_h{0}<CUR_h_min{0}       \
                            CUR_h_min{0}

                    ; label position
                    set CUR_y - CUR_y{0} CUR_h{0}
                    set CUR_x   VAL_mcp_x_offset_folder{0}
                    set CUR_w + VAL_mcp_w_label{0} VAL_Border{0}

                    ; [DRAW] background
                    MAC_Draw_Box    1 WALTER_ELEMENT "label_bg" VAL_color_master_icon{0} VAL_color_master_icon{1} VAL_color_master_icon{2}  CUR_x{0} CUR_y{0} CUR_w{0} CUR_h{0} 0 1 1 1
                    MAC_Draw_Image  1 WALTER_ELEMENT "label_bg" "track_custom_label_frame"                                                  CUR_x{0} CUR_y{0} CUR_w{0} CUR_h{0} 0 1 1 1

                    ; [DRAW] Menu Button
                    set WALTER_ELEMENT##.menubutton [CUR_x{0} CUR_y{0} CUR_w{0} CUR_h{0} 0 1 1 1]
                    front WALTER_ELEMENT##.menubutton

                    set CUR_w_icon VAL_Button{0}
                    set CUR_h_icon VAL_Button{1}
                    set CUR_x_icon + CUR_x{0} * 0.5 - VAL_mcp_w_full{0} CUR_w_icon{0}
                    set CUR_y_icon + CUR_y{0} * 0.5 - CUR_h{0}          CUR_h_icon{0}


                    custom WALTER_ELEMENT##.custom.menubutton_icon "" "" "" "track_custom_master"
                    set WALTER_ELEMENT##.custom.menubutton_icon [CUR_x_icon{0} CUR_y_icon{0} CUR_w_icon{0} CUR_h_icon{0} 0 1 1 1]
                    front WALTER_ELEMENT##.custom.menubutton_icon

                    ; selection marker
                    set CUR_y                                       \
                        ?par_mcp_gen_highlight_selection            \
                            - CUR_y{0} - CUR_h_selection{0} VAL_Border{0}

                    MAC_Draw_Box    par_mcp_gen_highlight_selection WALTER_ELEMENT "highlight_select" VAL_color_selectbar{0} VAL_color_selectbar{1} VAL_color_selectbar{2} CUR_x{0} CUR_y{0} CUR_w{0} CUR_h_selection{0} 0 1 1 1
                    MAC_Draw_Image  par_mcp_gen_highlight_selection WALTER_ELEMENT "highlight_select" "track_custom_selmarker_frame"                                       CUR_x{0} CUR_y{0} CUR_w{0} CUR_h_selection{0} 0 1 1 1

                    ; [SHARED] Close
                    MAC_DrawMcp_Label_SharedCode_Close SCALE WALTER_ELEMENT PARAMETER_SECTION

                endmacro

        ;   ### Draw : MCP : Label : Shared Code : Close
        ; --------------------------------------------------------------------------------

            macro MAC_DrawMcp_Label_SharedCode_Close SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; store end position
                set VAL_mcp_y_post_label CUR_y{0}
                set VAL_mcp_y_post_label_parallel - CUR_y{0} - VAL_mcp_y_offset_max{0} VAL_mcp_y_offset{0}

                ; dynamic hiding point
                set VAL_mcp_y_labelHide - h - VAL_mcp_h{0} - VAL_mcp_y_post_label_parallel{0} VAL_Pad{0}

            endmacro


    ;   ## Draw : MCP : Inserts
    ; --------------------------------------------------------------------------------

        macro MAC_DrawMcp_Inserts SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; visibility
            set VAL_mcp_show_inserts                        \
                ?par_mcp_##PARAMETER_SECTION##_insert_mode  \
                    1                                       \
                    0

            ; y position
            set CUR_y_inserts                       \
                ?VAL_mcp_use_sidebar{0}             \
                    0                               \
                    ?VAL_mcp_insert_padding{0}      \
                        VAL_Pad{0}                  \
                        0

            ; height
            set VAL_remaining_h - h + - VAL_mcp_y_offset_max{0} VAL_mcp_y_offset{0} + CUR_y_inserts{0} - VAL_mcp_h{0} VAL_mcp_y_post_label{0}

            set CUR_h                                                                                                                                               \
                !VAL_mcp_show_inserts{0}                                                                                                                            \
                    0                                                                                                                                               \
                ?par_mcp_##PARAMETER_SECTION##_insert_size_scale                                                                                                    \
                    + VAL_mcp_inserts_min_h{0} * - VAL_remaining_h{0} VAL_mcp_inserts_min_h{0}  * VAL_Fader_Scale{0}    par_mcp_##PARAMETER_SECTION##_insert_size   \
                    + VAL_mcp_inserts_min_h{0} * SCALE                                          * 0.4                   par_mcp_##PARAMETER_SECTION##_insert_size

            ; width
            set CUR_w                               \
                !VAL_mcp_use_sidebar{0}             \
                    VAL_mcp_w_insert{0}             \
                    VAL_mcp_precalc_w_sidebar{0}

            ; x position
            set CUR_x                                                                               \
                !VAL_mcp_use_sidebar{0}                                                             \
                    VAL_mcp_x_insert{0}                                                             \
                    - VAL_mcp_w_full{0} + CUR_w{0} + VAL_mcp_x_extension_folder{0} VAL_Border{0}

            ; sidebar padding y offset
            set CUR_y_inserts                           \
                ?VAL_mcp_use_sidebar{0}                 \
                    VAL_mcp_insert_padding{0}>=1        \
                        + CUR_y_inserts{0} VAL_Pad{0}

            ; [MASTER]
            ; sidebar padding width offset
            set CUR_w                                                   \
                ?VAL_mcp_use_sidebar{0}                                 \
                    VAL_mcp_insert_padding{0}>=1                        \
                        !trackidx                                       \
                            - CUR_w{0} - VAL_Pad{0} VAL_Unit{0}         \
                            - CUR_w{0} VAL_Pad{0}
            
            ; sidebar padding height offset
            set VAL_remaining_h                                             \
                ?VAL_mcp_use_sidebar{0}                                     \
                    VAL_mcp_insert_padding{0}>=1                            \
                        - VAL_remaining_h{0} + VAL_Border{0} VAL_Pad{0}     \
                        + VAL_remaining_h{0} VAL_Border{0}

            ; overhoot correction
            set VAL_mcp_insert_overshoot - h - VAL_mcp_h{0} - VAL_mcp_y_post_label{0} CUR_y_inserts{0}

            set CUR_h                                   \
                VAL_mcp_insert_overshoot{0}<CUR_h{0}    \
                    VAL_mcp_insert_overshoot{0}

            ; ------------------------------------------------------------------------------------------------------------
            ;       - On MCP Inserts -
            ;
            ;   The margins of slots inside the MCP’s inserts section are hard to control,
            ;   mainly because you can mix FX, sends, parameters, and also use embedded FX.
            ;
            ;   As a workaround, the actual inserts area is drawn with a slight offset and without a border.
            ;   The visible background and border come from an additional custom element.
            ; ------------------------------------------------------------------------------------------------------------

            ; calculate inner frame offset values
            set CUR_x_inserts_inner     + CUR_x{0} VAL_Border_2{0}
            set CUR_y_inserts_inner CUR_y_inserts{0}
            set CUR_w_inserts_inner     - CUR_w{0} VAl_Border_2{0}
            
            set CUR_h_inserts_inner         \
                !VAL_mcp_use_sidebar{0}     \
                    CUR_h{0}                \
                    VAL_remaining_h{0}    

            ; [DRAW] inserts border
            set WALTER_ELEMENT##.custom.inserts_bg                                  \
                ?VAL_mcp_use_sidebar{0}                                             \
                    [CUR_x{0} CUR_y_inserts CUR_w{0} VAL_remaining_h{0} 0 0 1 0]    \
                    ?VAL_mcp_show_inserts{0}                                        \
                        [CUR_x{0} CUR_y_inserts{0} CUR_w{0} CUR_h{0} 0 0 1 0]

            ; [DRAW] inserts
            set WALTER_ELEMENT##.extmixer.Position                                                                          \
                ?VAL_mcp_show_inserts{0}                                                                                    \
                    [CUR_x_inserts_inner{0} CUR_y_inserts_inner CUR_w_inserts_inner{0} CUR_h_inserts_inner{0} 0 0 1 0]

            set WALTER_ELEMENT##.extmixer.mode [1]
            front WALTER_ELEMENT##.custom.inserts_bg
            front WALTER_ELEMENT##.extmixer
            
            ; inserts on top marker
            set VAL_mcp_inserts_on_top          \
                ?VAL_mcp_show_inserts{0}        \
                    !VAL_mcp_use_sidebar{0}     \
                        1                       \
                        0                       \
                    0

            ; increment / reset y position
            set CUR_y                                                               \
                ?VAL_mcp_inserts_on_top{0}                                          \
                    + CUR_y_inserts{0} + CUR_h{0} VAL_mcp_spacing_section_y{0}      \
                    VAL_Pad{0}

        endmacro

    ;   ## Draw : MCP : RecInput
    ; --------------------------------------------------------------------------------

        ; The MCP Record Input selector gets its own drawing process instead of
        ; the conventional button-drawing macro.
        ;
        ; This is due to its flexible size and varying orientation.


        macro MAC_DrawMcp_Recinput SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; detect separator
                set CUR_separator_increment                                 \
                    par_mcp_##PARAMETER_SECTION##_element_separator&2       \
                        1                                                   \
                        0

                ; y position
                set CUR_y CUR_y_next_button{0}
                
                ; height
                set CUR_h_recinput                                                                                  \
                    par_mcp_##PARAMETER_SECTION##_element_vis&2                                                     \
                        par_mcp_##PARAMETER_SECTION##_element_width>=1                                              \
                            VAL_Button{1}                                                                           \
                            + VAL_Button{1} * SCALE + 30 * 0.2 par_mcp_##PARAMETER_SECTION##_element_input_size    \
                        0

                ; hiding logic
                set CUR_y_hide + CUR_y{0} CUR_h_recinput{0}

                set VAL_mcp_hide_rest                               \
                    par_mcp_##PARAMETER_SECTION##_element_vis&2     \
                        CUR_y_hide{0}>VAL_mcp_y_labelHide{0}        \
                            1

                ; visibility
                set VAL_mcp_show_recinput                           \
                    ?VAL_mcp_hide_rest{0}                           \
                        0                                           \
                    par_mcp_##PARAMETER_SECTION##_element_vis&2     \
                        1                                           \
                        0

                set VAL_mcp_button_group_count  +   VAL_mcp_button_group_count{0}   VAL_mcp_show_recinput
                set VAL_mcp_button_count        +   VAL_mcp_button_count{0}         VAL_mcp_show_recinput

                ; width
                set CUR_W_recinput                                      \
                    ?VAL_mcp_show_recinput{0}                           \
                        par_mcp_##PARAMETER_SECTION##_element_width>=1  \
                            - VAL_mcp_w_insert{0} * 2 VAL_Pad{0}        \
                            VAL_Button{0}                               \
                        0

                ; x position
                set CUR_x_recinput                               	        \
                    ?VAL_mcp_show_recinput{0}                               \
                        par_mcp_##PARAMETER_SECTION##_element_width>=1      \
                            + VAL_mcp_x_insert{0} VAL_Pad{0}                \
                            VAL_Mcp_x_button_start{0}                       \
                        0

                ; [DRAW] RecInput
                set WALTER_ELEMENT##.recinput                                                               \
                    ?VAL_mcp_show_recinput{0}                                                               \
                        [CUR_x_recinput{0} CUR_y{0} CUR_w_recinput{0} CUR_h_recinput{0} 0 0 0 0]            \
                        0
                
                ; [DRAW] RecInput Off Background
                set WALTER_ELEMENT##.custom.recinput_off                                                            \
                    ?VAL_mcp_show_recinput{0}                                                                       \
                        !recarm                                                                                     \
                            par_mcp_##PARAMETER_SECTION##_element_width>=1                                          \
                                [CUR_x_recinput{0} CUR_y{0} CUR_w_recinput{0} CUR_h_recinput{0} 0 0 0 0]            \
                                0                                                                                   \
                            0                                                                                       \
                        0
                
                ; [DRAW] RecInput On Background
                set WALTER_ELEMENT##.custom.recinput_on                                                             \
                    ?VAL_mcp_show_recinput{0}                                                                       \
                        ?recarm                                                                                     \
                            par_mcp_##PARAMETER_SECTION##_element_width>=1                                          \
                                [CUR_x_recinput{0} CUR_y{0} CUR_w_recinput{0} CUR_h_recinput{0} 0 0 0 0]            \
                                0                                                                                   \
                            0                                                                                       \
                        0

                ; [DRAW] RecInput Off Background (Vertical)
                set WALTER_ELEMENT##.custom.recinput_vert_off                                                       \
                    ?VAL_mcp_show_recinput{0}                                                                       \
                        !recarm                                                                                     \
                            par_mcp_##PARAMETER_SECTION##_element_width==0                                          \
                                [CUR_x_recinput{0} CUR_y{0} CUR_w_recinput{0} CUR_h_recinput{0} 0 0 0 0]            \
                                0                                                                                   \
                            0                                                                                       \
                        0

                ; [DRAW] RecInput On Background (Vertical)
                set WALTER_ELEMENT##.custom.recinput_vert_on                                                        \
                    ?VAL_mcp_show_recinput{0}                                                                       \
                        ?recarm                                                                                     \
                            par_mcp_##PARAMETER_SECTION##_element_width==0                                          \
                                [CUR_x_recinput{0} CUR_y{0} CUR_w_recinput{0} CUR_h_recinput{0} 0 0 0 0]            \
                                0                                                                                   \
                            0                                                                                       \
                        0

                ; z order
                front WALTER_ELEMENT##.custom.recinput_off
                front WALTER_ELEMENT##.custom.recinput_on
                front WALTER_ELEMENT##.custom.recinput_vert_off
                front WALTER_ELEMENT##.custom.recinput_vert_on
                front WALTER_ELEMENT##.recinput

                ; increment y position
                set CUR_y                                                               \
                    ?VAL_mcp_show_recinput{0}                                           \
                        + CUR_y{0} CUR_h_recinput{0}
                        
                set CUR_y_next_button                                                       \
                    ?VAL_mcp_show_recinput{0}                                               \
                        ?CUR_separator_increment{0}                                         \
                            + CUR_y{0} + VAL_mcp_spacing_y{0} VAL_mcp_spacing_separator{0}  \
                            + CUR_y{0} VAL_mcp_spacing_y{0}

                        
        endmacro


    ;   ## Draw : MCP : Master : Post Insert
    ; --------------------------------------------------------------------------------

        macro MAC_DrawMcp_PostInsert_Master SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; increment y position
            set CUR_y                                           \
                ?par_mcp_##PARAMETER_SECTION##_element_vis      \
                    + CUR_y{0} VAL_mcp_spacing_section_y{0}

        endmacro

    ;   ## Draw : MCP : Buttons
    ; --------------------------------------------------------------------------------

        ;   ### Draw : MCP : Buttons : Shared Code : Open
        ; --------------------------------------------------------------------------------

            macro MAC_DrawMcp_Buttons_SharedCode_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; flags
                set VAL_mcp_button_line_count 0
                set VAL_mcp_button_group_count 0
                set VAL_mcp_button_count 0
                set CUR_Linebreak 0

                ; initial position
                set CUR_x VAL_mcp_x_button_start{0}

                ; flag for skipping separators conditionally
                set VAL_mcp_skip_separator 0

                ; next y position
                set CUR_y_next_button CUR_y{0}

                ; calculate center-offset for wide layout
                set VAL_mcp_wide_center_offset                          \
                    par_mcp_##PARAMETER_SECTION##_element_width==2      \
                        1                                               \
                        0

                ; [ROUND]
                ; center offset x positions
                set VAL_mcp_button_x_center_offset                                                                                                                              \
                    par_mcp_##PARAMETER_SECTION##_element_width==1                                                                                                              \
                        + VAL_rounding_constant{0} - + VAL_mcp_x_button_start{0} * 0.5 - VAL_mcp_precalc_w_buttons{0} + VAL_Button{0} VAL_Pad{0}    VAL_rounding_constant{0}    \
                        VAL_mcp_x_button_start{0}
                
                
                ; dimensions
                set CUR_w VAL_Button{0}
                set CUR_h VAL_Button{1}

                ; width pre-calculation
                set CUR_w_2 + VAL_mcp_spacing_x{0} * 2 VAL_Button{0}
                set CUR_h_2 + VAL_mcp_spacing_y{0} * 2 VAL_Button{1}

            endmacro

            ;   #### Draw : MCP : Buttons : Track
            ; --------------------------------------------------------------------------------

                macro MAC_DrawMcp_Buttons_Track SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; [SHARED] Open
                    MAC_DrawMcp_Buttons_SharedCode_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; [BUTTON] Record Input
                    MAC_DrawMcp_Recinput SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; [BUTTON] Record Mode
                    set CUR_Linebreak                                       \
                        par_mcp_##PARAMETER_SECTION##_element_width<2       \
                            1                                               \
                            0

                    ; wide center offset
                    MAC_DrawMcp_Buttons_CenterOffset_Wide SCALE WALTER_ELEMENT PARAMETER_SECTION VAL_mcp_wide_center_offset 4 8 16 0 1 1 2 0
                    
                    ; button
                    MAC_DrawMcp_Buttons_SingleButton SCALE 4 WALTER_ELEMENT PARAMETER_SECTION "recmode" CUR_Linebreak

                    ; label dimensions
                    set VAL_label_offset * SCALE 4
                    set VAL_label_w - CUR_w VAL_label_offset

                    ; record mode extension icon
                    set WALTER_ELEMENT##.custom.label_recmode                                                                                                                   \
                        par_mcp_##PARAMETER_SECTION##_element_width==1                                                                                                          \
                            ?VAL_mcp_show_button_recmode{0}                                                                                                                     \
                                + [WALTER_ELEMENT##.recmode{x} WALTER_ELEMENT##.recmode{y} CUR_w{0} CUR_h{0} 0 0 0 0] + VAL_label_offset@x + VAL_mcp_spacing_x@w VAL_label_w@w

                    front WALTER_ELEMENT##.custom.label_recmode
                    front WALTER_ELEMENT##.recmode

                    ; [BUTTON] Input FX
                    set CUR_w VAL_Button{0}

                    set CUR_Linebreak                                       \
                        par_mcp_##PARAMETER_SECTION##_element_width<2       \
                            1                                               \
                            0

                    ; button
                    MAC_DrawMcp_Buttons_SingleButton SCALE 8 WALTER_ELEMENT PARAMETER_SECTION "fxin" CUR_Linebreak

                    ; input fx extension icon
                    set WALTER_ELEMENT##.custom.label_infx                                                                                                                  \
                        par_mcp_##PARAMETER_SECTION##_element_width==1                                                                                                      \
                            ?VAL_mcp_show_button_fxin{0}                                                                                                                    \
                                + [WALTER_ELEMENT##.fxin{x} WALTER_ELEMENT##.fxin{y} CUR_w{0} CUR_h{0} 0 0 0 0] + VAL_label_offset@x + VAL_mcp_spacing_x@w VAL_label_w@w

                    front WALTER_ELEMENT##.custom.label_infx
                    front WALTER_ELEMENT##.fxin

                    ; [BUTTON] FX
                    set CUR_H                                           \
                        par_mcp_##PARAMETER_SECTION##_element_width==0  \
                            CUR_h_2{0}                                  \
                            VAL_button{1}

                    set CUR_W                                                   \
                        par_mcp_##PARAMETER_SECTION##_element_width==0          \
                            VAL_button{0}                                       \
                            CUR_w_2{0}

                    ; button
                    MAC_DrawMcp_Buttons_SingleButton SCALE 16 WALTER_ELEMENT PARAMETER_SECTION "fx" 1

                    ; [BUTTON] FX Bypass
                    MAC_DrawMcp_Buttons_FxBypass SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; [BUTTON] IO / Phase

                    set CUR_w VAL_Button{0}

                    set CUR_Linebreak                                   \
                        par_mcp_##PARAMETER_SECTION##_element_width==0  \
                            1                                           \
                            0

                    ; wide center offset
                    MAC_DrawMcp_Buttons_CenterOffset_Wide SCALE WALTER_ELEMENT PARAMETER_SECTION VAL_mcp_wide_center_offset 32 64 128 256 1 1 1 1
                    
                    ; slim center offset
                    MAC_DrawMcp_Buttons_CenterOffset SCALE WALTER_ELEMENT PARAMETER_SECTION VAL_mcp_wide_center_offset 32 64
                    
                    ; button
                    MAC_DrawMcp_Buttons_SingleButton SCALE 32 WALTER_ELEMENT PARAMETER_SECTION "io" CUR_Linebreak

                    set CUR_Linebreak                                   \
                        par_mcp_##PARAMETER_SECTION##_element_width!=2  \
                            1                                           \
                            0

                    ; button
                    MAC_DrawMcp_Buttons_SingleButton SCALE 64 WALTER_ELEMENT PARAMETER_SECTION "phase" CUR_Linebreak
                    
                    ; [BUTTON] Mute / Solo
                    set CUR_W VAL_Button{0}
                    set CUR_Linebreak                                       \
                        par_mcp_##PARAMETER_SECTION##_element_width==0      \
                            1                                               \
                            0

                    ; slim center offset
                    MAC_DrawMcp_Buttons_CenterOffset SCALE WALTER_ELEMENT PARAMETER_SECTION VAL_mcp_wide_center_offset 128 256

                    ; button
                    MAC_DrawMcp_Buttons_SingleButton SCALE 128 WALTER_ELEMENT PARAMETER_SECTION "mute" CUR_Linebreak
                    
                    ; button
                    MAC_DrawMcp_Buttons_SingleButton SCALE 256 WALTER_ELEMENT PARAMETER_SECTION "solo" 1

                    ; [BUTTON] Record Arm / Record Monitor
                    set CUR_Linebreak                                   \
                        par_mcp_##PARAMETER_SECTION##_element_width==0  \
                            1                                           \
                            0

                    ; wide center offset
                    MAC_DrawMcp_Buttons_CenterOffset_Wide SCALE WALTER_ELEMENT PARAMETER_SECTION VAL_mcp_wide_center_offset 512 1024 2048 0 1 1 2 0
                    
                    ; slim center offset
                    MAC_DrawMcp_Buttons_CenterOffset SCALE WALTER_ELEMENT PARAMETER_SECTION VAL_mcp_wide_center_offset 512 1024
                    
                    ; button
                    MAC_DrawMcp_Buttons_SingleButton SCALE 512 WALTER_ELEMENT PARAMETER_SECTION "recarm" CUR_Linebreak

                    set CUR_Linebreak                                   \
                        par_mcp_##PARAMETER_SECTION##_element_width!=2  \
                            1                                           \
                            0

                    ; button
                    MAC_DrawMcp_Buttons_SingleButton SCALE 1024 WALTER_ELEMENT PARAMETER_SECTION "recmon" CUR_Linebreak

                    ; [BUTTON] Envelope
                    set CUR_H VAL_Button{1}

                    set CUR_w                                               \
                        par_mcp_##PARAMETER_SECTION##_element_width==0      \
                            VAL_button{0}                                   \
                            CUR_w_2{0}

                    ; button
                    MAC_DrawMcp_Buttons_SingleButton SCALE 2048 WALTER_ELEMENT PARAMETER_SECTION "env" 1

                    set WALTER_ELEMENT##.custom.env_icon                                                                \
                        ?VAL_mcp_show_button_env{0}                                                                     \
                            par_mcp_##PARAMETER_SECTION##_element_width>=1                                              \
                                [WALTER_ELEMENT##.env{0} WALTER_ELEMENT##.env{1} VAL_Button{0} VAL_Button{1} 0 0 0 0]   \
                                0                                                                                       \
                            0

                    front WALTER_ELEMENT##.custom.env_icon

                    ; [SHARED] Close
                    MAC_DrawMcp_Buttons_SharedCode_Close SCALE WALTER_ELEMENT PARAMETER_SECTION

                endmacro

            ;   #### Draw : MCP : Buttons : Master
            ; --------------------------------------------------------------------------------

                macro MAC_DrawMcp_Buttons_Master SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; [SHARED] Open
                    MAC_DrawMcp_Buttons_SharedCode_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; [BUTTON] FX
                    set CUR_H                                           \
                        par_mcp_##PARAMETER_SECTION##_element_width==0  \
                            CUR_h_2{0}                                  \
                            VAL_button{1}

                    set CUR_W                                               \
                        par_mcp_##PARAMETER_SECTION##_element_width==0      \
                            VAL_button{0}                                   \
                            CUR_w_2{0}

                    set CUR_Linebreak                                       \
                        par_mcp_##PARAMETER_SECTION##_element_width<2       \
                            1                                               \
                            0

                    ; wide center offset
                    MAC_DrawMcp_Buttons_CenterOffset_Wide SCALE WALTER_ELEMENT PARAMETER_SECTION VAL_mcp_wide_center_offset 2 4 8 0 2 1 1 0

                    ; button
                    MAC_DrawMcp_Buttons_SingleButton SCALE 2 WALTER_ELEMENT PARAMETER_SECTION "fx" CUR_Linebreak

                    ; [BUTTON] FX Bypass
                    MAC_DrawMcp_Buttons_FxBypass SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; [BUTTON] IO / Mono
                    set CUR_w VAL_Button{0}

                    set CUR_Linebreak                                       \
                        par_mcp_##PARAMETER_SECTION##_element_width==0      \
                            1                                               \
                            0

                    ; slim center offset
                    MAC_DrawMcp_Buttons_CenterOffset SCALE WALTER_ELEMENT PARAMETER_SECTION VAL_mcp_wide_center_offset 4 8
                    
                    ; button
                    MAC_DrawMcp_Buttons_SingleButton SCALE 4 WALTER_ELEMENT PARAMETER_SECTION "io" CUR_Linebreak
                    
                    ; button
                    MAC_DrawMcp_Buttons_SingleButton SCALE 8 WALTER_ELEMENT PARAMETER_SECTION "mono" 1

                    ; [BUTTON] Mute / Solo
                    set CUR_W VAL_Button{0}
                    set CUR_Linebreak                                       \
                        par_mcp_##PARAMETER_SECTION##_element_width==0      \
                            1                                               \
                            0

                    ; wide center offset
                    MAC_DrawMcp_Buttons_CenterOffset_Wide SCALE WALTER_ELEMENT PARAMETER_SECTION VAL_mcp_wide_center_offset 16 32 64 0 1 1 2 0

                    ; slim center offset
                    MAC_DrawMcp_Buttons_CenterOffset SCALE WALTER_ELEMENT PARAMETER_SECTION VAL_mcp_wide_center_offset 16 32
                    
                    ; button
                    MAC_DrawMcp_Buttons_SingleButton SCALE 16 WALTER_ELEMENT PARAMETER_SECTION "mute" CUR_Linebreak

                    set CUR_Linebreak                                       \
                        par_mcp_##PARAMETER_SECTION##_element_width<2       \
                            1                                               \
                            0

                    ; button
                    MAC_DrawMcp_Buttons_SingleButton SCALE 32 WALTER_ELEMENT PARAMETER_SECTION "solo" CUR_Linebreak
                    
                    ; [BUTTON] Envelope
                    set CUR_H VAL_Button{1}

                    set CUR_w                                               \
                        par_mcp_##PARAMETER_SECTION##_element_width==0      \
                            VAL_button{0}                                   \
                            CUR_w_2{0}

                    ; button
                    MAC_DrawMcp_Buttons_SingleButton SCALE 64 WALTER_ELEMENT PARAMETER_SECTION "env" 1

                    set WALTER_ELEMENT##.custom.env_icon                                                                \
                        ?VAL_mcp_show_button_env{0}                                                                     \
                            par_mcp_##PARAMETER_SECTION##_element_width>=1                                              \
                                [WALTER_ELEMENT##.env{0} WALTER_ELEMENT##.env{1} VAL_Button{0} VAL_Button{1} 0 0 0 0]   \
                                0                                                                                       \
                            0

                    front WALTER_ELEMENT##.custom.env_icon

                    ; [SHARED] Close
                    MAC_DrawMcp_Buttons_SharedCode_Close SCALE WALTER_ELEMENT PARAMETER_SECTION

                endmacro


                ;   ##### Draw : MCP : Buttons : FX Bypass
                ; --------------------------------------------------------------------------------

                    macro MAC_DrawMcp_Buttons_FxBypass SCALE WALTER_ELEMENT PARAMETER_SECTION

                        ; dimensions
                        set CUR_w VAL_Button{0}
                        set CUR_h VAL_Button{1}

                        ; visibility
                        set VAL_fxbyp_show                          \
                            ?VAL_mcp_show_button_fx{0}              \
                                ?VAL_mcp_button_group_count{0}      \
                                    1                               \
                                    0                               \
                                0                                   \

                        ; x position
                        set VAL_fxbyp_x                                                             \
                            ?VAL_fxbyp_show{0}                                                      \
                                par_mcp_##PARAMETER_SECTION##_element_width==0                      \
                                    WALTER_ELEMENT##.fx{0}                                          \
                                    + WALTER_ELEMENT##.fx{0} + VAL_mcp_spacing_x{0} VAL_Button{0}

                        ; y position
                        set VAL_fxbyp_y                                                                 \
                            ?VAL_fxbyp_show{0}                                                          \
                                par_mcp_##PARAMETER_SECTION##_element_width==0                          \
                                        + WALTER_ELEMENT##.fx{1} + VAL_Button{1} VAL_mcp_spacing_y      \
                                        WALTER_ELEMENT##.fx{1}                                          \
                                    0


                        ; [DRAW] Fx Bypass
                        set WALTER_ELEMENT##.fxbyp                                  \
                            ?VAL_fxbyp_show{0}                                      \
                                [VAL_fxbyp_x VAL_fxbyp_y CUR_w CUR_h 0 0 0 0]

                        front WALTER_ELEMENT##.fxbyp


                    endmacro

                ;   ##### Draw : MCP : Buttons : Center Offset
                ; --------------------------------------------------------------------------------

                    ; Depending on which buttons are visible and which layout is active,
                    ; each button line gets a pre-calculated horizontal offset to center the buttons.
                    ;
                    ; This macro covers the 2-buttons-per-line layout.

                    macro MAC_DrawMcp_Buttons_CenterOffset SCALE WALTER_ELEMENT PARAMETER_SECTION IS_WIDE INDEX_1 INDEX_2 

                        set CUR_x                                                       \
                            !IS_WIDE{0}                                                 \
                                par_mcp_##PARAMETER_SECTION##_element_vis&INDEX_1       \
                                    par_mcp_##PARAMETER_SECTION##_element_vis&INDEX_2   \
                                        .                                               \
                                        VAL_mcp_button_x_center_offset{0}               \
                                par_mcp_##PARAMETER_SECTION##_element_vis&INDEX_2       \
                                    par_mcp_##PARAMETER_SECTION##_element_vis&INDEX_1   \
                                        .                                               \
                                        VAL_mcp_button_x_center_offset{0}
                        
                    endmacro

                ;   ##### Draw : MCP : Buttons : Center Offset : Wide
                ; --------------------------------------------------------------------------------

                    ; Depending on which buttons are visible and which layout is active,
                    ; each button line gets a pre-calculated horizontal offset to center the buttons.
                    ;
                    ; This macro covers the 4-buttons-per-line layout.

                    macro MAC_DrawMcp_Buttons_CenterOffset_Wide SCALE WALTER_ELEMENT PARAMETER_SECTION IS_WIDE INDEX_1 INDEX_2 INDEX_3 INDEX_4 WEIGHT_1 WEIGHT_2 WEIGHT_3 WEIGHT_4

                        set VAL_mcp_button_offset_count 0
                        
                        ; element 1 missing check
                        set VAL_mcp_button_offset_count                             \
                            ?IS_WIDE{0}                                             \
                                par_mcp_##PARAMETER_SECTION##_element_vis&INDEX_1   \
                                    .                                               \
                                    + VAL_mcp_button_offset_count{0} WEIGHT_1{0}
                        
                        ; element 2 missing check
                        set VAL_mcp_button_offset_count                             \
                            ?IS_WIDE{0}                                             \
                                par_mcp_##PARAMETER_SECTION##_element_vis&INDEX_2   \
                                    .                                 \
                                    + VAL_mcp_button_offset_count{0} WEIGHT_2{0}

                        ; element 3 missing check
                        set VAL_mcp_button_offset_count                             \
                            ?IS_WIDE{0}                                             \
                                par_mcp_##PARAMETER_SECTION##_element_vis&INDEX_3   \
                                    .                                               \
                                    + VAL_mcp_button_offset_count{0} WEIGHT_3{0}

                        ; element 4 missing check
                        set VAL_mcp_button_offset_count                             \
                            ?IS_WIDE{0}                                             \
                                par_mcp_##PARAMETER_SECTION##_element_vis&INDEX_4   \
                                    .                                               \
                                    + VAL_mcp_button_offset_count{0} WEIGHT_4{0}
                        
                        ; [ROUND]
                        ; apply offset
                        set CUR_x                                                                                                                                           \
                            ?IS_WIDE{0}                                                                                                                                     \
                                VAL_mcp_button_offset_count{0}<=0                                                                                                           \
                                    VAL_mcp_x_button_start{0}                                                                                                               \
                                VAL_mcp_button_offset_count{0}>0                                                                                                            \
                                    +                                                                                                                                       \
                                        VAL_mcp_x_button_start{0}                                                                                                           \
                                        + VAL_rounding_constant{0} - * 0.5 * VAL_mcp_button_offset_count + VAL_Button{0} VAL_mcp_spacing_x{0} VAL_rounding_constant{0}

                        
                    endmacro


                ;   ##### Draw : MCP : Buttons : Single Button
                ; --------------------------------------------------------------------------------

                    macro MAC_DrawMcp_Buttons_SingleButton SCALE INDEX WALTER_ELEMENT PARAMETER_SECTION ELEMENT LINEBREAK

                        ; detect separator
                        set CUR_separator_increment                                     \
                            par_mcp_##PARAMETER_SECTION##_element_separator&INDEX       \
                                1                                                       \
                                0

                        ; y target position
                        set CUR_y_hide + CUR_y_next_button{0} CUR_h{0}

                        ; hiding logic
                        set VAL_mcp_hide_rest                                       \
                            par_mcp_##PARAMETER_SECTION##_element_vis&INDEX         \
                                CUR_y_hide{0}>VAL_mcp_y_labelHide{0}                \
                                    1

                        ; visibility
                        set VAL_mcp_show_button_##ELEMENT                       \
                            ?VAL_mcp_hide_rest{0}                               \
                                0                                               \
                            par_mcp_##PARAMETER_SECTION##_element_vis&INDEX     \
                                1                                               \
                                0

                        ; update y position (including button spacing)
                        set CUR_y                                   \
                            ?VAL_mcp_show_button_##ELEMENT##{0}     \
                                CUR_y_next_button{0}

                        ; line count
                        set VAL_mcp_button_line_count               \
                            ?VAL_mcp_show_button_##ELEMENT##{0}     \
                                + VAL_mcp_button_line_count{0} 1

                        set VAL_mcp_new_line                    \
                            ?LINEBREAK{0}                       \
                                ?VAL_mcp_button_line_count{0}   \
                                    1                           \
                                    0                           \
                                0

                        ; counter
                        set VAL_mcp_button_group_count  +   VAL_mcp_button_group_count{0}   VAL_mcp_show_button_##ELEMENT##{0}
                        set VAL_mcp_button_count        +   VAL_mcp_button_count{0}         VAL_mcp_show_button_##ELEMENT##{0}

                        ; drawing
                        set WALTER_ELEMENT##.##ELEMENT              \
                            ?VAL_mcp_show_button_##ELEMENT##{0}     \
                                [CUR_x{0} CUR_y{0} CUR_w{0} CUR_h{0} 0 0 0 0]

                        front WALTER_ELEMENT##.##ELEMENT

                        ; increment x position
                        set CUR_x                                               \
                            ?VAL_mcp_show_button_##ELEMENT##{0}                 \
                                !VAL_mcp_new_line{0}                            \
                                    + CUR_x{0} + CUR_w{0} VAL_mcp_spacing_x{0}

                        ; x position reset
                        set CUR_x                           \
                            ?VAL_mcp_new_line{0}            \
                                VAL_mcp_x_button_start{0}

                        ; increment y position
                        set CUR_y                       \
                            ?VAL_mcp_new_line{0}        \
                                + CUR_y{0} CUR_h{0}

                        ; next button position
                        set CUR_y_next_button                                                       \
                            ?VAL_mcp_new_line{0}                                                    \
                                ?CUR_separator_increment{0}                                         \
                                    + CUR_y{0} + VAL_mcp_spacing_y{0} VAL_mcp_spacing_separator{0}  \
                                    + CUR_y{0} VAL_mcp_spacing_y{0}

                        ; reset line count
                        set VAL_mcp_button_line_count       \
                            ?VAL_mcp_new_line{0}            \
                                0

                        set VAL_mcp_new_line 0

                    endmacro

        ;   ### Draw : MCP : Buttons : Shared Code : Close
        ; --------------------------------------------------------------------------------

            macro MAC_DrawMcp_Buttons_SharedCode_Close SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; x position reset
                set CUR_x VAL_mcp_x_button_start{0}

                ; y section spacer
                set CUR_y                                       \
                    ?VAL_mcp_button_count{0}                    \
                        + CUR_y{0} VAL_mcp_spacing_section_y{0}

            endmacro


    ;   ## Draw : MCP : Meter : Top
    ; --------------------------------------------------------------------------------

        macro MAC_DrawMcp_Meter_Top SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; visibility
            set VAL_mcp_show_meter_top                              \
                ?VAL_mcp_hide_rest{0}                               \
                    0                                               \
                par_mcp_##PARAMETER_SECTION##_meter_pos{0}==1       \
                    1                                               \
                    0

            ; width
            set CUR_w VAL_mcp_w_meter{0}

            ; x position
            set CUR_x VAL_mcp_x_meter{0}

            ; [ROUND]
            ; height
            set VAL_mcp_meter_top_remaining_h - h + - VAL_mcp_y_offset_max{0} VAL_mcp_y_offset{0} + CUR_y{0} - VAL_mcp_h{0} VAL_mcp_y_post_label{0}

            set CUR_h                                                                                                                                                                                                                       \
                ?VAL_mcp_show_meter_top{0}                                                                                                                                                                                                  \
                    ?par_mcp_##PARAMETER_SECTION##_meter_size_scale                                                                                                                                                                         \
                        + VAL_rounding_constant{0} - + VAL_mcp_meter_min_h{0} * - VAL_mcp_meter_top_remaining_h{0} VAL_mcp_meter_min_h{0}    * VAL_Fader_Scale{0}    par_mcp_##PARAMETER_SECTION##_meter_size    VAL_rounding_constant{0}   \
                        + VAL_rounding_constant{0} - + VAL_mcp_meter_min_h{0} * SCALE                                                        * 0.3                   par_mcp_##PARAMETER_SECTION##_meter_size    VAL_rounding_constant{0}   \
                    0

            ; padding correction
            set CUR_y                               \
                ?VAL_mcp_show_meter_top{0}          \
                    ?VAL_mcp_meter_padding{0}       \
                        + CUR_y{0} VAL_Border{0}

            set CUR_h                               \
                ?VAL_mcp_show_meter_top{0}          \
                    ?VAL_mcp_meter_padding{0}       \
                        - CUR_h{0} VAL_Border_2{0}

            ; empty button section offset (force border overlap)
            set CUR_y                                                   \
                ?VAL_mcp_inserts_on_top{0}                              \
                    par_mcp_##PARAMETER_SECTION##_element_vis{0}==0     \
                        - CUR_y VAL_Border

            ; overshoot
            set VAL_mcp_meter_top_overshoot - h - VAL_mcp_h{0} - VAL_mcp_y_post_label_parallel{0} CUR_y{0}

            ; readout visibility
            set VAL_mcp_meter_top_overshoot_readout - VAL_mcp_meter_top_overshoot{0} VAL_mcp_vol_readout_h{0}

            set VAL_mcp_show_vol_readout                                    \
                ?VAL_mcp_show_meter_top{0}                                  \
                    VAL_mcp_meter_top_overshoot_readout{0}>CUR_h{0}         \
                        ?par_mcp_##PARAMETER_SECTION##_meter_vol_readout    \
                            1                                               \
                            0                                               \
                        0                                                   \
                    0

            ; overshoot height correction
            set CUR_h                                       \
                VAL_mcp_meter_top_overshoot{0}<CUR_h{0}     \
                    VAL_mcp_meter_top_overshoot{0}

            ; meter overshoot marker
            set VAL_mcp_hide_rest                                       \
                ?VAL_mcp_show_meter_top{0}                              \
                    VAL_mcp_meter_top_overshoot_readout{0}<=CUR_h{0}    \
                        1

            ; [DRAW] Meter
            set CUR_meter + [CUR_x{0} CUR_y{0} CUR_w{0} CUR_h{0}] [VAL_Border{0} VAL_Border{0} VAL_Border_Neg_2{0} VAL_Border_Neg_2{0}]

            set WALTER_ELEMENT##.custom.meter_frame                 \
                ?VAL_mcp_show_meter_top{0}                          \
                    [CUR_x{0} CUR_y{0} CUR_w{0} CUR_h{0} 0 0 1 0]   \
                    0

            set WALTER_ELEMENT##.meter                                              \
                ?VAL_mcp_show_meter_top{0}                                          \
                    [CUR_meter{0} CUR_meter{1} CUR_meter{2} CUR_meter{3} 0 0 1 0]

            ; meter text
            set WALTER_ELEMENT##.meter.scale.color.lit.top          ?par_mcp_##PARAMETER_SECTION##_meter_vu_db          VAL_meter_mcp_lit_top
            set WALTER_ELEMENT##.meter.scale.color.lit.bottom       ?par_mcp_##PARAMETER_SECTION##_meter_vu_db          VAL_meter_mcp_lit_bottom
            set WALTER_ELEMENT##.meter.scale.color.unlit.top        ?par_mcp_##PARAMETER_SECTION##_meter_vu_db          VAL_meter_mcp_unlit_top
            set WALTER_ELEMENT##.meter.scale.color.unlit.bottom     ?par_mcp_##PARAMETER_SECTION##_meter_vu_db          VAL_meter_mcp_unlit_bottom
            set WALTER_ELEMENT##.meter.readout.color                ?par_mcp_##PARAMETER_SECTION##_meter_vu_readout     VAL_meter_mcp_readout

            ; increment y position
            set CUR_y                           \
                ?VAL_mcp_show_meter_top{0}      \
                    + CUR_y{0} CUR_h{0}

            ; readout width
            set VAL_mcp_vol_readout_w                                   \
                ?VAL_mcp_show_vol_readout{0}                            \
                    par_mcp_##PARAMETER_SECTION##_meter_vol_readout==1  \
                        CUR_w{0}                                        \
                        VAL_MCP_Label{0}                                \
                    0

            ; readout x
            set VAL_mcp_vol_readout_x                                           \
                ?VAL_mcp_show_vol_readout{0}                                    \
                    par_mcp_##PARAMETER_SECTION##_meter_vol_readout==1          \
                        CUR_x{0}                                                \
                        + CUR_x{0} * 0.5 - CUR_w{0} VAL_mcp_vol_readout_w{0}    \
                    0

            ; [DRAW] Volume Readout
            set WALTER_ELEMENT##.volume.label                                                                       \
                ?VAL_mcp_show_vol_readout{0}                                                                        \
                    [VAL_mcp_vol_readout_x{0} CUR_y{0} VAL_mcp_vol_readout_w{0} VAL_mcp_vol_readout_h{0} 0 0 1 0]

            ; readout bg
            set WALTER_ELEMENT##.custom.readout_bg                                                                      \
                ?VAL_mcp_show_vol_readout{0}                                                                            \
                    - + VAL_Border{0}@h [CUR_x{0} CUR_y{0} CUR_w{0} VAL_mcp_vol_readout_h{0} 0 0 1 0] VAL_Border{0}@y   \
                    0

            ; increment y position
            set CUR_y                                       \
                ?VAL_mcp_show_vol_readout{0}                \
                    + CUR_y{0} VAL_mcp_vol_readout_h{0}

            ; y section spacer
            ; --> also add a section spacer if no buttons are shown
            set CUR_y                                                   \
                ?VAL_mcp_show_meter_top{0}                              \
                    + CUR_y{0} VAL_mcp_spacing_section_y{0}             \
                    par_mcp_##PARAMETER_SECTION##_element_vis{0}==0     \
                        + CUR_y{0} VAL_mcp_spacing_section_y{0}

        endmacro

    ;   ## Draw : MCP : Meter : Format : Track
    ; --------------------------------------------------------------------------------

        macro MAC_DrawMcp_Meter_Format_Track SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; meter channel division
            set CUR_chan_div           * SCALE * 0.05 par_mcp_##PARAMETER_SECTION##_meter_channeldiv
            
            ; gain reduction
            set CUR_gain_div           * SCALE * 0.05 par_mcp_##PARAMETER_SECTION##_meter_gaindiv
            set CUR_gain_wid    + 1    * SCALE * 0.05 par_mcp_##PARAMETER_SECTION##_meter_gainwid

            ; set dimensions
            set WALTER_ELEMENT##.meter.vu.div [CUR_chan_div{0} 0 CUR_gain_div{0} CUR_gain_wid{0}]

        endmacro

    ;   ## Draw : MCP : Meter : Format : Master
    ; --------------------------------------------------------------------------------

        macro MAC_DrawMcp_Meter_Format_Master SCALE WALTER_ELEMENT PARAMETER_SECTION
            
            ; meter channel division
            set CUR_chan_div           * SCALE * 0.05 par_mcp_##PARAMETER_SECTION##_meter_channeldiv
            
            ; set dimensions
            set WALTER_ELEMENT##.meter.vu.div       [CUR_chan_div{0} 0]
            set WALTER_ELEMENT##.meter.vu.rmsdiv    [CUR_chan_div{0} 0]

        endmacro

    ;   ## Draw : MCP : Faders : Top
    ; --------------------------------------------------------------------------------

        macro MAC_DrawMcp_Faders_Top SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; visibility - layout detection
            set VAL_mcp_show_faders_top                             \
                ?VAL_mcp_hide_rest{0}                               \
                    0                                               \
                par_mcp_##PARAMETER_SECTION##_fader_layout==0       \
                    !VAL_mcp_button_count{0}                        \
                        1                                           \
                    !VAL_mcp_hide_rest{0}                           \
                        1                                           \
                        0                                           \
                    0

            ; horizontal fader correction
            set VAL_mcp_faders_panmode                                  \
                ?VAL_mcp_show_faders_top{0}                             \
                    par_mcp_##PARAMETER_SECTION##_fader_layout{0}==2    \
                        1                                               \
                    par_mcp_##PARAMETER_SECTION##_fader_layout{0}!=0    \
                        VAL_mcp_faders_panmode{0}==2                    \
                            1

            ; fadermodes
            set WALTER_ELEMENT##.volume.fadermode -1

            set WALTER_ELEMENT##.pan.fadermode      \
                !VAL_mcp_faders_panmode{0}          \
                    1                               \
                    -1

            set WALTER_ELEMENT##.width.fadermode WALTER_ELEMENT##.pan.fadermode

            ; show width fader
            set VAL_mcp_faders_show_width                           \
                !par_mcp_##PARAMETER_SECTION##_fader_wid_always     \
                    trackpanmode>=5                                 \
                        1                                           \
                        0                                           \
                    1

            ; visibility - layout detection
            set VAL_mcp_show_faders_top                             \
                ?VAL_mcp_hide_rest{0}                               \
                    0                                               \
                par_mcp_##PARAMETER_SECTION##_fader_layout==0       \
                    !VAL_mcp_button_count{0}                        \
                        1                                           \
                    !VAL_mcp_hide_rest{0}                           \
                        1                                           \
                        0                                           \
                    0

            ; horizontal fader correction
            set VAL_mcp_faders_panmode                              \
                par_mcp_##PARAMETER_SECTION##_fader_layout!=0       \
                    VAL_mcp_faders_panmode{0}==2                    \
                        1

            ; show width fader
            set VAL_mcp_faders_show_width                           \
                !par_mcp_##PARAMETER_SECTION##_fader_wid_always     \
                    trackpanmode>=5                                 \
                        1                                           \
                        0                                           \
                    1

            ; fader width
            set CUR_w                                               \
                VAL_mcp_faders_panmode{0}==2                        \
                    - VAL_mcp_precalc_w_faders_top VAL_Unit         \
                VAL_mcp_faders_panmode{0}==1                        \
                    VAL_Button{0}                                   \
                    VAL_Knob{0}


            ; fader height
            set CUR_h                           \
                VAL_mcp_faders_panmode{0}==2    \
                    VAL_Fader{2}                \
                VAL_mcp_faders_panmode{0}==1    \
                    VAL_Button{0}               \
                    VAL_Knob{0}

            ; remaining height
            set VAL_mcp_faders_top_remaining_h - h + - VAL_mcp_y_offset_max VAL_mcp_y_offset + CUR_y - VAL_mcp_h VAL_mcp_y_post_label

            ; section minimal height
            set CUR_h_section_min_vert      VAL_mcp_fader_min_h{0}
            set CUR_h_section_min_horz      + VAL_mcp_spacing_fader_y{0} * 2 VAL_Fader{2}

            set CUR_h_section_min CUR_h{0}

            set CUR_h_section_min                                   \
                ?VAL_mcp_faders_has_vert{0}                         \
                    CUR_h_section_min{0}<CUR_h_section_min_vert{0}  \
                        CUR_h_section_min_vert{0}

            set CUR_h_section_min                                   \
                ?VAL_mcp_faders_has_horz{0}                         \
                    CUR_h_section_min{0}<CUR_h_section_min_horz{0}  \
                        CUR_h_section_min_horz{0}

            ; [ROUND]
            ; section target height
            set CUR_h_section                                                                                                                                                                                                       \
                ?VAL_mcp_show_faders_top{0}                                                                                                                                                                                         \
                    ?par_mcp_##PARAMETER_SECTION##_fader_pan_height_scale                                                                                                                                                           \
                        + VAL_rounding_constant{0} - * - VAL_mcp_faders_top_remaining_h{0} CUR_h_section_min  * VAL_Fader_Scale{0}              par_mcp_##PARAMETER_SECTION##_fader_pan_height          VAL_rounding_constant{0}    \
                        + VAL_rounding_constant{0} - + CUR_h_section_min{0} * SCALE                                                  * 0.25     par_mcp_##PARAMETER_SECTION##_fader_pan_height          VAL_rounding_constant{0}    \
                    0

            ; preserve minimal height
            set CUR_h_section                           \
                CUR_h_section{0}<CUR_h_section_min{0}   \
                    CUR_h_section_min{0}

            ; hiding logic
            set CUR_y_hide + CUR_y{0} CUR_h_section{0}

            set VAL_mcp_hide_faders_top                     \
                ?VAL_mcp_show_faders_top{0}                 \
                    CUR_y_hide{0}>VAL_mcp_y_labelHide{0}    \
                        1                                   \
                        0                                   \
                    0

            set VAL_mcp_show_faders_top         \
                ?VAL_mcp_hide_faders_top{0}     \
                    0

            ; end position
            set CUR_y_faders_top_end    	                                    \
                ?VAL_mcp_show_faders_top{0}                                     \
                    + CUR_y{0} + CUR_h_section{0} VAL_mcp_spacing_section_y{0}  \
                    0

            ; [ROUND]
            ; initial x position
            set CUR_x                                                                                                                                                                                       \
                ?VAL_mcp_show_faders_top{0}                                                                                                                                                                 \
                    VAL_mcp_faders_panmode{0}==2                                                                                                                                                            \
                        + VAL_rounding_constant{0} - + VAL_mcp_x_offset{0} * 0.5 - - VAL_mcp_w{0} VAL_mcp_trim_right{0}          CUR_w{0}  VAL_rounding_constant{0}                                         \
                        ?VAL_mcp_faders_show_width{0}                                                                                                                                                       \
                            + VAL_rounding_constant{0} - +   VAL_mcp_x_offset{0} * 0.5 - - VAL_mcp_w{0} VAL_mcp_trim_right{0} + * 2    CUR_w{0}    VAL_mcp_spacing_fader_x{0}   VAL_rounding_constant{0}    \
                            + VAL_rounding_constant{0} - +   VAL_mcp_x_offset{0} * 0.5 - - VAL_mcp_w{0} VAL_mcp_trim_right{0}          CUR_w{0}                                 VAL_rounding_constant{0}

            ; [ROUND]
            ; y position center offset
            set CUR_y_offset                                                                                                                                \
                ?VAL_mcp_show_faders_top{0}                                                                                                                 \
                    VAL_mcp_faders_panmode{0}==1                                                                                                            \
                        0                                                                                                                                   \
                    VAL_mcp_faders_panmode{0}==2                                                                                                            \
                        ?VAL_mcp_faders_show_width{0}                                                                                                       \
                            + VAL_rounding_constant{0} - * 0.5 - CUR_h_section{0} + VAL_mcp_spacing_fader_y{0} * 2 CUR_h{2}     VAL_rounding_constant{0}    \
                            + VAL_rounding_constant{0} - * 0.5 - CUR_h_section{0} CUR_h{0}                                      VAL_rounding_constant{0}    \
                        + VAL_rounding_constant{0} - * 0.5 - CUR_h_section{0} CUR_h{0}              VAL_rounding_constant{0}                                \
                    0

            ; initial y offset
            set CUR_y                           \
                ?VAL_mcp_show_faders_top{0}     \
                    + CUR_y{0} CUR_y_offset{0}

            ; [DRAW] pan
            set WALTER_ELEMENT##.pan                                                                    \
                ?VAL_mcp_show_faders_top{0}                                                             \
                    ?VAL_mcp_faders_panmode{0}==2                                                       \
                        [CUR_x{0} CUR_y{0} CUR_w{0}      VAL_fader{2}        0 0 0 0]                   \
                    ?VAL_mcp_faders_panmode{0}==1                                                       \
                        + [CUR_x{0} CUR_y{0} VAL_Fader{0}  CUR_h_section{0} 0 0 0 0] VAL_Fader{1}@x     \
                        [CUR_x{0} CUR_y{0} VAL_Knob{0} VAL_Knob{0} 0 0 0 0]

            set WALTER_ELEMENT##.custom.pan_frame       \
                ?VAL_mcp_show_faders_top{0}             \
                    VAL_mcp_faders_panmode{0}!=0        \
                        WALTER_ELEMENT##.pan            \
                        0                               \
                    0

            set WALTER_ELEMENT##.custom.pan_knob_frame      \
                ?VAL_mcp_show_faders_top{0}                 \
                    VAL_mcp_faders_panmode{0}==0            \
                        WALTER_ELEMENT##.pan                \
                        0                                   \
                    0

            ; increment y position
            set CUR_y                                                               \
                ?VAL_mcp_show_faders_top{0}                                         \
                    ?VAL_mcp_faders_show_width{0}                                   \
                        VAL_mcp_faders_panmode{0}==2                                \
                            + CUR_y{0} + CUR_h{0} VAL_mcp_spacing_fader_y{0}

            ; increment x position
            set CUR_x                                                           \
                ?VAL_mcp_show_faders_top{0}                                     \
                    ?VAL_mcp_faders_show_width{0}                               \
                        VAL_mcp_faders_panmode{0}!=2                            \
                            + CUR_x{0} + CUR_w{0} VAL_mcp_spacing_fader_x{0}

            ; [DRAW] width
            set WALTER_ELEMENT##.width                                                                      \
                ?VAL_mcp_show_faders_top{0}                                                                 \
                    ?VAL_mcp_faders_show_width{0}                                                           \
                        VAL_mcp_faders_panmode{0}==2                                                        \
                            [CUR_x{0} CUR_y{0} CUR_w{0}      VAL_fader{2}        0 0 0 0]                   \
                        VAL_mcp_faders_panmode{0}==1                                                        \
                            + [CUR_x{0} CUR_y{0} VAL_Fader{0}  CUR_h_section{0} 0 0 0 0] VAL_Fader{1}@x     \
                            [CUR_x{0} CUR_y{0} VAL_Knob{0} VAL_Knob{0} 0 0 0 0]

            set WALTER_ELEMENT##.custom.wid_frame       \
                ?VAL_mcp_show_faders_top{0}             \
                    ?VAL_mcp_faders_show_width{0}       \
                        VAL_mcp_faders_panmode{0}!=0    \
                            WALTER_ELEMENT##.width      \
                            0                           \
                        0                               \
                    0

            set WALTER_ELEMENT##.custom.wid_knob_frame      \
                ?VAL_mcp_show_faders_top{0}                 \
                    ?VAL_mcp_faders_show_width{0}           \
                        VAL_mcp_faders_panmode{0}==0        \
                            WALTER_ELEMENT##.width          \
                            0                               \
                        0                                   \
                    0

            ; update cursor end postion
            set CUR_y                           \
                ?VAL_mcp_show_faders_top{0}     \
                    CUR_y_faders_top_end{0}

        endmacro


    ;   ## Draw : MCP : Meter : Bottom
    ; --------------------------------------------------------------------------------

        macro MAC_DrawMcp_Meter_Bottom SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; y position
            set VAL_mcp_bottom_faders_y CUR_y{0}

            ; visibility
            set VAL_mcp_show_meter_bottom                       \
                ?VAL_mcp_hide_rest{0}                           \
                    0                                           \
                par_mcp_##PARAMETER_SECTION##_meter_pos!=2      \
                    0                                           \
                    !VAL_mcp_hide_rest{0}                       \
                        1                                       \
                        0

            ; calculate height using remaining vertical space
            set VAL_mcp_meter_bottom_remaining_h - h + - VAL_mcp_y_offset_max{0} VAL_mcp_y_offset{0} + CUR_y{0} - VAL_mcp_h{0} - VAL_mcp_y_post_label{0} VAL_Pad{0}

            set CUR_h VAL_mcp_meter_bottom_remaining_h{0}

            ; readout visibility
            set VAL_mcp_show_vol_readout                                \
                ?VAL_mcp_show_meter_bottom{0}                           \
                    ?par_mcp_##PARAMETER_SECTION##_meter_vol_readout    \
                        1                                               \
                        0                                               \
                    0

            ; meter height (including optional readout)
            set CUR_h_meter - CUR_h{0} VAL_mcp_vol_readout_h{0}

            ; readout overshoot check
            set VAL_mcp_show_vol_readout                    \
                CUR_h_meter{0}<VAL_mcp_vol_readout_h{0}     \
                0

            ; revert height when missing readout
            set CUR_h_meter                     \
                !VAL_mcp_show_vol_readout{0}    \
                    CUR_h{0}

            ; width
            set CUR_w VAL_mcp_meter_bottom_w_precalc{0}

            ; x position
            set CUR_x + VAL_mcp_x_offset{0} * 0.5 - VAL_mcp_w{0} VAL_mcp_precalc_w_bottom{0}

            ; [DRAW] meter
            set CUR_meter + [CUR_x{0} CUR_y{0} CUR_w{0} CUR_h_meter{0}] [VAL_Border{0} VAL_Border{0} VAL_Border_Neg_2{0} VAL_Border_Neg_2{0}]

            set WALTER_ELEMENT##.custom.meter_frame                         \
                ?VAL_mcp_show_meter_bottom{0}                               \
                    [CUR_x{0} CUR_y{0} CUR_w{0} CUR_h_meter{0} 0 0 0 0]

            set WALTER_ELEMENT##.meter                                              \
                ?VAL_mcp_show_meter_bottom{0}                                       \
                    [CUR_meter{0} CUR_meter{1} CUR_meter{2} CUR_meter{3} 0 0 0 0]

            ; readout width
            set VAL_mcp_vol_readout_w                                   \
                ?VAL_mcp_show_vol_readout{0}                            \
                    par_mcp_##PARAMETER_SECTION##_meter_vol_readout==1  \
                        CUR_w{0}                                        \
                        VAL_MCP_Label{0}

            ; [ROUND]
            ; readout x
            set VAL_mcp_vol_readout_x                                                                                                   \
                ?VAL_mcp_show_vol_readout{0}                                                                                            \
                    par_mcp_##PARAMETER_SECTION##_meter_vol_readout==1                                                                  \
                        CUR_x{0}                                                                                                        \
                        + VAL_rounding_constant{0} - + CUR_x{0} * 0.5 - CUR_w{0} VAL_mcp_vol_readout_w{0}   VAL_rounding_constant{0}    \
                    0

            ; readout y
            set CUR_readout_y                   \
                ?VAL_mcp_show_vol_readout{0}    \
                    + CUR_y{0} CUR_h_meter{0}   \
                    0

            ; [DRAW] Volume Readout
            set WALTER_ELEMENT##.volume.label                                                                               \
                ?VAL_mcp_show_vol_readout{0}                                                                                \
                    [VAL_mcp_vol_readout_x{0} CUR_readout_y{0} VAL_mcp_vol_readout_w{0} VAL_mcp_vol_readout_h{0} 0 0 0 0]

            ; readout bg
            set CUR_w_readout_bg                \
                ?VAL_mcp_show_vol_readout{0}    \
                    CUR_w{0}                    \
                    0

            ; readout bg
            set WALTER_ELEMENT##.custom.readout_bg                                                                              \
                ?VAL_mcp_show_vol_readout{0}                                                                                    \
                    - + VAL_Border{0}@h [CUR_x{0} CUR_readout_y{0} CUR_w{0} VAL_mcp_vol_readout_h{0} 0 0 0 0] VAL_Border{0}@y

            ; increment x position
            set CUR_x                                                   \
                ?VAL_mcp_show_meter_bottom{0}                           \
                    + CUR_x{0} + CUR_w{0} VAL_mcp_spacing_section_x{0}

            front WALTER_ELEMENT##.custom.readout_bg
            front WALTER_ELEMENT##.volume.label
            front WALTER_ELEMENT##.meter
            front WALTER_ELEMENT##.custom.meter_frame



        endmacro

    ;   ## Draw : MCP : Faders : Bottom
    ; --------------------------------------------------------------------------------

        macro MAC_DrawMcp_Faders_Bottom SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; visibility
            set VAL_mcp_show_faders_pan_bottom                  \
                par_mcp_##PARAMETER_SECTION##_fader_layout!=0   \
                    1                                           \
                    0

            set VAL_mcp_hide_faders_bottom      \
                ?VAL_mcp_hide_rest{0}           \
                    1                           \
                ?VAL_mcp_hide_rest{0}           \
                    1                           \
                    0

            ; ::::::::::::::::::::::::::::::::::::::::::::::::::
            ;       Layout -> Pan above Volume
            ; ::::::::::::::::::::::::::::::::::::::::::::::::::

            ; pan section visibility
            set VAL_mcp_show_pansection                             \
                ?VAL_mcp_show_faders_pan_bottom{0}                  \
                    par_mcp_##PARAMETER_SECTION##_fader_layout==1   \
                        1                                           \
                        0                                           \
                    0

            ; width
            set CUR_w VAL_Button{0}
            set CUR_w_fader VAL_Fader{0}

            ; x position offset
            set CUR_x_fader + CUR_x VAL_Fader{1}

            ; pan section height calculation
            set VAL_bottom_remaining_h - h - 0 + CUR_y{0} - VAL_mcp_h{0} - VAL_mcp_y_post_label{0} VAL_Pad{0}
            set CUR_h VAL_bottom_remaining_h{0}

            ; calculate the minimal height
            set CUR_h_section_min                                       \
                !VAL_mcp_faders_has_horz{0}                             \
                    !VAL_mcp_faders_has_vert{0}                         \
                        + VAL_mcp_spacing_fader_y{0} * 2 VAL_Knob{0}    \
                        VAL_mcp_fader_min_h_2{0}                        \
                    VAL_mcp_fader_min_h_2{0}

            ; [ROUND]
            ; panning sectiom height
            set CUR_h_section                                                                                                                                                                   \
                ?par_mcp_##PARAMETER_SECTION##_fader_pan_height_scale                                                                                                                           \
                    + VAL_rounding_constant{0} - * VAL_bottom_remaining_h{0}  * VAL_Fader_Scale{0}              par_mcp_##PARAMETER_SECTION##_fader_pan_height     VAL_rounding_constant{0}     \
                    + VAL_rounding_constant{0} - + CUR_h_section_min{0} * SCALE                      * 0.25     par_mcp_##PARAMETER_SECTION##_fader_pan_height     VAL_rounding_constant{0}

            ; preserve minimal height
            set CUR_h_section                           \
                CUR_h_section{0}<CUR_h_section_min{0}   \
                    CUR_h_section_min{0}

            ; calculate y position past panning section
            set CUR_y_post_pan      + CUR_y{0} + CUR_h_section{0} * 2 VAL_mcp_spacing_fader_y{0}

            ; [ROUND]
            ; individual fader height
            set CUR_h                                                                                   \
                VAL_mcp_faders_panmode{0}==0                                                            \
                    VAL_Knob{0}                                                                         \
                ?VAL_mcp_faders_show_width{0}                                                           \
                    + VAL_rounding_constant{0} - * 0.5 CUR_h_section{0}    VAL_rounding_constant{0}     \
                    + CUR_h_section{0} VAL_mcp_spacing_fader_y{0}

            ; [ROUND]
            ; pan knob y offset
            set CUR_y_offset                                                                                                \
                VAL_mcp_faders_panmode{0}!=0                                                                                \
                    0                                                                                                       \
                    ?VAL_mcp_faders_show_width{0}                                                                           \
                        + VAL_rounding_constant{0} - * 0.5 - CUR_h_section{0} * 2    CUR_h{0}   VAL_rounding_constant{0}   \
                        + VAL_rounding_constant{0} - * 0.5 - CUR_h_section{0}        CUR_h{0}   VAL_rounding_constant{0}

            ; pan hiding logic
            set CUR_y_hide + CUR_y CUR_h_section
            
            set VAL_mcp_hide_faders_Pan                 \
                CUR_y_hide{0}>VAL_mcp_y_labelHide{0}    \
                    1                                   \
                    0

            set VAL_mcp_show_pansection         \
                ?VAL_mcp_hide_faders_Pan{0}     \
                    0

            ; pan knob pre y offset
            set CUR_y                               \
                ?VAL_mcp_show_pansection{0}         \
                    VAL_mcp_faders_panmode{0}==0    \
                        + CUR_y{0} CUR_y_offset{0}

            ; [DRAW] pan
            set WALTER_ELEMENT##.pan                                                    \
                ?VAL_mcp_show_pansection{0}                                             \
                    !VAL_mcp_hide_faders_bottom{0}                                      \
                        VAL_mcp_faders_panmode{0}==0                                    \
                            [CUR_x{0}       CUR_y{0} CUR_w{0}       CUR_h{0} 0 0 0 0]   \
                            [CUR_x_fader{0} CUR_y{0} CUR_w_fader{0} CUR_h{0} 0 0 0 0]

            set WALTER_ELEMENT##.custom.pan_frame           \
                ?VAL_mcp_show_pansection{0}                 \
                    !VAL_mcp_hide_faders_bottom{0}          \
                        VAL_mcp_faders_panmode{0}!=0        \
                            WALTER_ELEMENT##.pan

            set WALTER_ELEMENT##.custom.pan_knob_frame      \
                ?VAL_mcp_show_pansection{0}                 \
                    !VAL_mcp_hide_faders_bottom{0}          \
                        VAL_mcp_faders_panmode{0}==0        \
                            WALTER_ELEMENT##.pan

            ; pan knob post y offset
            set CUR_y                                                   \
                ?VAL_mcp_show_pansection{0}                             \
                    + CUR_y{0} + CUR_h{0} VAL_mcp_spacing_fader_y{0}

            ; [DRAW] width
            set WALTER_ELEMENT##.width                                                      \
                ?VAL_mcp_show_pansection{0}                                                 \
                    ?VAL_mcp_faders_show_width{0}                                           \
                        !VAL_mcp_hide_faders_bottom{0}                                      \
                            VAL_mcp_faders_panmode{0}==0                                    \
                                [CUR_x{0}       CUR_y{0} CUR_w{0}       CUR_h{0} 0 0 0 0]   \
                                [CUR_x_fader{0} CUR_y{0} CUR_w_fader{0} CUR_h{0} 0 0 0 0]

            set WALTER_ELEMENT##.custom.wid_frame               \
                ?VAL_mcp_show_pansection{0}                     \
                    ?VAL_mcp_faders_show_width{0}               \
                        !VAL_mcp_hide_faders_bottom{0}          \
                            VAL_mcp_faders_panmode{0}!=0        \
                                WALTER_ELEMENT##.width

            set WALTER_ELEMENT##.custom.wid_knob_frame          \
                ?VAL_mcp_show_pansection{0}                     \
                    ?VAL_mcp_faders_show_width{0}               \
                        !VAL_mcp_hide_faders_bottom{0}          \
                            VAL_mcp_faders_panmode{0}==0        \
                                WALTER_ELEMENT##.width

            ; place y cursor past panning section
            set CUR_y                           \
                ?VAL_mcp_show_pansection{0}     \
                    CUR_y_post_pan{0}

            ; ::::::::::::::::::::::::::::::::::::::::::::::::::
            ;       Volume Fader Dimension Calculations
            ; ::::::::::::::::::::::::::::::::::::::::::::::::::

            ; remaining height calculation
            set CUR_h - h + - VAL_mcp_y_offset_max{0} VAL_mcp_y_offset{0} + CUR_y{0} - VAL_mcp_h{0} - VAL_mcp_y_post_label{0} VAL_Pad{0}
            
            ; store volume fader height
            set CUR_h_vol_fader CUR_h{0}

            ; store volume x position
            set CUR_x_vol_knob CUR_x{0}
            set CUR_x_vol_fader CUR_x_fader{0}
            
            ; store volume fader y position
            set CUR_y_vol_fader CUR_y{0}

            ; hide for volume display
            set VAL_mcp_show_vol                    \
                CUR_h{0}>VAL_mcp_vol_h_min_show{0}  \
                    1                               \
                    0

            ; height check if volume should be displayed as knob
            set VAL_mcp_vol_knob                    \
                CUR_h{0}>VAL_mcp_vol_h_min_knob{0}  \
                    0                               \
                    1

            ; volume knob display
            set WALTER_ELEMENT##.volume.fadermode   \
                ?VAL_mcp_vol_knob{0}                \
                    1                               \
                    -1

            ; volume knob y position
            set CUR_y_volknob + CUR_y * 0.5 - CUR_h VAL_Knob


    	    ; ::::::::::::::::::::::::::::::::::::::::::::::::::
            ;       Layout -> Pan next to Volume
            ; ::::::::::::::::::::::::::::::::::::::::::::::::::

            ; pan section visibility
            set VAL_mcp_show_pansection                         \
                par_mcp_##PARAMETER_SECTION##_fader_layout==2   \
                    1                                           \
                    0


            ; starting y position
            set CUR_y                           \
                ?VAL_mcp_show_pansection{0}     \
                    VAL_mcp_bottom_faders_y{0}

            ; x position increment
            set CUR_x                                                   \
                ?VAL_mcp_show_pansection{0}                             \
                    + CUR_x{0} + CUR_w{0} VAL_mcp_spacing_fader_x{0}

            ; x position offset
            set CUR_x_fader + CUR_x VAL_Fader{1}

            ; [ROUND]
            ; fader height
            set CUR_h                                                                                                   \
                ?VAL_mcp_faders_show_width{0}                                                                           \
                    + VAL_rounding_constant{0} - * 0.5 - CUR_h{0} VAL_mcp_spacing_fader_y{0} VAL_rounding_constant{0}

            set VAL_mcp_show_pansection                 \
                CUR_h{0}<VAL_mcp_vol_h_min_show{0}      \
                    0

            ; minimal height hiding
            set VAL_mcp_show_pansection                 \
                    CUR_h{0}<VAL_mcp_vol_h_min_show{0}  \
                        0

            ; knob mode detection
            set VAL_mcp_pan_knobs                                   \
                    ?VAL_mcp_show_pansection{0}                     \
                        CUR_h{0}<VAL_mcp_vol_h_min_knob{0}          \
                            1                                       \
                            0                                       \
                    0

            ; knob y offset
            set CUR_y_knob_offset * 0.5 - CUR_h{0} VAL_Knob{0}

            ; knob mode override -> volume
            set WALTER_ELEMENT##.volume.fadermode    \
                ?VAL_mcp_show_pansection{0}         \
                    ?VAL_mcp_pan_knobs{0}           \
                        1                           \
                        -1

            ; volume knob instruction override
            set VAL_mcp_vol_knob                \
                ?VAL_mcp_show_pansection{0}     \
                    ?VAL_mcp_pan_knobs{0}       \
                        1

            ; knob mode override -> pan
            set WALTER_ELEMENT##.pan.fadermode      \
                ?VAL_mcp_show_pansection{0}         \
                    ?VAL_mcp_pan_knobs{0}           \
                        1                           \
                        -1

            ; knob mode override -> pan
            set WALTER_ELEMENT##.width.fadermode    \
                ?VAL_mcp_show_pansection{0}         \
                    ?VAL_mcp_pan_knobs{0}           \
                        1                           \
                        -1
            
            ; [DRAW] pan
            set WALTER_ELEMENT##.pan                                                                                                    \
                ?VAL_mcp_show_pansection{0}                                                                                             \
                    !VAL_mcp_hide_faders_bottom{0}                                                                                      \
                        !VAL_mcp_pan_knobs{0}                                                                                           \
                            [   CUR_x_fader{0}  CUR_y{0} CUR_w_fader{0}     CUR_h{0}    0 0 0 0]                                        \
                            + [ CUR_x{0}        CUR_y{0} VAL_Knob{0}        VAL_Knob{0} 0 0 0 0] CUR_y_knob_offset{0}@y

            set WALTER_ELEMENT##.custom.pan_frame       \
                ?VAL_mcp_show_pansection{0}             \
                    !VAL_mcp_hide_faders_bottom{0}      \
                        !VAL_mcp_pan_knobs{0}           \
                            WALTER_ELEMENT##.pan

            set WALTER_ELEMENT##.custom.pan_knob_frame  \
                ?VAL_mcp_show_pansection{0}             \
                    !VAL_mcp_hide_faders_bottom{0}      \
                        ?VAL_mcp_pan_knobs{0}           \
                            WALTER_ELEMENT##.pan

            
            ; width y position
            set CUR_y                                                           \
                + VAL_mcp_bottom_faders_y{0} - CUR_h_vol_fader{0} CUR_h{0}

            ; [DRAW] width
            set WALTER_ELEMENT##.width                                                                                              \
                ?VAL_mcp_show_pansection{0}                                                                                         \
                    ?VAL_mcp_faders_show_width{0}                                                                                   \
                        !VAL_mcp_hide_faders_bottom{0}                                                                              \
                            !VAL_mcp_pan_knobs{0}                                                                                   \
                                [   CUR_x_fader{0}  CUR_y{0}    CUR_w_fader{0}  CUR_h{0}        0 0 0 0]                            \
                                + [ CUR_x{0}        CUR_y{0}    VAL_Knob{0}     VAL_Knob{0}     0 0 0 0] CUR_y_knob_offset{0}@y

            set WALTER_ELEMENT##.custom.wid_frame           \
                ?VAL_mcp_show_pansection{0}                 \
                    ?VAL_mcp_faders_show_width{0}           \
                        !VAL_mcp_hide_faders_bottom{0}      \
                            !VAL_mcp_pan_knobs{0}           \
                                WALTER_ELEMENT##.width

            set WALTER_ELEMENT##.custom.wid_knob_frame      \
                ?VAL_mcp_show_pansection{0}                 \
                    ?VAL_mcp_faders_show_width{0}           \
                        !VAL_mcp_hide_faders_bottom{0}      \
                            ?VAL_mcp_pan_knobs{0}           \
                                WALTER_ELEMENT##.width

            ; ::::::::::::::::::::::::::::::::::::::::::::::::::
            ;       Volume Fader Placement
            ; ::::::::::::::::::::::::::::::::::::::::::::::::::

            ; [DRAW] volume
            set WALTER_ELEMENT##.volume                                                                                 \
                !VAL_mcp_hide_faders_bottom{0}                                                                          \
                    ?VAL_mcp_show_vol{0}                                                                                \
                        !VAL_mcp_vol_knob{0}                                                                            \
                            [CUR_x_vol_fader{0}     CUR_y_vol_fader{0}  CUR_w_fader{0}  CUR_h_vol_fader{0}  0 0 0 0]    \
                            [CUR_x_vol_knob{0}  CUR_y_volknob{0}    VAL_Knob{0}     VAL_Knob{0}         0 0 0 0]

            ; [DRAW] volume fader frame
            set WALTER_ELEMENT##.custom.vol_frame       \
                !VAL_mcp_hide_faders_bottom{0}          \
                    ?VAL_mcp_show_vol{0}                \
                        !VAL_mcp_vol_knob{0}            \
                            WALTER_ELEMENT##.volume     \
                            0                           \
                        0                               \
                    0

            ; [DRAW] volume knob frame
            set WALTER_ELEMENT##.custom.vol_knob_frame                                                              \
                !VAL_mcp_hide_faders_bottom{0}                                                                      \
                    ?VAL_mcp_show_vol{0}                                                                            \
                        ?VAL_mcp_vol_knob{0}                                                                        \
                            [CUR_x_vol_knob{0}       CUR_y_volknob{0}    VAL_Knob{0}     VAL_Knob{0}     0 0 0 0]   \
                            0                                                                                       \
                        0                                                                                           \
                    0

            ; ::::::::::::::::::::::::::::::::::::::::::::::::::
            ;       Z-Order
            ; ::::::::::::::::::::::::::::::::::::::::::::::::::

            front WALTER_ELEMENT##.volume
            front WALTER_ELEMENT##.pan
            front WALTER_ELEMENT##.width
            front WALTER_ELEMENT##.custom.vol_frame
            front WALTER_ELEMENT##.custom.pan_frame
            front WALTER_ELEMENT##.custom.wid_frame
            front WALTER_ELEMENT##.custom.vol_knob_frame
            front WALTER_ELEMENT##.custom.pan_knob_frame
            front WALTER_ELEMENT##.custom.wid_knob_frame

        endmacro

    ;   ## Draw : MCP : Size
    ; --------------------------------------------------------------------------------

        macro MAC_DrawMcp_Size SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; final mcp size
            set WALTER_ELEMENT##.size [VAL_mcp_w_full{0} VAL_mcp_h{0} VAL_mcp_w_full{0} VAL_mcp_y_offset_max{0}]

        endmacro

    ;   ## Draw : MCP : Folder
    ; --------------------------------------------------------------------------------

        macro MAC_DrawMcp_Folder SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; position setup
            set CUR_x_rightmost     -   VAL_mcp_w_full{0}   VAL_mcp_x_extension_folder{0}
            set CUR_x               -   CUR_x_rightmost{0}  VAL_Button_Folder{0}
            set CUR_y               -   VAL_mcp_h{0}        VAL_mcp_y_offset{0}
            set CUR_y_line          +   CUR_y{0}            VAL_mcp_folderindent{0}
            

            ; [DRAW] Folder Icon
            set WALTER_ELEMENT##.folder                                                         \
                ?par_mcp_gen_folder_icon_folder                                                 \
                    folderstate>0                                                               \
                        [CUR_x{0} CUR_y{0} VAL_Button_Folder{0} VAL_Button_Folder{0} 0 1 0 1]

            ; last track x position
            set CUR_x                                                                               \
                folderstate<0                                                                       \
                    par_mcp_gen_folder_icon_folder==1                                               \
                        CUR_x                                                                       \
                        - 0 VAL_Pad{0}                                                              \
                folderstate==0                                                                      \
                    par_mcp_gen_folder_icon_folder==2                                               \
                        - 0 VAL_Pad{0}

            ; folder icon width
            set CUR_w                                                       \
                folderstate<0                                               \
                    par_mcp_gen_folder_icon_folder==1                       \
                        * 0.6 VAL_Button_Folder{0}                          \
                        - CUR_x_rightmost{0} * 0.5 VAL_Button_Folder{0}     \
                folderstate==0                                              \
                    par_mcp_gen_folder_icon_folder==2                       \
                        CUR_w_bg{0}

            ; folder icon height
            set CUR_h * 0.5 VAL_Button_Folder{0}

            ; last track line height
            set CUR_h_line + VAL_mcp_folderindent{0} * 0.5 VAL_Button_Folder{0}

            ; [DRAW] Last Track in Folder Icon
            set WALTER_ELEMENT##.folder                                                 \
                par_mcp_gen_folder_icon_folder==1                                       \
                    folderstate<0                                                       \
                        + [CUR_x{0} CUR_y{0} CUR_w{0} CUR_h{0} 0 1 0 1] VAL_Pad{0}@y

            ; [DRAW] last track folder line
            set WALTER_ELEMENT##.custom.folder_last                 \
                par_mcp_gen_folder_icon_folder==2                   \
                    folderstate<0                                   \
                        [0 CUR_y{0} CUR_w{0} CUR_h_line{0} 0 1 0 1]

            ; width of line for nested folder tracks
            set CUR_w                                               \
                folderstate>0                                       \
                    - CUR_x_rightmost{0} VAL_Button_Folder{0}

            ; [DRAW] folder line
            set WALTER_ELEMENT##.custom.folder_child                \
                par_mcp_gen_folder_icon_folder==2                   \
                    folderdepth>0                                   \
                        folderstate>=0                              \
                            [0 CUR_y_line{0} CUR_w{0} CUR_h{0} 0 1 0 1]  \
                            0                                       \
                        0                                           \
                    0

            ; update z order
            front WALTER_ELEMENT##.folder
            front WALTER_ELEMENT##.custom.folder_last
            front WALTER_ELEMENT##.custom.folder_child

        endmacro

    ;   ## Draw : MCP : Font
    ; --------------------------------------------------------------------------------

        ;   ### Draw : MCP : Font : Shared Code : Open
        ; --------------------------------------------------------------------------------

            macro MAC_DrawMcp_Font_SharedCode_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; inserts
                set WALTER_ELEMENT##.fxlist.font        [VAL_Font_Label_Inserts VAL_insert_slot{0} ##WALTER_ELEMENT##.extmixer.position{w} 0 0 0 0]
                set WALTER_ELEMENT##.fxlist.margin      [VAL_Margin_Label{0} VAL_Margin_Label{1} VAL_Margin_Label{2} VAL_Margin_Label{3}]
                set WALTER_ELEMENT##.sendlist.font      WALTER_ELEMENT##.fxlist.font
                set WALTER_ELEMENT##.sendlist.margin    [VAL_Margin_Label{0} VAL_Margin_Label{1} 0 VAL_Margin_Label{3}]
                set WALTER_ELEMENT##.fxparm.font        WALTER_ELEMENT##.fxlist.font
                set WALTER_ELEMENT##.fxparm.margin      WALTER_ELEMENT##.fxlist.margin

                ; volume readout
                set WALTER_ELEMENT##.volume.label.color [THEME_color_readout_font{0} THEME_color_readout_font{1} THEME_color_readout_font{2}]
                set WALTER_ELEMENT##.volume.label.font VAL_Font_Label
                set WALTER_ELEMENT##.volume.label.margin                                                                                            \
                    par_mcp_##PARAMETER_SECTION##_meter_vol_readout==2                                                                              \
                        [VAL_Margin_Label_vertical{0} VAL_Margin_Label_vertical{1} VAL_Margin_Label_vertical{2} VAL_Margin_Label_vertical{3} 0]     \
                        [VAL_Margin_Label{0} VAL_Margin_Label{1} VAL_Margin_Label{2} VAL_Margin_Label{3} 0.5]


            endmacro

        ;   ### Draw : MCP : Font : Track
        ; --------------------------------------------------------------------------------

            macro MAC_DrawMcp_Font_Track SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; [SHARED]
                MAC_DrawMcp_Font_SharedCode_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; track label
                set WALTER_ELEMENT##.label.font VAL_Font_Label
                set WALTER_ELEMENT##.label.margin                                                                                                   \
                    !par_mcp_##PARAMETER_SECTION##_settings_label_vertical                                                                          \
                        [VAL_Margin_Label{0} VAL_Margin_Label{1} VAL_Margin_Label{2} VAL_Margin_Label{3} 0]                                         \
                        [VAL_Margin_Label_vertical{0} VAL_Margin_Label_vertical{1} VAL_Margin_Label_vertical{2} VAL_Margin_Label_vertical{3} 0]

                set WALTER_ELEMENT##.label.color    [VAL_Color_Track_Label_Text{0}  VAL_Color_Track_Label_Text{1}   VAL_Color_Track_Label_Text{2}]

                ; track index
                set WALTER_ELEMENT##.trackidx.font VAL_Font_Label
                set WALTER_ELEMENT##.trackidx.margin                                                                                                \
                    par_mcp_##PARAMETER_SECTION##_settings_label_index==2                                                                           \
                        [VAL_Margin_Label{0} VAL_Margin_Label{1} VAL_Margin_Label{2} VAL_Margin_Label{3} 0.5]                                       \
                    !par_mcp_##PARAMETER_SECTION##_settings_label_vertical                                                                          \
                        [VAL_Margin_Label{0} VAL_Margin_Label{1} VAL_Margin_Label{2} VAL_Margin_Label{3} 0]                                         \
                        [VAL_Margin_Label_vertical{0} VAL_Margin_Label_vertical{1} VAL_Margin_Label_vertical{2} VAL_Margin_Label_vertical{3} 0]

                set WALTER_ELEMENT##.trackidx.margin                            \
                    ?par_mcp_##PARAMETER_SECTION##_settings_label_index==2      \
                        [. . . . 0.5]

                set WALTER_ELEMENT##.trackidx.color [VAL_Color_Track_Index_MCP{0}   VAL_Color_Track_Index_MCP{1}    VAL_Color_Track_Index_MCP{2}]

                ; rec input
                set WALTER_ELEMENT##.recinput.color     \
                    ?recarm                             \
                        THEME_color_button_text_on      \
                        THEME_color_button_text_off

                set WALTER_ELEMENT##.recinput.font VAL_Font_Label
                set WALTER_ELEMENT##.recinput.margin                                                                            \
                    par_mcp_##PARAMETER_SECTION##_element_width==0                                                              \
                        [VAL_Margin_RecInput{2} VAL_Margin_RecInput{0} VAL_Margin_RecInput{3} VAL_Margin_RecInput{2} 1 0 0 0]   \
                        [VAL_Margin_RecInput{0} VAL_Margin_RecInput{1} VAL_Margin_RecInput{2} VAL_Margin_RecInput{3} 1 0 0 0]

            endmacro

        ;   ### Draw : MCP : Font : Master
        ; --------------------------------------------------------------------------------

            macro MAC_DrawMcp_Font_Master SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; [SHARED]
                MAC_DrawMcp_Font_SharedCode_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

            endmacro

    ;   ## Draw : MCP : Finish
    ; --------------------------------------------------------------------------------

        macro MAC_DrawMcp_Finish SCALE WALTER_ELEMENT PARAMETER_SECTION
            
            ; box frame
            front WALTER_ELEMENT##.custom.Image_frame

            ; selection frame
            front WALTER_ELEMENT##.custom.Box_selection_frame_l
            front WALTER_ELEMENT##.custom.Box_selection_frame_r
            front WALTER_ELEMENT##.custom.Box_selection_frame_t
            front WALTER_ELEMENT##.custom.Box_selection_frame_b
        
        endmacro

; ====================================================================================================================================
;   # TCP
; ====================================================================================================================================

    ;   ## Draw : TCP : Draw
    ; --------------------------------------------------------------------------------

        macro MAC_DrawTcp   SCALE

            ; tcp
            clear tcp.*
            MAC_DrawTcp_Setup_Track             SCALE "tcp" "track"
            MAC_DrawTcp_Meter                   SCALE "tcp" "track"
            MAC_DrawTcp_Meter_Format_Track      SCALE "tcp" "track"
            MAC_DrawTcp_Inserts                 SCALE "tcp" "track"
            MAC_DrawTcp_Faders                  SCALE "tcp" "track"
            MAC_DrawTcp_Buttons_Track           SCALE "tcp" "track"
            MAC_DrawTcp_Label                   SCALE "tcp" "track"
            MAC_DrawTcp_EmbedFx                 SCALE "tcp" "track"
            MAC_DrawTcp_Folder                  SCALE "tcp" "track"
            MAC_DrawTcp_Font_Track              SCALE "tcp" "track"
            MAC_DrawTcp_Finish                  SCALE "tcp" "track"

            ; envcp
            clear envcp.*
            MAC_DrawEnvcp_Setup                 SCALE "envcp" "envcp"
            MAC_DrawEnvcp_Fader                 SCALE "envcp" "envcp"
            MAC_DrawEnvcp_Buttons               SCALE "envcp" "envcp"
            MAC_DrawEnvcp_Label                 SCALE "envcp" "envcp"
            MAC_DrawEnvcp_Folder                SCALE "envcp" "envcp"
            MAC_DrawEnvcp_Font                  SCALE "envcp" "envcp"
            MAC_DrawTcp_Finish                  SCALE "envcp" "envcp"

            ; master
            clear master.tcp.*
            MAC_DrawTcp_Setup_Master            SCALE "master.tcp" "master"
            MAC_DrawTcp_Meter                   SCALE "master.tcp" "master"
            MAC_DrawTcp_Meter_Format_Master     SCALE "master.tcp" "master"
            MAC_DrawTcp_Inserts                 SCALE "master.tcp" "master"
            MAC_DrawTcp_Faders                  SCALE "master.tcp" "master"
            MAC_DrawTcp_Buttons_Master          SCALE "master.tcp" "master"
            MAC_DrawTcp_EmbedFx                 SCALE "master.tcp" "master"
            MAC_DrawTcp_Font_Master             SCALE "master.tcp" "master"
            MAC_DrawTcp_Finish                  SCALE "master.tcp" "master"

            ; [DEV] Development Overlay
            ;MAC_Development_Overlay_TCP         SCALE   "tcp"           "track"
            ;MAC_Development_Overlay_TCP         SCALE   "envcp"         "envcp"
            ;MAC_Development_Overlay_TCP         SCALE   "master.tcp"    "master"


        endmacro

    ;   ## Draw : TCP : Setup
    ; --------------------------------------------------------------------------------

        ;   ### Draw : TCP : Setup : Shared Code : Open
        ; --------------------------------------------------------------------------------

            macro MAC_DrawTcp_Setup_SharedCode_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; custom elements
                custom WALTER_ELEMENT##.custom.meter_frame          "" "" "" "meter_custom_border"
                custom WALTER_ELEMENT##.custom.inserts_bg           "" "" "" "track_custom_insert_bg"
                custom WALTER_ELEMENT##.custom.inserts_bg_select    "" "" "" "track_custom_insert_bg_select"
                custom WALTER_ELEMENT##.custom.vol_frame            "" "" "" "track_custom_fader_frame"
                custom WALTER_ELEMENT##.custom.pan_frame            "" "" "" "track_custom_fader_frame"
                custom WALTER_ELEMENT##.custom.wid_frame            "" "" "" "track_custom_fader_frame"
                custom WALTER_ELEMENT##.custom.vol_knob_frame       "" "" "" "track_custom_knob_border"
                custom WALTER_ELEMENT##.custom.pan_knob_frame       "" "" "" "track_custom_knob_border"
                custom WALTER_ELEMENT##.custom.wid_knob_frame       "" "" "" "track_custom_knob_border"
                custom WALTER_ELEMENT##.custom.env_icon             "" "" "" "track_custom_env_icon"

                ; size
                set WALTER_ELEMENT##.size [400 200]

                ; rightmost position
                set VAL_tcp_x_rightmost WALTER_ELEMENT##.size{0}

                ; visibility of the selection frame in track
                set VAL_show_selection_frame                \
                    ?par_tcp_gen_highlight_selectionframe   \
                        ?track_selected                     \
                            1                               \
                            0                               \
                        0
        
                ; visibility of the selection frame in envcp
                set VAL_show_selection_frame_envcp          \
                    ?par_tcp_gen_highlight_selectionframe   \
                        ?env_selected                       \
                            1                               \
                            0                               \
                        0

                ; adjustable margins
                set VAL_tcp_label_margin            + VAL_Margin_Label{0} * SCALE * par_tcp_track_element_adj_label_margin      0.03
                set VAL_tcp_envcp_label_margin      + VAL_Margin_Label{0} * SCALE * par_tcp_envcp_label_margin                  0.03

            endmacro

            ;   #### Draw : TCP : Setup : Track
            ; --------------------------------------------------------------------------------

                macro MAC_DrawTcp_Setup_Track SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; custom elements
                    custom WALTER_ELEMENT##.custom.readout_bg           "" "" "" "meter_custom_readout_bg_horz"
                    custom WALTER_ELEMENT##.custom.recinput_off         "" "" "" "track_custom_recinput_r_off"
                    custom WALTER_ELEMENT##.custom.recinput_on          "" "" "" "track_custom_recinput_r_on"
                    custom WALTER_ELEMENT##.custom.folder_last          "" "" "" "track_custom_tcp_folder_last"
                    custom WALTER_ELEMENT##.custom.folder_last_bold     "" "" "" "track_custom_tcp_folder_last_bold"
                    custom WALTER_ELEMENT##.custom.folder_child         "" "" "" "track_custom_tcp_folder_child"

                    ; button wrapping
                    set VAL_tcp_wrap_buttons par_tcp_track_element_adj_wrap_buttons

                    ; label size
                    set VAL_tcp_label_size  + VAL_tcp_label_min_w{0} * SCALE * 0.3 par_tcp_##PARAMETER_SECTION##_label_size
                    
                    ; keep label above increased minimal size when infobar is visible
                    set VAL_tcp_label_size                                          \
                        ?par_tcp_##PARAMETER_SECTION##_label_infobox                \
                            VAL_tcp_label_size{0}<VAL_tcp_label_min_w_infobar{0}    \
                                VAL_tcp_label_min_w_infobar{0}                      \
                    
                    ; top position
                    set VAL_tcp_y_top 0

                    ; [SHARED] Open
                    MAC_DrawTcp_Setup_SharedCode_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; [MASTER]
                    ;folder features
                    set VAL_tcp_FolderFeatures                  \
                        !trackidx                               \
                            0                                   \
                        !par_tcp_gen_folder_icon_collapse       \
                            !par_tcp_gen_folder_icon_mode       \
                                0                               \
                                1                               \
                            1

                    ; folder indent
                    set VAL_tcp_x_offset_folder 0

                    set VAL_tcp_x_offset_folder                                 \
                        ?VAL_tcp_FolderFeatures{0}                              \
                            ?par_tcp_gen_folder_icon_collapse                   \
                                + VAL_tcp_x_offset_folder VAL_Button_Folder{0}

                    set VAL_tcp_x_offset_folder                                 \
                        ?VAL_tcp_FolderFeatures{0}                              \
                            ?par_tcp_gen_folder_icon_mode                       \
                                + VAL_tcp_x_offset_folder VAL_Button_Folder{0}

                    ; [ROUND]
                    set VAL_tcp_folderindent            + VAL_rounding_constant{0} - * SCALE * 0.02 par_tcp_gen_folder_indent VAL_rounding_constant{0}

                    set VAL_tcp_x_offset                + VAL_tcp_x_offset_folder{0} * folderdepth  	    VAL_tcp_folderindent{0}
                    set VAL_tcp_x_offset_max_precomp    + VAL_tcp_x_offset_folder{0} * maxfolderdepth      VAL_tcp_folderindent{0}

                    ; compact width
                    set VAL_compact_w + VAL_tcp_x_offset_max_precomp{0} * SCALE 120
                    set VAL_tcp_compact         \
                        w<VAL_compact_w{0}      \
                            1                   \
                            0
                    
                    ; minimal width
                    set VAL_tcp_min_w * VAL_compact_w{0} 0.75

                    ; indentation x offset
                    set VAL_tcp_x_offset                \
                        ?VAL_tcp_compact{0}             \
                            VAL_tcp_x_offset_folder{0}

                    set VAL_tcp_x_offset_max                    \
                        ?VAL_tcp_compact{0}                     \
                            VAL_tcp_x_offset_folder{0}          \
                            VAL_tcp_x_offset_max_precomp{0}

                    ; folder drag line indentation
                    set VAL_drag_folder_offset + VAL_tcp_x_offset{0} * 0.5 - w VAL_tcp_x_offset{0}
                    set tcp.dragdropinfo [VAL_tcp_x_offset{0} VAL_drag_folder_offset]

                    ; indentation background
                    MAC_Draw_Box 1 WALTER_ELEMENT "indent_bg" THEME_color_tcp_empty_space{0} THEME_color_tcp_empty_space{1} THEME_color_tcp_empty_space{2} 0 0 VAL_tcp_x_offset{0} WALTER_ELEMENT##.size{1} 0 0 0 1

                    ; background
                    set CUR_y 0
                    set CUR_h - WALTER_ELEMENT##.size{1} VAL_Border{0}

                    MAC_DrawTcp_Setup_Background SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; selection highlight
                    set CUR_x VAL_tcp_x_rightmost{0}

                    set CUR_x                                               \
                        !par_tcp_gen_highlight_selection                    \
                            !par_tcp_gen_highlight_color                    \
                                - WALTER_ELEMENT##.size{0} VAL_Border{0}


                    MAC_DrawTcp_Setup_Highlight_Selection SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; color highlight
                    MAC_DrawTcp_Setup_Highlight_Color SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; ----------------------------------------------------------------------------------------
                    ;       - On TCP Hiding Positions -
                    ;
                    ;   The TCP drawing flow goes from right to left,
                    ;   so most elements are anchored on the right side — except for the label.
                    ;
                    ;   Since the label and the buttons interact but use different coordinate anchors,
                    ;   some algorithms are used to calculate a position that serves as a reference
                    ;   for hiding and stretching buttons.
                    ;
                    ;   It’s a bit clunky and should probably be replaced with something simpler in future releases.
                    ;
                    ;   The original reason for this approach was the lack of proper number rounding.
                    ;   With the current pseudo-rounding workaround, this might be solvable,
                    ;   but it does require major code replacements.
                    ; ----------------------------------------------------------------------------------------


                    ; hiding position - line 1 containing label
                    set VAL_tcp_hide_x_line_1                               \
                        -                                                   \
                            + * SCALE 10 + WALTER_ELEMENT##.size{0}         \
                            + VAL_tcp_x_offset_max{0} VAL_tcp_label_size{0} \
                        w

                    ; hiding position - everything after line 1
                    set VAL_tcp_hide_x_line_2                                   \
                        -                                                       \
                            + * SCALE 10                                        \
                            + WALTER_ELEMENT##.size{0} VAL_tcp_x_offset_max{0}  \
                        w

                    ; hiding position - leftmost
                    set VAL_tcp_hide_x_leftmost                                             \
                        -                                                                   \
                            + WALTER_ELEMENT##.size{0} + VAL_tcp_x_offset{0} VAL_Pad{0}     \
                        w

                    ; meter overshoot line
                    set VAL_tcp_meter_overshoot_line VAL_tcp_hide_x_line_1

                    ; fader hiding position
                    set VAL_tcp_hide_x_fader                        \
                        -                                           \
                            + * SCALE 100 WALTER_ELEMENT##.size{0}  \
                        w

                    ; [SHARED] Close
                    MAC_DrawTcp_Setup_SharedCode_Close SCALE WALTER_ELEMENT PARAMETER_SECTION

                endmacro

            ;   #### Draw : TCP : Setup : Master
            ; --------------------------------------------------------------------------------

                macro MAC_DrawTcp_Setup_Master SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; button wrapping
                    set VAL_tcp_wrap_buttons par_tcp_master_element_adj_wrap_buttons

                    ; custom elements
                    custom WALTER_ELEMENT##.custom.readout_bg       "" "" "" "meter_custom_readout_bg_horz"

                    ; label size
                    set VAL_tcp_label_size 0

                    ; top position
                    set VAL_tcp_y_top 0

                    ; [SHARED] Open
                    MAC_DrawTcp_Setup_SharedCode_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; indent offset
                    set VAL_tcp_x_offset 0
                    set VAL_tcp_x_offset_max_precomp    0
                    set VAL_tcp_x_offset_max            0

                    ; compact width
                    set VAL_compact_w * SCALE 120
                    set VAL_tcp_compact         \
                        w<VAL_compact_w{0}      \
                            1                   \
                            0

                    ; minimal width
                    set VAL_tcp_min_w * VAL_compact_w{0} 0.9

                    ; background
                    set CUR_y 0
                    set CUR_h - WALTER_ELEMENT##.size{1} VAL_Border{0}
                    MAC_DrawTcp_Setup_Background SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; icon
                    set CUR_w VAL_Button{0}
                    set CUR_x - VAL_tcp_x_rightmost{0} CUR_w{0}

                    MAC_Draw_FramedBox 1 WALTER_ELEMENT "master_icon_bg" VAL_color_master_icon{0} VAL_color_master_icon{1} VAL_color_master_icon{2} CUR_x{0} CUR_y{0} CUR_w{0} CUR_h{0} 1 0 1 1

                    set CUR_y_mastericon * 0.5 - h VAL_Button{1}
                    custom WALTER_ELEMENT##.custom.master_icon "" "" "" "track_custom_master"

                    set WALTER_ELEMENT##.custom.master_icon [CUR_x{0} CUR_y_mastericon CUR_w{0} VAL_Button{1} 1 0 1 0]
                    front WALTER_ELEMENT##.custom.master_icon

                    ; update rightmost position
                    set VAL_tcp_x_master_post_icon CUR_x{0}

                    set CUR_x + CUR_x{0} VAL_Border{0}

                    set CUR_x                                   \
                        !par_tcp_gen_highlight_selection        \
                            !par_tcp_gen_highlight_color        \
                                VAL_tcp_x_master_post_icon{0}

                    ; selection highlight
                    MAC_DrawTcp_Setup_Highlight_Selection SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; hiding position - line 1 containing label
                    set VAL_tcp_hide_x_line_1                       \
                        -                                           \
                            + * SCALE 10 WALTER_ELEMENT##.size{0}   \
                        w

                    ; hiding position - everything after line 1
                    set VAL_tcp_hide_x_line_2                       \
                        -                                           \
                            + * SCALE 10 WALTER_ELEMENT##.size{0}   \
                        w

                    ; hiding position - leftmost
                    set VAL_tcp_hide_x_leftmost                     \
                        -                                           \
                            + WALTER_ELEMENT##.size{0} VAL_Pad{0}   \
                        w

                    ; meter overshoot line
                    set VAL_tcp_meter_overshoot_line                \
                        -                                           \
                            + * SCALE 100 WALTER_ELEMENT##.size{0}   \
                        w

                    ; fader hiding position
                    set VAL_tcp_hide_x_fader                        \
                        -                                           \
                            + * SCALE 100 WALTER_ELEMENT##.size{0}   \
                        w

                    ; [SHARED] Close
                    MAC_DrawTcp_Setup_SharedCode_Close SCALE WALTER_ELEMENT PARAMETER_SECTION

                endmacro

                ;   ##### Draw : TCP : Setup : Background
                ; --------------------------------------------------------------------------------

                    macro MAC_DrawTcp_Setup_Background SCALE WALTER_ELEMENT PARAMETER_SECTION

                        ; background
                        set CUR_w - WALTER_ELEMENT##.size{0} VAL_tcp_x_offset{0}
                        MAC_Draw_Box    1 WALTER_ELEMENT "bg" Val_Color_Track_Bg{0} Val_Color_Track_Bg{1} Val_Color_Track_Bg{2}     VAL_tcp_x_offset{0} CUR_y{0} CUR_w{0} CUR_h{0} 0 0 1 1
                        MAC_Draw_Image  1 WALTER_ELEMENT "frame" "track_custom_bg_frame"                                            VAL_tcp_x_offset{0} CUR_y{0} CUR_w{0} CUR_h{0} 0 0 1 1

                        ; offset for covering border
                        set CUR_xr_frame    -       + WALTER_ELEMENT##.size{0}    tcp_iconsize          VAL_Border{0}
                        set CUR_w_frame     -       + CUR_w{0}                    tcp_iconsize          VAL_Border{0}
                        set CUR_h_frame     -         CUR_h{0}                                          VAL_Border{0}

                        ; selection frame                            
                        MAC_Draw_Box    VAL_show_selection_frame     WALTER_ELEMENT "selection_frame_l" VAL_color_selection_frame{0} VAL_color_selection_frame{1} VAL_color_selection_frame{2}     VAL_tcp_x_offset{0}      0               VAL_Border{0}       CUR_h_frame{0}  0 0 0 1
                        MAC_Draw_Box    VAL_show_selection_frame     WALTER_ELEMENT "selection_frame_r" VAL_color_selection_frame{0} VAL_color_selection_frame{1} VAL_color_selection_frame{2}     CUR_xr_frame{0}          0               VAL_Border{0}       CUR_h{0}        1 0 1 1
                        MAC_Draw_Box    VAL_show_selection_frame     WALTER_ELEMENT "selection_frame_t" VAL_color_selection_frame{0} VAL_color_selection_frame{1} VAL_color_selection_frame{2}     VAL_tcp_x_offset{0}      0               CUR_w_frame{0}      VAL_Border{0}   0 0 1 0
                        MAC_Draw_Box    VAL_show_selection_frame     WALTER_ELEMENT "selection_frame_b" VAL_color_selection_frame{0} VAL_color_selection_frame{1} VAL_color_selection_frame{2}     VAL_tcp_x_offset{0}      CUR_h_frame{0}  CUR_w_frame{0}      VAL_Border{0}   0 1 1 1

                    endmacro

                ;   ##### Draw : TCP : Setup : Highlights
                ; --------------------------------------------------------------------------------

                    ;   ###### Draw : TCP : Setup : Highlights : Selection
                    ; --------------------------------------------------------------------------------

                        macro MAC_DrawTcp_Setup_Highlight_Selection SCALE WALTER_ELEMENT PARAMETER_SECTION

                            ; [ROUND]
                            ; width
                            set CUR_w                                                                                                           \
                                ?par_tcp_gen_highlight_selection                                                                                \
                                    + VAL_rounding_constant{0} - * SCALE + 3 * 0.02 par_tcp_gen_highlight_selection VAL_rounding_constant{0}    \
                                    0

                            set CUR_x - CUR_x{0} CUR_w{0}

                            MAC_Draw_Box    par_tcp_gen_highlight_selection WALTER_ELEMENT "highlight_select" VAL_color_selectbar{0} VAL_color_selectbar{1} VAL_color_selectbar{2}    CUR_x{0} CUR_y{0} CUR_w{0} CUR_h{0} 1 0 1 1
                            MAC_Draw_Image  par_tcp_gen_highlight_selection WALTER_ELEMENT "highlight_select" "track_custom_selmarker_frame"                                          CUR_x{0} CUR_y{0} CUR_w{0} CUR_h{0} 1 0 1 1

                        endmacro

                    ;   ###### Draw : TCP : Setup : Highlights : Color
                    ; --------------------------------------------------------------------------------

                        macro MAC_DrawTcp_Setup_Highlight_Color SCALE WALTER_ELEMENT PARAMETER_SECTION

                            ; [ROUND]
                            ; width
                            set CUR_w                                                                                                       \
                                ?par_tcp_gen_highlight_color                                                                                \
                                    + VAL_rounding_constant{0} - * SCALE + 3 * 0.02 par_tcp_gen_highlight_color VAL_rounding_constant{0}    \
                                    0
                                                        
                            set CUR_x                                           \
                                ?par_tcp_gen_highlight_selection                \
                                    - CUR_x{0} -    CUR_w{0} VAL_Border{0}      \
                                    - CUR_x{0}      CUR_w{0}

                            MAC_Draw_Box    par_tcp_gen_highlight_color WALTER_ELEMENT "highlight_color" VAL_color_colorbar{0} VAL_color_colorbar{1} VAL_color_colorbar{2}    CUR_x{0} CUR_y{0} CUR_w{0} CUR_h{0} 1 0 1 1
                            MAC_Draw_Image  par_tcp_gen_highlight_color WALTER_ELEMENT "highlight_color" "track_custom_colorbar_frame"                                        CUR_x{0} CUR_y{0} CUR_w{0} CUR_h{0} 1 0 1 1

                        endmacro


        ;   ### Draw : TCP : Setup : Shared Code : Close
        ; --------------------------------------------------------------------------------

            macro MAC_DrawTcp_Setup_SharedCode_Close SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; reset custom elements
                set WALTER_ELEMENT##.custom.meter_frame         0
                set WALTER_ELEMENT##.custom.vol_frame           0
                set WALTER_ELEMENT##.custom.pan_frame           0
                set WALTER_ELEMENT##.custom.wid_frame           0
                set WALTER_ELEMENT##.custom.vol_knob_frame      0
                set WALTER_ELEMENT##.custom.pan_knob_frame      0
                set WALTER_ELEMENT##.custom.wid_knob_frame      0
                set WALTER_ELEMENT##.custom.readout_bg          0
                set WALTER_ELEMENT##.custom.inserts_bg          0
                set WALTER_ELEMENT##.custom.inserts_bg_select   0

                ; update minimal tcp width
                set WALTER_ELEMENT##.size [WALTER_ELEMENT##.size{0} WALTER_ELEMENT##.size{1} VAL_tcp_min_w{0}]

                ; position markers
                set VAL_tcp_x_rightmost         CUR_x{0}
                set VAL_tcp_x_start_button      CUR_x{0}
                set VAL_tcp_x_leftmost          + VAL_tcp_x_offset{0} VAL_Pad{0}
                set VAL_tcp_y_start_fxembed     + VAL_tcp_h{0} VAL_tcp_spacing_section_y{0}
                set VAL_tcp_x_end_inserts       CUR_x{0}
                set VAL_tcp_button_line_h + VAL_Button{1} VAL_tcp_spacing_y

                ; available space
                set VAL_tcp_available_space - w + VAL_tcp_x_offset_max{0} VAL_Pad{0}


            endmacro

    ;   ## Draw : TCP : Faders
    ; --------------------------------------------------------------------------------

        macro MAC_DrawTcp_Faders SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; override hiding
            set VAL_tcp_hide_faders         \
                !VAL_tcp_h_level{0}         \
                    1                       \
                    ?VAL_tcp_compact{0}     \
                        1                   \
                        0
                    
            ; x position
            set CUR_x                               \
                ?VAL_tcp_inserts_inline{0}          \
                    VAL_tcp_x_end_inserts{0}        \
                    VAL_tcp_x_start_button{0}                           

            ; vertical fader x offset
            set VAL_tcp_x_vertical_fader_offset * 0.5 - VAL_Knob_s{0} VAL_Fader{2}

            ; store x position for future reference
            set VAL_tcp_x_start_faders CUR_x{0}

            ; y position
            set CUR_y + VAL_tcp_y_top{0}  VAL_tcp_h{1}
                
            ; vertical fader height threshold
            set VAL_tcp_h_vert_knob + CUR_y{0} * SCALE 40

            ; height
            set CUR_h VAL_Button{1}

            ; draw faders
            set VAL_tcp_fadercount 0
            set VAL_tcp_fader_line_count 0
            MAC_DrawTcp_Faders_SingleFader_##PARAMETER_SECTION SCALE WALTER_ELEMENT     "volume"    PARAMETER_SECTION     "vol"
            MAC_DrawTcp_Faders_SingleFader_##PARAMETER_SECTION SCALE WALTER_ELEMENT     "width"     PARAMETER_SECTION     "wid"
            MAC_DrawTcp_Faders_SingleFader_##PARAMETER_SECTION SCALE WALTER_ELEMENT     "pan"       PARAMETER_SECTION     "pan"

            ; optionally swap pan order for proper dual pan
            set swap_pan                                                \
                par_tcp_##PARAMETER_SECTION##_fader_placement{0}==2     \
                    ?VAL_tcp_show_wid{0}                                \
                        ?VAL_tcp_show_pan{0}                            \
                            1                                           \
                            0                                           \
                        0                                               \
                    0

            ; store pan data
            set pan_data                    \
                ?swap_pan{0}                \
                    WALTER_ELEMENT##.pan    \
                    0

            ; load width data in to pan
            set WALTER_ELEMENT##.pan        \
                ?swap_pan{0}                \
                    WALTER_ELEMENT##.width
            
            ; load stored pan data into width
            set WALTER_ELEMENT##.width      \
                ?swap_pan{0}                \
                    pan_data

            ; store width of the fader section
            set VAL_tcp_w_faders                            \
                ?VAL_tcp_fadercount{0}                      \
                    - VAL_tcp_x_start_faders{0} CUR_x{0}    \
                    0

            ; shift embed y position
            set VAL_tcp_y_start_fxembed                                         \
                ?VAL_tcp_fadercount{0}                                          \
                    par_tcp_##PARAMETER_SECTION##_fader_placement{0}==2         \
                        + CUR_Y{0}      VAL_tcp_spacing_section_y{0}

            ; shift insert rightmost position
            set VAL_tcp_x_end_inserts                                   \
                par_tcp_##PARAMETER_SECTION##_fader_placement{0}==3     \
                    CUR_x{0}

            ; update z-order
            front WALTER_ELEMENT##.custom.vol_frame
            front WALTER_ELEMENT##.custom.pan_frame
            front WALTER_ELEMENT##.custom.wid_frame
            front WALTER_ELEMENT##.custom.vol_knob_frame
            front WALTER_ELEMENT##.custom.pan_knob_frame
            front WALTER_ELEMENT##.custom.wid_knob_frame

        endmacro

        ;   ### Draw : TCP : Faders : Single Fader
        ; --------------------------------------------------------------------------------

                ;   ##### Draw : TCP : Faders : Single Fader : Track
                ; --------------------------------------------------------------------------------

                    macro MAC_DrawTcp_Faders_SingleFader_Track SCALE WALTER_ELEMENT TARGET_ELEMENT PAR_SECTION PAR_NAME

                        ; visibility
                        set VAL_tcp_show_##PAR_NAME                                                 \
                            ?par_tcp_##PARAMETER_SECTION##_fader_##PAR_NAME##_vis{0}                \
                                ?par_tcp_##PARAMETER_SECTION##_fader_##PAR_NAME##_vis_mixer{0}      \
                                    !mixer_visible                                                  \
                                        1                                                           \
                                        0                                                           \
                                1                                                                   \
                                0

                        MAC_DrawTcp_Faders_SingleFader_SharedCode_Close SCALE WALTER_ELEMENT TARGET_ELEMENT PAR_SECTION PAR_NAME

                    endmacro

                ;   ##### Draw : TCP : Faders : Single Fader : Master
                ; --------------------------------------------------------------------------------

                    macro MAC_DrawTcp_Faders_SingleFader_Master SCALE WALTER_ELEMENT TARGET_ELEMENT PAR_SECTION PAR_NAME

                        ; visibility
                        set VAL_tcp_show_##PAR_NAME                                     \
                            ?par_tcp_##PARAMETER_SECTION##_fader_##PAR_NAME##_vis{0}    \
                                1                                                       \
                                0

                        MAC_DrawTcp_Faders_SingleFader_SharedCode_Close SCALE WALTER_ELEMENT TARGET_ELEMENT PAR_SECTION PAR_NAME

                    endmacro

            ;   #### Draw : TCP : Faders : Single Fader : Shared Code : Close
            ; --------------------------------------------------------------------------------

                macro MAC_DrawTcp_Faders_SingleFader_SharedCode_Close SCALE WALTER_ELEMENT TARGET_ELEMENT PAR_SECTION PAR_NAME

                    ; vertical hiding logic
                    set CUR_y_target + CUR_y{0} + CUR_h{0} VAL_Pad{0}

                    set VAL_tcp_hide_##PAR_NAME                                 \
                        par_tcp_##PARAMETER_SECTION##_fader_placement{0}!=2     \
                            0                                                   \
                        h<CUR_y_target{0}                                       \
                            1                                                   \
                            0

                    ; knob mode
                    set VAL_tcp_##PAR_NAME##_knob                                   \
                        par_tcp_##PARAMETER_SECTION##_fader_placement{0}==2         \
                            !par_tcp_##PARAMETER_SECTION##_fader_vol_size           \
                                1                                                   \
                                0                                                   \
                        par_tcp_##PARAMETER_SECTION##_fader_placement{0}==3         \
                            !par_tcp_##PARAMETER_SECTION##_fader_##PAR_NAME##_size  \
                                1                                                   \
                            h<VAL_tcp_h_vert_knob{0}                                \
                                1                                                   \
                                0                                                   \
                        !par_tcp_##PARAMETER_SECTION##_fader_##PAR_NAME##_size      \
                            1                                                       \
                            0

                    set WALTER_ELEMENT##.##TARGET_ELEMENT##.fadermode   \
                        ?VAL_tcp_##PAR_NAME##_knob{0}                   \
                            1                                           \
                            -1

                    ; width
                    set VAL_remaining_w - VAL_tcp_available_space{0} - WALTER_ELEMENT##.size{0} CUR_x{0}

                    set CUR_w                                                                                                                                                                                                                           \
                        ?VAL_tcp_show_##PAR_NAME##{0}                                                                                                                                                                                                   \
                            ?VAL_tcp_##PAR_NAME##_knob{0}                                                                                                                                                                                               \
                                VAL_Knob_s{0}                                                                                                                                                                                                           \
                            par_tcp_##PARAMETER_SECTION##_fader_placement{0}==3                                                                                                                                                                         \
                                VAL_Fader{2}                                                                                                                                                                                                            \
                            par_tcp_##PARAMETER_SECTION##_fader_placement{0}==2                                                                                                                                                                         \
                                !par_tcp_##PARAMETER_SECTION##_fader_vol_size_scale                                                                                                                                                                     \
                                    + VAL_rounding_constant{0} - + VAL_tcp_fader_min_w{0}    +   VAL_Button{0}                               * 0.2                   par_tcp_##PARAMETER_SECTION##_fader_vol_size         VAL_rounding_constant{0}      \
                                    + VAL_rounding_constant{0} - + VAL_tcp_fader_min_w{0}    * - VAL_remaining_w{0} VAL_tcp_fader_min_w{0}   * VAL_Fader_Scale{0}    par_tcp_##PARAMETER_SECTION##_fader_vol_size         VAL_rounding_constant{0}      \
                            !par_tcp_##PARAMETER_SECTION##_fader_##PAR_NAME##_size_scale                                                                                                                                                                \
                                + VAL_rounding_constant{0} - + VAL_tcp_fader_min_w{0}    +   VAL_Button{0}                               * 0.2                   par_tcp_##PARAMETER_SECTION##_fader_##PAR_NAME##_size     VAL_rounding_constant{0}     \
                                + VAL_rounding_constant{0} - + VAL_tcp_fader_min_w{0}    * - VAL_remaining_w{0} VAL_tcp_fader_min_w{0}   * VAL_Fader_Scale{0}    par_tcp_##PARAMETER_SECTION##_fader_##PAR_NAME##_size     VAL_rounding_constant{0}

                    ; height
                    set VAL_tcp_fader_h                                             \
                        par_tcp_##PARAMETER_SECTION##_fader_placement{0}!=3         \
                            VAL_Fader{2}                                            \
                            - WALTER_ELEMENT##.size{1} + CUR_y{0} * 3 VAL_Pad{0}

                    ; x position
                    set CUR_x_target                                                        \
                        par_tcp_##PARAMETER_SECTION##_fader_placement{0}==2                 \
                            - CUR_x{0} + CUR_w{0} VAL_tcp_spacing_section_x{0}              \
                        !VAL_tcp_fadercount{0}                                              \
                            par_tcp_##PARAMETER_SECTION##_fader_placement{0}==3             \
                                - CUR_x{0} + VAL_Knob_s{0}  VAL_tcp_spacing_section_x{0}    \
                                - CUR_x{0} + CUR_w{0} VAL_tcp_spacing_section_x{0}          \
                            par_tcp_##PARAMETER_SECTION##_fader_placement{0}==3             \
                                - CUR_x{0} + VAL_Knob_s{0} VAL_tcp_spacing_x_fader{0}       \
                                - CUR_x{0} + CUR_w{0} VAL_tcp_spacing_x_fader{0}

                    ; overshoot hiding
                    set VAL_tcp_hide_faders                                         \
                        ?VAL_tcp_show_##PAR_NAME##{0}                               \
                            par_tcp_##PARAMETER_SECTION##_fader_placement{0}==2     \
                                VAL_tcp_hide_x_fader{0}>CUR_x_target{0}             \
                                    1 .                                             \
                            par_tcp_##PARAMETER_SECTION##_fader_placement{0}==0     \
                                VAL_tcp_hide_x_line_1{0}>CUR_x_target{0}            \
                                    1

                    set VAL_tcp_show_##PAR_NAME                                     \
                            par_tcp_##PARAMETER_SECTION##_fader_placement{0}==3     \
                                VAL_tcp_hide_x_fader{0}>CUR_x_target{0}             \
                                    0

                    ; show override on hide flag on
                    set VAL_tcp_show_##PAR_NAME     \
                        ?VAL_tcp_hide_faders{0}     \
                            0
                    
                    ; update cursor
                    set CUR_x                           \
                        ?VAL_tcp_show_##PAR_NAME##{0}   \
                            CUR_x_target{0}

                    ; [DRAW] fader
                    set WALTER_ELEMENT##.##TARGET_ELEMENT                                                                                                                       \
                        !VAL_tcp_hide_##PAR_NAME##{0}                                                                                                                           \
                        ?VAL_tcp_show_##PAR_NAME##{0}                                                                                                                           \
                            ?VAL_tcp_##PAR_NAME##_knob{0}                                                                                                                       \
                                [   CUR_x{0}    CUR_y{0}        CUR_w{0}    CUR_h{0}    1 0 1 0]                                                                                \
                                par_tcp_##PARAMETER_SECTION##_fader_placement{0}!=3                                                                                             \
                                + [ 0 VAL_Fader{3} 0 0 0 0 0 0]   [CUR_x{0} CUR_y{0} CUR_w{0} VAL_tcp_fader_h{0} 1 0 1 0]                                                         \
                                + [ 0 VAL_Fader{3} 0 0 0 0 0 0] + [CUR_x{0} CUR_y{0} CUR_w{0} VAL_tcp_fader_h{0} 1 0 1 1] [VAL_tcp_x_vertical_fader_offset{0} 0 0 0 0 0 0 0]

                    ; [DRAW] fader frame
                    set WALTER_ELEMENT##.custom.##PAR_NAME##_frame      \
                        !VAL_tcp_hide_##PAR_NAME##{0}                   \
                        ?VAL_tcp_show_##PAR_NAME##{0}                   \
                            !VAL_tcp_##PAR_NAME##_knob{0}               \
                                WALTER_ELEMENT##.##TARGET_ELEMENT

                    ; [DRAW] knob fader
                    set WALTER_ELEMENT##.custom.##PAR_NAME##_knob_frame     \
                        !VAL_tcp_hide_##PAR_NAME##{0}                       \
                        ?VAL_tcp_show_##PAR_NAME##{0}                       \
                            ?VAL_tcp_##PAR_NAME##_knob{0}                   \
                                WALTER_ELEMENT##.##TARGET_ELEMENT

                    front WALTER_ELEMENT##.##TARGET_ELEMENT

                    ; increment y position
                    set increment_line                                                  \
                        ?VAL_tcp_show_##PAR_NAME##{0}                                   \
                            par_tcp_##PARAMETER_SECTION##_fader_placement{0}==2         \
                                1                                                       \
                                0                                                       \
                            0
                    
                    set CUR_y                                                           \
                        ?increment_line{0}                                              \
                            + CUR_y{0} + VAL_Button{1}  VAL_tcp_spacing_y_fader{0}

                    ; update button start x position depending on fader layout
                    set VAL_tcp_x_start_button                                  \
                        par_tcp_##PARAMETER_SECTION##_fader_placement{0}!=1     \
                            ?VAL_tcp_show_##PAR_NAME##{0}                       \
                                CUR_x{0}<VAL_tcp_x_start_button{0}              \
                                        CUR_x{0}
                        
                    ; reset x position
                    set CUR_x                                                       \
                        ?VAL_tcp_show_##PAR_NAME##{0}                               \
                            par_tcp_##PARAMETER_SECTION##_fader_placement{0}==2     \
                                VAL_tcp_x_start_faders{0}

                    ; fader count
                    set VAL_tcp_fadercount              \
                        ?VAL_tcp_show_##PAR_NAME##{0}   \
                            + VAL_tcp_fadercount{0} 1

                    ; line count
                    set VAL_tcp_fader_line_count            \
                        ?increment_line{0}                  \
                            + VAL_tcp_fader_line_count 1

                endmacro

    ;   ## Draw : TCP : Meter
    ; --------------------------------------------------------------------------------

            ;   #### Draw : TCP : Meter
            ; --------------------------------------------------------------------------------

                macro MAC_DrawTcp_Meter SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; meter visibility
                    set VAL_tcp_show_meter                                      \
                        ?par_tcp_##PARAMETER_SECTION##_meter_mode               \
                            VAL_tcp_h_level{0}>0                                \
                                1                                               \
                                ?par_tcp_##PARAMETER_SECTION##_meter_mode==2    \
                                    1                                           \
                                    0                                           \
                                0

                    ; y position
                    set CUR_y                       \
                        ?VAL_tcp_show_meter{0}      \
                            VAL_Border{0}

                    ; height (master track differs)
                    set CUR_h   - WALTER_ELEMENT##.size{1} VAL_Border_2{0}

                    ; width
                    set VAL_tcp_meter_remaining_w - VAL_tcp_available_space{0} - WALTER_ELEMENT##.size{0} CUR_x{0}

                    set CUR_w                                                                                                                                                                                                                   \
                        ?VAL_tcp_show_meter{0}                                                                                                                                                                                                  \
                            !par_tcp_##PARAMETER_SECTION##_meter_size_scale                                                                                                                                                                     \
                                + VAL_rounding_constant{0} - + VAL_tcp_meter_min_w{0}    * SCALE + 1                                             * 0.3                   par_tcp_##PARAMETER_SECTION##_meter_size    VAL_rounding_constant{0}   \
                                + VAL_rounding_constant{0} - + VAL_tcp_meter_min_w{0}    * - VAL_tcp_meter_remaining_w{0} VAL_tcp_meter_min_w{0} * VAL_Fader_Scale{0}    par_tcp_##PARAMETER_SECTION##_meter_size    VAL_rounding_constant{0}   \
                            0

                    ; readout visibility
                    set VAL_tcp_show_vol_readout                            \
                        ?par_tcp_##PARAMETER_SECTION##_meter_vol_readout    \
                            1                                               \
                            0

                    ; readout width
                    set CUR_w_readout                   \
                        ?VAL_tcp_show_vol_readout{0}    \
                            VAL_tcp_vol_readout_w{0}    \
                            0

                    ; x position
                    set CUR_x - + VAL_tcp_x_start_button{0} VAL_Border{0} + CUR_w{0} CUR_w_readout{0}

                    ; overshoot correction
                    set VAL_tcp_meter_w_overshoot - VAL_tcp_meter_overshoot_line{0} CUR_x{0}

                    set CUR_x                                       \
                        VAL_tcp_meter_w_overshoot{0}>0              \
                            + CUR_x{0} VAL_tcp_meter_w_overshoot{0}

                    ; width
                    set CUR_w                                       \
                        VAL_tcp_meter_w_overshoot{0}>0              \
                            - CUR_w{0} VAL_tcp_meter_w_overshoot{0}

                    ; hiding logic
                    set VAL_tcp_show_meter                  \
                        CUR_w{0}<=VAL_tcp_meter_min_w{0}    \
                            0

                    set VAL_tcp_show_vol_readout    \
                        !VAL_tcp_show_meter{0}      \
                            0

                    ; meter x position
                    set CUR_x_meter                             \
                        ?VAL_tcp_show_vol_readout{0}            \
                            + CUR_x{0} VAL_tcp_vol_readout_w{0} \
                            CUR_x{0}

                    ; button offset
                    set VAL_tcp_x_start_button      \
                        ?VAL_tcp_show_meter{0}      \
                            CUR_x{0}

                    ; [DRAW] Meter
                    set CUR_meter + [CUR_x_meter{0} CUR_y{0} CUR_w{0} CUR_h{0}] [VAL_Border{0} 0 VAL_Border_Neg_2{0} VAL_Border_Neg{0}]

                    set WALTER_ELEMENT##.custom.meter_frame                                                 \
                        ?VAL_tcp_show_meter{0}                                                              \
                            [CUR_x_meter{0}     CUR_y{0}        CUR_w{0}        CUR_h{0}        1 0 1 1]

                    set WALTER_ELEMENT##.meter                                                              \
                        ?VAL_tcp_show_meter{0}                                                              \
                            [CUR_meter{0}       CUR_meter{1}    CUR_meter{2}    CUR_meter{3}    1 0 1 1]

                    ; readout y position
                    set CUR_y_readout * 0.5 - h + VAL_TCP_Label{0} VAL_Pad{0}

                    ; [DRAW] Volume Readout
                    set WALTER_ELEMENT##.volume.label                                                                           \
                        ?VAL_tcp_h_level{0}                                                                                     \
                            ?VAL_tcp_show_vol_readout{0}                                                                        \
                                [CUR_X{0}       CUR_y_readout{0}    VAL_tcp_vol_readout_w{0}    VAL_TCP_Label{0}    1 0 1 0]

                    set WALTER_ELEMENT##.custom.readout_bg                                                                      \
                        ?VAL_tcp_h_level{0}                                                                                     \
                            ?VAL_tcp_show_vol_readout{0}                                                                        \
                                [CUR_X{0}       CUR_y{0}            VAL_tcp_vol_readout_w{0}    CUR_h{0}            1 0 1 1]

                    front WALTER_ELEMENT##.custom.readout_bg



                    ; shift insert rightmost position
                    set VAL_tcp_x_end_inserts       \
                        ?VAL_tcp_show_meter{0}      \
                            CUR_x{0}

                    ; meter text
                    set WALTER_ELEMENT##.meter.scale.color.lit.top          ?VAL_tcp_h_level{0} ?par_tcp_##PARAMETER_SECTION##_meter_vu_db      VAL_meter_tcp_lit_top
                    set WALTER_ELEMENT##.meter.scale.color.lit.bottom       ?VAL_tcp_h_level{0} ?par_tcp_##PARAMETER_SECTION##_meter_vu_db      VAL_meter_tcp_lit_bottom
                    set WALTER_ELEMENT##.meter.scale.color.unlit.top        ?VAL_tcp_h_level{0} ?par_tcp_##PARAMETER_SECTION##_meter_vu_db      VAL_meter_tcp_unlit_top
                    set WALTER_ELEMENT##.meter.scale.color.unlit.bottom     ?VAL_tcp_h_level{0} ?par_tcp_##PARAMETER_SECTION##_meter_vu_db      VAL_meter_tcp_unlit_bottom
                    set WALTER_ELEMENT##.meter.readout.color                ?VAL_tcp_h_level{0} ?par_tcp_##PARAMETER_SECTION##_meter_vu_readout VAL_meter_tcp_readout

                    ; z order
                    front WALTER_ELEMENT##.custom.meter_frame
                    front WALTER_ELEMENT##.meter
                    front WALTER_ELEMENT##.volume.label

                endmacro

        ;   ### Draw : TCP : Meter : Format : Track
        ; --------------------------------------------------------------------------------

            macro MAC_DrawTcp_Meter_Format_Track SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; meter channel division
                set CUR_chan_div        * SCALE * 0.05 par_tcp_##PARAMETER_SECTION##_meter_channeldiv
                
                ; gain reduction
                set CUR_gain_div        * SCALE * 0.05 par_tcp_##PARAMETER_SECTION##_meter_gaindiv
                set CUR_gain_wid    + 1 * SCALE * 0.05 par_tcp_##PARAMETER_SECTION##_meter_gainwid
                
                ; set dimensions
                set WALTER_ELEMENT##.meter.vu.div [CUR_chan_div{0} 0 CUR_gain_div{0} CUR_gain_wid{0}]

            endmacro

        ;   ### Draw : TCP : Meter : Format : Master
        ; --------------------------------------------------------------------------------

            macro MAC_DrawTcp_Meter_Format_Master SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; meter channel division
                set CUR_chan_div        * SCALE * 0.05 par_tcp_##PARAMETER_SECTION##_meter_channeldiv
                
                ; gain reduction
                set CUR_gain_div        * SCALE * 0.05 par_tcp_##PARAMETER_SECTION##_meter_gaindiv
                set CUR_gain_wid    + 1 * SCALE * 0.05 par_tcp_##PARAMETER_SECTION##_meter_gainwid
                
                ; set dimensions
                set WALTER_ELEMENT##.meter.vu.div [CUR_chan_div{0} 0 CUR_gain_div{0} CUR_gain_wid{0}]
                set WALTER_ELEMENT##.meter.vu.rmsdiv [CUR_chan_div{0} 0]

            endmacro


    ;   ## Draw : TCP : Inserts
    ; --------------------------------------------------------------------------------

        macro MAC_DrawTcp_Inserts SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; artificial inserts padding
            set VAL_tcp_inserts_padding * [VAL_Pad{0} 0 VAL_Pad{0} 0 0 0 0] [1 1 -2 1 1 1 1 1]

            ; detect split sends mode (requires user paramter and internal Reaper setting)
            set VAL_tcp_inserts_split_sends     \
                ?par_tcp_gen_insert_split       \
                    ?tcp_sends_enabled          \
                        1                       \
                    0                           \
                0

            ; caclulate split sends crossover point
            set VAL_tcp_inserts_split_crossover                                     \
                ?VAL_tcp_inserts_split_sends{0}                                     \
                    * par_tcp_gen_insert_split_send_crossover VAL_Fader_Scale{0}    \
                    0
                
            ; visibility detection
            set VAL_tcp_show_inserts                                \
                ?VAL_tcp_compact{0}                                 \
                    0                                               \
                !VAL_tcp_h_level{0}                                 \
                    0                                               \
                par_tcp_##PARAMETER_SECTION##_insert_mode{0}==0     \
                    0                                               \
                    1
            
            ; inline mode visibility
            set VAL_tcp_inserts_inline                                  \
                !VAL_tcp_show_inserts{0}                                \
                    0                                                   \
                par_tcp_##PARAMETER_SECTION##_insert_mode{0}==2         \
                        0                                               \
                        1

            ; y position
            set CUR_y                                                                       \
                ?VAL_tcp_inserts_inline{0}                                                  \
                        VAL_tcp_y_top{0}                                                    \
                    +   VAL_tcp_y_top{0} +    VAL_Button{1} VAL_tcp_spacing_section_y{0}

            ; height
            set CUR_h - WALTER_ELEMENT##.size{1} + CUR_y{0} VAL_Border{0}

            
            ; width
            set VAL_remaining_w - VAL_tcp_available_space{0} + VAL_tcp_spacing_section_x{0} - WALTER_ELEMENT##.size{0} CUR_x{0}
            set CUR_w                                                                                                                                                                                                           \
                !par_tcp_##PARAMETER_SECTION##_insert_size_scale                                                                                                                                                                \
                    + VAL_rounding_constant{0} - + VAL_tcp_inserts_min_w{0} * SCALE + 10                                 * 0.3                   par_tcp_##PARAMETER_SECTION##_insert_size         VAL_rounding_constant{0}     \
                    + VAL_rounding_constant{0} - + VAL_tcp_inserts_min_w{0} * - VAL_remaining_w{0} VAL_insert_slot{4}    * VAL_Fader_Scale{0}    par_tcp_##PARAMETER_SECTION##_insert_size         VAL_rounding_constant{0}     \

            ; double the width on split sends mode
            set CUR_w                               \
                ?VAL_tcp_inserts_split_sends{0}     \
                    * CUR_w 2

            ; x position
            set CUR_x                                                                       \
                ?VAL_tcp_inserts_inline{0}                                                  \
                    - VAL_tcp_x_start_button{0} - CUR_w{0} VAL_Border{0}
 
            ; overshoot correction
            set VAL_tcp_inserts_w_overshoot - VAL_tcp_meter_overshoot_line{0} CUR_x{0}

            set CUR_x                                           \
                VAL_tcp_inserts_w_overshoot{0}>0                \
                    + CUR_x{0} VAL_tcp_inserts_w_overshoot{0}

            set CUR_w                                           \
                VAL_tcp_inserts_w_overshoot{0}>0                \
                    - CUR_w{0} VAL_tcp_inserts_w_overshoot{0}


            ; split sends: fx block width
            set CUR_w_insert_half_fx                                        \
                ?VAL_tcp_inserts_split_sends{0}                             \
                    * CUR_w         VAL_tcp_inserts_split_crossover{0}      \
                    0
            
            ; split sends: sends block width
            set CUR_w_insert_half_sends                                     \
                ?VAL_tcp_inserts_split_sends{0}                             \
                    * CUR_w     - 1 VAL_tcp_inserts_split_crossover{0}      \
                    0

            ; split sends: send list x offset
            set CUR_x_sends + CUR_x CUR_w_insert_half_fx
            

            ; [DRAW] inserts (fx + parameters)
            set WALTER_ELEMENT##.fxparm                                                                                     \
                ?VAL_tcp_inserts_inline{0}                                                                                  \
                    ?VAL_tcp_inserts_split_sends{0}                                                                         \
                        + [CUR_x{0} CUR_y{0} CUR_w_insert_half_fx{0}            CUR_h{0} 1 0 1 1] VAL_tcp_inserts_padding   \
                        + [CUR_x{0} CUR_y{0} CUR_w{0}                           CUR_h{0} 1 0 1 1] VAL_tcp_inserts_padding

            ; [DRAW] sends
            set WALTER_ELEMENT##.sendlist                                                                                   \
                ?VAL_tcp_inserts_inline{0}                                                                                  \
                    ?VAL_tcp_inserts_split_sends{0}                                                                         \
                        + [CUR_x_sends{0} CUR_y{0} CUR_w_insert_half_sends{0}   CUR_h{0} 1 0 1 1] VAL_tcp_inserts_padding   \
                        0

            ; [DRAW] inserts bg - track unselected
            set WALTER_ELEMENT##.custom.inserts_bg                      \
                ?VAL_tcp_inserts_inline{0}                              \
                    !track_selected                                     \
                        [CUR_x{0} CUR_y{0} CUR_w{0} CUR_h{0} 1 0 1 1]
            
            ; [DRAW] inserts bg - track selected
            set WALTER_ELEMENT##.custom.inserts_bg_select               \
                ?VAL_tcp_inserts_inline{0}                              \
                    ?track_selected                                     \
                        [CUR_x{0} CUR_y{0} CUR_w{0} CUR_h{0} 1 0 1 1]
            
            ; inline button offset when inline overshoot didn't hide inserts
            set VAL_tcp_x_start_button      \
                ?VAL_tcp_inserts_inline{0}  \
                    CUR_w{0}>0              \
                        CUR_x{0}

            ; store x position when inline overshoot didn't hide inserts
            set VAL_tcp_x_end_inserts       \
                ?VAL_tcp_inserts_inline{0}  \
                    CUR_w{0}>0              \
                        CUR_x{0}                

            

        endmacro

    ;   ## Draw : TCP : Buttons
    ; --------------------------------------------------------------------------------

        ;   ### Draw : TCP : Buttons : Shared Code : Open
        ; --------------------------------------------------------------------------------

            macro MAC_DrawTcp_Buttons_SharedCode_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; preparation
                set CUR_w                   VAL_Button{0}
                set CUR_h                   VAL_Button{1}
                                
                ; tracking data
                set VAL_tcp_button_count        0
                set VAL_tcp_button_count_line   0
                set VAL_tcp_button_line 0
                
                ; optional width compression
                set VAL_tcp_allow_overflow_width_correction 0

                ; separator height
                set CUR_h_separator - VAL_Button{1} * 4 VAL_Unit{0}

                ; separator y position
                set CUR_y_separator + CUR_y{0} * 0.5 - VAL_Button{1} CUR_h_separator{0}

                ; hide buttons when height is compact
                set VAL_tcp_hide_buttons         	                        \
                    ?VAL_tcp_compact{0}        	                            \
                        1                   	                            \
                    !VAL_tcp_h_level{0}        	                            \
                        1                   	                            \
                        0
                
                ; pick second line when inline fader is hidden and wrapping is on -> set line count
                set VAL_tcp_button_line                                         \
                    ?VAL_tcp_hide_faders{0}                                     \
                        par_tcp_##PARAMETER_SECTION##_fader_placement{0}==0     \
                            ?VAL_tcp_wrap_buttons{0}                            \
                                1

                ; initial y position
                set CUR_y                                           \
                    VAL_tcp_button_line{0}>0                        \
                        + CUR_y{0} VAL_tcp_button_line_h{0}         \
                        + VAL_tcp_y_top{0} VAL_tcp_h{1}

                ; hide buttons when an inline fader is invisible and button wrapping is disabled
                set VAL_tcp_hide_buttons                                        \
                    ?VAL_tcp_hide_faders{0}                                     \
                        par_tcp_##PARAMETER_SECTION##_fader_placement{0}==0     \
                            !VAL_tcp_wrap_buttons{0}                            \
                                1

                ; initial x position
                set CUR_x                                                               \
                    VAL_tcp_button_line{0}<=0                                           \
                        - VAL_tcp_x_start_button{0} VAL_tcp_spacing_section_x{0}        \
                        ?VAL_tcp_inserts_inline{0}                                      \
                            - VAL_tcp_x_end_inserts{0} VAL_tcp_spacing_section_x{0}     \
                            - VAL_tcp_x_start_faders{0} VAL_tcp_spacing_section_x{0}
                
                ; end x position
                set VAL_tcp_x_end_buttons   - VAL_tcp_x_start_button{0} VAL_tcp_spacing_section_x{0}
                
            endmacro


            ;   #### Draw : TCP : Buttons : Track
            ; --------------------------------------------------------------------------------

                macro MAC_DrawTcp_Buttons_Track SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; [SHARED] Open
                    MAC_DrawTcp_Buttons_SharedCode_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; [BUTTON] Mute / Solo
                    MAC_DrawTcp_Buttons_SingleButton_Track SCALE 16 WALTER_ELEMENT PARAMETER_SECTION "solo"
                    MAC_DrawTcp_Buttons_SingleButton_Track SCALE 32 WALTER_ELEMENT PARAMETER_SECTION "mute"

                    ; [BUTTON] Record Arm / Record Monitor
                    MAC_DrawTcp_Buttons_SingleButton_Track SCALE 4 WALTER_ELEMENT PARAMETER_SECTION "recarm"
                    MAC_DrawTcp_Buttons_SingleButton_Track SCALE 8 WALTER_ELEMENT PARAMETER_SECTION "recmon"

                    ; [BUTTON] Envelope
                    set CUR_w       ?par_tcp_##PARAMETER_SECTION##_element_adj_size_env{0}         VAL_Button_2{0}
                    MAC_DrawTcp_Buttons_SingleButton_Track SCALE 2 WALTER_ELEMENT PARAMETER_SECTION "env"
                    set CUR_w       ?par_tcp_##PARAMETER_SECTION##_element_adj_size_env{0}         VAL_Button{0}

                    set WALTER_ELEMENT##.custom.env_icon                                                                \
                        ?VAL_tcp_show_button_env{0}                                                                     \
                            ?par_tcp_##PARAMETER_SECTION##_element_adj_size_env{0}                                      \
                                [WALTER_ELEMENT##.env{0} WALTER_ELEMENT##.env{1} VAL_Button{0} VAL_Button{1} 1 0 1 0]   \
                                0                                                                                       \
                            0

                    front WALTER_ELEMENT##.custom.env_icon

                    ; [BUTTON] IO / Phase
                    MAC_DrawTcp_Buttons_SingleButton_Track SCALE 64 WALTER_ELEMENT PARAMETER_SECTION "phase"
                    MAC_DrawTcp_Buttons_SingleButton_Track SCALE 128 WALTER_ELEMENT PARAMETER_SECTION "io"

                    ; [BUTTON] FX                    
                    set CUR_w       VAL_Button_2{0}
                    MAC_DrawTcp_Buttons_SingleButton_Track SCALE 256 WALTER_ELEMENT PARAMETER_SECTION "fx"
                    set CUR_w       VAL_Button{0}

                    ; [BUTTON] FX Bypass
                    set VAL_fxbyp_x                                                             \
                        ?VAL_tcp_show_button_fx{0}                                              \
                            - + WALTER_ELEMENT##.fx{0} WALTER_ELEMENT##.fx{2} VAL_Button{0}     \
                            0

                    set WALTER_ELEMENT##.fxbyp                                  \
                        ?VAL_tcp_show_button_fx{0}                              \
                            [VAL_fxbyp_x{0} CUR_y{0} CUR_w{0} CUR_h{0} 1 0 1 0]

                    front WALTER_ELEMENT##.fxbyp

                    ; [BUTTON] FX Input
                    MAC_DrawTcp_Buttons_SingleButton_Track SCALE 512 WALTER_ELEMENT PARAMETER_SECTION "fxin"

                    ; [BUTTON] Record Mode
                    set CUR_w       VAL_Button{0}

                    set WALTER_ELEMENT##.recinput.color     \
                        ?recarm                             \
                            THEME_color_button_text_on      \
                            THEME_color_button_text_off

                    ; button
                    MAC_DrawTcp_Buttons_SingleButton_Track SCALE 1024 WALTER_ELEMENT PARAMETER_SECTION "recmode"
                    
                    ; [BUTTON] Record Input
                    set VAL_tcp_allow_overflow_width_correction 1

                    set CUR_w + CUR_w{0} * SCALE + 20 * 0.2 par_tcp_##PARAMETER_SECTION##_element_adj_size_input
                    
                    ; button
                    MAC_DrawTcp_Buttons_SingleButton_Track SCALE 2048 WALTER_ELEMENT PARAMETER_SECTION "recinput"
                    
                    set VAL_tcp_allow_overflow_width_correction 0

                    set WALTER_ELEMENT##.custom.recinput_off    \
                        ?VAL_tcp_show_button_recinput{0}        \
                            !recarm                             \
                                WALTER_ELEMENT##.recinput       \
                                0                               \
                            0

                    set WALTER_ELEMENT##.custom.recinput_on     \
                        ?VAL_tcp_show_button_recinput{0}        \
                            ?recarm                             \
                                WALTER_ELEMENT##.recinput       \
                                0                               \
                            0

                    front WALTER_ELEMENT##.custom.recinput_off
                    front WALTER_ELEMENT##.custom.recinput_on
                    front WALTER_ELEMENT##.recinput


                endmacro

            ;   #### Draw : TCP : Buttons : Master
            ; --------------------------------------------------------------------------------

                macro MAC_DrawTcp_Buttons_Master SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; [SHARED] Open
                    MAC_DrawTcp_Buttons_SharedCode_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

                    ; [BUTTON] Mute / Solo
                    MAC_DrawTcp_Buttons_SingleButton_Master SCALE 4 WALTER_ELEMENT PARAMETER_SECTION "mute"
                    MAC_DrawTcp_Buttons_SingleButton_Master SCALE 8 WALTER_ELEMENT PARAMETER_SECTION "solo"

                    ; [BUTTON] Envelope
                    set CUR_w       ?par_tcp_##PARAMETER_SECTION##_element_adj_size_env         VAL_Button_2{0}
                    MAC_DrawTcp_Buttons_SingleButton_Master SCALE 2 WALTER_ELEMENT PARAMETER_SECTION "env"
                    set CUR_w       ?par_tcp_##PARAMETER_SECTION##_element_adj_size_env         VAL_Button{0}

                    set WALTER_ELEMENT##.custom.env_icon                                                                \
                        ?VAL_tcp_show_button_env{0}                                                                     \
                            ?par_tcp_##PARAMETER_SECTION##_element_adj_size_env{0}                                      \
                                [WALTER_ELEMENT##.env{0} WALTER_ELEMENT##.env{1} VAL_Button{0} VAL_Button{1} 1 0 1 0]   \
                                0                                                                                       \
                            0

                    front WALTER_ELEMENT##.custom.env_icon

                    ; [BUTTON] IO / Mono
                    MAC_DrawTcp_Buttons_SingleButton_master SCALE 16 WALTER_ELEMENT PARAMETER_SECTION "mono"
                    MAC_DrawTcp_Buttons_SingleButton_master SCALE 32 WALTER_ELEMENT PARAMETER_SECTION "io"

                    ; [BUTTON] FX
                    set CUR_w       VAL_Button_2{0}
                    MAC_DrawTcp_Buttons_SingleButton_Master SCALE 64 WALTER_ELEMENT PARAMETER_SECTION "fx"
                    set CUR_w       VAL_Button{0}

                    ; [BUTTON] FX Bypass
                    set VAL_fxbyp_x                                                             \
                        ?VAL_tcp_show_button_fx{0}                                              \
                            - + WALTER_ELEMENT##.fx{0} WALTER_ELEMENT##.fx{2} VAL_Button{0}

                    set WALTER_ELEMENT##.fxbyp                                      \
                        ?VAL_tcp_show_button_fx{0}                                  \
                            [VAL_fxbyp_x{0} CUR_y{0} CUR_w{0} CUR_h{0} 1 0 1 0]

                    front WALTER_ELEMENT##.fxbyp

                endmacro

                ;   ##### Draw : TCP : Buttons : SingleButton
                ; --------------------------------------------------------------------------------

                    ;   ####### Draw : TCP : Buttons : SingleButton : Track
                    ; --------------------------------------------------------------------------------

                        macro MAC_DrawTcp_Buttons_SingleButton_Track SCALE INDEX WALTER_ELEMENT PARAMETER_SECTION ELEMENT
                            
                            ; visibility
                            set VAL_tcp_show_button_##ELEMENT                                   \
                                ?VAL_tcp_hide_buttons{0}                                        \
                                    0                                                           \
                                ?par_tcp_##PARAMETER_SECTION##_element_vis&INDEX##              \
                                    ?par_tcp_##PARAMETER_SECTION##_element_vis_mixer&INDEX##    \
                                        !mixer_visible                                          \
                                            1                                                   \
                                            0                                                   \
                                        1                                                       \
                                        0

                            ; [SHARED] close
                            MAC_DrawTcp_Buttons_SingleButton_SharedCode_Close SCALE INDEX WALTER_ELEMENT PARAMETER_SECTION ELEMENT

                        endmacro

                    ;   ####### Draw : TCP : Buttons : SingleButton : Master
                    ; --------------------------------------------------------------------------------

                        macro MAC_DrawTcp_Buttons_SingleButton_Master SCALE INDEX WALTER_ELEMENT PARAMETER_SECTION ELEMENT

                            ; visibility
                            set VAL_tcp_show_button_##ELEMENT                                   \
                                ?VAL_tcp_hide_buttons{0}                                        \
                                    0                                                           \
                                ?par_tcp_##PARAMETER_SECTION##_element_vis&INDEX##              \
                                    1                                                           \
                                    0

                            ; [SHARED] close
                            MAC_DrawTcp_Buttons_SingleButton_SharedCode_Close SCALE INDEX WALTER_ELEMENT PARAMETER_SECTION ELEMENT

                        endmacro

                    ;   ####### Draw : TCP : Buttons : SingleButton : Envcp
                    ; --------------------------------------------------------------------------------

                        macro MAC_DrawTcp_Buttons_SingleButton_Envcp SCALE INDEX WALTER_ELEMENT PARAMETER_SECTION ELEMENT FX_EXCLUSIVE
                                
                            ; use separator
                            set CUR_separator_increment                                 \
                                par_tcp_##PARAMETER_SECTION##_element_separator&INDEX   \
                                    1                                                   \
                                    0
                                    
                            ; visibility
                            set VAL_envcp_show_button_##ELEMENT                         \
                                ?VAL_tcp_hide_buttons{0}                                \
                                    0                                                   \
                                ?par_tcp_##PARAMETER_SECTION##_element_vis&INDEX##      \
                                    1                                                   \
                                    0

                            ; target x position
                            set CUR_x_target                                            \
                                ?VAL_tcp_button_count{0}                                \
                                    VAL_tcp_button_line{0}==0                           \
                                        - CUR_x{0} + CUR_w{0} VAL_tcp_spacing_x{0}      \
                                        VAL_tcp_wrap_buttons{0}>=3                      \
                                            - CUR_x{0} + CUR_w{0} VAL_Pad{0}            \
                                            - CUR_x{0} + CUR_w{0} VAL_tcp_spacing_x{0}  \
                                    - CUR_x{0} CUR_w{0}
                                
                            
                            ; x position overshoot detection
                            set VAL_tcp_button_overshoot                        \
                                VAL_tcp_button_line{0}<=0                       \
                                    VAL_tcp_hide_x_line_1{0}>CUR_x_target{0}    \
                                        1                                       \
                                        0                                       \
                                    VAL_tcp_hide_x_line_2{0}>CUR_x_target{0}    \
                                        1                                       \
                                        0
                            
                            ; overshoot hiding
                            set VAL_tcp_hide_buttons                \
                                !VAL_tcp_wrap_buttons{0}            \
                                    ?VAL_tcp_button_overshoot{0}    \
                                        1                            
                            
                            ; show button flag
                            set VAL_envcp_show_button_##ELEMENT     \
                                ?VAL_tcp_hide_buttons{0}            \
                                    0
                                
                            ; linebreak x position reset
                            set CUR_x_target                                                                            \
                                ?VAL_envcp_show_button_##ELEMENT##{0}                                                   \
                                    ?VAL_tcp_wrap_buttons{0}                                                            \
                                        ?VAL_tcp_button_overshoot{0}                                                    \
                                            ?par_tcp_##PARAMETER_SECTION##_value_vertical{0}                            \
                                                - VAL_envcp_x_start_button{0} + CUR_w{0} VAL_tcp_spacing_section_x{0}   \
                                                - VAL_tcp_x_start_faders{0} + CUR_w{0} VAL_tcp_spacing_section_x{0}

                            ; update cursor
                            set CUR_x                                   \
                                ?VAL_envcp_show_button_##ELEMENT##{0}   \
                                    CUR_x_target{0}                     \
                                ?FX_EXCLUSIVE{0}                        \
                                    !VAL_tcp_hide_buttons{0}            \
                                        CUR_x_target{0}

                            ; linebreak y offset
                            set CUR_y                                               \
                                ?VAL_tcp_wrap_buttons{0}                            \
                                    ?VAL_tcp_button_overshoot{0}                    \
                                        ?VAL_envcp_show_button_##ELEMENT##{0}       \
                                            + CUR_y{0} VAL_tcp_button_line_h{0}
                            
                            ; [DRAW] button
                            set WALTER_ELEMENT##.##ELEMENT                          \
                                ?VAL_envcp_show_button_##ELEMENT##{0}               \
                                    [CUR_x{0} CUR_y{0} CUR_w{0} CUR_h{0} 1 0 1 0]

                            front WALTER_ELEMENT##.##ELEMENT

                            ; counter
                            set VAL_tcp_button_count        +   VAL_tcp_button_count{0}        VAL_envcp_show_button_##ELEMENT##{0}

                            ; line count increment
                            set VAL_tcp_button_line                         \
                                ?VAL_envcp_show_button_##ELEMENT##{0}       \
                                    ?VAL_tcp_wrap_buttons{0}                \
                                        ?VAL_tcp_button_overshoot{0}        \
                                            + VAL_tcp_button_line{0} 1


                            ; store x position for first line
                            set VAL_tcp_x_end_buttons                               \
                                ?VAL_envcp_show_button_##ELEMENT##{0}               \
                                    VAL_tcp_button_line{0}<=0                       \
                                        - CUR_x{0} VAL_tcp_spacing_section_x{0}

                            ; increment x position by separator
                            set CUR_x                                                   \
                                ?VAL_envcp_show_button_##ELEMENT##{0}                   \
                                    ?CUR_separator_increment{0}                         \
                                        VAL_tcp_button_line{0}==0                       \
                                            - CUR_x{0} VAL_tcp_spacing_separator{0}     \
                                        VAL_tcp_wrap_buttons{0}==1                      \
                                            - CUR_x{0} VAL_tcp_spacing_separator{0}   

                        endmacro

                ;   ###### Draw : TCP : Buttons : SingleButton : Shared Code : Close
                ; --------------------------------------------------------------------------------

                    macro MAC_DrawTcp_Buttons_SingleButton_SharedCode_Close SCALE INDEX WALTER_ELEMENT PARAMETER_SECTION ELEMENT
                            
                        ; use separator
                        set CUR_separator_increment                                 \
                            par_tcp_##PARAMETER_SECTION##_element_separator&INDEX   \
                                1                                                   \
                                0

                        ; target x position
                        set CUR_x_target                                            \
                            ?VAL_tcp_button_count{0}                                \
                                VAL_tcp_button_line{0}==0                           \
                                    - CUR_x{0} + CUR_w{0} VAL_tcp_spacing_x{0}      \
                                    VAL_tcp_wrap_buttons{0}>=3                      \
                                        - CUR_x{0} + CUR_w{0} VAL_Pad{0}            \
                                        - CUR_x{0} + CUR_w{0} VAL_tcp_spacing_x{0}  \
                                - CUR_x{0} CUR_w{0}
                            
                        ; x position overshoot detection
                        set VAL_tcp_button_overshoot                        \
                            VAL_tcp_button_line{0}<=0                       \
                                VAL_tcp_hide_x_line_1{0}>CUR_x_target{0}    \
                                    1                                       \
                                    0                                       \
                                VAL_tcp_hide_x_line_2{0}>CUR_x_target{0}    \
                                    1                                       \
                                    0
                        
                        ; hide buttons when wrapping is disabled and overshoot happens
                        set VAL_tcp_hide_buttons                        \
                            ?VAL_tcp_show_button_##ELEMENT##{0}         \
                                    !VAL_tcp_wrap_buttons{0}            \
                                        ?VAL_tcp_button_overshoot{0}    \
                                            1
                        
                        ; show-button flag
                        set VAL_tcp_show_button_##ELEMENT       \
                            ?VAL_tcp_hide_buttons{0}            \
                                0

                        ; linebreak x position reset
                        set CUR_x_target                                                                                \
                            ?VAL_tcp_show_button_##ELEMENT##{0}                                                         \
                                ?VAL_tcp_wrap_buttons{0}                                                                \
                                    ?VAL_tcp_button_overshoot{0}                                                        \
                                        par_tcp_##PARAMETER_SECTION##_fader_placement{0}==0                             \
                                                - VAL_tcp_x_start_faders{0} + CUR_w{0} VAL_tcp_spacing_section_x{0}     \
                                                - VAL_tcp_x_start_button{0} + CUR_w{0} VAL_tcp_spacing_section_x{0}

                        ; linebreak y offset
                        set CUR_y                                           \
                            ?VAL_tcp_wrap_buttons{0}                        \
                                ?VAL_tcp_button_overshoot{0}                \
                                    ?VAL_tcp_show_button_##ELEMENT##{0}     \
                                        + CUR_y{0} VAL_tcp_button_line_h{0}

                        ; bottom edge y position
                        set CUR_y_bottom + CUR_y{0} + CUR_h{0} VAL_Pad{0}
                                
                        ; hide buttons when wrapping is enabled and there is no vertical room
                        set VAL_tcp_hide_buttons        \
                            ?VAL_tcp_wrap_buttons{0}    \
                                h<CUR_y_bottom{0}       \
                                    1

                        ; show button flag overwrite
                        set VAL_tcp_show_button_##ELEMENT       \
                            ?VAL_tcp_hide_buttons{0}            \
                                0
                        
                        ; update x position
                        set CUR_x                                   \
                            ?VAL_tcp_show_button_##ELEMENT##{0}     \
                                CUR_x_target{0}

                        ; detect potential width overflow
                        set VAL_tcp_button_overflow                                     \
                            ?VAL_tcp_allow_overflow_width_correction{0}                 \
                                - w -   WALTER_ELEMENT##.size{0}  - CUR_x{0} * SCALE 20 \
                                0
                               
                        ; overflow x correction
                        set CUR_x                                               \
                            ?VAL_tcp_allow_overflow_width_correction{0}         \
                                VAL_tcp_button_overflow{0}<0                    \
                                    + CUR_x * -1 VAL_tcp_button_overflow{0}
                        
                        ; overflow width correction
                        set CUR_w                                           \
                            ?VAL_tcp_allow_overflow_width_correction{0}     \
                                VAL_tcp_button_overflow{0}<0                \
                                + CUR_w VAL_tcp_button_overflow{0}

                        ; draw
                        set WALTER_ELEMENT##.##ELEMENT                          \
                            ?VAL_tcp_show_button_##ELEMENT##{0}                 \
                                [CUR_x{0} CUR_y{0} CUR_w{0} CUR_h{0} 1 0 1 0]

                        front WALTER_ELEMENT##.##ELEMENT

                        ; counter
                        set VAL_tcp_button_count        +   VAL_tcp_button_count{0}        VAL_tcp_show_button_##ELEMENT##{0}
                        
                        ; line count increment
                        set VAL_tcp_button_line                         \
                            ?VAL_tcp_show_button_##ELEMENT##{0}         \
                                ?VAL_tcp_wrap_buttons{0}                \
                                    ?VAL_tcp_button_overshoot{0}        \
                                        + VAL_tcp_button_line{0} 1

                        ; store x position for first line
                        set VAL_tcp_x_end_buttons                               \
                            ?VAL_tcp_show_button_##ELEMENT##{0}                 \
                                VAL_tcp_button_line{0}<=0                       \
                                    - CUR_x{0} VAL_tcp_spacing_section_x{0}

                        ; shift embed y position
                        set CUR_y_overshoot + CUR_y + VAL_Button{1} VAL_tcp_spacing_section_y{0}
                        
                        set VAL_tcp_y_start_fxembed                                         \
                            CUR_y_overshoot{0}>VAL_tcp_y_start_fxembed{0}                   \
                                CUR_Y_overshoot{0}

                        ; increment x position by separator
                        set CUR_x                                                   \
                            ?VAL_tcp_show_button_##ELEMENT##{0}                     \
                                ?CUR_separator_increment{0}                         \
                                    VAL_tcp_button_line{0}==0                       \
                                        - CUR_x{0} VAL_tcp_spacing_separator{0}     \
                                    VAL_tcp_wrap_buttons{0}==1                      \
                                        - CUR_x{0} VAL_tcp_spacing_separator{0}   

                    endmacro

    ;   ## Draw : TCP : Label
    ; --------------------------------------------------------------------------------

        macro MAC_DrawTcp_Label SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; preparations
            set CUR_x VAL_tcp_x_leftmost{0}
            set CUR_y + VAL_tcp_y_top VAL_tcp_h{1}
            set CUR_w                                                                                   \
                !VAL_tcp_compact{0}                                                                     \
                    - VAL_tcp_x_end_buttons{0} CUR_x{0}                                                 \
                    + VAL_tcp_spacing_section_x{0} - VAL_tcp_x_end_buttons{0} + CUR_x{0} VAL_Pad{0}
            set CUR_h VAL_Button{1}

            ; infobar visibility
            set VAL_tcp_show_infobar                            \
                ?par_tcp_##PARAMETER_SECTION##_label_infobox    \
                    !VAL_tcp_compact{0}                         \
                        1                                       \
                        0                                       \
                    0

            ; infobar position
            set CUR_x_infobar                                   \
                ?VAL_tcp_show_infobar{0}                        \
                    + CUR_x{0} - CUR_w{0} VAL_InfoBox{0}        \
                    0

            ; infobar width compensation
            set CUR_w_infobar_padding                           \
                ?VAL_tcp_show_infobar{0}                        \
                    + VAL_Pad{0} VAL_InfoBox{0}                 \
                    0

            ; index width
            set CUR_w_idx                               \
                * SCALE + 8 * 8 VAL_index_letters{0}

            ; label x
            set CUR_x_label                                         \
                par_tcp_##PARAMETER_SECTION##_label_index_vis==1    \
                    + CUR_x{0} CUR_w_idx{0}                         \
                    CUR_x{0}

            ; label width index compensation
            set CUR_w                                               \
                par_tcp_##PARAMETER_SECTION##_label_index_vis==1    \
                    - CUR_w{0} CUR_w_idx{0}

            ; inner label x position
            set CUR_x_innerLabel                                    \
                par_tcp_##PARAMETER_SECTION##_label_index_vis!=0    \
                    + CUR_x{0} CUR_w_idx{0}                         \
                    CUR_x{0}

            ; inner label width
            set CUR_w_innerLabel                                            \
                par_tcp_##PARAMETER_SECTION##_label_index_vis==2            \
                    - CUR_w{0} + CUR_w_idx{0} CUR_w_infobar_padding{0}      \
                    - CUR_w{0} CUR_w_infobar_padding{0}

            
            ; [DRAW] label background
            MAC_Draw_Box    1 WALTER_ELEMENT "label" VAL_Color_Track_Label_Bg{0} VAL_Color_Track_Label_Bg{1} VAL_Color_Track_Label_Bg{2}    CUR_x_label{0} CUR_y{0} CUR_w{0} CUR_h{0} 0 0 1 0
            
            ; hide label on comapct height
            set WALTER_ELEMENT##.custom.Box_label           \
                !VAL_tcp_h_level{0}                         \
                    [0 0 0 0 0 0 0 0]

            ; [DRAW] label
            set WALTER_ELEMENT##.label                                                      \
                ?VAL_tcp_h_level{0}                                                         \
                    [CUR_x_innerLabel{0} CUR_y{0} CUR_w_innerLabel{0} CUR_h{0} 0 0 1 0]

            ; [DRAW] track index
            set WALTER_ELEMENT##.trackidx                                   \
                ?par_tcp_##PARAMETER_SECTION##_label_index_vis              \
                    ?VAL_tcp_h_level{0}                                     \
                        [CUR_x{0} CUR_y{0} CUR_w_idx{0} CUR_h{0} 0 0 0 0]

            set VAL_tcp_IndexOffset * SCALE 4
    
            ; [DRAW] infobar
            set WALTER_ELEMENT##.infoblock                                                  \
                ?VAL_tcp_show_infobar{0}                                                    \
                    ?VAL_tcp_h_level{0}                                                     \
                        [CUR_x_infobar{0} CUR_y{0} VAL_InfoBox{0} VAL_InfoBox{1} 1 0 1 0]   \
                        0                                                                   \
                    0

            set WALTER_ELEMENT##.infoblock.color THEME_color_infobox_text    

            ; z order
            front WALTER_ELEMENT##.label
            front WALTER_ELEMENT##.trackidx
            front WALTER_ELEMENT##.infoblock

            

        endmacro

    ;   ## Draw : TCP : Embedded FX
    ; --------------------------------------------------------------------------------

        ; This one also covers the inserts section if it is displayed as a separate block.

        macro MAC_DrawTcp_EmbedFx SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; calculate insert / embedded fx placement box
            set CUR_y           VAL_tcp_y_start_fxembed{0}
            set CUR_x           + VAL_tcp_x_leftmost{0} VAL_Pad{0}
            set CUR_w           - w + VAL_tcp_spacing_section_x{0} + + VAL_tcp_x_offset{0} * 2 VAL_Pad{0} - WALTER_ELEMENT##.size{0} VAL_tcp_x_end_inserts{0}
            set CUR_h           - WALTER_ELEMENT##.size{1} + VAL_tcp_y_start_fxembed{0} VAL_Pad{0}
            set CUR_h_insert    - CUR_h * SCALE 6
            
            ; calculate absolute hiding position
            set VAL_tcp_insert_hide_pos                             \
                    -                                               \
                        -                                           \
                            + CUR_y{0} WALTER_ELEMENT##.size{1}     \
                            * SCALE 175                             \
                    h
            
            ; hide embed when height is under certain threshold
            set VAL_tcp_hide_embed_section      \
                ?VAL_tcp_compact{0}             \
                    1                           \
                VAL_tcp_insert_hide_pos{0}>0    \
                    1                           \
                    0
            
            ; check if inserts should be shown
            set VAL_tcp_show_inserts_in_embed_area      \
                ?VAL_tcp_hide_embed_section{0}          \
                    0                                   \
                ?VAL_tcp_show_inserts{0}                \
                    !VAL_tcp_inserts_inline{0}          \
                        1                               \
                        0                               \
                    0
            
            ; insert size
            set CUR_w_insert                                                                                                                                                                                    \
                !VAL_tcp_show_inserts_in_embed_area{0}                                                                                                                                                          \
                    0                                                                                                                                                                                           \
                    !par_tcp_##PARAMETER_SECTION##_insert_size_scale                                                                                                                                            \
                        + VAL_rounding_constant{0} - + VAL_tcp_inserts_min_w{0} * SCALE + 10 * 0.3 par_tcp_##PARAMETER_SECTION##_insert_size                                        VAL_rounding_constant{0}    \
                        + VAL_rounding_constant{0} - + VAL_tcp_inserts_min_w{0} * - CUR_w{0} VAL_insert_slot{4} * VAL_Fader_Scale{0} par_tcp_##PARAMETER_SECTION##_insert_size      VAL_rounding_constant{0}

            ; double the width on split sends
            set CUR_w_insert                        \
                ?VAL_tcp_inserts_split_sends{0}     \
                    * CUR_w_insert 2
            
            ; limit insert size
            set CUR_w_insert                \
                CUR_w_insert{0}>CUR_w{0}    \
                    CUR_w{0}

            set CUR_x_insert                                \
                ?VAL_tcp_show_inserts_in_embed_area{0}      \
                    + CUR_x{0} - CUR_w{0} CUR_w_insert{0}   \
                    0
            
            ; split sends: fx block width
            set CUR_w_insert_half_fx                                            \
                ?VAL_tcp_inserts_split_sends{0}                                 \
                    * CUR_w_insert      VAL_tcp_inserts_split_crossover{0}

            ; split sends: sends block width
            set CUR_w_insert_half_sends                                         \
                ?VAL_tcp_inserts_split_sends{0}                                 \
                    * CUR_w_insert  - 1 VAL_tcp_inserts_split_crossover{0}      \
                    0
            
            ; split sends: send list x offset
            set CUR_x_sends + CUR_x_insert CUR_w_insert_half_fx

            ; [DRAW] inserts (fx + parameters)
            set WALTER_ELEMENT##.fxparm                                                                                             \
                ?VAL_tcp_show_inserts_in_embed_area{0}                                                                              \
                    ?VAL_tcp_inserts_split_sends{0}                                                                                 \
                    + [CUR_x_insert{0} CUR_y{0} CUR_w_insert_half_fx{0}     CUR_h_insert{0} 0 0 0 1]    VAL_tcp_inserts_padding     \
                    + [CUR_x_insert{0} CUR_y{0} CUR_w_insert{0}             CUR_h_insert{0} 0 0 0 1]    VAL_tcp_inserts_padding

            ; [DRAW] sends
            set WALTER_ELEMENT##.sendlist                                                                                           \
                ?VAL_tcp_show_inserts_in_embed_area{0}                                                                              \
                    ?VAL_tcp_inserts_split_sends{0}                                                                                 \
                    + [CUR_x_sends{0} CUR_y{0} CUR_w_insert_half_sends{0}   CUR_h_insert{0} 0 0 0 1]    VAL_tcp_inserts_padding
                    

            ; [DRAW] inserts bg - track unselected
            set WALTER_ELEMENT##.custom.inserts_bg                                          \
                ?VAL_tcp_show_inserts_in_embed_area{0}                                      \
                    !track_selected                                                         \
                        [CUR_x_insert{0} CUR_y{0} CUR_w_insert{0} CUR_h_insert{0} 0 0 0 1]
            
            ; [DRAW] inserts bg - track selected
            set WALTER_ELEMENT##.custom.inserts_bg_select                                   \
                ?VAL_tcp_show_inserts_in_embed_area{0}                                      \
                    ?track_selected                                                         \
                        [CUR_x_insert{0} CUR_y{0} CUR_w_insert{0} CUR_h_insert{0} 0 0 0 1]

            ; font color
            set WALTER_ELEMENT##.fxembedheader.color    \
                !VAL_tcp_hide_embed_section{0}          \
                    THEME_color_button_text_off

            ; embedded fx width
            set CUR_w                                                               \
                !VAL_tcp_hide_embed_section{0}                                      \
                    ?VAL_tcp_show_inserts_in_embed_area{0}                          \
                        - CUR_x_insert{0} + CUR_x{0} VAL_tcp_spacing_section_x{0}

            ; [DRAW] embedded fx
            set WALTER_ELEMENT##.fxembed                            \
                !VAL_tcp_hide_embed_section{0}                      \
                    [CUR_x{0} CUR_y{0} CUR_w{0} CUR_h{0} 0 0 0 1]

            ; inserts z order
            front WALTER_ELEMENT##.custom.inserts_bg
            front WALTER_ELEMENT##.custom.inserts_bg_select            
            front WALTER_ELEMENT##.fxparm
            front WALTER_ELEMENT##.sendlist
            
            ; visbility flags for inserts (parameters, fx, sends)
            ; -> overwrite internal TCP sendlist setttings when split sends mode is activated
            set WALTER_ELEMENT##.fxparm.visflags    \
                ?VAL_tcp_inserts_split_sends{0}     \
                    [1 0 -1]                        \
                    [1 0 0]
            
            

        endmacro

    ;   ## Draw : TCP : Folder
    ; --------------------------------------------------------------------------------

        macro MAC_DrawTcp_Folder SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; position setup
            set CUR_w       VAL_Button_Folder{0}
            set CUR_x       - VAL_tcp_x_offset{0} CUR_w{0}
            set CUR_x_line  - CUR_x{0} VAL_tcp_folderindent{0}
            set CUR_y       - tcp.size{1} + VAL_Button_Folder{0} VAL_Pad{0}

            ; [DRAW] folder collapse button
            set WALTER_ELEMENT##.foldercomp                                                     \
                ?par_tcp_gen_folder_icon_collapse                                               \
                    ?VAL_tcp_h_level{0}                                                         \
                        [CUR_x{0} CUR_y{0} VAL_Button_Folder{0} VAL_Button_Folder{0} 0 1 0 1]

            ; y position of line
            set CUR_y_line                              \
                par_tcp_gen_folder_icon_collapse==2     \
                    0                                   \
                    + CUR_y VAL_Pad{0}

            ; x position of line
            set CUR_x_line                                      \
                par_tcp_gen_folder_icon_collapse==2             \
                    + CUR_x_line * 0.5 VAL_Button_Folder{0}     \
                    + CUR_x_line * 0.4 VAL_Button_Folder{0}
            
            ; line width
            set CUR_w_line                                                                  \
                par_tcp_gen_folder_icon_collapse==1                                         \
                    - CUR_w * 0.6 VAL_Button_Folder{0}                                      \
                    folderstate<0                                                           \
                        + CUR_w - VAL_tcp_folderindent{0}   * 0.5 VAL_Button_Folder{0}      \
                        - CUR_w                             * 0.5 VAL_Button_Folder{0}
            
            ; line height
            set CUR_h_line                                              \
                folderstate>0                                           \
                    - WALTER_ELEMENT##.size{1} VAL_tcp_h{0}             \
                folderstate==0                                          \
                    - WALTER_ELEMENT##.size{1} VAL_Border{0}            \
                folderstate<0                                           \
                    par_tcp_gen_folder_icon_collapse==2                 \
                        - tcp.size{1} * 0.5 VAL_Button_Folder{0}        \
                        * 0.5 VAL_Button_Folder{0}                      \
                    0

            ; [DRAW] last track in folder marker
            set WALTER_ELEMENT##.custom.folder_last_bold                                        \
                par_tcp_gen_folder_icon_collapse==1                                             \
                    ?VAL_tcp_h_level{0}                                                         \
                        folderstate<0                                                           \
                            [CUR_x_line{0} CUR_y_line{0} CUR_w_line{0} CUR_h_line{0} 0 1 0 1]   \
                            0                                                                   \
                        0                                                                       \
                    0

            ; [DRAW] last track in folder line
            set WALTER_ELEMENT##.custom.folder_last                                             \
                par_tcp_gen_folder_icon_collapse==2                                             \
                    ?VAL_tcp_h_level{0}                                                         \
                        folderstate<0                                                           \
                            [CUR_x_line{0} CUR_y_line{0} CUR_w_line{0} CUR_h_line{0} 0 0 0 1]   \
                            0                                                                   \
                        0                                                                       \
                    0

            ; [DRAW] child track line
            set WALTER_ELEMENT##.custom.folder_child                                                \
                par_tcp_gen_folder_icon_collapse==2                                                 \
                    ?VAL_tcp_h_level{0}                                                             \
                        folderdepth>0                                                               \
                            folderstate>=0                                                          \
                                [CUR_x_line{0} CUR_y_line{0} CUR_w_line{0} CUR_h_line{0} 0 0 0 1]   \
                                0                                                                   \
                            0                                                                       \
                        0                                                                           \
                    0

            ; mode icon offset
            set CUR_x                               \
                ?par_tcp_gen_folder_icon_collapse   \
                    - CUR_x{0} CUR_w{0}

            ; [DRAW] folder mode icon
            set WALTER_ELEMENT##.folder                                                         \
                ?par_tcp_gen_folder_icon_mode                                                   \
                    ?VAL_tcp_h_level{0}                                                         \
                        [CUR_x{0} CUR_y{0} VAL_Button_Folder{0} VAL_Button_Folder{0} 0 1 0 1]

            ; update z order
            front WALTER_ELEMENT##.foldercomp
            front WALTER_ELEMENT##.folder
            front WALTER_ELEMENT##.custom.folder_last
            front WALTER_ELEMENT##.custom.folder_last_bold
            front WALTER_ELEMENT##.custom.folder_child


        endmacro

    ;   ## Draw : TCP : Font
    ; --------------------------------------------------------------------------------

        ;   ### Draw : TCP : Font : Shared Code : Open
        ; --------------------------------------------------------------------------------

            macro MAC_DrawTcp_Font_SharedCode_Open SCALE WALTER_ELEMENT PARAMETER_SECTION
                
                ; insert slot width pre-calculation
                set VAL_tcp_slot_w_fx          + 0.15 * 0.000375 par_tcp_gen_insert_slot_width
                set VAL_tcp_slot_w_sends       + 0.15 * 0.000375 par_tcp_gen_insert_slot_width_sends

                ; fx slot width
                set VAL_tcp_slot_w_min          * WALTER_ELEMENT##.fxparm{w} VAL_tcp_slot_w_fx{0}
                set VAL_tcp_slot_w_max          + WALTER_ELEMENT##.fxparm{w} 1

                ;; send slot width
                set VAL_tcp_slot_w_min_send     * WALTER_ELEMENT##.sendlist{w} VAL_tcp_slot_w_sends{0}
                set VAL_tcp_slot_w_max_send     + WALTER_ELEMENT##.sendlist{w} 1
                
                ; inserts
                set WALTER_ELEMENT##.fxparm.font        [VAL_Font_Label_Inserts     VAL_insert_slot{0}      VAL_tcp_slot_w_min{0}           VAL_tcp_slot_w_max{0}       0 0 VAL_fxlist_scrollbar{1} VAL_fxlist_scrollbar{0}]
                set WALTER_ELEMENT##.sendlist.font      [VAL_Font_Label_Inserts     VAL_insert_slot{0}      VAL_tcp_slot_w_min_send{0}      VAL_tcp_slot_w_max_send{0}  0 0 VAL_fxlist_scrollbar{1} VAL_fxlist_scrollbar{0}]
                set WALTER_ELEMENT##.fxlist.font        WALTER_ELEMENT##.fxparm.font
                
                set WALTER_ELEMENT##.fxparm.margin      [VAL_Margin_Label{0}        VAL_Margin_Label{1}     VAL_Margin_Label{2}     VAL_Margin_Label{3} 0 0 0 VAL_Pad{0}]
                set WALTER_ELEMENT##.sendlist.margin    [VAL_Margin_Label{0}        VAL_Margin_Label{1}     0                       VAL_Margin_Label{3} 0 0 0 VAL_Pad{0}]
                set WALTER_ELEMENT##.fxlist.margin      WALTER_ELEMENT##.fxparm.margin

                ; volume readout
                set WALTER_ELEMENT##.volume.label.color     [THEME_color_readout_font{0} THEME_color_readout_font{1} THEME_color_readout_font{2}]
                set WALTER_ELEMENT##.volume.label.margin    [VAL_Margin_Label{1} VAL_Margin_Label{1} VAL_Margin_Label{1} VAL_Margin_Label{1} 0.5]

                ; fx embed
                set WWALTER_ELEMENT##.fxembedheader.color WALTER_ELEMENT##.volume.label.color

            endmacro

        ;   ### Draw : TCP : Font : Track
        ; --------------------------------------------------------------------------------

            macro MAC_DrawTcp_Font_Track SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; [SHARED]
                MAC_DrawTcp_Font_SharedCode_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; recinput
                set WALTER_ELEMENT##.recinput.font      VAL_Font_Label
                set WALTER_ELEMENT##.recinput.margin    [VAL_Margin_RecInput{0} VAL_Margin_RecInput{1} VAL_Margin_RecInput{2} VAL_Margin_RecInput{3} 1 0 0 0]

                ; track index
                set WALTER_ELEMENT##.trackidx.font VAL_Font_Label
                set WALTER_ELEMENT##.trackidx.margin                                                \
                par_tcp_##PARAMETER_SECTION##_label_index_vis==1                                    \
                    [VAL_Margin_Label{0} VAL_Margin_Label{1} VAL_Margin_Label{2} VAL_Margin_Label{3} 0.5 0 0 0]     \
                    [VAL_Margin_Label{0} VAL_Margin_Label{1} VAL_Margin_Label{2} VAL_Margin_Label{3} 1 0 0 0]

                set WALTER_ELEMENT##.trackidx.color [VAL_Color_Track_Index_TCP{0} VAL_Color_Track_Index_TCP{1} VAL_Color_Track_Index_TCP{2} . . . .]

                ; name label
                set WALTER_ELEMENT##.label.font VAL_Font_Label
                set WALTER_ELEMENT##.label.margin   [VAL_tcp_label_margin{0}        VAL_Margin_Label{1}             VAL_Margin_Label{2}             VAL_Margin_Label{3} 0 0 0 0]
                set WALTER_ELEMENT##.label.color    [VAL_Color_Track_Label_Text{0}  VAL_Color_Track_Label_Text{1}   VAL_Color_Track_Label_Text{2}   .                   . . . .]

            endmacro

        ;   ### Draw : TCP : Font : Master
        ; --------------------------------------------------------------------------------

            macro MAC_DrawTcp_Font_Master SCALE WALTER_ELEMENT PARAMETER_SECTION

                ; [SHARED]
                MAC_DrawTcp_Font_SharedCode_Open SCALE WALTER_ELEMENT PARAMETER_SECTION

            endmacro


    ;   ## Draw : TCP : Finish
    ; --------------------------------------------------------------------------------

            macro MAC_DrawTcp_Finish SCALE WALTER_ELEMENT PARAMETER_SECTION

                front WALTER_ELEMENT##.custom.Image_frame

                front WALTER_ELEMENT##.custom.Box_selection_frame_l
                front WALTER_ELEMENT##.custom.Box_selection_frame_r
                front WALTER_ELEMENT##.custom.Box_selection_frame_t
                front WALTER_ELEMENT##.custom.Box_selection_frame_b

            endmacro


; ====================================================================================================================================
;   # ENVCP
; ====================================================================================================================================

    ;   ## Draw : ENVCP : Setup
    ; --------------------------------------------------------------------------------

        macro MAC_DrawEnvcp_Setup SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; size
            set WALTER_ELEMENT##.size tcp.size

            ; custom element
            custom WALTER_ELEMENT##.custom.envcp_symbol         "" "" "" "track_custom_env_icon_tail"
            custom WALTER_ELEMENT##.custom.iconlane             "" "" "" "tcp_iconbg"
            custom WALTER_ELEMENT##.custom.iconlane_select      "" "" "" "tcp_iconbgsel"
            custom WALTER_ELEMENT##.custom.fader_frame          "" "" "" "track_custom_fader_frame"
            custom WALTER_ELEMENT##.custom.fader_knob_frame     "" "" "" "track_custom_knob_border"
            custom WALTER_ELEMENT##.custom.folder_child         "" "" "" "track_custom_tcp_folder_child"

            ; button wrapping
            set VAL_tcp_wrap_buttons par_tcp_envcp_element_adj_wrap_buttons

            ; compact width
            set VAL_envcp_compact_w + tcp_iconsize + VAL_tcp_x_offset_max_precomp * SCALE 120
            
            set VAL_tcp_compact             \
                w<VAL_envcp_compact_w{0}    \
                    1                       \
                    0

            ; envcp indentation
            set VAL_envcp_indent                                                                                                                                        \
                !par_tcp_envcp_settings_symbol                                                                                                                          \
                    + VAL_rounding_constant{0} - * SCALE         * 0.03 par_tcp_##PARAMETER_SECTION##_settings_indent                       VAL_rounding_constant{0}    \
                    + VAL_rounding_constant{0} - + * SCALE       * 0.03 par_tcp_##PARAMETER_SECTION##_settings_indent VAL_Envcp_Symbol{0}   VAL_rounding_constant{0}

            ; x offset
            set VAL_envcp_x_offset                              \
                ?VAL_tcp_compact{0}                             \
                    VAL_tcp_x_offset_folder{0}                  \
                    + VAL_tcp_x_offset{0} VAL_envcp_indent{0}

            ; [DRAW] indentation background
            MAC_Draw_Box 1 WALTER_ELEMENT "indent" THEME_color_tcp_empty_space{0} THEME_color_tcp_empty_space{1} THEME_color_tcp_empty_space{2} 0 0 VAL_envcp_x_offset WALTER_ELEMENT##.size{1} 0 0 0 1

            ; symbol y offset
            set CUR_y_symbol * SCALE 3

            ; [DRAW] Envcp Symbol
            set WALTER_ELEMENT##.custom.envcp_symbol                                            \
                ?par_tcp_envcp_settings_symbol{0}                                               \
                    VAL_tcp_h_level{0}>0                                                        \
                        [0 CUR_y_symbol VAL_envcp_x_offset{0} VAL_Envcp_Symbol{1} 0 0 0 0]      \
                        0                                                                       \
                    0

            front WALTER_ELEMENT##.custom.envcp_symbol

            ; icon lane usage
            set VAL_envcp_use_icon_lane                                     \
                trackidx>0                                                  \
                    ?par_tcp_##PARAMETER_SECTION##_settings_lane_display    \
                        tcp_iconsize>0                                      \
                            1                                               \
                            0                                               \
                        0                                                   \
                    0

            ; icon background
            set CUR_w tcp_iconsize
            set CUR_x                                                   \
                ?VAL_envcp_use_icon_lane{0}                             \
                    - WALTER_ELEMENT##.size{0} CUR_w{0}                 \
                    WALTER_ELEMENT##.size{0}

            set CUR_h       - WALTER_ELEMENT##.size{1} VAL_Border{0}
            set CUR_h_icon  WALTER_ELEMENT##.size{1}

            ; [DRAW] icon background
            set WALTER_ELEMENT##.custom.iconlane                        \
                ?VAL_envcp_use_icon_lane{0}                             \
                    !env_selected                                       \
                        [CUR_x{0} 0 CUR_w{0} CUR_h_icon{0} 1 0 1 1]

            set WALTER_ELEMENT##.custom.iconlane_select                 \
                ?VAL_envcp_use_icon_lane{0}                             \
                        ?env_selected                                   \
                            [CUR_x{0} 0 CUR_w{0} CUR_h_icon{0} 1 0 1 1]

            ; store x position
            set CUR_x_rightmost CUR_x{0}

            ; select bar
            set CUR_x                                                       \
                ?par_tcp_gen_highlight_selection                            \
                    ?VAL_envcp_use_icon_lane{0}                             \
                        - tcp.custom.box_highlight_select{x} tcp_iconsize   \
                        tcp.custom.box_highlight_select{x}

            set CUR_w tcp.custom.box_highlight_select{w}

            ; [DRAW] select bar
            MAC_Draw_Box        1 WALTER_ELEMENT "highlight_select" VAL_color_selectbar_envcp{0} VAL_color_selectbar_envcp{1} VAL_color_selectbar_envcp{2}  CUR_x{0} 0 CUR_w{0} CUR_h{0} 1 0 1 1
            MAC_Draw_Image      1 WALTER_ELEMENT "highlight_select" "track_custom_selmarker_frame"                                                          CUR_x{0} 0 CUR_w{0} CUR_h{0} 1 0 1 1

            ; color bar
            set CUR_x                                                       \
                ?par_tcp_gen_highlight_color                                \
                    ?VAL_envcp_use_icon_lane{0}                             \
                        - tcp.custom.box_highlight_color{x} tcp_iconsize    \
                        tcp.custom.box_highlight_color{x}

            set CUR_w tcp.custom.box_highlight_color{w}
            
            ; [DRAW] color bar
            MAC_Draw_Box    1 WALTER_ELEMENT "highlight_color" VAL_color_colorbar_envcp{0} VAL_color_colorbar_envcp{1} VAL_color_colorbar_envcp{2}  CUR_x{0} 0 CUR_w{0} CUR_h{0} 1 0 1 1
            MAC_Draw_Image  1 WALTER_ELEMENT "highlight_color" "track_custom_colorbar_frame"                                                        CUR_x{0} 0 CUR_w{0} CUR_h{0} 1 0 1 1

            ; starting position for buttons
            set VAL_envcp_x_start_button CUR_x

            ; button line height
            set VAL_tcp_button_line_h + VAL_Button{1} VAL_tcp_spacing_y

            ; background
            set CUR_w - CUR_x_rightmost{0} VAL_envcp_x_offset{0}

            MAC_Draw_Box    1 WALTER_ELEMENT "bg" VAL_Color_Envcp_Bg{0} VAL_Color_Envcp_Bg{1} VAL_Color_Envcp_Bg{2}     VAL_envcp_x_offset{0} 0 CUR_w{0} CUR_h{0} 0 0 1 1
            MAC_Draw_Image  1 WALTER_ELEMENT "frame" "track_custom_bg_frame"                                            VAL_envcp_x_offset{0} 0 CUR_w{0} CUR_h{0} 0 0 1 1

            ; offset for lower frame line
            set CUR_xr_frame    - WALTER_ELEMENT##.size{0}      VAL_Border{0}
            set CUR_w_frame     - WALTER_ELEMENT##.size{0}      VAL_envcp_x_offset{0}
            set CUR_h_frame     - CUR_h{0}                      VAL_Border{0}

            ; selection frame
            MAC_Draw_Box    VAL_show_selection_frame_envcp     WALTER_ELEMENT "selection_frame_l" VAL_color_selection_frame{0} VAL_color_selection_frame{1} VAL_color_selection_frame{2}     VAL_envcp_x_offset{0}      0               VAL_Border{0}       CUR_h_frame{0}      0 0 0 1
            MAC_Draw_Box    VAL_show_selection_frame_envcp     WALTER_ELEMENT "selection_frame_r" VAL_color_selection_frame{0} VAL_color_selection_frame{1} VAL_color_selection_frame{2}     CUR_xr_frame{0}            0               VAL_Border{0}       CUR_h{0}            1 0 1 1
            MAC_Draw_Box    VAL_show_selection_frame_envcp     WALTER_ELEMENT "selection_frame_t" VAL_color_selection_frame{0} VAL_color_selection_frame{1} VAL_color_selection_frame{2}     VAL_envcp_x_offset{0}      0               CUR_w_frame{0}      VAL_Border{0}       0 0 1 0
            MAC_Draw_Box    VAL_show_selection_frame_envcp     WALTER_ELEMENT "selection_frame_b" VAL_color_selection_frame{0} VAL_color_selection_frame{1} VAL_color_selection_frame{2}     VAL_envcp_x_offset{0}      CUR_h_frame{0}  CUR_w_frame{0}      VAL_Border{0}       0 1 1 1

            ; z-alignment correction
            front WALTER_ELEMENT##.custom.Box_highlight_select
            front WALTER_ELEMENT##.custom.Image_highlight_select
            front WALTER_ELEMENT##.custom.Box_highlight_color
            front WALTER_ELEMENT##.custom.Image_highlight_color

            ; leftmost position
            set VAL_envcp_x_leftmost + VAL_envcp_x_offset{0} VAL_Pad{0}

            ; dynamic hiding points
            set VAL_envcp_label_size + VAL_tcp_label_min_w{0} * SCALE * 0.3 par_tcp_##PARAMETER_SECTION##_label_size

            set VAL_tcp_hide_x_line_1                                                               \
                -                                                                                   \
                    + * SCALE 10 + WALTER_ELEMENT##.size{0} +                                       \
                    VAL_tcp_x_offset_max_precomp{0} + VAL_envcp_indent{0} VAL_envcp_label_size{0}   \
                w

            set VAL_tcp_hide_x_line_2                                       \
                -                                                           \
                    + * SCALE 10 + WALTER_ELEMENT##.size{0} +               \
                    VAL_tcp_x_offset_max_precomp{0} VAL_envcp_indent{0}     \
                w

            set VAL_tcp_hide_x_leftmost                                             \
                -                                                                   \
                    + WALTER_ELEMENT##.size{0} + VAL_tcp_x_offset{0} VAL_Pad{0}     \
                w

            ; init hide flags
            set VAL_tcp_hide_buttons 0
            set VAL_tcp_hide_faders 0

            ; available space
            set VAL_envcp_available_space - w + VAL_tcp_x_offset_max{0} + VAL_envcp_indent{0} + VAL_Pad{0} - WALTER_ELEMENT##.size{0} CUR_x{0}


        endmacro

    ;   ## Draw : ENVCP : Fader
    ; --------------------------------------------------------------------------------

        macro MAC_DrawEnvcp_Fader SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; mark fader start position
            set VAL_tcp_x_start_faders CUR_x{0}

            ; show in icon lane
            set VAL_envcp_lanedisplay                               \
                ?VAL_envcp_use_icon_lane{0}                         \
                    par_tcp_##PARAMETER_SECTION##_value_mode==3     \
                        1                                           \
                        0                                           \
                    0

            ; inline display
            set VAL_envcp_fader_inline                              \
                par_tcp_##PARAMETER_SECTION##_value_mode==1         \
                    1                                               \
                    par_tcp_##PARAMETER_SECTION##_value_mode==3     \
                        !VAL_envcp_use_icon_lane{0}                 \
                            1                                       \
                            0                                       \
                        0

            ; minimal width
            set VAL_envcp_fader_min_w                               \
                !par_tcp_##PARAMETER_SECTION##_value_vertical       \
                    * SCALE 40                                      \
                    * SCALE 25


            ; visibility
            set VAL_envcp_show_fader                                \
                !VAL_tcp_h_level{0}                                 \
                    0                                               \
                !VAL_tcp_compact{0}                                 \
                    ?VAL_envcp_lanedisplay{0}                       \
                        tcp_iconsize>VAL_envcp_fader_min_w{0}       \
                            1                                       \
                            0                                       \
                    ?VAL_envcp_fader_inline{0}                      \
                        1                                           \
                        0                                           \
                    0
            

            ; y position
            set CUR_y VAL_Envcp_h{1}
                
            ; height
            set CUR_h                                           \
                !par_tcp_##PARAMETER_SECTION##_value_vertical   \
                    VAL_Button{1}                               \
                par_tcp_##PARAMETER_SECTION##_value_mode!=2     \
                    - WALTER_ELEMENT##.size{1} * 3 VAL_Pad{0}

            ; vertical hiding logic
            set CUR_y_target + CUR_y{0} + VAL_Button{1} VAL_Pad{0}

            set VAL_envcp_show_fader                            \
                par_tcp_##PARAMETER_SECTION##_value_mode==2     \
                    h<CUR_y_target{0}                           \
                        0

            ; knob mode
            set VAL_envcp_h_vert_knob + CUR_y_target{0} * SCALE 20

            set VAL_envcp_fader_knob                                \
                ?par_tcp_##PARAMETER_SECTION##_value_vertical       \
                    h<VAL_envcp_h_vert_knob{0}                      \
                        1                                           \
                        0                                           \
                    ?VAL_envcp_lanedisplay{0}                       \
                        0                                           \
                        !par_tcp_##PARAMETER_SECTION##_value_size   \
                            1                                       \
                            0

            ; width
            set CUR_w                                                                                                                                                                                                                   \
                ?par_tcp_##PARAMETER_SECTION##_value_vertical                                                                                                                                                                           \
                    VAL_Knob_s{0}                                                                                                                                                                                                       \
                ?VAL_envcp_lanedisplay{0}                                                                                                                                                                                               \
                    - tcp_iconsize * 3 VAL_Pad{0}                                                                                                                                                                                       \
                ?VAL_envcp_fader_knob{0}                                                                                                                                                                                                \
                    VAL_Knob_s{0}                                                                                                                                                                                                       \
                !par_tcp_##PARAMETER_SECTION##_value_scale                                                                                                                                                                              \
                    + VAL_rounding_constant{0} - + VAL_tcp_fader_min_w{0} + VAL_Knob{0}                                              * 0.2 * SCALE              par_tcp_##PARAMETER_SECTION##_value_size    VAL_rounding_constant{0}    \
                    + VAL_rounding_constant{0} - + VAL_tcp_fader_min_w{0} * - VAL_envcp_available_space{0} VAL_tcp_fader_min_w{0}    * VAL_Fader_Scale{0}       par_tcp_##PARAMETER_SECTION##_value_size    VAL_rounding_constant{0}

            ; target x position
            set CUR_x_target                                                                    \
                ?VAL_envcp_show_fader{0}                                                        \
                    ?VAL_envcp_lanedisplay{0}                                                   \
                        ?par_tcp_##PARAMETER_SECTION##_value_vertical                           \
                            - WALTER_ELEMENT##.size{0} + CUR_w{0}           * 4 VAL_Pad{0}      \
                            !VAL_envcp_fader_knob{0}                                            \
                                - WALTER_ELEMENT##.size{0} - tcp_iconsize       VAL_Pad{0}      \
                                - WALTER_ELEMENT##.size{0} + VAL_Knob_s{0}  * 4 VAL_Pad{0}      \
                        - CUR_x{0} + CUR_w{0} VAL_tcp_spacing_section_x{0}

            ; hiding logic
            set VAL_envcp_show_fader                            \
                ?VAL_envcp_fader_inline{0}                      \
                    VAL_tcp_hide_x_line_1{0}>CUR_x_target{0}    \
                        0

            ; hide fader flag
            set VAL_tcp_hide_faders             \
                ?VAL_envcp_fader_inline{0}      \
                    !VAL_envcp_show_fader{0}    \
                        1

            ; knob mode
            set WALTER_ELEMENT##.fader.fadermode    \
                ?VAL_envcp_fader_knob{0}            \
                    1                               \
                    -1

            ; [DRAW] fader
            set WALTER_ELEMENT##.fader                                                                              \
                ?VAL_envcp_show_fader{0}                                                                            \
                    ?VAL_envcp_fader_knob{0}                                                                        \
                        + [0 0 0 0 0 0 0 0] [CUR_x_target{0} CUR_y{0} VAL_Knob_s{0} VAL_Knob_s{0} 1 0 1 0]          \
                    !par_tcp_##PARAMETER_SECTION##_value_vertical                                                   \
                        + [0 VAL_Fader{3} 0 0 0 0 0 0] [CUR_x_target{0} CUR_y{0} CUR_w{0} VAL_Fader{2} 1 0 1 0]     \
                        + [VAL_Fader{3} 0 0 0 0 0 0 0] [CUR_x_target{0} CUR_y{0} VAL_Fader{2} CUR_h{0} 1 0 1 1]

            set WALTER_ELEMENT##.custom.fader_frame     \
                ?VAL_envcp_show_fader{0}                \
                    !VAL_envcp_fader_knob{0}            \
                        WALTER_ELEMENT##.fader          \
                        0                               \
                    0

            set WALTER_ELEMENT##.custom.fader_knob_frame    \
                ?VAL_envcp_show_fader{0}                    \
                    ?VAL_envcp_fader_knob{0}                \
                        WALTER_ELEMENT##.fader              \
                        0                                   \
                    0

            front WALTER_ELEMENT##.fader
            front WALTER_ELEMENT##.custom.fader_frame
            front WALTER_ELEMENT##.custom.fader_knob_frame

            ; store x position
            set CUR_x                           \
                ?VAL_envcp_show_fader{0}        \
                    CUR_x_target{0}

            set VAL_envcp_x_start_button        \
                ?VAL_envcp_show_fader{0}        \
                    ?VAL_envcp_fader_inline{0}  \
                        CUR_x_target{0}


        endmacro

    ;   ## Draw : ENVCP : Buttons
    ; --------------------------------------------------------------------------------

        macro MAC_DrawEnvcp_Buttons SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; preparation
            set CUR_x - VAL_envcp_x_start_button{0} VAL_tcp_spacing_section_x{0}
    	    set CUR_y VAL_Envcp_h{1}
            set CUR_w VAL_Button{0}
            set CUR_h VAL_Button{1}
            
            ; tracking data
            set VAL_tcp_button_count        0
            set VAL_tcp_button_count_line   0
            set VAL_tcp_button_line 0

            ; position tracking
            set VAL_tcp_x_end_buttons CUR_x{0}
            set VAL_envcp_x_postfx CUR_x{0}

            ; hide buttons when height is compact
            set VAL_tcp_hide_buttons    \
                ?VAL_tcp_compact{0}     \
                    1                   \
                !VAL_tcp_h_level{0}     \
                    1

            ; pick second line when inline fader is hidden and wrapping is on -> set y position
            set CUR_y                                               \
                ?VAL_tcp_hide_faders{0}                             \
                    ?VAL_envcp_fader_inline{0}                      \
                        ?VAL_tcp_wrap_buttons{0}                    \
                            + CUR_y{0} VAL_tcp_button_line_h{0}

            ; pick second line when inline fader is hidden and wrapping is on -> set line count
            set VAL_tcp_button_line                 \
                ?VAL_tcp_hide_faders{0}             \
                    ?VAL_envcp_fader_inline{0}      \
                        ?VAL_tcp_wrap_buttons{0}    \
                            1

            ; hide buttons when an inline fader is invisible and button wrapping is disabled
            set VAL_tcp_hide_buttons                \
                ?VAL_tcp_hide_faders{0}             \
                    ?VAL_envcp_fader_inline{0}      \
                        !VAL_tcp_wrap_buttons{0}    \
                            1

            ; learn visibility
            set VAL_envcp_fx_learn                                  \
                envcp_type{0}==4                                    \
                    par_tcp_##PARAMETER_SECTION##_element_vis&16    \
                        1                                           \
                        0                                           \
                    0

            ; mod visibility
            set VAL_envcp_fx_mod                                    \
                envcp_type{0}==4                                    \
                    par_tcp_##PARAMETER_SECTION##_element_vis&32    \
                        1                                           \
                        0                                           \
                    0

            ; [BUTTON] Arm
            MAC_DrawTcp_Buttons_SingleButton_Envcp SCALE 2 WALTER_ELEMENT PARAMETER_SECTION "arm" 0

            ; [BUTTON] Bypass / Hide
            MAC_DrawTcp_Buttons_SingleButton_Envcp SCALE 4 WALTER_ELEMENT PARAMETER_SECTION "bypass" 0
            MAC_DrawTcp_Buttons_SingleButton_Envcp SCALE 8 WALTER_ELEMENT PARAMETER_SECTION "hide" 0

            ; [BUTTON] Mod / Lean
            MAC_DrawTcp_Buttons_SingleButton_Envcp SCALE 16 WALTER_ELEMENT PARAMETER_SECTION "mod" VAL_envcp_fx_learn
            MAC_DrawTcp_Buttons_SingleButton_Envcp SCALE 32 WALTER_ELEMENT PARAMETER_SECTION "learn" VAL_envcp_fx_mod


        endmacro

    ;   ## Draw : ENVCP : Label
    ; --------------------------------------------------------------------------------

        macro MAC_DrawEnvcp_Label SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; preparations
            set CUR_x VAL_envcp_x_leftmost{0}
            set CUR_y VAL_Envcp_h{1}
            set CUR_w - VAL_tcp_x_end_buttons{0} CUR_x{0}
            set CUR_h VAL_Button{1}
            set VAL_readout_margin * SCALE 10

            ; absolute width
            set CUR_w_abs - w - WALTER_ELEMENT##.size{0} CUR_w{0}

            ; readout width
            set CUR_w_readout                                                                                   \
                ?par_tcp_##PARAMETER_SECTION##_label_readout_size_scale                                         \
                    * CUR_w_abs{0}  * VAL_Fader_Scale{0}    par_tcp_##PARAMETER_SECTION##_label_readout_size    \
                    * 2             * SCALE * 0.2           par_tcp_##PARAMETER_SECTION##_label_readout_size

            ; readout absolute width
            set CUR_w_readout_abs - w - WALTER_ELEMENT##.size{0} CUR_w_readout{0}

            ; label width
            set CUR_w_label                                                     \
                par_tcp_##PARAMETER_SECTION##_label_readout_placement{0}>=1     \
                    - CUR_w{0} CUR_w_readout{0}                                 \
                    CUR_w{0}

            ; label background
            set CUR_w_label_bg                                                  \
                par_tcp_##PARAMETER_SECTION##_label_readout_placement{0}==2     \
                    CUR_w_label{0}                                              \
                    CUR_w{0}

            ; readout x position
            set CUR_x_readout + CUR_x{0} CUR_w_label{0}

            ; readout hiding logic
            set CUR_x_readout_abs - w - WALTER_ELEMENT##.size{0} - CUR_x_readout{0} - VAL_envcp_label_size{0} VAL_tcp_x_offset{0}

            set VAL_Show_readout                                            \
                !VAL_tcp_h_level{0}                                         \
                    0                                                       \
                !par_tcp_##PARAMETER_SECTION##_label_readout_placement      \
                    0                                                       \
                CUR_x_readout_abs{0}>CUR_x{0}                               \
                    !VAL_tcp_compact{0}                                     \
                        1                                                   \
                        0                                                   \
                    0
            
            set VAL_envcp_show_label        \
                VAL_tcp_h_level{0}>0        \
                    1                       \
                    0

            ; inner label width when there's no readout
            set CUR_w_label                 \
                !VAL_Show_readout{0}        \
                    CUR_w{0}

            ; label background width when there's no readout
            set CUR_w_label_bg              \
                !VAL_Show_readout{0}        \
                    CUR_w{0}

            ; [DRAW] label background (when there is enough height)
            MAC_Draw_Box    VAL_envcp_show_label{0} WALTER_ELEMENT "label" VAL_Color_Envcp_label_Bg{0} VAL_Color_Envcp_label_Bg{1} VAL_Color_Envcp_label_Bg{2}    CUR_x{0} CUR_y{0} CUR_w_label_bg{0} CUR_h{0} 0 0 1 0
            
            
            ; [DRAW] label (when there is enough height)
            set WALTER_ELEMENT##.label                                      \
                ?VAL_envcp_show_label{0}                                    \
                    [CUR_x{0} CUR_y{0} CUR_w_label{0} CUR_h{0} 0 0 1 0]

            ; [DRAW] readout
            set WALTER_ELEMENT##.value                                              \
                ?VAL_envcp_show_label{0}                                            \
                    [CUR_x_readout{0} CUR_y{0} CUR_w_readout{0} CUR_h{0} 1 0 1 0]

            ; z order
            front WALTER_ELEMENT##.label
            front WALTER_ELEMENT##.value

        endmacro

    ;   ## Draw : ENVCP : Folder
    ; --------------------------------------------------------------------------------

        macro MAC_DrawEnvcp_Folder SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; position setup
            set CUR_w   VAL_Button_Folder{0}
            set CUR_x   - VAL_tcp_x_offset{0} + CUR_w{0} VAL_tcp_folderindent{0}

            ; y position of line
            set CUR_y_line      0
                
            ; x position of line
            set CUR_x_line                                  \
                par_tcp_gen_folder_icon_collapse==2         \
                    + CUR_x * 0.5 VAL_Button_Folder{0}      \
                    + CUR_x * 0.4 VAL_Button_Folder{0}
            
            ; line width
            set CUR_w_line                                  \
                par_tcp_gen_folder_icon_collapse==1         \
                    - CUR_w * 0.6 VAL_Button_Folder{0}      \
                    - CUR_w * 0.5 VAL_Button_Folder{0}
            
            ; line height
            set CUR_h_line  - WALTER_ELEMENT##.size{1} VAL_Unit{0}
                
            ; [DRAW] child track line
            set WALTER_ELEMENT##.custom.folder_child                                                \
                par_tcp_gen_folder_icon_collapse==2                                                 \
                    ?VAL_tcp_h_level{0}                                                             \
                        folderdepth>0                                                               \
                            folderstate>=0                                                          \
                                [CUR_x_line{0} CUR_y_line{0} CUR_w_line{0} CUR_h_line{0} 0 0 0 1]   \
                                0                                                                   \
                            0                                                                       \
                        0                                                                           \
                    0
            
            ; update z order
            front WALTER_ELEMENT##.custom.folder_child


        endmacro


    ;   ## Draw : ENVCP : Font
    ; --------------------------------------------------------------------------------

        macro MAC_DrawEnvcp_Font SCALE WALTER_ELEMENT PARAMETER_SECTION

            ; name label
            set WALTER_ELEMENT##.label.font     VAL_Font_Label
            set WALTER_ELEMENT##.label.margin   [VAL_tcp_envcp_label_margin{0}      VAL_Margin_Label{1}             VAL_Margin_Label{2}             VAL_Margin_Label{3} 0 0 0 0]
            set WALTER_ELEMENT##.label.color    [VAL_Color_Envcp_Label_Text{0}      VAL_Color_Envcp_Label_Text{1}   VAL_Color_Envcp_Label_Text{2}   .                   . . . .]

            ; readout value
            set WALTER_ELEMENT##.value.font     VAL_Font_Label
            set WALTER_ELEMENT##.value.margin   [VAL_readout_margin{0}          0                               VAL_readout_margin{0}               0]
            set WALTER_ELEMENT##.value.color    [VAL_Color_Envcp_Readout{0}     VAL_Color_Envcp_Readout{1}      VAL_Color_Envcp_Readout{2}          .                   . . . .]

        endmacro

; ====================================================================================================================================
;   # GLOBAL
; ====================================================================================================================================

    ; Here's where the main process of the layouting starts.
    ; Everything above this code is just macros triggered from here on.

    ;   ## Draw
    ; --------------------------------------------------------------------------------

        ; This is the main drawing process, triggerd once per scaling factor

        macro MAC_Draw     SCALE
            
            ; Preparation of core variables
            MAC_Setup           SCALE
            
            ; Transport Section
            MAC_DrawTransport   SCALE
            
            ; TCP [Master / Track / Envelope Lane]
            MAC_DrawTcp         SCALE
            
            ; MCP [Master / Track]
            MAC_DrawMcp         SCALE
        endmacro

    ;   ## Settings
    ; --------------------------------------------------------------------------------

;THEMEBUILDER_INSERT_ZEROLINE
;~ ~ ~ ~ ~ ~ ~ ~ ~ ~ THEME_BLOCK ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ 

tcp_vol_zeroline 80000000
tcp_pan_zeroline 80000000
mcp_vol_zeroline 80000000
mcp_pan_zeroline 80000000
trans_speed_zeroline A0000000
gen_vol_zeroline 40000000
gen_pan_zeroline 40000000
item_volknobfg 00000000 00000000 00000000
;~ ~ ~ ~ ~ ~ ~ ~ ~ ~ THEME_BLOCK_CLOSE ~ ~ ~ ~ ~ ~ ~ ~ ~ ~ 

        ; general
        version 7
        use_pngs 1
        use_overlays 0
        global_scale 1.0

        ; tinting
        tinttcp 1980
        peaksedges 0

        ; warnings (set to be highly sensitive)
        warnings pedantic

        ; record label
        no_meter_reclbl 1

        ; borders
        tcp_showborders 0
        mcp_showborders 0
        transport_showborders 0

        ; peak indicators
        tcp_vupeakwidth 2

        mcp_vupeakheight 2
        mcp_mastervupeakheight 2

        ; folder indentation
        tcp_folderindent 0

        ; heights
        mcp_min_height 50
        tcp_heights 8 19 50 100
        tcp_master_minheight 19
        envcp_min_height 19

        ; volume readout label
        tcp_voltext_flags 9
        tcp_master_voltext_flags 9
        mcp_voltext_flags 3
        mcp_master_voltext_flags 9

        ; deprecated
        mcp_altmeterpos 0



    ;LAYOUT_BLOCK
    ;   ## DPI translation
    ; --------------------------------------------------------------------------------

        ; non-WALTER dpi translation
        misc_dpi_translate  125     125
        misc_dpi_translate  150     150
        misc_dpi_translate  175     175
        misc_dpi_translate  200     200
        misc_dpi_translate  225     225
        misc_dpi_translate  250     250

        ; WALTR dpi translation
        layout_dpi_translate    ''  1.25    '125'
        layout_dpi_translate    ''  1.5     '150'
        layout_dpi_translate    ''  1.75    '175'
        layout_dpi_translate    ''  2.0     '200'
        layout_dpi_translate    ''  2.25    '225'
        layout_dpi_translate    ''  2.5     '250'

    ;   ## Layouts
    ; --------------------------------------------------------------------------------

        MAC_Draw            1.0

        ; Layout 100
        Layout '100' ''
            MAC_Draw            1.0
        endLayout

        ; Layout 125
        Layout '125' '125'
            MAC_Draw           1.25
        endLayout

        ; Layout 150
        Layout '150' '150'
            MAC_Draw           1.5
        endLayout

        ; Layout 175
        Layout '175' '175'
            MAC_Draw           1.75
        endLayout

        ; Layout 200
        Layout '200' '200'
            MAC_Draw           2.0
        endLayout

        ; Layout 225
        Layout '225' '225'
            MAC_Draw           2.25
        endLayout

        ; Layout 250
        Layout '250' '250'
            MAC_Draw           2.5
        endLayout

        ; global layouts
        GlobalLayout '100'
        GlobalLayout '125'
        GlobalLayout '150'
        GlobalLayout '175'
        GlobalLayout '200'
        GlobalLayout '225'
        GlobalLayout '250'
;LAYOUT_BLOCK_END
